import{S as te,i as se,s as ae,a3 as re,Y as S,Z as V,e as R,j as z,k as O,t as oe,c as E,a as F,m as q,n as G,g as le,d as C,b as P,f as ie,o as H,H as k,I as K,J as ne,_ as A,x as Y,u as B,v as J,L as ue,M as fe,A as ce,a6 as de}from"./vendor-9a64f523.js";import{s as me}from"./stores-bd9665ba.js";import{C as ge}from"./checkPlayerHasProfile-b1851115.js";import{F as pe}from"./form-272bebbb.js";import{R as be}from"./resultFeedback-6bde5315.js";import{g as _e,c as he}from"./helper-d6a45b8d.js";import{g as ye}from"./navigation-51f4a605.js";const{setTimeout:Q}=de;function ke(r){let _=!1,a=()=>{_=!1},d,o,i,g,w,n,u,s,f,c,T,j,h,y,e,p,b,m,D,L;re(r[7]);function x(t){r[8](t)}let N={};r[4]!==void 0&&(N.alert=r[4]),i=new be({props:N}),S.push(()=>V(i,"alert",x));function $(t){r[9](t)}let U={};r[2]!==void 0&&(U.hasCurriculumProfile=r[2]),n=new ge({props:U}),S.push(()=>V(n,"hasCurriculumProfile",$));function ee(t){r[10](t)}let X={};return r[3]!==void 0&&(X.goal=r[3]),c=new pe({props:X}),S.push(()=>V(c,"goal",ee)),{c(){o=R("div"),z(i.$$.fragment),w=O(),z(n.$$.fragment),s=O(),f=R("form"),z(c.$$.fragment),j=O(),h=R("div"),y=R("div"),e=R("button"),p=oe("Leerdoel publiseren"),this.h()},l(t){o=E(t,"DIV",{});var l=F(o);q(i.$$.fragment,l),w=G(l),q(n.$$.fragment,l),s=G(l),f=E(l,"FORM",{class:!0});var v=F(f);q(c.$$.fragment,v),j=G(v),h=E(v,"DIV",{class:!0});var I=F(h);y=E(I,"DIV",{class:!0});var M=F(y);e=E(M,"BUTTON",{"data-cy":!0,type:!0,class:!0});var Z=F(e);p=le(Z,"Leerdoel publiseren"),Z.forEach(C),M.forEach(C),I.forEach(C),v.forEach(C),l.forEach(C),this.h()},h(){P(e,"data-cy","create-goal-submit-button"),e.disabled=b=r[1]||!r[2],P(e,"type","submit"),P(e,"class","float-right disabled:opacity-50 ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"),P(y,"class","flex justify-end"),P(h,"class","pt-5"),P(f,"class","mt-8 space-y-8 divide-y divide-gray-200")},m(t,l){ie(t,o,l),H(i,o,null),k(o,w),H(n,o,null),k(o,s),k(o,f),H(c,f,null),k(f,j),k(f,h),k(h,y),k(y,e),k(e,p),m=!0,D||(L=[K(window,"scroll",()=>{_=!0,clearTimeout(d),d=Q(a,100),r[7]()}),K(f,"submit",ne(r[5]))],D=!0)},p(t,[l]){l&1&&!_&&(_=!0,clearTimeout(d),scrollTo(window.pageXOffset,t[0]),d=Q(a,100));const v={};!g&&l&16&&(g=!0,v.alert=t[4],A(()=>g=!1)),i.$set(v);const I={};!u&&l&4&&(u=!0,I.hasCurriculumProfile=t[2],A(()=>u=!1)),n.$set(I);const M={};!T&&l&8&&(T=!0,M.goal=t[3],A(()=>T=!1)),c.$set(M),(!m||l&6&&b!==(b=t[1]||!t[2]))&&(e.disabled=b)},i(t){m||(Y(i.$$.fragment,t),Y(n.$$.fragment,t),Y(c.$$.fragment,t),m=!0)},o(t){B(i.$$.fragment,t),B(n.$$.fragment,t),B(c.$$.fragment,t),m=!1},d(t){t&&C(o),J(i),J(n),J(c),D=!1,ue(L)}}}function W(){return{success:!1,successMessage:"",error:!1,errorCode:"",errorMessage:""}}function we(r,_,a){let d;fe(r,me,e=>a(13,d=e));let{firebase:o}=_,i,g,w=!1,n;ce(async()=>{g=await o.firestore()});let u={title:"",description:"",goalLinks:[],taxonomy_bloom:[],taxonomy_solo:[],unitopic:"",multitopics:[],context:"",selectedVerbs:[],fromText:"",battles:[]},s=W();async function f(){if(d.user){let e=_e(u,d.serverFirestoreTimeStamp);a(4,s=W());try{let p=await g.collection("talk").add({type:"goal"});e.talkId=p.id;let b=await g.collection("goals").add(e);for(let m=0;m<u.battles.length;m++){let D=g.doc("/goals/"+b.id+"/battles/"+u.battles[m].name),L={quizzes:u.battles[m].quizzes};await D.set(L)}e.authorId=d.player.curriculumProfileId,e.goalId=b.id,await he(g,u,e,d.user.uid,o),a(4,s.success=!0,s),a(4,s.successTitle="Leerdoel gemaakt",s),a(4,s.successMessage="id: "+b.id,s),await ye("/leerdoel/"+b.id)}catch(p){console.error("Error adding document: ",p),a(4,s.error=!0,s),a(4,s.errorCode=p.code,s),a(4,s.errorMessage=p.message,s)}a(0,i=0)}}async function c(e){a(1,w=!0),await f(),setTimeout(()=>{a(1,w=!1)},5e3)}function T(){a(0,i=window.pageYOffset)}function j(e){s=e,a(4,s)}function h(e){n=e,a(2,n)}function y(e){u=e,a(3,u)}return r.$$set=e=>{"firebase"in e&&a(6,o=e.firebase)},[i,w,n,u,s,c,o,T,j,h,y]}class Me extends te{constructor(_){super();se(this,_,we,ke,ae,{firebase:6})}}export{Me as C};
