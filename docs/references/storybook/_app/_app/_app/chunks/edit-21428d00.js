import{S as re,i as oe,s as ie,a3 as ne,j as q,k as H,e as G,t as fe,m as L,n as N,c as O,a as V,g as ue,d as C,b as B,o as Y,f as Z,H as P,I as $,J as ce,_ as A,x as D,u as T,v as J,l as ee,r as me,w as de,M as ge,Y as U,Z as X}from"./vendor-ef0a5b69.js";import{s as be}from"./stores-2d9a71bb.js";import{C as _e}from"./checkPlayerHasProfile-5552aa6e.js";import{F as pe}from"./form-bd5287f8.js";import{G as he}from"./goal-e580c954.js";import{R as we}from"./resultFeedback-cc00a4e5.js";import{g as ke,c as ye}from"./helper-d6a45b8d.js";function te(i){let n,s,d,f,u,g,p,t,l,o,r,_,E,I,k,y,b,F,a,h,c,w;function j(e){i[10](e)}let v={subSelected:"edit"};i[0]!==void 0&&(v.goal=i[0]),n=new he({props:v}),U.push(()=>X(n,"goal",j));function K(e){i[11](e)}let Q={};i[3]!==void 0&&(Q.alert=i[3]),u=new we({props:Q}),U.push(()=>X(u,"alert",K));function se(e){i[12](e)}let W={};i[1]!==void 0&&(W.hasCurriculumProfile=i[1]),t=new _e({props:W}),U.push(()=>X(t,"hasCurriculumProfile",se));function le(e){i[13](e)}let x={};return i[0]!==void 0&&(x.goal=i[0]),_=new pe({props:x}),U.push(()=>X(_,"goal",le)),{c(){q(n.$$.fragment),d=H(),f=G("div"),q(u.$$.fragment),p=H(),q(t.$$.fragment),o=H(),r=G("form"),q(_.$$.fragment),I=H(),k=G("div"),y=G("div"),b=G("button"),F=fe("Leerdoel publiseren"),this.h()},l(e){L(n.$$.fragment,e),d=N(e),f=O(e,"DIV",{class:!0});var m=V(f);L(u.$$.fragment,m),p=N(m),L(t.$$.fragment,m),o=N(m),r=O(m,"FORM",{class:!0});var R=V(r);L(_.$$.fragment,R),I=N(R),k=O(R,"DIV",{class:!0});var M=V(k);y=O(M,"DIV",{class:!0});var S=V(y);b=O(S,"BUTTON",{"data-cy":!0,type:!0,class:!0});var z=V(b);F=ue(z,"Leerdoel publiseren"),z.forEach(C),S.forEach(C),M.forEach(C),R.forEach(C),m.forEach(C),this.h()},h(){b.disabled=a=!i[1],B(b,"data-cy","edit-goal-submit-button"),B(b,"type","submit"),B(b,"class","float-right disabled:opacity-50 ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"),B(y,"class","flex justify-end"),B(k,"class","pt-5"),B(r,"class","space-y-8 divide-y divide-gray-200"),B(f,"class","mt-8")},m(e,m){Y(n,e,m),Z(e,d,m),Z(e,f,m),Y(u,f,null),P(f,p),Y(t,f,null),P(f,o),P(f,r),Y(_,r,null),P(r,I),P(r,k),P(k,y),P(y,b),P(b,F),h=!0,c||(w=$(r,"submit",ce(i[4])),c=!0)},p(e,m){const R={};!s&&m&1&&(s=!0,R.goal=e[0],A(()=>s=!1)),n.$set(R);const M={};!g&&m&8&&(g=!0,M.alert=e[3],A(()=>g=!1)),u.$set(M);const S={};!l&&m&2&&(l=!0,S.hasCurriculumProfile=e[1],A(()=>l=!1)),t.$set(S);const z={};!E&&m&1&&(E=!0,z.goal=e[0],A(()=>E=!1)),_.$set(z),(!h||m&2&&a!==(a=!e[1]))&&(b.disabled=a)},i(e){h||(D(n.$$.fragment,e),D(u.$$.fragment,e),D(t.$$.fragment,e),D(_.$$.fragment,e),h=!0)},o(e){T(n.$$.fragment,e),T(u.$$.fragment,e),T(t.$$.fragment,e),T(_.$$.fragment,e),h=!1},d(e){J(n,e),e&&C(d),e&&C(f),J(u),J(t),J(_),c=!1,w()}}}function ve(i){let n=!1,s=()=>{n=!1},d,f,u,g,p;ne(i[9]);let t=i[0]&&te(i);return{c(){t&&t.c(),f=ee()},l(l){t&&t.l(l),f=ee()},m(l,o){t&&t.m(l,o),Z(l,f,o),u=!0,g||(p=$(window,"scroll",()=>{n=!0,clearTimeout(d),d=setTimeout(s,100),i[9]()}),g=!0)},p(l,[o]){o&4&&!n&&(n=!0,clearTimeout(d),scrollTo(window.pageXOffset,l[2]),d=setTimeout(s,100)),l[0]?t?(t.p(l,o),o&1&&D(t,1)):(t=te(l),t.c(),D(t,1),t.m(f.parentNode,f)):t&&(me(),T(t,1,1,()=>{t=null}),de())},i(l){u||(D(t),u=!0)},o(l){T(t),u=!1},d(l){t&&t.d(l),l&&C(f),g=!1,p()}}}function ae(){return{success:!1,successMessage:"",error:!1,errorCode:"",errorMessage:""}}function Ce(i,n,s){let d;ge(i,be,a=>s(14,d=a));let{battleCol:f}=n,{firebase:u}=n,{previousBattles:g=[]}=n,p,t,{goalRef:l}=n,{goal:o}=n,r=ae();async function _(){const a=await u.firestore();let h=ke(o,d.serverFirestoreTimeStamp);s(3,r=ae());try{await l.update(h);for(let c=0;c<o.battles.length;c++){let w=a.doc("/goals/"+l.id+"/battles/"+o.battles[c].name),j={quizzes:o.battles[c].quizzes};(await w.get()).exists?await w.update(j):await w.set(j)}for(let c=0;c<g.length;c++){let w=g[c],j=!0;for(let v=0;v<o.battles.length;v++)o.battles[v].name===w.name&&(j=!1);j&&await a.doc("/goals/"+l.id+"/battles/"+w.name).delete()}h.authorId=d.player.curriculumProfileId,h.goalId=l.id,await ye(a,o,h,d.user.uid,u),s(3,r.success=!0,r),s(3,r.successTitle="Leerdoel gewijzigd",r),s(3,r.successMessage="id: "+l.id,r)}catch(c){console.error("Error adding document: ",c),s(3,r.error=!0,r),s(3,r.errorCode=c.code,r),s(3,r.errorMessage=c.message,r)}s(2,t=0)}async function E(a){await _()}function I(){s(2,t=window.pageYOffset)}function k(a){o=a,s(0,o)}function y(a){r=a,s(3,r)}function b(a){p=a,s(1,p)}function F(a){o=a,s(0,o)}return i.$$set=a=>{"battleCol"in a&&s(5,f=a.battleCol),"firebase"in a&&s(6,u=a.firebase),"previousBattles"in a&&s(7,g=a.previousBattles),"goalRef"in a&&s(8,l=a.goalRef),"goal"in a&&s(0,o=a.goal)},[o,p,t,r,E,f,u,g,l,I,k,y,b,F]}class Ie extends re{constructor(n){super();oe(this,n,Ce,ve,ie,{battleCol:5,firebase:6,previousBattles:7,goalRef:8,goal:0})}}export{Ie as E};
