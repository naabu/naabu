import{_ as k,a as z,g as mi,b as m,i as Fh,c as v,d as Mh,e as Vh,h as Uh,j as qh,k as jh,l as Bh,m as H,n as Kh,L as Gh,o as xe,C as Qh,f as $h}from"./index.esm-61ff5ac9.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wi=function(e,t){return wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},wi(e,t)};function zh(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");wi(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function Is(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var Hh=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},S,bi=bi||{},R=Hh||self;function sr(){}function Ti(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function pn(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function Wh(e){return Object.prototype.hasOwnProperty.call(e,Ii)&&e[Ii]||(e[Ii]=++Yh)}var Ii="closure_uid_"+(1e9*Math.random()>>>0),Yh=0;function Xh(e,t,n){return e.call.apply(e.bind,arguments)}function Jh(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function ot(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ot=Xh:ot=Jh,ot.apply(null,arguments)}function ur(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function st(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(r,i,o){for(var s=Array(arguments.length-2),u=2;u<arguments.length;u++)s[u-2]=arguments[u];return t.prototype[i].apply(r,s)}}function Ht(){this.s=this.s,this.o=this.o}var Zh=0,tl={};Ht.prototype.s=!1;Ht.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),Zh!=0)){var e=Wh(this);delete tl[e]}};Ht.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Es=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},_s=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=typeof e=="string"?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function el(e){t:{for(var t=$l,n=e.length,r=typeof e=="string"?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break t}t=-1}return 0>t?null:typeof e=="string"?e.charAt(t):e[t]}function Ss(e){return Array.prototype.concat.apply([],arguments)}function Ei(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function ar(e){return/^[\s\xa0]*$/.test(e)}var Ds=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function gt(e,t){return e.indexOf(t)!=-1}function _i(e,t){return e<t?-1:e>t?1:0}var vt;t:{var Ns=R.navigator;if(Ns){var As=Ns.userAgent;if(As){vt=As;break t}}vt=""}function Si(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Cs(e){var t={};for(var n in e)t[n]=e[n];return t}var ks="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xs(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var o=0;o<ks.length;o++)n=ks[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Di(e){return Di[" "](e),e}Di[" "]=sr;function nl(e){var t=ol;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}var rl=gt(vt,"Opera"),Re=gt(vt,"Trident")||gt(vt,"MSIE"),Rs=gt(vt,"Edge"),Ni=Rs||Re,Ls=gt(vt,"Gecko")&&!(gt(vt.toLowerCase(),"webkit")&&!gt(vt,"Edge"))&&!(gt(vt,"Trident")||gt(vt,"MSIE"))&&!gt(vt,"Edge"),il=gt(vt.toLowerCase(),"webkit")&&!gt(vt,"Edge");function Os(){var e=R.document;return e?e.documentMode:void 0}var cr;t:{var Ai="",Ci=function(){var e=vt;if(Ls)return/rv:([^\);]+)(\)|;)/.exec(e);if(Rs)return/Edge\/([\d\.]+)/.exec(e);if(Re)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(il)return/WebKit\/(\S+)/.exec(e);if(rl)return/(?:Version)[ \/]?(\S+)/.exec(e)}();if(Ci&&(Ai=Ci?Ci[1]:""),Re){var ki=Os();if(ki!=null&&ki>parseFloat(Ai)){cr=String(ki);break t}}cr=Ai}var ol={};function sl(){return nl(function(){for(var e=0,t=Ds(String(cr)).split("."),n=Ds("9").split("."),r=Math.max(t.length,n.length),i=0;e==0&&i<r;i++){var o=t[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o[0].length==0&&s[0].length==0)break;e=_i(o[1].length==0?0:parseInt(o[1],10),s[1].length==0?0:parseInt(s[1],10))||_i(o[2].length==0,s[2].length==0)||_i(o[2],s[2]),o=o[3],s=s[3]}while(e==0)}return 0<=e})}var xi;if(R.document&&Re){var Ps=Os();xi=Ps||parseInt(cr,10)||void 0}else xi=void 0;var ul=xi,al=function(){if(!R.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{R.addEventListener("test",sr,t),R.removeEventListener("test",sr,t)}catch{}return e}();function lt(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}lt.prototype.h=function(){this.defaultPrevented=!0};function yn(e,t){if(lt.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Ls){t:{try{Di(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:cl[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&yn.Z.h.call(this)}}st(yn,lt);var cl={2:"touch",3:"pen",4:"mouse"};yn.prototype.h=function(){yn.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var gn="closure_listenable_"+(1e6*Math.random()|0),hl=0;function ll(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++hl,this.ca=this.fa=!1}function hr(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function lr(e){this.src=e,this.g={},this.h=0}lr.prototype.add=function(e,t,n,r,i){var o=e.toString();e=this.g[o],e||(e=this.g[o]=[],this.h++);var s=Li(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):(t=new ll(t,this.src,o,!!r,i),t.fa=n,e.push(t)),t};function Ri(e,t){var n=t.type;if(n in e.g){var r=e.g[n],i=Es(r,t),o;(o=0<=i)&&Array.prototype.splice.call(r,i,1),o&&(hr(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function Li(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.ca&&o.listener==t&&o.capture==!!n&&o.ia==r)return i}return-1}var Oi="closure_lm_"+(1e6*Math.random()|0),Pi={};function Fs(e,t,n,r,i){if(r&&r.once)return Vs(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)Fs(e,t[o],n,r,i);return null}return n=Ui(n),e&&e[gn]?e.N(t,n,pn(r)?!!r.capture:!!r,i):Ms(e,t,n,!1,r,i)}function Ms(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var s=pn(i)?!!i.capture:!!i,u=Mi(e);if(u||(e[Oi]=u=new lr(e)),n=u.add(t,n,r,s,o),n.proxy)return n;if(r=fl(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)al||(i=s),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(qs(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function fl(){function e(n){return t.call(e.src,e.listener,n)}var t=dl;return e}function Vs(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)Vs(e,t[o],n,r,i);return null}return n=Ui(n),e&&e[gn]?e.O(t,n,pn(r)?!!r.capture:!!r,i):Ms(e,t,n,!0,r,i)}function Us(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)Us(e,t[o],n,r,i);else r=pn(r)?!!r.capture:!!r,n=Ui(n),e&&e[gn]?(e=e.i,t=String(t).toString(),t in e.g&&(o=e.g[t],n=Li(o,n,r,i),-1<n&&(hr(o[n]),Array.prototype.splice.call(o,n,1),o.length==0&&(delete e.g[t],e.h--)))):e&&(e=Mi(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Li(t,n,r,i)),(n=-1<e?t[e]:null)&&Fi(n))}function Fi(e){if(typeof e!="number"&&e&&!e.ca){var t=e.src;if(t&&t[gn])Ri(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(qs(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Mi(t))?(Ri(n,e),n.h==0&&(n.src=null,t[Oi]=null)):hr(e)}}}function qs(e){return e in Pi?Pi[e]:Pi[e]="on"+e}function dl(e,t){if(e.ca)e=!0;else{t=new yn(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Fi(e),e=n.call(r,t)}return e}function Mi(e){return e=e[Oi],e instanceof lr?e:null}var Vi="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ui(e){return typeof e=="function"?e:(e[Vi]||(e[Vi]=function(t){return e.handleEvent(t)}),e[Vi])}function tt(){Ht.call(this),this.i=new lr(this),this.P=this,this.I=null}st(tt,Ht);tt.prototype[gn]=!0;tt.prototype.removeEventListener=function(e,t,n,r){Us(this,e,t,n,r)};function ut(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,typeof t=="string")t=new lt(t,e);else if(t instanceof lt)t.target=t.target||e;else{var i=t;t=new lt(r,e),xs(t,i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.g=n[o];i=fr(s,r,!0,t)&&i}if(s=t.g=e,i=fr(s,r,!0,t)&&i,i=fr(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)s=t.g=n[o],i=fr(s,r,!1,t)&&i}tt.prototype.M=function(){if(tt.Z.M.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)hr(n[r]);delete e.g[t],e.h--}}this.I=null};tt.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};tt.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function fr(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.ca&&s.capture==n){var u=s.listener,a=s.ia||s.src;s.fa&&Ri(e.i,s),i=u.call(a,r)!==!1&&i}}return i&&!r.defaultPrevented}var qi=R.JSON.stringify;function pl(){var e=Bs,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var yl=function(){function e(){this.h=this.g=null}return e.prototype.add=function(t,n){var r=js.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r},e}(),js=new(function(){function e(t,n){this.i=t,this.j=n,this.h=0,this.g=null}return e.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},e}())(function(){return new gl},function(e){return e.reset()}),gl=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(t,n){this.h=t,this.g=n,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function vl(e){R.setTimeout(function(){throw e},0)}function ji(e,t){Bi||ml(),Ki||(Bi(),Ki=!0),Bs.add(e,t)}var Bi;function ml(){var e=R.Promise.resolve(void 0);Bi=function(){e.then(wl)}}var Ki=!1,Bs=new yl;function wl(){for(var e;e=pl();){try{e.h.call(e.g)}catch(n){vl(n)}var t=js;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ki=!1}function dr(e,t){tt.call(this),this.h=e||1,this.g=t||R,this.j=ot(this.kb,this),this.l=Date.now()}st(dr,tt);S=dr.prototype;S.da=!1;S.S=null;S.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ut(this,"tick"),this.da&&(Gi(this),this.start()))}};S.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Gi(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}S.M=function(){dr.Z.M.call(this),Gi(this),delete this.g};function Qi(e,t,n){if(typeof e=="function")n&&(e=ot(e,n));else if(e&&typeof e.handleEvent=="function")e=ot(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:R.setTimeout(e,t||0)}function Ks(e){e.g=Qi(function(){e.g=null,e.i&&(e.i=!1,Ks(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}var bl=function(e){zh(t,e);function t(n,r){var i=e.call(this)||this;return i.m=n,i.j=r,i.h=null,i.i=!1,i.g=null,i}return t.prototype.l=function(n){this.h=arguments,this.g?this.i=!0:Ks(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(R.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(Ht);function vn(e){Ht.call(this),this.h=e,this.g={}}st(vn,Ht);var Gs=[];function Qs(e,t,n,r){Array.isArray(n)||(n&&(Gs[0]=n.toString()),n=Gs);for(var i=0;i<n.length;i++){var o=Fs(t,n[i],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}}function $s(e){Si(e.g,function(t,n){this.g.hasOwnProperty(n)&&Fi(t)},e),e.g={}}vn.prototype.M=function(){vn.Z.M.call(this),$s(this)};vn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function pr(){this.g=!0}pr.prototype.Aa=function(){this.g=!1};function Tl(e,t,n,r,i,o){e.info(function(){if(e.g)if(o)for(var s="",u=o.split("&"),a=0;a<u.length;a++){var c=u[a].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&l[1]=="type"?s+(h+"="+c+"&"):s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+n+`
`+s})}function Il(e,t,n,r,i,o,s){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+n+`
`+o+" "+s})}function Le(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+_l(e,n)+(r?" "+r:"")})}function El(e,t){e.info(function(){return"TIMEOUT: "+t})}pr.prototype.info=function(){};function _l(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if(o!="noop"&&o!="stop"&&o!="close")for(var s=1;s<i.length;s++)i[s]=""}}}}return qi(n)}catch{return t}}var ce={},zs=null;function yr(){return zs=zs||new tt}ce.Ma="serverreachability";function Hs(e){lt.call(this,ce.Ma,e)}st(Hs,lt);function mn(e){var t=yr();ut(t,new Hs(t,e))}ce.STAT_EVENT="statevent";function Ws(e,t){lt.call(this,ce.STAT_EVENT,e),this.stat=t}st(Ws,lt);function mt(e){var t=yr();ut(t,new Ws(t,e))}ce.Na="timingevent";function Ys(e,t){lt.call(this,ce.Na,e),this.size=t}st(Ys,lt);function wn(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){e()},t)}var gr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Xs={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function $i(){}$i.prototype.h=null;function Js(e){return e.h||(e.h=e.i())}function Zs(){}var bn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function zi(){lt.call(this,"d")}st(zi,lt);function Hi(){lt.call(this,"c")}st(Hi,lt);var Wi;function vr(){}st(vr,$i);vr.prototype.g=function(){return new XMLHttpRequest};vr.prototype.i=function(){return{}};Wi=new vr;function Tn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new vn(this),this.P=Sl,e=Ni?125:void 0,this.W=new dr(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new tu}function tu(){this.i=null,this.g="",this.h=!1}var Sl=45e3,Yi={},mr={};S=Tn.prototype;S.setTimeout=function(e){this.P=e};function Xi(e,t,n){e.K=1,e.v=Er(jt(t)),e.s=n,e.U=!0,eu(e,null)}function eu(e,t){e.F=Date.now(),In(e),e.A=jt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),hu(n.h,"t",r),e.C=0,n=e.l.H,e.h=new tu,e.g=Lu(e.l,n?t:null,!e.s),0<e.O&&(e.L=new bl(ot(e.Ia,e,e.g),e.O)),Qs(e.V,e.g,"readystatechange",e.gb),t=e.H?Cs(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),mn(1),Tl(e.j,e.u,e.A,e.m,e.X,e.s)}S.gb=function(e){e=e.target;var t=this.L;t&&Bt(e)==3?t.l():this.Ia(e)};S.Ia=function(e){try{if(e==this.g)t:{var t=Bt(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(t!=3||Ni||this.g&&(this.h.h||this.g.ga()||Iu(this.g)))){this.I||t!=4||n==7||(n==8||0>=r?mn(3):mn(2)),wr(this);var i=this.g.ba();this.N=i;e:if(nu(this)){var o=Iu(this.g);e="";var s=o.length,u=Bt(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){he(this),En(this);var a="";break e}this.h.i=new R.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(o[n],{stream:u&&n==s-1});o.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=i==200,Il(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ar(c)){var l=c;break e}}l=null}if(i=l)Le(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ji(this,i);else{this.i=!1,this.o=3,mt(12),he(this),En(this);break t}}this.U?(ru(this,t,a),Ni&&this.i&&t==3&&(Qs(this.V,this.W,"tick",this.fb),this.W.start())):(Le(this.j,this.m,a,null),Ji(this,a)),t==4&&he(this),this.i&&!this.I&&(t==4?Cu(this.l,this):(this.i=!1,In(this)))}else i==400&&0<a.indexOf("Unknown SID")?(this.o=3,mt(12)):(this.o=0,mt(13)),he(this),En(this)}}}catch{}finally{}};function nu(e){return e.g?e.u=="GET"&&e.K!=2&&e.l.Ba:!1}function ru(e,t,n){for(var r=!0,i;!e.I&&e.C<n.length;)if(i=Dl(e,n),i==mr){t==4&&(e.o=4,mt(14),r=!1),Le(e.j,e.m,null,"[Incomplete Response]");break}else if(i==Yi){e.o=4,mt(15),Le(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else Le(e.j,e.m,i,null),Ji(e,i);nu(e)&&i!=mr&&i!=Yi&&(e.h.g="",e.C=0),t!=4||n.length!=0||e.h.h||(e.o=1,mt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,t=e.l,t.g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),co(t),t.L=!0,mt(11))):(Le(e.j,e.m,n,"[Invalid Chunked Response]"),he(e),En(e))}S.fb=function(){if(this.g){var e=Bt(this.g),t=this.g.ga();this.C<t.length&&(wr(this),ru(this,e,t),this.i&&e!=4&&In(this))}};function Dl(e,t){var n=e.C,r=t.indexOf(`
`,n);return r==-1?mr:(n=Number(t.substring(n,r)),isNaN(n)?Yi:(r+=1,r+n>t.length?mr:(t=t.substr(r,n),e.C=r+n,t)))}S.cancel=function(){this.I=!0,he(this)};function In(e){e.Y=Date.now()+e.P,iu(e,e.P)}function iu(e,t){if(e.B!=null)throw Error("WatchDog timer not null");e.B=wn(ot(e.eb,e),t)}function wr(e){e.B&&(R.clearTimeout(e.B),e.B=null)}S.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(El(this.j,this.A),this.K!=2&&(mn(3),mt(17)),he(this),this.o=2,En(this)):iu(this,this.Y-e)};function En(e){e.l.G==0||e.I||Cu(e.l,e)}function he(e){wr(e);var t=e.L;t&&typeof t.na=="function"&&t.na(),e.L=null,Gi(e.W),$s(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Ji(e,t){try{var n=e.l;if(n.G!=0&&(n.g==e||eo(n.i,e))){if(n.I=e.N,!e.J&&eo(n.i,e)&&n.G==3){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0)t:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)Cr(n),Nr(n);else break t;ao(n),mt(18)}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&n.A==0&&!n.v&&(n.v=wn(ot(n.ab,n),6e3));if(1>=du(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else de(n,11)}else if((e.J||n.g==e)&&Cr(n),!ar(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var o=i[t];if(n.U=o[0],o=o[1],n.G==2)if(o[0]=="c"){n.J=o[1],n.la=o[2];var s=o[3];s!=null&&(n.ma=s,n.h.info("VER="+n.ma));var u=o[4];u!=null&&(n.za=u,n.h.info("SVER="+n.za));var a=o[5];a!=null&&typeof a=="number"&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(gt(h,"spdy")||gt(h,"quic")||gt(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(no(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,K(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms")),r=n;var p=e;if(r.oa=Ru(r,r.H?r.la:null,r.W),p.J){pu(r.i,p);var d=p,g=r.K;g&&d.setTimeout(g),d.B&&(wr(d),In(d)),r.g=p}else Nu(r);0<n.l.length&&Ar(n)}else o[0]!="stop"&&o[0]!="close"||de(n,7);else n.G==3&&(o[0]=="stop"||o[0]=="close"?o[0]=="stop"?de(n,7):so(n):o[0]!="noop"&&n.j&&n.j.wa(o),n.A=0)}}mn(4)}catch{}}function Nl(e){if(e.R&&typeof e.R=="function")return e.R();if(typeof e=="string")return e.split("");if(Ti(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function Zi(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(Ti(e)||typeof e=="string")_s(e,t,void 0);else{if(e.T&&typeof e.T=="function")var n=e.T();else if(e.R&&typeof e.R=="function")n=void 0;else if(Ti(e)||typeof e=="string"){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=Nl(e),i=r.length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Oe(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Oe)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}S=Oe.prototype;S.R=function(){to(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e};S.T=function(){return to(this),this.g.concat()};function to(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];le(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)r=e.g[t],le(i,r)||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}S.get=function(e,t){return le(this.h,e)?this.h[e]:t};S.set=function(e,t){le(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t};S.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};function le(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var ou=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Al(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function fe(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof fe){this.g=t!==void 0?t:e.g,br(this,e.j),this.s=e.s,Tr(this,e.i),Ir(this,e.m),this.l=e.l,t=e.h;var n=new Dn;n.i=t.i,t.g&&(n.g=new Oe(t.g),n.h=t.h),su(this,n),this.o=e.o}else e&&(n=String(e).match(ou))?(this.g=!!t,br(this,n[1]||"",!0),this.s=_n(n[2]||""),Tr(this,n[3]||"",!0),Ir(this,n[4]),this.l=_n(n[5]||"",!0),su(this,n[6]||"",!0),this.o=_n(n[7]||"")):(this.g=!!t,this.h=new Dn(null,this.g))}fe.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Sn(t,uu,!0),":");var n=this.i;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(Sn(t,uu,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.i&&n.charAt(0)!="/"&&e.push("/"),e.push(Sn(n,n.charAt(0)=="/"?Ll:Rl,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Sn(n,Pl)),e.join("")};function jt(e){return new fe(e)}function br(e,t,n){e.j=n?_n(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Tr(e,t,n){e.i=n?_n(t,!0):t}function Ir(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function su(e,t,n){t instanceof Dn?(e.h=t,Fl(e.h,e.g)):(n||(t=Sn(t,Ol)),e.h=new Dn(t,e.g))}function K(e,t,n){e.h.set(t,n)}function Er(e){return K(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Cl(e){return e instanceof fe?jt(e):new fe(e,void 0)}function kl(e,t,n,r){var i=new fe(null,void 0);return e&&br(i,e),t&&Tr(i,t),n&&Ir(i,n),r&&(i.l=r),i}function _n(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Sn(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,xl),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function xl(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var uu=/[#\/\?@]/g,Rl=/[#\?:]/g,Ll=/[#\?]/g,Ol=/[#\?@]/g,Pl=/#/g;function Dn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Wt(e){e.g||(e.g=new Oe,e.h=0,e.i&&Al(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}S=Dn.prototype;S.add=function(e,t){Wt(this),this.i=null,e=Pe(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function au(e,t){Wt(e),t=Pe(e,t),le(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,e=e.g,le(e.h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&to(e)))}function cu(e,t){return Wt(e),t=Pe(e,t),le(e.g.h,t)}S.forEach=function(e,t){Wt(this),this.g.forEach(function(n,r){_s(n,function(i){e.call(t,i,r,this)},this)},this)};S.T=function(){Wt(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n};S.R=function(e){Wt(this);var t=[];if(typeof e=="string")cu(this,e)&&(t=Ss(t,this.g.get(Pe(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Ss(t,e[n])}return t};S.set=function(e,t){return Wt(this),this.i=null,e=Pe(this,e),cu(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};S.get=function(e,t){return e?(e=this.R(e),0<e.length?String(e[0]):t):t};function hu(e,t,n){au(e,t),0<n.length&&(e.i=null,e.g.set(Pe(e,t),Ei(n)),e.h+=n.length)}S.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;r[o]!==""&&(s+="="+encodeURIComponent(String(r[o]))),e.push(s)}}return this.i=e.join("&")};function Pe(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Fl(e,t){t&&!e.j&&(Wt(e),e.i=null,e.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(au(this,r),hu(this,i,n))},e)),e.j=t}var Ml=function(){function e(t,n){this.h=t,this.g=n}return e}();function lu(e){this.l=e||Vl,R.PerformanceNavigationTiming?(e=R.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(R.g&&R.g.Ea&&R.g.Ea()&&R.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Vl=10;function fu(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function du(e){return e.h?1:e.g?e.g.size:0}function eo(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function no(e,t){e.g?e.g.add(t):e.h=t}function pu(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}lu.prototype.cancel=function(){var e,t;if(this.i=yu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){try{for(var n=Is(this.g.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.cancel()}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}};function yu(e){var t,n;if(e.h!=null)return e.i.concat(e.h.D);if(e.g!=null&&e.g.size!==0){var r=e.i;try{for(var i=Is(e.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}return Ei(e.i)}function ro(){}ro.prototype.stringify=function(e){return R.JSON.stringify(e,void 0)};ro.prototype.parse=function(e){return R.JSON.parse(e,void 0)};function Ul(){this.g=new ro}function ql(e,t,n){var r=n||"";try{Zi(e,function(i,o){var s=i;pn(i)&&(s=qi(i)),t.push(r+o+"="+encodeURIComponent(s))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function jl(e,t){var n=new pr;if(R.Image){var r=new Image;r.onload=ur(_r,n,r,"TestLoadImage: loaded",!0,t),r.onerror=ur(_r,n,r,"TestLoadImage: error",!1,t),r.onabort=ur(_r,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=ur(_r,n,r,"TestLoadImage: timeout",!1,t),R.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function _r(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function Nn(e){this.l=e.$b||null,this.j=e.ib||!1}st(Nn,$i);Nn.prototype.g=function(){return new Sr(this.l,this.j)};Nn.prototype.i=function(e){return function(){return e}}({});function Sr(e,t){tt.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=io,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}st(Sr,tt);var io=0;S=Sr.prototype;S.open=function(e,t){if(this.readyState!=io)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Cn(this)};S.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||R).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))};S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,An(this)),this.readyState=io};S.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Cn(this)),this.g&&(this.readyState=3,Cn(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof R.ReadableStream!="undefined"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gu(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))};function gu(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}S.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?An(this):Cn(this),this.readyState==3&&gu(this)}};S.Ua=function(e){this.g&&(this.response=this.responseText=e,An(this))};S.Ta=function(e){this.g&&(this.response=e,An(this))};S.ha=function(){this.g&&An(this)};function An(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Cn(e)}S.setRequestHeader=function(e,t){this.v.append(e,t)};S.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};S.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function Cn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(Sr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var Bl=R.JSON.parse;function W(e){tt.call(this),this.headers=new Oe,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=vu,this.K=this.L=!1}st(W,tt);var vu="",Kl=/^https?$/i,Gl=["POST","PUT"];S=W.prototype;S.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Wi.g(),this.C=this.u?Js(this.u):Js(Wi),this.g.onreadystatechange=ot(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(o){mu(this,o);return}e=n||"";var i=new Oe(this.headers);r&&Zi(r,function(o,s){i.set(s,o)}),r=el(i.T()),n=R.FormData&&e instanceof R.FormData,!(0<=Es(Gl,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(o,s){this.g.setRequestHeader(s,o)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Tu(this),0<this.B&&((this.K=Ql(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ot(this.pa,this)):this.A=Qi(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(o){mu(this,o)}};function Ql(e){return Re&&sl()&&typeof e.timeout=="number"&&e.ontimeout!==void 0}function $l(e){return e.toLowerCase()=="content-type"}S.pa=function(){typeof bi!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ut(this,"timeout"),this.abort(8))};function mu(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,wu(e),Dr(e)}function wu(e){e.D||(e.D=!0,ut(e,"complete"),ut(e,"error"))}S.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ut(this,"complete"),ut(this,"abort"),Dr(this))};S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Dr(this,!0)),W.Z.M.call(this)};S.Fa=function(){this.s||(this.F||this.v||this.l?bu(this):this.cb())};S.cb=function(){bu(this)};function bu(e){if(e.h&&typeof bi!="undefined"&&(!e.C[1]||Bt(e)!=4||e.ba()!=2)){if(e.v&&Bt(e)==4)Qi(e.Fa,0,e);else if(ut(e,"readystatechange"),Bt(e)==4){e.h=!1;try{var t=e.ba();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break t;default:n=!1}var r;if(!(r=n)){var i;if(i=t===0){var o=String(e.H).match(ou)[1]||null;if(!o&&R.self&&R.self.location){var s=R.self.location.protocol;o=s.substr(0,s.length-1)}i=!Kl.test(o?o.toLowerCase():"")}r=i}if(r)ut(e,"complete"),ut(e,"success");else{e.m=6;try{var u=2<Bt(e)?e.g.statusText:""}catch{u=""}e.j=u+" ["+e.ba()+"]",wu(e)}}finally{Dr(e)}}}}function Dr(e,t){if(e.g){Tu(e);var n=e.g,r=e.C[0]?sr:null;e.g=null,e.C=null,t||ut(e,"ready");try{n.onreadystatechange=r}catch{}}}function Tu(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(R.clearTimeout(e.A),e.A=null)}function Bt(e){return e.g?e.g.readyState:0}S.ba=function(){try{return 2<Bt(this)?this.g.status:-1}catch{return-1}};S.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};S.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),Bl(t)}};function Iu(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case vu:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}S.Da=function(){return this.m};S.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function zl(e){var t="";return Si(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function oo(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=zl(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):K(e,t,n))}function kn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Eu(e){this.za=0,this.l=[],this.h=new pr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=kn("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=kn("baseRetryDelayMs",5e3,e),this.$a=kn("retryDelaySeedMs",1e4,e),this.Ya=kn("forwardChannelMaxRetries",2,e),this.ra=kn("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new lu(e&&e.concurrentRequestLimit),this.Ca=new Ul,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||e.Xb!==!1}S=Eu.prototype;S.ma=8;S.G=1;function so(e){if(_u(e),e.G==3){var t=e.V++,n=jt(e.F);K(n,"SID",e.J),K(n,"RID",t),K(n,"TYPE","terminate"),xn(e,n),t=new Tn(e,e.h,t,void 0),t.K=2,t.v=Er(jt(n)),n=!1,R.navigator&&R.navigator.sendBeacon&&(n=R.navigator.sendBeacon(t.v.toString(),"")),!n&&R.Image&&(new Image().src=t.v,n=!0),n||(t.g=Lu(t.l,null),t.g.ea(t.v)),t.F=Date.now(),In(t)}xu(e)}S.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}};function Nr(e){e.g&&(co(e),e.g.cancel(),e.g=null)}function _u(e){Nr(e),e.u&&(R.clearTimeout(e.u),e.u=null),Cr(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&R.clearTimeout(e.m),e.m=null)}function uo(e,t){e.l.push(new Ml(e.Za++,t)),e.G==3&&Ar(e)}function Ar(e){fu(e.i)||e.m||(e.m=!0,ji(e.Ha,e),e.C=0)}function Hl(e,t){return du(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.l=t.D.concat(e.l),!0):e.G==1||e.G==2||e.C>=(e.Xa?0:e.Ya)?!1:(e.m=wn(ot(e.Ha,e,t),ku(e,e.C)),e.C++,!0)}S.Ha=function(e){if(this.m)if(this.m=null,this.G==1){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new Tn(this,this.h,e,void 0),n=this.s;if(this.P&&(n?(n=Cs(n),xs(n,this.P)):n=this.P),this.o===null&&(t.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){e:{var o=this.l[i];if("__data__"in o.g&&(o=o.g.__data__,typeof o=="string")){o=o.length;break e}o=void 0}if(o===void 0)break;if(r+=o,4096<r){r=i;break t}if(r===4096||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Du(this,t,r),i=jt(this.F),K(i,"RID",e),K(i,"CVER",22),this.D&&K(i,"X-HTTP-Session-Id",this.D),xn(this,i),this.o&&n&&oo(i,this.o,n),no(this.i,t),this.Ra&&K(i,"TYPE","init"),this.ja?(K(i,"$req",r),K(i,"SID","null"),t.$=!0,Xi(t,i,null)):Xi(t,i,r),this.G=2}}else this.G==3&&(e?Su(this,e):this.l.length==0||fu(this.i)||Su(this))};function Su(e,t){var n;t?n=t.m:n=e.V++;var r=jt(e.F);K(r,"SID",e.J),K(r,"RID",n),K(r,"AID",e.U),xn(e,r),e.o&&e.s&&oo(r,e.o,e.s),n=new Tn(e,e.h,n,e.C+1),e.o===null&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Du(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),no(e.i,n),Xi(n,r,t)}function xn(e,t){e.j&&Zi({},function(n,r){K(t,r,n)})}function Du(e,t,n){n=Math.min(e.l.length,n);var r=e.j?ot(e.j.Oa,e.j,e):null;t:for(var i=e.l,o=-1;;){var s=["count="+n];o==-1?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].h,h=i[a].g;if(c-=o,0>c)o=Math.max(0,i[a].h-100),u=!1;else try{ql(h,s,"req"+c+"_")}catch{r&&r(h)}}if(u){r=s.join("&");break t}}return e=e.l.splice(0,n),t.D=e,r}function Nu(e){e.g||e.u||(e.Y=1,ji(e.Ga,e),e.A=0)}function ao(e){return e.g||e.u||3<=e.A?!1:(e.Y++,e.u=wn(ot(e.Ga,e),ku(e,e.A)),e.A++,!0)}S.Ga=function(){if(this.u=null,Au(this),this.$&&!(this.L||this.g==null||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=wn(ot(this.bb,this),e)}};S.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,mt(10),Nr(this),Au(this))};function co(e){e.B!=null&&(R.clearTimeout(e.B),e.B=null)}function Au(e){e.g=new Tn(e,e.h,"rpc",e.Y),e.o===null&&(e.g.H=e.s),e.g.O=0;var t=jt(e.oa);K(t,"RID","rpc"),K(t,"SID",e.J),K(t,"CI",e.N?"0":"1"),K(t,"AID",e.U),xn(e,t),K(t,"TYPE","xmlhttp"),e.o&&e.s&&oo(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Er(jt(t)),n.s=null,n.U=!0,eu(n,e)}S.ab=function(){this.v!=null&&(this.v=null,Nr(this),ao(this),mt(19))};function Cr(e){e.v!=null&&(R.clearTimeout(e.v),e.v=null)}function Cu(e,t){var n=null;if(e.g==t){Cr(e),co(e),e.g=null;var r=2}else if(eo(e.i,t))n=t.D,pu(e.i,t),r=1;else return;if(e.I=t.N,e.G!=0){if(t.i)if(r==1){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;r=yr(),ut(r,new Ys(r,n,t,i)),Ar(e)}else Nu(e);else if(i=t.o,i==3||i==0&&0<e.I||!(r==1&&Hl(e,t)||r==2&&ao(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:de(e,5);break;case 4:de(e,10);break;case 3:de(e,6);break;default:de(e,2)}}}function ku(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function de(e,t){if(e.h.info("Error code "+t),t==2){var n=null;e.j&&(n=null);var r=ot(e.jb,e);n||(n=new fe("//www.google.com/images/cleardot.gif"),R.location&&R.location.protocol=="http"||br(n,"https"),Er(n)),jl(n.toString(),r)}else mt(2);e.G=0,e.j&&e.j.va(t),xu(e),_u(e)}S.jb=function(e){e?(this.h.info("Successfully pinged google.com"),mt(2)):(this.h.info("Failed to ping google.com"),mt(1))};function xu(e){e.G=0,e.I=-1,e.j&&((yu(e.i).length!=0||e.l.length!=0)&&(e.i.i.length=0,Ei(e.l),e.l.length=0),e.j.ua())}function Ru(e,t,n){var r=Cl(n);if(r.i!="")t&&Tr(r,t+"."+r.i),Ir(r,r.m);else{var i=R.location;r=kl(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&Si(e.aa,function(o,s){K(r,s,o)}),t=e.D,n=e.sa,t&&n&&K(r,t,n),K(r,"VER",e.ma),xn(e,r),r}function Lu(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return t=n&&e.Ba&&!e.qa?new W(new Nn({ib:!0})):new W(e.qa),t.L=e.H,t}function Ou(){}S=Ou.prototype;S.xa=function(){};S.wa=function(){};S.va=function(){};S.ua=function(){};S.Oa=function(){};function kr(){if(Re&&!(10<=Number(ul)))throw Error("Environmental error: no available transport.")}kr.prototype.g=function(e,t){return new St(e,t)};function St(e,t){tt.call(this),this.g=new Eu(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!ar(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!ar(t)&&(this.g.D=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new Fe(this)}st(St,tt);St.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),ji(ot(e.hb,e,t))),mt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=Ru(e,null,e.W),Ar(e)};St.prototype.close=function(){so(this.g)};St.prototype.u=function(e){if(typeof e=="string"){var t={};t.__data__=e,uo(this.g,t)}else this.v?(t={},t.__data__=qi(e),uo(this.g,t)):uo(this.g,e)};St.prototype.M=function(){this.g.j=null,delete this.j,so(this.g),delete this.g,St.Z.M.call(this)};function Pu(e){zi.call(this);var t=e.__sm__;if(t){t:{for(var n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}st(Pu,zi);function Fu(){Hi.call(this),this.status=1}st(Fu,Hi);function Fe(e){this.g=e}st(Fe,Ou);Fe.prototype.xa=function(){ut(this.g,"a")};Fe.prototype.wa=function(e){ut(this.g,new Pu(e))};Fe.prototype.va=function(e){ut(this.g,new Fu(e))};Fe.prototype.ua=function(){ut(this.g,"b")};kr.prototype.createWebChannel=kr.prototype.g;St.prototype.send=St.prototype.u;St.prototype.open=St.prototype.m;St.prototype.close=St.prototype.close;gr.NO_ERROR=0;gr.TIMEOUT=8;gr.HTTP_ERROR=6;Xs.COMPLETE="complete";Zs.EventType=bn;bn.OPEN="a";bn.CLOSE="b";bn.ERROR="c";bn.MESSAGE="d";tt.prototype.listen=tt.prototype.N;W.prototype.listenOnce=W.prototype.O;W.prototype.getLastError=W.prototype.La;W.prototype.getLastErrorCode=W.prototype.Da;W.prototype.getStatus=W.prototype.ba;W.prototype.getResponseJson=W.prototype.Qa;W.prototype.getResponseText=W.prototype.ga;W.prototype.send=W.prototype.ea;var Wl=function(){return new kr},Yl=function(){return yr()},ho=gr,Xl=Xs,Jl=ce,Mu={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Zl=Nn,xr=Zs,tf=W;/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt=function(){function e(t,n){var r=this;this.previousValue=t,n&&(n.sequenceNumberHandler=function(i){return r.t(i)},this.i=function(i){return n.writeSequenceNumber(i)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e}();Dt.o=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=function(e){function t(n,r){var i=this;return(i=e.call(this,r)||this).code=n,i.message=r,i.name="FirebaseError",i.toString=function(){return i.name+": [code="+i.code+"]: "+i.message},i}return k(t,e),t}(Error),Lt=new Gh("@firebase/firestore");function lo(){return Lt.logLevel}function I(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Lt.logLevel<=xe.DEBUG){var r=t.map(fo);Lt.debug.apply(Lt,z(["Firestore (8.10.0): "+e],r))}}function Y(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Lt.logLevel<=xe.ERROR){var r=t.map(fo);Lt.error.apply(Lt,z(["Firestore (8.10.0): "+e],r))}}function Rn(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Lt.logLevel<=xe.WARN){var r=t.map(fo);Lt.warn.apply(Lt,z(["Firestore (8.10.0): "+e],r))}}function fo(e){if(typeof e=="string")return e;try{return t=e,JSON.stringify(t)}catch{return e}var t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D(e){e===void 0&&(e="Unexpected state");var t="FIRESTORE (8.10.0) INTERNAL ASSERTION FAILED: "+e;throw Y(t),new Error(t)}function x(e,t){e||D()}function _(e,t){return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(e){var t=typeof self!="undefined"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vu=function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";r.length<20;)for(var i=ef(40),o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=t.charAt(i[o]%t.length));return r},e}();function P(e,t){return e<t?-1:e>t?1:0}function Me(e,t,n){return e.length===t.length&&e.every(function(r,i){return n(r,t[i])})}function Uu(e){return e+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt=function(){function e(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new w(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new w(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new w(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new w(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?P(this.nanoseconds,t.nanoseconds):P(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),L=function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new Tt(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qu(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function pe(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ju(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bu=function(){function e(t,n,r){n===void 0?n=0:n>t.length&&D(),r===void 0?r=t.length-n:r>t.length-n&&D(),this.segments=t,this.offset=n,this.len=r}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return e.comparator(this,t)===0},e.prototype.child=function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(r){n.push(r)}):n.push(t),this.construct(n)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return this.length===0},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.forEach=function(t){for(var n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,n){for(var r=Math.min(t.length,n.length),i=0;i<r;i++){var o=t.get(i),s=n.get(i);if(o<s)return-1;if(o>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0},e}(),V=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=[],o=0,s=n;o<s.length;o++){var u=s[o];if(u.indexOf("//")>=0)throw new w(y.INVALID_ARGUMENT,"Invalid segment ("+u+"). Paths must not contain // in them.");i.push.apply(i,u.split("/").filter(function(a){return a.length>0}))}return new t(i)},t.emptyPath=function(){return new t([])},t}(Bu),nf=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ot=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.isValidIdentifier=function(n){return nf.test(n)},t.prototype.canonicalString=function(){return this.toArray().map(function(n){return n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(n)||(n="`"+n+"`"),n}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return this.length===1&&this.get(0)==="__name__"},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(n){for(var r=[],i="",o=0,s=function(){if(i.length===0)throw new w(y.INVALID_ARGUMENT,"Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");r.push(i),i=""},u=!1;o<n.length;){var a=n[o];if(a==="\\"){if(o+1===n.length)throw new w(y.INVALID_ARGUMENT,"Path has trailing escape character: "+n);var c=n[o+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new w(y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);i+=c,o+=2}else a==="`"?(u=!u,o++):a!=="."||u?(i+=a,o++):(s(),o++)}if(s(),u)throw new w(y.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new t(r)},t.emptyPath=function(){return new t([])},t}(Bu),Ve=function(){function e(t){this.fields=t,t.sort(Ot.comparator)}return e.prototype.covers=function(t){for(var n=0,r=this.fields;n<r.length;n++)if(r[n].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return Me(this.fields,t.fields,function(n,r){return n.isEqual(r)})},e}(),wt=function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(n){for(var r="",i=0;i<n.length;++i)r+=String.fromCharCode(n[i]);return r}(t))},e.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},e.prototype.toUint8Array=function(){return function(t){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return P(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e}();wt.EMPTY_BYTE_STRING=new wt("");var rf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Yt(e){if(x(!!e),typeof e=="string"){var t=0,n=rf.exec(e);if(x(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:X(e.seconds),nanos:X(e.nanos)}}function X(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function Ue(e){return typeof e=="string"?wt.fromBase64String(e):wt.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function po(e){var t,n;return((n=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Ku(e){var t=e.mapValue.fields.__previous_value__;return po(t)?Ku(t):t}function Ln(e){var t=Yt(e.mapValue.fields.__local_write_time__.timestampValue);return new Tt(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(e){return e==null}function Rr(e){return e===0&&1/e==-1/0}function Gu(e){return typeof e=="number"&&Number.isInteger(e)&&!Rr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N=function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(V.fromString(t))},e.fromName=function(t){return new e(V.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return t!==null&&V.comparator(this.path,t.path)===0},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,n){return V.comparator(t.path,n.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new V(t.slice()))},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ge(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?po(e)?4:10:D()}function Ft(e,t){var n=ge(e);if(n!==ge(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ln(e).isEqual(Ln(t));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;var o=Yt(r.timestampValue),s=Yt(i.timestampValue);return o.seconds===s.seconds&&o.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(r,i){return Ue(r.bytesValue).isEqual(Ue(i.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(r,i){return X(r.geoPointValue.latitude)===X(i.geoPointValue.latitude)&&X(r.geoPointValue.longitude)===X(i.geoPointValue.longitude)}(e,t);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return X(r.integerValue)===X(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){var o=X(r.doubleValue),s=X(i.doubleValue);return o===s?Rr(o)===Rr(s):isNaN(o)&&isNaN(s)}return!1}(e,t);case 9:return Me(e.arrayValue.values||[],t.arrayValue.values||[],Ft);case 10:return function(r,i){var o=r.mapValue.fields||{},s=i.mapValue.fields||{};if(qu(o)!==qu(s))return!1;for(var u in o)if(o.hasOwnProperty(u)&&(s[u]===void 0||!Ft(o[u],s[u])))return!1;return!0}(e,t);default:return D()}}function On(e,t){return(e.values||[]).find(function(n){return Ft(n,t)})!==void 0}function qe(e,t){var n=ge(e),r=ge(t);if(n!==r)return P(n,r);switch(n){case 0:return 0;case 1:return P(e.booleanValue,t.booleanValue);case 2:return function(i,o){var s=X(i.integerValue||i.doubleValue),u=X(o.integerValue||o.doubleValue);return s<u?-1:s>u?1:s===u?0:isNaN(s)?isNaN(u)?0:-1:1}(e,t);case 3:return Qu(e.timestampValue,t.timestampValue);case 4:return Qu(Ln(e),Ln(t));case 5:return P(e.stringValue,t.stringValue);case 6:return function(i,o){var s=Ue(i),u=Ue(o);return s.compareTo(u)}(e.bytesValue,t.bytesValue);case 7:return function(i,o){for(var s=i.split("/"),u=o.split("/"),a=0;a<s.length&&a<u.length;a++){var c=P(s[a],u[a]);if(c!==0)return c}return P(s.length,u.length)}(e.referenceValue,t.referenceValue);case 8:return function(i,o){var s=P(X(i.latitude),X(o.latitude));return s!==0?s:P(X(i.longitude),X(o.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(i,o){for(var s=i.values||[],u=o.values||[],a=0;a<s.length&&a<u.length;++a){var c=qe(s[a],u[a]);if(c)return c}return P(s.length,u.length)}(e.arrayValue,t.arrayValue);case 10:return function(i,o){var s=i.fields||{},u=Object.keys(s),a=o.fields||{},c=Object.keys(a);u.sort(),c.sort();for(var h=0;h<u.length&&h<c.length;++h){var l=P(u[h],c[h]);if(l!==0)return l;var f=qe(s[u[h]],a[c[h]]);if(f!==0)return f}return P(u.length,c.length)}(e.mapValue,t.mapValue);default:throw D()}}function Qu(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return P(e,t);var n=Yt(e),r=Yt(t),i=P(n.seconds,r.seconds);return i!==0?i:P(n.nanos,r.nanos)}function yo(e){return go(e)}function go(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(r){var i=Yt(r);return"time("+i.seconds+","+i.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ue(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,N.fromName(n).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(r){for(var i="[",o=!0,s=0,u=r.values||[];s<u.length;s++)o?o=!1:i+=",",i+=go(u[s]);return i+"]"}(e.arrayValue):"mapValue"in e?function(r){for(var i="{",o=!0,s=0,u=Object.keys(r.fields||{}).sort();s<u.length;s++){var a=u[s];o?o=!1:i+=",",i+=a+":"+go(r.fields[a])}return i+"}"}(e.mapValue):D();var t,n}function Lr(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function vo(e){return!!e&&"integerValue"in e}function mo(e){return!!e&&"arrayValue"in e}function $u(e){return!!e&&"nullValue"in e}function zu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Or(e){return!!e&&"mapValue"in e}function Pn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return pe(e.mapValue.fields,function(i,o){return t.mapValue.fields[i]=Pn(o)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Pn(e.arrayValue.values[r]);return n}return Object.assign({},e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nt=function(){function e(t){this.value=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){if(t.isEmpty())return this.value;for(var n=this.value,r=0;r<t.length-1;++r)if(!Or(n=(n.mapValue.fields||{})[t.get(r)]))return null;return(n=(n.mapValue.fields||{})[t.lastSegment()])||null},e.prototype.set=function(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=Pn(n)},e.prototype.setAll=function(t){var n=this,r=Ot.emptyPath(),i={},o=[];t.forEach(function(u,a){if(!r.isImmediateParentOf(a)){var c=n.getFieldsMap(r);n.applyChanges(c,i,o),i={},o=[],r=a.popLast()}u?i[a.lastSegment()]=Pn(u):o.push(a.lastSegment())});var s=this.getFieldsMap(r);this.applyChanges(s,i,o)},e.prototype.delete=function(t){var n=this.field(t.popLast());Or(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]},e.prototype.isEqual=function(t){return Ft(this.value,t.value)},e.prototype.getFieldsMap=function(t){var n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(var r=0;r<t.length;++r){var i=n.mapValue.fields[t.get(r)];Or(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=i),n=i}return n.mapValue.fields},e.prototype.applyChanges=function(t,n,r){pe(n,function(u,a){return t[u]=a});for(var i=0,o=r;i<o.length;i++){var s=o[i];delete t[s]}},e.prototype.clone=function(){return new e(Pn(this.value))},e}();function Hu(e){var t=[];return pe(e.fields,function(n,r){var i=new Ot([n]);if(Or(r)){var o=Hu(r.mapValue).fields;if(o.length===0)t.push(i);else for(var s=0,u=o;s<u.length;s++){var a=u[s];t.push(i.child(a))}}else t.push(i)}),new Ve(t)}var at=function(){function e(t,n,r,i,o){this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=o}return e.newInvalidDocument=function(t){return new e(t,0,L.min(),Nt.empty(),0)},e.newFoundDocument=function(t,n,r){return new e(t,1,n,r,0)},e.newNoDocument=function(t,n){return new e(t,2,n,Nt.empty(),0)},e.newUnknownDocument=function(t,n){return new e(t,3,n,Nt.empty(),2)},e.prototype.convertToFoundDocument=function(t,n){return this.version=t,this.documentType=1,this.data=n,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Nt.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Nt.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return this.documentState===1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return this.documentState===2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return this.documentType!==0},e.prototype.isFoundDocument=function(){return this.documentType===1},e.prototype.isNoDocument=function(){return this.documentType===2},e.prototype.isUnknownDocument=function(){return this.documentType===3},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),of=function(e,t,n,r,i,o,s){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wu(e,t,n,r,i,o,s){return t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),new of(e,t,n,r,i,o,s)}function Fn(e){var t=_(e);if(t.h===null){var n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(r){return function(i){return i.field.canonicalString()+i.op.toString()+yo(i.value)}(r)}).join(","),n+="|ob:",n+=t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+i.dir}(r)}).join(","),ye(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=Mr(t.startAt)),t.endAt&&(n+="|ub:",n+=Mr(t.endAt)),t.h=n}return t.h}function Pr(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!df(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],o=t.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Ft(i.value,o.value))return!1;var i,o;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ju(e.startAt,t.startAt)&&Ju(e.endAt,t.endAt)}function Fr(e){return N.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var At=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).field=n,o.op=r,o.value=i,o}return k(t,e),t.create=function(n,r,i){return n.isKeyField()?r==="in"||r==="not-in"?this.l(n,r,i):new sf(n,r,i):r==="array-contains"?new cf(n,i):r==="in"?new hf(n,i):r==="not-in"?new lf(n,i):r==="array-contains-any"?new ff(n,i):new t(n,r,i)},t.l=function(n,r,i){return r==="in"?new uf(n,i):new af(n,i)},t.prototype.matches=function(n){var r=n.data.field(this.field);return this.op==="!="?r!==null&&this.m(qe(r,this.value)):r!==null&&ge(this.value)===ge(r)&&this.m(qe(r,this.value))},t.prototype.m=function(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return D()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),sf=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,i)||this).key=N.fromName(i.referenceValue),o}return k(t,e),t.prototype.matches=function(n){var r=N.comparator(n.key,this.key);return this.m(r)},t}(At),uf=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"in",r)||this).keys=Yu("in",r),i}return k(t,e),t.prototype.matches=function(n){return this.keys.some(function(r){return r.isEqual(n.key)})},t}(At),af=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"not-in",r)||this).keys=Yu("not-in",r),i}return k(t,e),t.prototype.matches=function(n){return!this.keys.some(function(r){return r.isEqual(n.key)})},t}(At);function Yu(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(function(r){return N.fromName(r.referenceValue)})}var cf=function(e){function t(n,r){return e.call(this,n,"array-contains",r)||this}return k(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return mo(r)&&On(r.arrayValue,this.value)},t}(At),hf=function(e){function t(n,r){return e.call(this,n,"in",r)||this}return k(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return r!==null&&On(this.value.arrayValue,r)},t}(At),lf=function(e){function t(n,r){return e.call(this,n,"not-in",r)||this}return k(t,e),t.prototype.matches=function(n){if(On(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var r=n.data.field(this.field);return r!==null&&!On(this.value.arrayValue,r)},t}(At),ff=function(e){function t(n,r){return e.call(this,n,"array-contains-any",r)||this}return k(t,e),t.prototype.matches=function(n){var r=this,i=n.data.field(this.field);return!(!mo(i)||!i.arrayValue.values)&&i.arrayValue.values.some(function(o){return On(r.value.arrayValue,o)})},t}(At),Mn=function(e,t){this.position=e,this.before=t};function Mr(e){return(e.before?"b":"a")+":"+e.position.map(function(t){return yo(t)}).join(",")}var je=function(e,t){t===void 0&&(t="asc"),this.field=e,this.dir=t};function df(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Xu(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var o=t[i],s=e.position[i];if(r=o.field.isKeyField()?N.comparator(N.fromName(s.referenceValue),n.key):qe(s,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return e.before?r<=0:r<0}function Ju(e,t){if(e===null)return t===null;if(t===null||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Ft(e.position[n],t.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt=function(e,t,n,r,i,o,s,u){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o="F"),s===void 0&&(s=null),u===void 0&&(u=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.p=null,this.T=null,this.startAt,this.endAt};function Zu(e,t,n,r,i,o,s,u){return new Kt(e,t,n,r,i,o,s,u)}function Be(e){return new Kt(e)}function Vr(e){return!ye(e.limit)&&e.limitType==="F"}function Ur(e){return!ye(e.limit)&&e.limitType==="L"}function wo(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function bo(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(r.g())return r.field}return null}function To(e){return e.collectionGroup!==null}function Ke(e){var t=_(e);if(t.p===null){t.p=[];var n=bo(t),r=wo(t);if(n!==null&&r===null)n.isKeyField()||t.p.push(new je(n)),t.p.push(new je(Ot.keyField(),"asc"));else{for(var i=!1,o=0,s=t.explicitOrderBy;o<s.length;o++){var u=s[o];t.p.push(u),u.field.isKeyField()&&(i=!0)}if(!i){var a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new je(Ot.keyField(),a))}}}return t.p}function xt(e){var t=_(e);if(!t.T)if(t.limitType==="F")t.T=Wu(t.path,t.collectionGroup,Ke(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=Ke(t);r<i.length;r++){var o=i[r],s=o.dir==="desc"?"asc":"desc";n.push(new je(o.field,s))}var u=t.endAt?new Mn(t.endAt.position,!t.endAt.before):null,a=t.startAt?new Mn(t.startAt.position,!t.startAt.before):null;t.T=Wu(t.path,t.collectionGroup,n,t.filters,t.limit,u,a)}return t.T}function ta(e,t,n){return new Kt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Vn(e,t){return Pr(xt(e),xt(t))&&e.limitType===t.limitType}function ea(e){return Fn(xt(e))+"|lt:"+e.limitType}function Io(e){return"Query(target="+function(t){var n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=", filters: ["+t.filters.map(function(r){return(i=r).field.canonicalString()+" "+i.op+" "+yo(i.value);var i}).join(", ")+"]"),ye(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=", orderBy: ["+t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+" ("+i.dir+")"}(r)}).join(", ")+"]"),t.startAt&&(n+=", startAt: "+Mr(t.startAt)),t.endAt&&(n+=", endAt: "+Mr(t.endAt)),"Target("+n+")"}(xt(e))+"; limitType="+e.limitType+")"}function Un(e,t){return t.isFoundDocument()&&function(n,r){var i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):N.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(e,t)&&function(n,r){for(var i=0,o=n.explicitOrderBy;i<o.length;i++){var s=o[i];if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1}return!0}(e,t)&&function(n,r){for(var i=0,o=n.filters;i<o.length;i++)if(!o[i].matches(r))return!1;return!0}(e,t)&&function(n,r){return!(n.startAt&&!Xu(n.startAt,Ke(n),r))&&(!n.endAt||!Xu(n.endAt,Ke(n),r))}(e,t)}function na(e){return function(t,n){for(var r=!1,i=0,o=Ke(e);i<o.length;i++){var s=o[i],u=pf(s,t,n);if(u!==0)return u;r=r||s.field.isKeyField()}return 0}}function pf(e,t,n){var r=e.field.isKeyField()?N.comparator(t.key,n.key):function(i,o,s){var u=o.data.field(i),a=s.data.field(i);return u!==null&&a!==null?qe(u,a):D()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return D()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ra(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Rr(t)?"-0":t}}function ia(e){return{integerValue:""+e}}function oa(e,t){return Gu(t)?ia(t):ra(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qr=function(){this._=void 0};function yf(e,t,n){return e instanceof Ge?function(r,i){var o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,t):e instanceof ve?ua(e,t):e instanceof me?aa(e,t):function(r,i){var o=sa(r,i),s=ca(o)+ca(r.A);return vo(o)&&vo(r.A)?ia(s):ra(r.R,s)}(e,t)}function gf(e,t,n){return e instanceof ve?ua(e,t):e instanceof me?aa(e,t):n}function sa(e,t){return e instanceof Qe?vo(n=t)||function(r){return!!r&&"doubleValue"in r}(n)?t:{integerValue:0}:null;var n}var Ge=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t}(qr),ve=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return k(t,e),t}(qr);function ua(e,t){for(var n=ha(t),r=function(s){n.some(function(u){return Ft(u,s)})||n.push(s)},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var me=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return k(t,e),t}(qr);function aa(e,t){for(var n=ha(t),r=function(s){n=n.filter(function(u){return!Ft(u,s)})},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Qe=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).R=n,i.A=r,i}return k(t,e),t}(qr);function ca(e){return X(e.integerValue||e.doubleValue)}function ha(e){return mo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qn=function(e,t){this.field=e,this.transform=t},vf=function(e,t){this.version=e,this.transformResults=t},ft=function(){function e(t,n){this.updateTime=t,this.exists=n}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return this.updateTime===void 0&&this.exists===void 0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e}();function jr(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var Br=function(){};function mf(e,t,n){e instanceof jn?function(r,i,o){var s=r.value.clone(),u=pa(r.fieldTransforms,i,o.transformResults);s.setAll(u),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Xt?function(r,i,o){if(jr(r.precondition,i)){var s=pa(r.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(da(r)),u.setAll(s),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}else i.convertToUnknownDocument(o.version)}(e,t,n):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,n)}function Eo(e,t,n){e instanceof jn?function(r,i,o){if(jr(r.precondition,i)){var s=r.value.clone(),u=ya(r.fieldTransforms,o,i);s.setAll(u),i.convertToFoundDocument(fa(i),s).setHasLocalMutations()}}(e,t,n):e instanceof Xt?function(r,i,o){if(jr(r.precondition,i)){var s=ya(r.fieldTransforms,o,i),u=i.data;u.setAll(da(r)),u.setAll(s),i.convertToFoundDocument(fa(i),u).setHasLocalMutations()}}(e,t,n):function(r,i){jr(r.precondition,i)&&i.convertToNoDocument(L.min())}(e,t)}function wf(e,t){for(var n=null,r=0,i=e.fieldTransforms;r<i.length;r++){var o=i[r],s=t.data.field(o.field),u=sa(o.transform,s||null);u!=null&&(n==null&&(n=Nt.empty()),n.set(o.field,u))}return n||null}function la(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&Me(n,r,function(i,o){return function(s,u){return s.field.isEqual(u.field)&&function(a,c){return a instanceof ve&&c instanceof ve||a instanceof me&&c instanceof me?Me(a.elements,c.elements,Ft):a instanceof Qe&&c instanceof Qe?Ft(a.A,c.A):a instanceof Ge&&c instanceof Ge}(s.transform,u.transform)}(i,o)})}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function fa(e){return e.isFoundDocument()?e.version:L.min()}var jn=function(e){function t(n,r,i,o){o===void 0&&(o=[]);var s=this;return(s=e.call(this)||this).key=n,s.value=r,s.precondition=i,s.fieldTransforms=o,s.type=0,s}return k(t,e),t}(Br),Xt=function(e){function t(n,r,i,o,s){s===void 0&&(s=[]);var u=this;return(u=e.call(this)||this).key=n,u.data=r,u.fieldMask=i,u.precondition=o,u.fieldTransforms=s,u.type=1,u}return k(t,e),t}(Br);function da(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function pa(e,t,n){var r=new Map;x(e.length===n.length);for(var i=0;i<n.length;i++){var o=e[i],s=o.transform,u=t.data.field(o.field);r.set(o.field,gf(s,u,n[i]))}return r}function ya(e,t,n){for(var r=new Map,i=0,o=e;i<o.length;i++){var s=o[i],u=s.transform,a=n.data.field(s.field);r.set(s.field,yf(u,a,t))}return r}var J,M,Bn=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return k(t,e),t}(Br),_o=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return k(t,e),t}(Br),bf=function(e){this.count=e};function ga(e){switch(e){case y.OK:return D();case y.CANCELLED:case y.UNKNOWN:case y.DEADLINE_EXCEEDED:case y.RESOURCE_EXHAUSTED:case y.INTERNAL:case y.UNAVAILABLE:case y.UNAUTHENTICATED:return!1;case y.INVALID_ARGUMENT:case y.NOT_FOUND:case y.ALREADY_EXISTS:case y.PERMISSION_DENIED:case y.FAILED_PRECONDITION:case y.ABORTED:case y.OUT_OF_RANGE:case y.UNIMPLEMENTED:case y.DATA_LOSS:return!0;default:return D()}}function va(e){if(e===void 0)return Y("GRPC error has no .code"),y.UNKNOWN;switch(e){case J.OK:return y.OK;case J.CANCELLED:return y.CANCELLED;case J.UNKNOWN:return y.UNKNOWN;case J.DEADLINE_EXCEEDED:return y.DEADLINE_EXCEEDED;case J.RESOURCE_EXHAUSTED:return y.RESOURCE_EXHAUSTED;case J.INTERNAL:return y.INTERNAL;case J.UNAVAILABLE:return y.UNAVAILABLE;case J.UNAUTHENTICATED:return y.UNAUTHENTICATED;case J.INVALID_ARGUMENT:return y.INVALID_ARGUMENT;case J.NOT_FOUND:return y.NOT_FOUND;case J.ALREADY_EXISTS:return y.ALREADY_EXISTS;case J.PERMISSION_DENIED:return y.PERMISSION_DENIED;case J.FAILED_PRECONDITION:return y.FAILED_PRECONDITION;case J.ABORTED:return y.ABORTED;case J.OUT_OF_RANGE:return y.OUT_OF_RANGE;case J.UNIMPLEMENTED:return y.UNIMPLEMENTED;case J.DATA_LOSS:return y.DATA_LOSS;default:return D()}}(M=J||(J={}))[M.OK=0]="OK",M[M.CANCELLED=1]="CANCELLED",M[M.UNKNOWN=2]="UNKNOWN",M[M.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",M[M.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",M[M.NOT_FOUND=5]="NOT_FOUND",M[M.ALREADY_EXISTS=6]="ALREADY_EXISTS",M[M.PERMISSION_DENIED=7]="PERMISSION_DENIED",M[M.UNAUTHENTICATED=16]="UNAUTHENTICATED",M[M.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",M[M.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",M[M.ABORTED=10]="ABORTED",M[M.OUT_OF_RANGE=11]="OUT_OF_RANGE",M[M.UNIMPLEMENTED=12]="UNIMPLEMENTED",M[M.INTERNAL=13]="INTERNAL",M[M.UNAVAILABLE=14]="UNAVAILABLE",M[M.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dt=function(){function e(t,n){this.comparator=t,this.root=n||Jt.EMPTY}return e.prototype.insert=function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Jt.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Jt.BLACK,null,null))},e.prototype.get=function(t){for(var n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null},e.prototype.indexOf=function(t){for(var n=0,r=this.root;!r.isEmpty();){var i=this.comparator(t,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal(function(n,r){return t(n,r),!1})},e.prototype.toString=function(){var t=[];return this.inorderTraversal(function(n,r){return t.push(n+":"+r),!1}),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new Kr(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new Kr(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new Kr(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new Kr(this.root,t,this.comparator,!0)},e}(),Kr=function(){function e(t,n,r,i){this.isReverse=i,this.nodeStack=[];for(var o=1;!t.isEmpty();)if(o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(this.nodeStack.length===0)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e}(),Jt=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=r!=null?r:e.RED,this.left=i!=null?i:e.EMPTY,this.right=o!=null?o:e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,n,r,i,o){return new e(t!=null?t:this.key,n!=null?n:this.value,r!=null?r:this.color,i!=null?i:this.left,o!=null?o:this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,n,r){var i=this,o=r(t,i.key);return(i=o<0?i.copy(null,null,null,i.left.insert(t,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(t,n,r))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();var t=this.left.check();if(t!==this.right.check())throw D();return t+(this.isRed()?0:1)},e}();Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1,Jt.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw D()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,n,r,i,o){return this},e.prototype.insert=function(t,n,r){return new Jt(t,n)},e.prototype.remove=function(t,n){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Z=function(){function e(t){this.comparator=t,this.data=new dt(this.comparator)}return e.prototype.has=function(t){return this.data.get(t)!==null},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.forEachInRange=function(t,n){for(var r=this.data.getIteratorFrom(t[0]);r.hasNext();){var i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;n(i.key)}},e.prototype.forEachWhile=function(t,n){var r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null},e.prototype.getIterator=function(){return new ma(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new ma(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var n=this;return n.size<t.size&&(n=t,t=this),t.forEach(function(r){n=n.add(r)}),n},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach(function(n){t.push(n)}),t},e.prototype.toString=function(){var t=[];return this.forEach(function(n){return t.push(n)}),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var n=new e(this.comparator);return n.data=t,n},e}(),ma=function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),Tf=new dt(N.comparator);function Rt(){return Tf}var If=new dt(N.comparator);function So(){return If}var Ef=new dt(N.comparator);function wa(){return Ef}var _f=new Z(N.comparator);function j(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=_f,r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Sf=new Z(P);function Gr(){return Sf}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Do=function(){function e(t,n,r,i,o){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}return e.createSynthesizedRemoteEventForCurrentChange=function(t,n){var r=new Map;return r.set(t,No.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(L.min(),r,Gr(),Rt(),j())},e}(),No=function(){function e(t,n,r,i,o){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}return e.createSynthesizedTargetChangeForCurrentChange=function(t,n){return new e(wt.EMPTY_BYTE_STRING,n,j(),j(),j())},e}(),Qr=function(e,t,n,r){this.v=e,this.removedTargetIds=t,this.key=n,this.P=r},ba=function(e,t){this.targetId=e,this.V=t},Ta=function(e,t,n,r){n===void 0&&(n=wt.EMPTY_BYTE_STRING),r===void 0&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},Ia=function(){function e(){this.S=0,this.D=_a(),this.C=wt.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"F",{get:function(){return this.S!==0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),e.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},e.prototype.M=function(){var t=j(),n=j(),r=j();return this.D.forEach(function(i,o){switch(o){case 0:t=t.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:D()}}),new No(this.C,this.N,t,n,r)},e.prototype.L=function(){this.k=!1,this.D=_a()},e.prototype.B=function(t,n){this.k=!0,this.D=this.D.insert(t,n)},e.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.k=!0,this.N=!0},e}(),Df=function(){function e(t){this.W=t,this.G=new Map,this.H=Rt(),this.J=Ea(),this.Y=new Z(P)}return e.prototype.X=function(t){for(var n=0,r=t.v;n<r.length;n++){var i=r[n];t.P&&t.P.isFoundDocument()?this.Z(i,t.P):this.tt(i,t.key,t.P)}for(var o=0,s=t.removedTargetIds;o<s.length;o++)i=s[o],this.tt(i,t.key,t.P)},e.prototype.et=function(t){var n=this;this.forEachTarget(t,function(r){var i=n.nt(r);switch(t.state){case 0:n.st(r)&&i.O(t.resumeToken);break;case 1:i.K(),i.F||i.L(),i.O(t.resumeToken);break;case 2:i.K(),i.F||n.removeTarget(r);break;case 3:n.st(r)&&(i.j(),i.O(t.resumeToken));break;case 4:n.st(r)&&(n.it(r),i.O(t.resumeToken));break;default:D()}})},e.prototype.forEachTarget=function(t,n){var r=this;t.targetIds.length>0?t.targetIds.forEach(n):this.G.forEach(function(i,o){r.st(o)&&n(o)})},e.prototype.rt=function(t){var n=t.targetId,r=t.V.count,i=this.ot(n);if(i){var o=i.target;if(Fr(o))if(r===0){var s=new N(o.path);this.tt(n,s,at.newNoDocument(s,L.min()))}else x(r===1);else this.ct(n)!==r&&(this.it(n),this.Y=this.Y.add(n))}},e.prototype.ut=function(t){var n=this,r=new Map;this.G.forEach(function(s,u){var a=n.ot(u);if(a){if(s.current&&Fr(a.target)){var c=new N(a.target.path);n.H.get(c)!==null||n.at(u,c)||n.tt(u,c,at.newNoDocument(c,t))}s.$&&(r.set(u,s.M()),s.L())}});var i=j();this.J.forEach(function(s,u){var a=!0;u.forEachWhile(function(c){var h=n.ot(c);return!h||h.purpose===2||(a=!1,!1)}),a&&(i=i.add(s))});var o=new Do(t,r,this.Y,this.H,i);return this.H=Rt(),this.J=Ea(),this.Y=new Z(P),o},e.prototype.Z=function(t,n){if(this.st(t)){var r=this.at(t,n.key)?2:0;this.nt(t).B(n.key,r),this.H=this.H.insert(n.key,n),this.J=this.J.insert(n.key,this.ht(n.key).add(t))}},e.prototype.tt=function(t,n,r){if(this.st(t)){var i=this.nt(t);this.at(t,n)?i.B(n,1):i.q(n),this.J=this.J.insert(n,this.ht(n).delete(t)),r&&(this.H=this.H.insert(n,r))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var n=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var n=this.G.get(t);return n||(n=new Ia,this.G.set(t,n)),n},e.prototype.ht=function(t){var n=this.J.get(t);return n||(n=new Z(P),this.J=this.J.insert(t,n)),n},e.prototype.st=function(t){var n=this.ot(t)!==null;return n||I("WatchChangeAggregator","Detected inactive target",t),n},e.prototype.ot=function(t){var n=this.G.get(t);return n&&n.F?null:this.W.lt(t)},e.prototype.it=function(t){var n=this;this.G.set(t,new Ia),this.W.getRemoteKeysForTarget(t).forEach(function(r){n.tt(t,r,null)})},e.prototype.at=function(t,n){return this.W.getRemoteKeysForTarget(t).has(n)},e}();function Ea(){return new dt(N.comparator)}function _a(){return new dt(N.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nf={asc:"ASCENDING",desc:"DESCENDING"},Af={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cf=function(e,t){this.databaseId=e,this.I=t};function Kn(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function Sa(e,t){return e.I?t.toBase64():t.toUint8Array()}function kf(e,t){return Kn(e,t.toTimestamp())}function et(e){return x(!!e),L.fromTimestamp(function(t){var n=Yt(t);return new Tt(n.seconds,n.nanos)}(e))}function Ao(e,t){return function(n){return new V(["projects",n.projectId,"databases",n.database])}(e).child("documents").child(t).canonicalString()}function Da(e){var t=V.fromString(e);return x(Va(t)),t}function Gn(e,t){return Ao(e.databaseId,t.path)}function Mt(e,t){var n=Da(t);if(n.get(1)!==e.databaseId.projectId)throw new w(y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new w(y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new N(Aa(n))}function Co(e,t){return Ao(e.databaseId,t)}function Na(e){var t=Da(e);return t.length===4?V.emptyPath():Aa(t)}function Qn(e){return new V(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Aa(e){return x(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function Ca(e,t,n){return{name:Gn(e,t),fields:n.value.mapValue.fields}}function ka(e,t,n){var r=Mt(e,t.name),i=et(t.updateTime),o=new Nt({mapValue:{fields:t.fields}}),s=at.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function $r(e,t){var n;if(t instanceof jn)n={update:Ca(e,t.key,t.value)};else if(t instanceof Bn)n={delete:Gn(e,t.key)};else if(t instanceof Xt)n={update:Ca(e,t.key,t.data),updateMask:Pf(t.fieldMask)};else{if(!(t instanceof _o))return D();n={verify:Gn(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(r){return function(i,o){var s=o.transform;if(s instanceof Ge)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof ve)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof me)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof Qe)return{fieldPath:o.field.canonicalString(),increment:s.A};throw D()}(0,r)})),t.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:kf(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:D()}(e,t.precondition)),n}function xa(e,t){var n=t.currentDocument?function(c){return c.updateTime!==void 0?ft.updateTime(et(c.updateTime)):c.exists!==void 0?ft.exists(c.exists):ft.none()}(t.currentDocument):ft.none(),r=t.updateTransforms?t.updateTransforms.map(function(c){return function(h,l){var f=null;if("setToServerValue"in l)x(l.setToServerValue==="REQUEST_TIME"),f=new Ge;else if("appendMissingElements"in l){var p=l.appendMissingElements.values||[];f=new ve(p)}else if("removeAllFromArray"in l){var d=l.removeAllFromArray.values||[];f=new me(d)}else"increment"in l?f=new Qe(h,l.increment):D();var g=Ot.fromServerFormat(l.fieldPath);return new qn(g,f)}(e,c)}):[];if(t.update){t.update.name;var i=Mt(e,t.update.name),o=new Nt({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=function(c){var h=c.fieldPaths||[];return new Ve(h.map(function(l){return Ot.fromServerFormat(l)}))}(t.updateMask);return new Xt(i,o,s,n,r)}return new jn(i,o,n,r)}if(t.delete){var u=Mt(e,t.delete);return new Bn(u,n)}if(t.verify){var a=Mt(e,t.verify);return new _o(a,n)}return D()}function Ra(e,t){return{documents:[Co(e,t.path)]}}function La(e,t){var n={structuredQuery:{}},r=t.path;t.collectionGroup!==null?(n.parent=Co(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Co(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(u){if(u.length!==0){var a=u.map(function(c){return function(h){if(h.op==="=="){if(zu(h.value))return{unaryFilter:{field:$e(h.field),op:"IS_NAN"}};if($u(h.value))return{unaryFilter:{field:$e(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(zu(h.value))return{unaryFilter:{field:$e(h.field),op:"IS_NOT_NAN"}};if($u(h.value))return{unaryFilter:{field:$e(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$e(h.field),op:Rf(h.op),value:h.value}}}(c)});return a.length===1?a[0]:{compositeFilter:{op:"AND",filters:a}}}}(t.filters);i&&(n.structuredQuery.where=i);var o=function(u){if(u.length!==0)return u.map(function(a){return function(c){return{field:$e(c.field),direction:xf(c.dir)}}(a)})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(u,a){return u.I||ye(a)?a:{value:a}}(e,t.limit);return s!==null&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=Fa(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Fa(t.endAt)),n}function Oa(e){var t=Na(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){x(r===1);var o=n.from[0];o.allDescendants?i=o.collectionId:t=t.child(o.collectionId)}var s=[];n.where&&(s=Pa(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(l){return function(f){return new je(ze(f.field),function(p){switch(p){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(f.direction))}(l)}));var a=null;n.limit&&(a=function(l){var f;return ye(f=typeof l=="object"?l.value:l)?null:f}(n.limit));var c=null;n.startAt&&(c=Ma(n.startAt));var h=null;return n.endAt&&(h=Ma(n.endAt)),Zu(t,i,u,s,a,"F",c,h)}function Pa(e){return e?e.unaryFilter!==void 0?[Of(e)]:e.fieldFilter!==void 0?[Lf(e)]:e.compositeFilter!==void 0?e.compositeFilter.filters.map(function(t){return Pa(t)}).reduce(function(t,n){return t.concat(n)}):D():[]}function Fa(e){return{before:e.before,values:e.position}}function Ma(e){var t=!!e.before,n=e.values||[];return new Mn(n,t)}function xf(e){return Nf[e]}function Rf(e){return Af[e]}function $e(e){return{fieldPath:e.canonicalString()}}function ze(e){return Ot.fromServerFormat(e.fieldPath)}function Lf(e){return At.create(ze(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return D()}}(e.fieldFilter.op),e.fieldFilter.value)}function Of(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ze(e.unaryFilter.field);return At.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ze(e.unaryFilter.field);return At.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ze(e.unaryFilter.field);return At.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ze(e.unaryFilter.field);return At.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return D()}}function Pf(e){var t=[];return e.fields.forEach(function(n){return t.push(n.canonicalString())}),{fieldPaths:t}}function Va(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pt(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=Ua(t)),t=Ff(e.get(n),t);return Ua(t)}function Ff(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Ua(e){return e+""}function Gt(e){var t=e.length;if(x(t>=2),t===2)return x(e.charAt(0)===""&&e.charAt(1)===""),V.emptyPath();for(var n=t-2,r=[],i="",o=0;o<t;){var s=e.indexOf("",o);switch((s<0||s>n)&&D(),e.charAt(s+1)){case"":var u=e.substring(o,s),a=void 0;i.length===0?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=e.substring(o,s),i+="\0";break;case"":i+=e.substring(o,s+1);break;default:D()}o=s+2}return new V(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mf=function(e,t){this.seconds=e,this.nanoseconds=t},Ct=function(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n};Ct.store="owner",Ct.key="owner";var Zt=function(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n};Zt.store="mutationQueues",Zt.keyPath="userId";var B=function(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};B.store="mutations",B.keyPath="batchId",B.userMutationsIndex="userMutationsIndex",B.userMutationsKeyPath=["userId","batchId"];var pt=function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,n){return[t,Pt(n)]},e.key=function(t,n,r){return[t,Pt(n),r]},e}();pt.store="documentMutations",pt.PLACEHOLDER=new pt;var Vf=function(e,t){this.path=e,this.readTime=t},Uf=function(e,t){this.path=e,this.version=t},Q=function(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Q.store="remoteDocuments",Q.readTimeIndex="readTimeIndex",Q.readTimeIndexPath="readTime",Q.collectionReadTimeIndex="collectionReadTimeIndex",Q.collectionReadTimeIndexPath=["parentPath","readTime"];var Vt=function(e){this.byteSize=e};Vt.store="remoteDocumentGlobal",Vt.key="remoteDocumentGlobalKey";var It=function(e,t,n,r,i,o,s){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};It.store="targets",It.keyPath="targetId",It.queryTargetsIndexName="queryTargetsIndex",It.queryTargetsKeyPath=["canonicalId","targetId"];var ct=function(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n};ct.store="targetDocuments",ct.keyPath=["targetId","path"],ct.documentTargetsIndex="documentTargetsIndex",ct.documentTargetsKeyPath=["path","targetId"];var kt=function(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r};kt.key="targetGlobalKey",kt.store="targetGlobal";var we=function(e,t){this.collectionId=e,this.parent=t};we.store="collectionParents",we.keyPath=["collectionId","parent"];var Qt=function(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r};Qt.store="clientMetadata",Qt.keyPath="clientId";var He=function(e,t,n){this.bundleId=e,this.createTime=t,this.version=n};He.store="bundles",He.keyPath="bundleId";var We=function(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n};We.store="namedQueries",We.keyPath="name";var qf=z(z([],z(z([],z(z([],z(z([],[Zt.store,B.store,pt.store,Q.store,It.store,Ct.store,kt.store,ct.store]),[Qt.store])),[Vt.store])),[we.store])),[He.store,We.store]),qa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ja=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},e}(),yt=function(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})},b=function(){function e(t){var n=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(r){n.isDone=!0,n.result=r,n.nextCallback&&n.nextCallback(r)},function(r){n.isDone=!0,n.error=r,n.catchCallback&&n.catchCallback(r)})}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,n){var r=this;return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(i,o){r.nextCallback=function(s){r.wrapSuccess(t,s).next(i,o)},r.catchCallback=function(s){r.wrapFailure(n,s).next(i,o)}})},e.prototype.toPromise=function(){var t=this;return new Promise(function(n,r){t.next(n,r)})},e.prototype.wrapUserFunction=function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(r){return e.reject(r)}},e.prototype.wrapSuccess=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)},e.prototype.wrapFailure=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)},e.resolve=function(t){return new e(function(n,r){n(t)})},e.reject=function(t){return new e(function(n,r){r(t)})},e.waitFor=function(t){return new e(function(n,r){var i=0,o=0,s=!1;t.forEach(function(u){++i,u.next(function(){++o,s&&o===i&&n()},function(a){return r(a)})}),s=!0,o===i&&n()})},e.or=function(t){for(var n=e.resolve(!1),r=function(s){n=n.next(function(u){return u?e.resolve(u):s()})},i=0,o=t;i<o.length;i++)r(o[i]);return n},e.forEach=function(t,n){var r=this,i=[];return t.forEach(function(o,s){i.push(n.call(r,o,s))}),this.waitFor(i)},e}(),Ba=function(){function e(t,n){var r=this;this.action=t,this.transaction=n,this.aborted=!1,this.ft=new yt,this.transaction.oncomplete=function(){r.ft.resolve()},this.transaction.onabort=function(){n.error?r.ft.reject(new $n(t,n.error)):r.ft.resolve()},this.transaction.onerror=function(i){var o=ko(i.target.error);r.ft.reject(new $n(t,o))}}return e.open=function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(o){throw new $n(n,o)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(I("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var n=this.transaction.objectStore(t);return new Bf(n)},e}(),Ye=function(){function e(t,n,r){this.name=t,this.version=n,this.wt=r,e._t(mi())===12.2&&Y("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return I("SimpleDb","Removing database:",t),Te(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if(typeof indexedDB=="undefined")return!1;if(e.gt())return!0;var t=mi(),n=e._t(t),r=0<n&&n<10,i=e.Et(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.gt=function(){var t;return typeof process!="undefined"&&((t=process.env)===null||t===void 0?void 0:t.Tt)==="YES"},e.It=function(t,n){return t.store(n)},e._t=function(t){var n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)},e.Et=function(t){var n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)},e.prototype.At=function(t){return m(this,void 0,void 0,function(){var n,r=this;return v(this,function(i){switch(i.label){case 0:return this.db?[3,2]:(I("SimpleDb","Opening database:",this.name),n=this,[4,new Promise(function(o,s){var u=indexedDB.open(r.name,r.version);u.onsuccess=function(a){var c=a.target.result;o(c)},u.onblocked=function(){s(new $n(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},u.onerror=function(a){var c=a.target.error;c.name==="VersionError"?s(new w(y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s(new $n(t,c))},u.onupgradeneeded=function(a){I("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',a.oldVersion);var c=a.target.result;r.wt.Rt(c,u.transaction,a.oldVersion,r.version).next(function(){I("SimpleDb","Database upgrade to version "+r.version+" complete")})}})]);case 1:n.db=i.sent(),i.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(o){return r.bt(o)}),this.db)]}})})},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(n){return t(n)})},e.prototype.runTransaction=function(t,n,r,i){return m(this,void 0,void 0,function(){var o,s,u,a,c;return v(this,function(h){switch(h.label){case 0:o=n==="readonly",s=0,u=function(){var l,f,p,d,g;return v(this,function(T){switch(T.label){case 0:++s,T.label=1;case 1:return T.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=T.sent(),l=Ba.open(a.db,t,o?"readonly":"readwrite",r),f=i(l).catch(function(E){return l.abort(E),b.reject(E)}).toPromise(),p={},f.catch(function(){}),[4,l.dt];case 3:return[2,(p.value=(T.sent(),f),p)];case 4:return d=T.sent(),g=d.name!=="FirebaseError"&&s<3,I("SimpleDb","Transaction failed with error:",d.message,"Retrying:",g),a.close(),g?[3,5]:[2,{value:Promise.reject(d)}];case 5:return[2]}})},a=this,h.label=1;case 1:return[5,u()];case 2:if(typeof(c=h.sent())=="object")return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),jf=function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return Te(this.Pt.delete())},e}(),$n=function(e){function t(n,r){var i=this;return(i=e.call(this,y.UNAVAILABLE,"IndexedDB transaction '"+n+"' failed: "+r)||this).name="IndexedDbTransactionError",i}return k(t,e),t}(w);function be(e){return e.name==="IndexedDbTransactionError"}var Bf=function(){function e(t){this.store=t}return e.prototype.put=function(t,n){var r;return n!==void 0?(I("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),Te(r)},e.prototype.add=function(t){return I("SimpleDb","ADD",this.store.name,t,t),Te(this.store.add(t))},e.prototype.get=function(t){var n=this;return Te(this.store.get(t)).next(function(r){return r===void 0&&(r=null),I("SimpleDb","GET",n.store.name,t,r),r})},e.prototype.delete=function(t){return I("SimpleDb","DELETE",this.store.name,t),Te(this.store.delete(t))},e.prototype.count=function(){return I("SimpleDb","COUNT",this.store.name),Te(this.store.count())},e.prototype.Nt=function(t,n){var r=this.cursor(this.options(t,n)),i=[];return this.xt(r,function(o,s){i.push(s)}).next(function(){return i})},e.prototype.kt=function(t,n){I("SimpleDb","DELETE ALL",this.store.name);var r=this.options(t,n);r.Ft=!1;var i=this.cursor(r);return this.xt(i,function(o,s,u){return u.delete()})},e.prototype.$t=function(t,n){var r;n?r=t:(r={},n=t);var i=this.cursor(r);return this.xt(i,n)},e.prototype.Ot=function(t){var n=this.cursor({});return new b(function(r,i){n.onerror=function(o){var s=ko(o.target.error);i(s)},n.onsuccess=function(o){var s=o.target.result;s?t(s.primaryKey,s.value).next(function(u){u?s.continue():r()}):r()}})},e.prototype.xt=function(t,n){var r=[];return new b(function(i,o){t.onerror=function(s){o(s.target.error)},t.onsuccess=function(s){var u=s.target.result;if(u){var a=new jf(u),c=n(u.primaryKey,u.value,a);if(c instanceof b){var h=c.catch(function(l){return a.done(),b.reject(l)});r.push(h)}a.isDone?i():a.Dt===null?u.continue():u.continue(a.Dt)}else i()}}).next(function(){return b.waitFor(r)})},e.prototype.options=function(t,n){var r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}},e.prototype.cursor=function(t){var n="next";if(t.reverse&&(n="prev"),t.index){var r=this.store.index(t.index);return t.Ft?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)},e}();function Te(e){return new b(function(t,n){e.onsuccess=function(r){var i=r.target.result;t(i)},e.onerror=function(r){var i=ko(r.target.error);n(i)}})}var Ka=!1;function ko(e){var t=Ye._t(mi());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new w("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ka||(Ka=!0,setTimeout(function(){throw r},0)),r}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ga=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Mt=n,i.currentSequenceNumber=r,i}return k(t,e),t}(ja);function Et(e,t){var n=_(e);return Ye.It(n.Mt,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xo=function(){function e(t,n,r,i){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return e.prototype.applyToRemoteDocument=function(t,n){for(var r=n.mutationResults,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t.key)&&mf(o,t,r[i])}},e.prototype.applyToLocalView=function(t){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t.key)&&Eo(s,t,this.localWriteTime);for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t.key)&&Eo(s,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var n=this;this.mutations.forEach(function(r){var i=t.get(r.key),o=i;n.applyToLocalView(o),i.isValidDocument()||o.convertToNoDocument(L.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(t,n){return t.add(n.key)},j())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&Me(this.mutations,t.mutations,function(n,r){return la(n,r)})&&Me(this.baseMutations,t.baseMutations,function(n,r){return la(n,r)})},e}(),Kf=function(){function e(t,n,r,i){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return e.from=function(t,n,r){x(t.mutations.length===r.length);for(var i=wa(),o=t.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new e(t,n,r,i)},e}(),zr=function(){function e(t,n,r,i,o,s,u){o===void 0&&(o=L.min()),s===void 0&&(s=L.min()),u===void 0&&(u=wt.EMPTY_BYTE_STRING),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),Qa=function(e){this.Lt=e};function Ro(e,t){if(t.document)return ka(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=N.fromSegments(t.noDocument.path),r=Je(t.noDocument.readTime),i=at.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var o=N.fromSegments(t.unknownDocument.path);return r=Je(t.unknownDocument.version),at.newUnknownDocument(o,r)}return D()}function $a(e,t,n){var r=Lo(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var o=function(l,f){return{name:Gn(l,f.key),fields:f.data.value.mapValue.fields,updateTime:Kn(l,f.version.toTimestamp())}}(e.Lt,t),s=t.hasCommittedMutations;return new Q(null,null,o,s,r,i)}if(t.isNoDocument()){var u=t.key.path.toArray(),a=Xe(t.version);return s=t.hasCommittedMutations,new Q(null,new Vf(u,a),null,s,r,i)}if(t.isUnknownDocument()){var c=t.key.path.toArray(),h=Xe(t.version);return new Q(new Uf(c,h),null,null,!0,r,i)}return D()}function Lo(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function za(e){var t=new Tt(e[0],e[1]);return L.fromTimestamp(t)}function Xe(e){var t=e.toTimestamp();return new Mf(t.seconds,t.nanoseconds)}function Je(e){var t=new Tt(e.seconds,e.nanoseconds);return L.fromTimestamp(t)}function Ze(e,t){for(var n=(t.baseMutations||[]).map(function(a){return xa(e.Lt,a)}),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&t.mutations[r+1].transform!==void 0){var o=t.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var s=t.mutations.map(function(a){return xa(e.Lt,a)}),u=Tt.fromMillis(t.localWriteTimeMs);return new xo(t.batchId,u,n,s)}function zn(e){var t,n,r=Je(e.readTime),i=e.lastLimboFreeSnapshotVersion!==void 0?Je(e.lastLimboFreeSnapshotVersion):L.min();return e.query.documents!==void 0?(x((n=e.query).documents.length===1),t=xt(Be(Na(n.documents[0])))):t=function(o){return xt(Oa(o))}(e.query),new zr(t,e.targetId,0,e.lastListenSequenceNumber,r,i,wt.fromBase64String(e.resumeToken))}function Ha(e,t){var n,r=Xe(t.snapshotVersion),i=Xe(t.lastLimboFreeSnapshotVersion);n=Fr(t.target)?Ra(e.Lt,t.target):La(e.Lt,t.target);var o=t.resumeToken.toBase64();return new It(t.targetId,Fn(t.target),r,o,t.sequenceNumber,i,n)}function Oo(e){var t=Oa({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?ta(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gf=function(){function e(){}return e.prototype.getBundleMetadata=function(t,n){return Wa(t).get(n).next(function(r){if(r)return{id:(i=r).bundleId,createTime:Je(i.createTime),version:i.version};var i})},e.prototype.saveBundleMetadata=function(t,n){return Wa(t).put({bundleId:(r=n).id,createTime:Xe(et(r.createTime)),version:r.version});var r},e.prototype.getNamedQuery=function(t,n){return Ya(t).get(n).next(function(r){if(r)return{name:(i=r).name,query:Oo(i.bundledQuery),readTime:Je(i.readTime)};var i})},e.prototype.saveNamedQuery=function(t,n){return Ya(t).put(function(r){return{name:r.name,readTime:Xe(et(r.readTime)),bundledQuery:r.bundledQuery}}(n))},e}();function Wa(e){return Et(e,He.store)}function Ya(e){return Et(e,We.store)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qf=function(){function e(){this.Bt=new Po}return e.prototype.addToCollectionParentIndex=function(t,n){return this.Bt.add(n),b.resolve()},e.prototype.getCollectionParents=function(t,n){return b.resolve(this.Bt.getEntries(n))},e}(),Po=function(){function e(){this.index={}}return e.prototype.add=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n]||new Z(V.comparator),o=!i.has(r);return this.index[n]=i.add(r),o},e.prototype.has=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n];return i&&i.has(r)},e.prototype.getEntries=function(t){return(this.index[t]||new Z(V.comparator)).toArray()},e}(),$f=function(){function e(){this.qt=new Po}return e.prototype.addToCollectionParentIndex=function(t,n){var r=this;if(!this.qt.has(n)){var i=n.lastSegment(),o=n.popLast();t.addOnCommittedListener(function(){r.qt.add(n)});var s={collectionId:i,parent:Pt(o)};return Xa(t).put(s)}return b.resolve()},e.prototype.getCollectionParents=function(t,n){var r=[],i=IDBKeyRange.bound([n,""],[Uu(n),""],!1,!0);return Xa(t).Nt(i).next(function(o){for(var s=0,u=o;s<u.length;s++){var a=u[s];if(a.collectionId!==n)break;r.push(Gt(a.parent))}return r})},e}();function Xa(e){return Et(e,we.store)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ja={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ut=function(){function e(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(e,t,n){var r=e.store(B.store),i=e.store(pt.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.$t({range:s},function(d,g,T){return u++,T.delete()});o.push(a.next(function(){x(u===1)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=pt.key(t,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return b.waitFor(o).next(function(){return c})}function Hr(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw D();t=e.noDocument}return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ut.DEFAULT_COLLECTION_PERCENTILE=10,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ut.DEFAULT=new Ut(41943040,Ut.DEFAULT_COLLECTION_PERCENTILE,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ut.DISABLED=new Ut(-1,0,0);var zf=function(){function e(t,n,r,i){this.userId=t,this.R=n,this.Ut=r,this.referenceDelegate=i,this.Kt={}}return e.Qt=function(t,n,r,i){return x(t.uid!==""),new e(t.isAuthenticated()?t.uid:"",n,r,i)},e.prototype.checkEmpty=function(t){var n=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return te(t).$t({index:B.userMutationsIndex,range:r},function(i,o,s){n=!1,s.done()}).next(function(){return n})},e.prototype.addMutationBatch=function(t,n,r,i){var o=this,s=tn(t),u=te(t);return u.add({}).next(function(a){x(typeof a=="number");for(var c=new xo(a,n,r,i),h=function(E,A,C){var O=C.baseMutations.map(function(q){return $r(E.Lt,q)}),F=C.mutations.map(function(q){return $r(E.Lt,q)});return new B(A,C.batchId,C.localWriteTime.toMillis(),O,F)}(o.R,o.userId,c),l=[],f=new Z(function(E,A){return P(E.canonicalString(),A.canonicalString())}),p=0,d=i;p<d.length;p++){var g=d[p],T=pt.key(o.userId,g.key.path,a);f=f.add(g.key.path.popLast()),l.push(u.put(h)),l.push(s.put(T,pt.PLACEHOLDER))}return f.forEach(function(E){l.push(o.Ut.addToCollectionParentIndex(t,E))}),t.addOnCommittedListener(function(){o.Kt[a]=c.keys()}),b.waitFor(l).next(function(){return c})})},e.prototype.lookupMutationBatch=function(t,n){var r=this;return te(t).get(n).next(function(i){return i?(x(i.userId===r.userId),Ze(r.R,i)):null})},e.prototype.jt=function(t,n){var r=this;return this.Kt[n]?b.resolve(this.Kt[n]):this.lookupMutationBatch(t,n).next(function(i){if(i){var o=i.keys();return r.Kt[n]=o,o}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=this,i=n+1,o=IDBKeyRange.lowerBound([this.userId,i]),s=null;return te(t).$t({index:B.userMutationsIndex,range:o},function(u,a,c){a.userId===r.userId&&(x(a.batchId>=i),s=Ze(r.R,a)),c.done()}).next(function(){return s})},e.prototype.getHighestUnacknowledgedBatchId=function(t){var n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return te(t).$t({index:B.userMutationsIndex,range:n,reverse:!0},function(i,o,s){r=o.batchId,s.done()}).next(function(){return r})},e.prototype.getAllMutationBatches=function(t){var n=this,r=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return te(t).Nt(B.userMutationsIndex,r).next(function(i){return i.map(function(o){return Ze(n.R,o)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=pt.prefixForPath(this.userId,n.path),o=IDBKeyRange.lowerBound(i),s=[];return tn(t).$t({range:o},function(u,a,c){var h=u[0],l=u[1],f=u[2],p=Gt(l);if(h===r.userId&&n.path.isEqual(p))return te(t).get(f).next(function(d){if(!d)throw D();x(d.userId===r.userId),s.push(Ze(r.R,d))});c.done()}).next(function(){return s})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new Z(P),o=[];return n.forEach(function(s){var u=pt.prefixForPath(r.userId,s.path),a=IDBKeyRange.lowerBound(u),c=tn(t).$t({range:a},function(h,l,f){var p=h[0],d=h[1],g=h[2],T=Gt(d);p===r.userId&&s.path.isEqual(T)?i=i.add(g):f.done()});o.push(c)}),b.waitFor(o).next(function(){return r.Wt(t,i)})},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=this,i=n.path,o=i.length+1,s=pt.prefixForPath(this.userId,i),u=IDBKeyRange.lowerBound(s),a=new Z(P);return tn(t).$t({range:u},function(c,h,l){var f=c[0],p=c[1],d=c[2],g=Gt(p);f===r.userId&&i.isPrefixOf(g)?g.length===o&&(a=a.add(d)):l.done()}).next(function(){return r.Wt(t,a)})},e.prototype.Wt=function(t,n){var r=this,i=[],o=[];return n.forEach(function(s){o.push(te(t).get(s).next(function(u){if(u===null)throw D();x(u.userId===r.userId),i.push(Ze(r.R,u))}))}),b.waitFor(o).next(function(){return i})},e.prototype.removeMutationBatch=function(t,n){var r=this;return Za(t.Mt,this.userId,n).next(function(i){return t.addOnCommittedListener(function(){r.Gt(n.batchId)}),b.forEach(i,function(o){return r.referenceDelegate.markPotentiallyOrphaned(t,o)})})},e.prototype.Gt=function(t){delete this.Kt[t]},e.prototype.performConsistencyCheck=function(t){var n=this;return this.checkEmpty(t).next(function(r){if(!r)return b.resolve();var i=IDBKeyRange.lowerBound(pt.prefixForUser(n.userId)),o=[];return tn(t).$t({range:i},function(s,u,a){if(s[0]===n.userId){var c=Gt(s[1]);o.push(c)}else a.done()}).next(function(){x(o.length===0)})})},e.prototype.containsKey=function(t,n){return tc(t,this.userId,n)},e.prototype.zt=function(t){var n=this;return ec(t).get(this.userId).next(function(r){return r||new Zt(n.userId,-1,"")})},e}();function tc(e,t,n){var r=pt.prefixForPath(t,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return tn(e).$t({range:o,Ft:!0},function(u,a,c){var h=u[0],l=u[1];u[2],h===t&&l===i&&(s=!0),c.done()}).next(function(){return s})}function te(e){return Et(e,B.store)}function tn(e){return Et(e,pt.store)}function ec(e){return Et(e,Zt.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wr=function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),Hf=function(){function e(t,n){this.referenceDelegate=t,this.R=n}return e.prototype.allocateTargetId=function(t){var n=this;return this.Xt(t).next(function(r){var i=new Wr(r.highestTargetId);return r.highestTargetId=i.next(),n.Zt(t,r).next(function(){return r.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(n){return L.fromTimestamp(new Tt(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(n){return n.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(t,n,r){var i=this;return this.Xt(t).next(function(o){return o.highestListenSequenceNumber=n,r&&(o.lastRemoteSnapshotVersion=r.toTimestamp()),n>o.highestListenSequenceNumber&&(o.highestListenSequenceNumber=n),i.Zt(t,o)})},e.prototype.addTargetData=function(t,n){var r=this;return this.te(t,n).next(function(){return r.Xt(t).next(function(i){return i.targetCount+=1,r.ee(n,i),r.Zt(t,i)})})},e.prototype.updateTargetData=function(t,n){return this.te(t,n)},e.prototype.removeTargetData=function(t,n){var r=this;return this.removeMatchingKeysForTargetId(t,n.targetId).next(function(){return en(t).delete(n.targetId)}).next(function(){return r.Xt(t)}).next(function(i){return x(i.targetCount>0),i.targetCount-=1,r.Zt(t,i)})},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return en(t).$t(function(u,a){var c=zn(a);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(o++,s.push(i.removeTargetData(t,c)))}).next(function(){return b.waitFor(s)}).next(function(){return o})},e.prototype.forEachTarget=function(t,n){return en(t).$t(function(r,i){var o=zn(i);n(o)})},e.prototype.Xt=function(t){return nc(t).get(kt.key).next(function(n){return x(n!==null),n})},e.prototype.Zt=function(t,n){return nc(t).put(kt.key,n)},e.prototype.te=function(t,n){return en(t).put(Ha(this.R,n))},e.prototype.ee=function(t,n){var r=!1;return t.targetId>n.highestTargetId&&(n.highestTargetId=t.targetId,r=!0),t.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t.sequenceNumber,r=!0),r},e.prototype.getTargetCount=function(t){return this.Xt(t).next(function(n){return n.targetCount})},e.prototype.getTargetData=function(t,n){var r=Fn(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return en(t).$t({range:i,index:It.queryTargetsIndexName},function(s,u,a){var c=zn(u);Pr(n,c.target)&&(o=c,a.done())}).next(function(){return o})},e.prototype.addMatchingKeys=function(t,n,r){var i=this,o=[],s=ee(t);return n.forEach(function(u){var a=Pt(u.path);o.push(s.put(new ct(r,a))),o.push(i.referenceDelegate.addReference(t,r,u))}),b.waitFor(o)},e.prototype.removeMatchingKeys=function(t,n,r){var i=this,o=ee(t);return b.forEach(n,function(s){var u=Pt(s.path);return b.waitFor([o.delete([r,u]),i.referenceDelegate.removeReference(t,r,s)])})},e.prototype.removeMatchingKeysForTargetId=function(t,n){var r=ee(t),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=IDBKeyRange.bound([n],[n+1],!1,!0),i=ee(t),o=j();return i.$t({range:r,Ft:!0},function(s,u,a){var c=Gt(s[1]),h=new N(c);o=o.add(h)}).next(function(){return o})},e.prototype.containsKey=function(t,n){var r=Pt(n.path),i=IDBKeyRange.bound([r],[Uu(r)],!1,!0),o=0;return ee(t).$t({index:ct.documentTargetsIndex,Ft:!0,range:i},function(s,u,a){var c=s[0];s[1],c!==0&&(o++,a.done())}).next(function(){return o>0})},e.prototype.lt=function(t,n){return en(t).get(n).next(function(r){return r?zn(r):null})},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function en(e){return Et(e,It.store)}function nc(e){return Et(e,kt.store)}function ee(e){return Et(e,ct.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ie(e){return m(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==y.FAILED_PRECONDITION||e.message!==qa)throw e;return I("LocalStore","Unexpectedly lost primary lease"),[2]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],s=P(n,i);return s===0?P(r,o):s}var Wf=function(){function e(t){this.ne=t,this.buffer=new Z(rc),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var n=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(n);else{var r=this.buffer.last();rc(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),Yf=function(){function e(t,n){this.garbageCollector=t,this.asyncQueue=n,this.oe=!1,this.ce=null}return e.prototype.start=function(t){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return this.ce!==null},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var n=this,r=this.oe?3e5:6e4;I("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,function(){return m(n,void 0,void 0,function(){var i;return v(this,function(o){switch(o.label){case 0:this.ce=null,this.oe=!0,o.label=1;case 1:return o.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return o.sent(),[3,7];case 3:return be(i=o.sent())?(I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i),[3,6]):[3,4];case 4:return[4,Ie(i)];case 5:o.sent(),o.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return o.sent(),[2]}})})})},e}(),Xf=function(){function e(t,n){this.ae=t,this.params=n}return e.prototype.calculateTargetCount=function(t,n){return this.ae.he(t).next(function(r){return Math.floor(n/100*r)})},e.prototype.nthSequenceNumber=function(t,n){var r=this;if(n===0)return b.resolve(Dt.o);var i=new Wf(n);return this.ae.forEachTarget(t,function(o){return i.re(o.sequenceNumber)}).next(function(){return r.ae.le(t,function(o){return i.re(o)})}).next(function(){return i.maxValue})},e.prototype.removeTargets=function(t,n,r){return this.ae.removeTargets(t,n,r)},e.prototype.removeOrphanedDocuments=function(t,n){return this.ae.removeOrphanedDocuments(t,n)},e.prototype.collect=function(t,n){var r=this;return this.params.cacheSizeCollectionThreshold===-1?(I("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Ja)):this.getCacheSize(t).next(function(i){return i<r.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector","Garbage collection skipped; Cache size "+i+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Ja):r.fe(t,n)})},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,n){var r,i,o,s,u,a,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(f){return f>h.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+f),i=h.params.maximumSequenceNumbersToCollect):i=f,s=Date.now(),h.nthSequenceNumber(t,i)}).next(function(f){return r=f,u=Date.now(),h.removeTargets(t,r,n)}).next(function(f){return o=f,a=Date.now(),h.removeOrphanedDocuments(t,r)}).next(function(f){return c=Date.now(),lo()<=xe.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in `+(s-l)+`ms
	Determined least recently used `+i+" in "+(u-s)+`ms
	Removed `+o+" targets in "+(a-u)+`ms
	Removed `+f+" documents in "+(c-a)+`ms
Total Duration: `+(c-l)+"ms"),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:f})})},e}(),Jf=function(){function e(t,n){this.db=t,this.garbageCollector=function(r,i){return new Xf(r,i)}(this,n)}return e.prototype.he=function(t){var n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(r){return n.next(function(i){return r+i})})},e.prototype.de=function(t){var n=0;return this.le(t,function(r){n++}).next(function(){return n})},e.prototype.forEachTarget=function(t,n){return this.db.getTargetCache().forEachTarget(t,n)},e.prototype.le=function(t,n){return this.we(t,function(r,i){return n(i)})},e.prototype.addReference=function(t,n,r){return Yr(t,r)},e.prototype.removeReference=function(t,n,r){return Yr(t,r)},e.prototype.removeTargets=function(t,n,r){return this.db.getTargetCache().removeTargets(t,n,r)},e.prototype.markPotentiallyOrphaned=function(t,n){return Yr(t,n)},e.prototype._e=function(t,n){return function(r,i){var o=!1;return ec(r).Ot(function(s){return tc(r,s,i).next(function(u){return u&&(o=!0),b.resolve(!u)})}).next(function(){return o})}(t,n)},e.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=this.db.getRemoteDocumentCache().newChangeBuffer(),o=[],s=0;return this.we(t,function(u,a){if(a<=n){var c=r._e(t,u).next(function(h){if(!h)return s++,i.getEntry(t,u).next(function(){return i.removeEntry(u),ee(t).delete([0,Pt(u.path)])})});o.push(c)}}).next(function(){return b.waitFor(o)}).next(function(){return i.apply(t)}).next(function(){return s})},e.prototype.removeTarget=function(t,n){var r=n.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)},e.prototype.updateLimboDocument=function(t,n){return Yr(t,n)},e.prototype.we=function(t,n){var r,i=ee(t),o=Dt.o;return i.$t({index:ct.documentTargetsIndex},function(s,u){var a=s[0];s[1];var c=u.path,h=u.sequenceNumber;a===0?(o!==Dt.o&&n(new N(Gt(r)),o),o=h,r=c):o=Dt.o}).next(function(){o!==Dt.o&&n(new N(Gt(r)),o)})},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e}();function Yr(e,t){return ee(e).put(function(n,r){return new ct(0,Pt(n.path),r)}(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nn=function(){function e(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return e.prototype.get=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0)for(var i=0,o=r;i<o.length;i++){var s=o[i],u=s[0],a=s[1];if(this.equalsFn(u,t))return a}},e.prototype.has=function(t){return this.get(t)!==void 0},e.prototype.set=function(t,n){var r=this.mapKeyFn(t),i=this.inner[r];if(i!==void 0){for(var o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,n]);i.push([t,n])}else this.inner[r]=[[t,n]]},e.prototype.delete=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[n]:r.splice(i,1),!0;return!1},e.prototype.forEach=function(t){pe(this.inner,function(n,r){for(var i=0,o=r;i<o.length;i++){var s=o[i],u=s[0],a=s[1];t(u,a)}})},e.prototype.isEmpty=function(){return ju(this.inner)},e}(),ic=function(){function e(){this.changes=new nn(function(t){return t.toString()},function(t,n){return t.isEqual(n)}),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var n=this.changes.get(t);return n?n.readTime:L.min()},e.prototype.addEntry=function(t,n){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:n})},e.prototype.removeEntry=function(t,n){n===void 0&&(n=null),this.assertNotApplied(),this.changes.set(t,{document:at.newInvalidDocument(t),readTime:n})},e.prototype.getEntry=function(t,n){this.assertNotApplied();var r=this.changes.get(n);return r!==void 0?b.resolve(r.document):this.getFromCache(t,n)},e.prototype.getEntries=function(t,n){return this.getAllFromCache(t,n)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e}(),Zf=function(){function e(t,n){this.R=t,this.Ut=n}return e.prototype.addEntry=function(t,n,r){return ne(t).put(Xr(n),r)},e.prototype.removeEntry=function(t,n){var r=ne(t),i=Xr(n);return r.delete(i)},e.prototype.updateMetadata=function(t,n){var r=this;return this.getMetadata(t).next(function(i){return i.byteSize+=n,r.me(t,i)})},e.prototype.getEntry=function(t,n){var r=this;return ne(t).get(Xr(n)).next(function(i){return r.ye(n,i)})},e.prototype.ge=function(t,n){var r=this;return ne(t).get(Xr(n)).next(function(i){return{document:r.ye(n,i),size:Hr(i)}})},e.prototype.getEntries=function(t,n){var r=this,i=Rt();return this.pe(t,n,function(o,s){var u=r.ye(o,s);i=i.insert(o,u)}).next(function(){return i})},e.prototype.Ee=function(t,n){var r=this,i=Rt(),o=new dt(N.comparator);return this.pe(t,n,function(s,u){var a=r.ye(s,u);i=i.insert(s,a),o=o.insert(s,Hr(u))}).next(function(){return{documents:i,Te:o}})},e.prototype.pe=function(t,n,r){if(n.isEmpty())return b.resolve();var i=IDBKeyRange.bound(n.first().path.toArray(),n.last().path.toArray()),o=n.getIterator(),s=o.getNext();return ne(t).$t({range:i},function(u,a,c){for(var h=N.fromSegments(u);s&&N.comparator(s,h)<0;)r(s,null),s=o.getNext();s&&s.isEqual(h)&&(r(s,a),s=o.hasNext()?o.getNext():null),s?c.Ct(s.path.toArray()):c.done()}).next(function(){for(;s;)r(s,null),s=o.hasNext()?o.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){var i=this,o=Rt(),s=n.path.length+1,u={};if(r.isEqual(L.min())){var a=n.path.toArray();u.range=IDBKeyRange.lowerBound(a)}else{var c=n.path.toArray(),h=Lo(r);u.range=IDBKeyRange.lowerBound([c,h],!0),u.index=Q.collectionReadTimeIndex}return ne(t).$t(u,function(l,f,p){if(l.length===s){var d=Ro(i.R,f);n.path.isPrefixOf(d.key.path)?Un(n,d)&&(o=o.insert(d.key,d)):p.done()}}).next(function(){return o})},e.prototype.newChangeBuffer=function(t){return new td(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next(function(n){return n.byteSize})},e.prototype.getMetadata=function(t){return oc(t).get(Vt.key).next(function(n){return x(!!n),n})},e.prototype.me=function(t,n){return oc(t).put(Vt.key,n)},e.prototype.ye=function(t,n){if(n){var r=Ro(this.R,n);if(!r.isNoDocument()||!r.version.isEqual(L.min()))return r}return at.newInvalidDocument(t)},e}(),td=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Ie=n,i.trackRemovals=r,i.Ae=new nn(function(o){return o.toString()},function(o,s){return o.isEqual(s)}),i}return k(t,e),t.prototype.applyChanges=function(n){var r=this,i=[],o=0,s=new Z(function(u,a){return P(u.canonicalString(),a.canonicalString())});return this.changes.forEach(function(u,a){var c=r.Ae.get(u);if(a.document.isValidDocument()){var h=$a(r.Ie.R,a.document,r.getReadTime(u));s=s.add(u.path.popLast());var l=Hr(h);o+=l-c,i.push(r.Ie.addEntry(n,u,h))}else if(o-=c,r.trackRemovals){var f=$a(r.Ie.R,at.newNoDocument(u,L.min()),r.getReadTime(u));i.push(r.Ie.addEntry(n,u,f))}else i.push(r.Ie.removeEntry(n,u))}),s.forEach(function(u){i.push(r.Ie.Ut.addToCollectionParentIndex(n,u))}),i.push(this.Ie.updateMetadata(n,o)),b.waitFor(i)},t.prototype.getFromCache=function(n,r){var i=this;return this.Ie.ge(n,r).next(function(o){return i.Ae.set(r,o.size),o.document})},t.prototype.getAllFromCache=function(n,r){var i=this;return this.Ie.Ee(n,r).next(function(o){var s=o.documents;return o.Te.forEach(function(u,a){i.Ae.set(u,a)}),s})},t}(ic);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oc(e){return Et(e,Vt.store)}function ne(e){return Et(e,Q.store)}function Xr(e){return e.path.toArray()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ed=function(){function e(t){this.R=t}return e.prototype.Rt=function(t,n,r,i){var o=this;x(r<i&&r>=0&&i<=11);var s=new Ba("createOrUpgrade",n);r<1&&i>=1&&(function(a){a.createObjectStore(Ct.store)}(t),function(a){a.createObjectStore(Zt.store,{keyPath:Zt.keyPath}),a.createObjectStore(B.store,{keyPath:B.keyPath,autoIncrement:!0}).createIndex(B.userMutationsIndex,B.userMutationsKeyPath,{unique:!0}),a.createObjectStore(pt.store)}(t),sc(t),function(a){a.createObjectStore(Q.store)}(t));var u=b.resolve();return r<3&&i>=3&&(r!==0&&(function(a){a.deleteObjectStore(ct.store),a.deleteObjectStore(It.store),a.deleteObjectStore(kt.store)}(t),sc(t)),u=u.next(function(){return function(a){var c=a.store(kt.store),h=new kt(0,0,L.min().toTimestamp(),0);return c.put(kt.key,h)}(s)})),r<4&&i>=4&&(r!==0&&(u=u.next(function(){return function(a,c){return c.store(B.store).Nt().next(function(h){a.deleteObjectStore(B.store),a.createObjectStore(B.store,{keyPath:B.keyPath,autoIncrement:!0}).createIndex(B.userMutationsIndex,B.userMutationsKeyPath,{unique:!0});var l=c.store(B.store),f=h.map(function(p){return l.put(p)});return b.waitFor(f)})}(t,s)})),u=u.next(function(){(function(a){a.createObjectStore(Qt.store,{keyPath:Qt.keyPath})})(t)})),r<5&&i>=5&&(u=u.next(function(){return o.Re(s)})),r<6&&i>=6&&(u=u.next(function(){return function(a){a.createObjectStore(Vt.store)}(t),o.be(s)})),r<7&&i>=7&&(u=u.next(function(){return o.ve(s)})),r<8&&i>=8&&(u=u.next(function(){return o.Pe(t,s)})),r<9&&i>=9&&(u=u.next(function(){(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(t),function(a){var c=a.objectStore(Q.store);c.createIndex(Q.readTimeIndex,Q.readTimeIndexPath,{unique:!1}),c.createIndex(Q.collectionReadTimeIndex,Q.collectionReadTimeIndexPath,{unique:!1})}(n)})),r<10&&i>=10&&(u=u.next(function(){return o.Ve(s)})),r<11&&i>=11&&(u=u.next(function(){(function(a){a.createObjectStore(He.store,{keyPath:He.keyPath})})(t),function(a){a.createObjectStore(We.store,{keyPath:We.keyPath})}(t)})),u},e.prototype.be=function(t){var n=0;return t.store(Q.store).$t(function(r,i){n+=Hr(i)}).next(function(){var r=new Vt(n);return t.store(Vt.store).put(Vt.key,r)})},e.prototype.Re=function(t){var n=this,r=t.store(Zt.store),i=t.store(B.store);return r.Nt().next(function(o){return b.forEach(o,function(s){var u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.Nt(B.userMutationsIndex,u).next(function(a){return b.forEach(a,function(c){x(c.userId===s.userId);var h=Ze(n.R,c);return Za(t,s.userId,h).next(function(){})})})})})},e.prototype.ve=function(t){var n=t.store(ct.store),r=t.store(Q.store);return t.store(kt.store).get(kt.key).next(function(i){var o=[];return r.$t(function(s,u){var a=new V(s),c=function(h){return[0,Pt(h)]}(a);o.push(n.get(c).next(function(h){return h?b.resolve():function(l){return n.put(new ct(0,Pt(l),i.highestListenSequenceNumber))}(a)}))}).next(function(){return b.waitFor(o)})})},e.prototype.Pe=function(t,n){t.createObjectStore(we.store,{keyPath:we.keyPath});var r=n.store(we.store),i=new Po,o=function(s){if(i.add(s)){var u=s.lastSegment(),a=s.popLast();return r.put({collectionId:u,parent:Pt(a)})}};return n.store(Q.store).$t({Ft:!0},function(s,u){var a=new V(s);return o(a.popLast())}).next(function(){return n.store(pt.store).$t({Ft:!0},function(s,u){s[0];var a=s[1];s[2];var c=Gt(a);return o(c.popLast())})})},e.prototype.Ve=function(t){var n=this,r=t.store(It.store);return r.$t(function(i,o){var s=zn(o),u=Ha(n.R,s);return r.put(u)})},e}();function sc(e){e.createObjectStore(ct.store,{keyPath:ct.keyPath}).createIndex(ct.documentTargetsIndex,ct.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(It.store,{keyPath:It.keyPath}).createIndex(It.queryTargetsIndexName,It.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(kt.store)}var Fo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",nd=function(){function e(t,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=u,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(l){return Promise.resolve()},!e.yt())throw new w(y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Jf(this,i),this.Le=n+"main",this.R=new Qa(a),this.Be=new Ye(this.Le,11,new ed(this.R)),this.qe=new Hf(this.referenceDelegate,this.R),this.Ut=new $f,this.Ue=function(l,f){return new Zf(l,f)}(this.R,this.Ut),this.Ke=new Gf,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,h===!1&&Y("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new w(y.FAILED_PRECONDITION,Fo);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(n){return t.qe.getHighestSequenceNumber(n)})}).then(function(n){t.Ne=new Dt(n,t.De)}).then(function(){t.xe=!0}).catch(function(n){return t.Be&&t.Be.close(),Promise.reject(n)})},e.prototype.He=function(t){var n=this;return this.Me=function(r){return m(n,void 0,void 0,function(){return v(this,function(i){return this.started?[2,t(r)]:[2]})})},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var n=this;this.Be.vt(function(r){return m(n,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return r.newVersion===null?[4,t()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return m(n,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(n){return Jr(n).put(new Qt(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(n).next(function(r){r||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(n)}).next(function(r){return t.isPrimary&&!r?t.Xe(n).next(function(){return!1}):!!r&&t.Ze(n).next(function(){return!0})})}).catch(function(n){if(be(n))return I("IndexedDbPersistence","Failed to extend owner lease: ",n),t.isPrimary;if(!t.allowTabSynchronization)throw n;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",n),!1}).then(function(n){t.isPrimary!==n&&t.Se.enqueueRetryable(function(){return t.Me(n)}),t.isPrimary=n})},e.prototype.Je=function(t){var n=this;return Hn(t).get(Ct.key).next(function(r){return b.resolve(n.tn(r))})},e.prototype.en=function(t){return Jr(t).delete(this.clientId)},e.prototype.nn=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o=this;return v(this,function(s){switch(s.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(u){var a=Et(u,Qt.store);return a.Nt().next(function(c){var h=o.rn(c,18e5),l=c.filter(function(f){return h.indexOf(f)===-1});return b.forEach(l,function(f){return a.delete(f.clientId)}).next(function(){return l})})}).catch(function(){return[]})]);case 1:if(t=s.sent(),this.Qe)for(n=0,r=t;n<r.length;n++)i=r[n],this.Qe.removeItem(this.on(i.clientId));s.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var n=this;return this.Ce?b.resolve(!0):Hn(t).get(Ct.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)){if(n.tn(r)&&n.networkEnabled)return!0;if(!n.tn(r)){if(!r.allowTabSynchronization)throw new w(y.FAILED_PRECONDITION,Fo);return!1}}return!(!n.networkEnabled||!n.inForeground)||Jr(t).Nt().next(function(i){return n.rn(i,5e3).find(function(o){if(n.clientId!==o.clientId){var s=!n.networkEnabled&&o.networkEnabled,u=!n.inForeground&&o.inForeground,a=n.networkEnabled===o.networkEnabled;if(s||u&&a)return!0}return!1})===void 0})}).next(function(r){return n.isPrimary!==r&&I("IndexedDbPersistence","Client "+(r?"is":"is not")+" eligible for a primary lease."),r})},e.prototype.shutdown=function(){return m(this,void 0,void 0,function(){var t=this;return v(this,function(n){switch(n.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ct.store,Qt.store],function(r){var i=new Ga(r,Dt.o);return t.Xe(i).next(function(){return t.en(i)})})];case 1:return n.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(t,n){var r=this;return t.filter(function(i){return r.sn(i.updateTimeMs,n)&&!r.cn(i.clientId)})},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(n){return Jr(n).Nt().next(function(r){return t.rn(r,18e5).map(function(i){return i.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return zf.Qt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;I("IndexedDbPersistence","Starting transaction:",t);var o,s=n==="readonly"?"readonly":"readwrite";return this.Be.runTransaction(t,s,qf,function(u){return o=new Ga(u,i.Ne?i.Ne.next():Dt.o),n==="readwrite-primary"?i.Je(o).next(function(a){return!!a||i.Ye(o)}).next(function(a){if(!a)throw Y("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new w(y.FAILED_PRECONDITION,qa);return r(o)}).next(function(a){return i.Ze(o).next(function(){return a})}):i.dn(o).next(function(){return r(o)})}).then(function(u){return o.raiseOnCommittedEvent(),u})},e.prototype.dn=function(t){var n=this;return Hn(t).get(Ct.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)&&!n.tn(r)&&!(n.Ce||n.allowTabSynchronization&&r.allowTabSynchronization))throw new w(y.FAILED_PRECONDITION,Fo)})},e.prototype.Ze=function(t){var n=new Ct(this.clientId,this.allowTabSynchronization,Date.now());return Hn(t).put(Ct.key,n)},e.yt=function(){return Ye.yt()},e.prototype.Xe=function(t){var n=this,r=Hn(t);return r.get(Ct.key).next(function(i){return n.tn(i)?(I("IndexedDbPersistence","Releasing primary lease."),r.delete(Ct.key)):b.resolve()})},e.prototype.sn=function(t,n){var r=Date.now();return!(t<r-n||t>r&&(Y("Detected an update time that is in the future: "+t+" > "+r),1))},e.prototype.We=function(){var t=this;this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground=t.document.visibilityState==="visible",t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground=this.document.visibilityState==="visible")},e.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},e.prototype.Ge=function(){var t,n=this;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ke=function(){n.un(),Fh()&&navigator.appVersion.match("Version/14")&&n.Se.enterRestrictedMode(!0),n.Se.enqueueAndForget(function(){return n.shutdown()})},this.window.addEventListener("pagehide",this.ke))},e.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},e.prototype.cn=function(t){var n;try{var r=((n=this.Qe)===null||n===void 0?void 0:n.getItem(this.on(t)))!==null;return I("IndexedDbPersistence","Client '"+t+"' "+(r?"is":"is not")+" zombied in LocalStorage"),r}catch(i){return Y("IndexedDbPersistence","Failed to get zombied client id.",i),!1}},e.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Y("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch{}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e}();function Hn(e){return Et(e,Ct.store)}function Jr(e){return Et(e,Qt.store)}function Mo(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var rd=function(e,t){this.progress=e,this.wn=t},uc=function(){function e(t,n,r){this.Ue=t,this._n=n,this.Ut=r}return e.prototype.mn=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(i){return r.yn(t,n,i)})},e.prototype.yn=function(t,n,r){return this.Ue.getEntry(t,n).next(function(i){for(var o=0,s=r;o<s.length;o++)s[o].applyToLocalView(i);return i})},e.prototype.gn=function(t,n){t.forEach(function(r,i){for(var o=0,s=n;o<s.length;o++)s[o].applyToLocalView(i)})},e.prototype.pn=function(t,n){var r=this;return this.Ue.getEntries(t,n).next(function(i){return r.En(t,i).next(function(){return i})})},e.prototype.En=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,n).next(function(i){return r.gn(n,i)})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){return function(i){return N.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.Tn(t,n.path):To(n)?this.In(t,n,r):this.An(t,n,r)},e.prototype.Tn=function(t,n){return this.mn(t,new N(n)).next(function(r){var i=So();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})},e.prototype.In=function(t,n,r){var i=this,o=n.collectionGroup,s=So();return this.Ut.getCollectionParents(t,o).next(function(u){return b.forEach(u,function(a){var c=function(h,l){return new Kt(l,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,a.child(o));return i.An(t,c,r).next(function(h){h.forEach(function(l,f){s=s.insert(l,f)})})}).next(function(){return s})})},e.prototype.An=function(t,n,r){var i,o,s=this;return this.Ue.getDocumentsMatchingQuery(t,n,r).next(function(u){return i=u,s._n.getAllMutationBatchesAffectingQuery(t,n)}).next(function(u){return o=u,s.Rn(t,o,i).next(function(a){i=a;for(var c=0,h=o;c<h.length;c++)for(var l=h[c],f=0,p=l.mutations;f<p.length;f++){var d=p[f],g=d.key,T=i.get(g);T==null&&(T=at.newInvalidDocument(g),i=i.insert(g,T)),Eo(d,T,l.localWriteTime),T.isFoundDocument()||(i=i.remove(g))}})}).next(function(){return i.forEach(function(u,a){Un(n,a)||(i=i.remove(u))}),i})},e.prototype.Rn=function(t,n,r){for(var i=j(),o=0,s=n;o<s.length;o++)for(var u=0,a=s[o].mutations;u<a.length;u++){var c=a[u];c instanceof Xt&&r.get(c.key)===null&&(i=i.add(c.key))}var h=r;return this.Ue.getEntries(t,i).next(function(l){return l.forEach(function(f,p){p.isFoundDocument()&&(h=h.insert(f,p))}),h})},e}(),id=function(){function e(t,n,r,i){this.targetId=t,this.fromCache=n,this.bn=r,this.vn=i}return e.Pn=function(t,n){for(var r=j(),i=j(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new e(t,n.fromCache,r,i)},e}(),ac=function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,n,r,i){var o=this;return function(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}(n)||r.isEqual(L.min())?this.Dn(t,n):this.Sn.pn(t,i).next(function(s){var u=o.Cn(n,s);return(Vr(n)||Ur(n))&&o.Nn(n.limitType,u,i,r)?o.Dn(t,n):(lo()<=xe.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Io(n)),o.Sn.getDocumentsMatchingQuery(t,n,r).next(function(a){return u.forEach(function(c){a=a.insert(c.key,c)}),a}))})},e.prototype.Cn=function(t,n){var r=new Z(na(t));return n.forEach(function(i,o){Un(t,o)&&(r=r.add(o))}),r},e.prototype.Nn=function(t,n,r,i){if(r.size!==n.size)return!0;var o=t==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)},e.prototype.Dn=function(t,n){return lo()<=xe.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",Io(n)),this.Sn.getDocumentsMatchingQuery(t,n,L.min())},e}(),od=function(){function e(t,n,r,i){this.persistence=t,this.xn=n,this.R=i,this.kn=new dt(P),this.Fn=new nn(function(o){return Fn(o)},Pr),this.$n=L.min(),this._n=t.getMutationQueue(r),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new uc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(r){return t.collect(r,n.kn)})},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(e,t,n,r){return new od(e,t,n,r)}function hc(e,t){return m(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(s){switch(s.label){case 0:return n=_(e),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(u){var a;return n._n.getAllMutationBatches(u).next(function(c){return a=c,r=n.persistence.getMutationQueue(t),i=new uc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(u)}).next(function(c){for(var h=[],l=[],f=j(),p=0,d=a;p<d.length;p++){var g=d[p];h.push(g.batchId);for(var T=0,E=g.mutations;T<E.length;T++){var A=E[T];f=f.add(A.key)}}for(var C=0,O=c;C<O.length;C++){var F=O[C];l.push(F.batchId);for(var q=0,it=F.mutations;q<it.length;q++){var vi=it[q];f=f.add(vi.key)}}return i.pn(u,f).next(function(dn){return{Ln:dn,removedBatchIds:h,addedBatchIds:l}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function sd(e,t){var n=_(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(r){var i=t.batch.keys(),o=n.On.newChangeBuffer({trackRemovals:!0});return function(s,u,a,c){var h=a.batch,l=h.keys(),f=b.resolve();return l.forEach(function(p){f=f.next(function(){return c.getEntry(u,p)}).next(function(d){var g=a.docVersions.get(p);x(g!==null),d.version.compareTo(g)<0&&(h.applyToRemoteDocument(d,a),d.isValidDocument()&&c.addEntry(d,a.commitVersion))})}),f.next(function(){return s._n.removeMutationBatch(u,h)})}(n,r,t,o).next(function(){return o.apply(r)}).next(function(){return n._n.performConsistencyCheck(r)}).next(function(){return n.Mn.pn(r,i)})})}function lc(e){var t=_(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(n){return t.qe.getLastRemoteSnapshotVersion(n)})}function ud(e,t){var n=_(e),r=t.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var s=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var u=[];t.targetChanges.forEach(function(h,l){var f=i.get(l);if(f){u.push(n.qe.removeMatchingKeys(o,h.removedDocuments,l).next(function(){return n.qe.addMatchingKeys(o,h.addedDocuments,l)}));var p=h.resumeToken;if(p.approximateByteSize()>0){var d=f.withResumeToken(p,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(l,d),function(g,T,E){return x(T.resumeToken.approximateByteSize()>0),g.resumeToken.approximateByteSize()===0||T.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8||E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(f,d,h)&&u.push(n.qe.updateTargetData(o,d))}}});var a=Rt();if(t.documentUpdates.forEach(function(h,l){t.resolvedLimboDocuments.has(h)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(o,h))}),u.push(fc(o,s,t.documentUpdates,r,void 0).next(function(h){a=h})),!r.isEqual(L.min())){var c=n.qe.getLastRemoteSnapshotVersion(o).next(function(h){return n.qe.setTargetsMetadata(o,o.currentSequenceNumber,r)});u.push(c)}return b.waitFor(u).next(function(){return s.apply(o)}).next(function(){return n.Mn.En(o,a)}).next(function(){return a})}).then(function(o){return n.kn=i,o})}function fc(e,t,n,r,i){var o=j();return n.forEach(function(s){return o=o.add(s)}),t.getEntries(e,o).next(function(s){var u=Rt();return n.forEach(function(a,c){var h=s.get(a),l=(i==null?void 0:i.get(a))||r;c.isNoDocument()&&c.version.isEqual(L.min())?(t.removeEntry(a,l),u=u.insert(a,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c,l),u=u.insert(a,c)):I("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version)}),u})}function ad(e,t){var n=_(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(r){return t===void 0&&(t=-1),n._n.getNextMutationBatchAfterBatchId(r,t)})}function rn(e,t){var n=_(e);return n.persistence.runTransaction("Allocate target","readwrite",function(r){var i;return n.qe.getTargetData(r,t).next(function(o){return o?(i=o,b.resolve(i)):n.qe.allocateTargetId(r).next(function(s){return i=new zr(t,s,0,r.currentSequenceNumber),n.qe.addTargetData(r,i).next(function(){return i})})})}).then(function(r){var i=n.kn.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.kn=n.kn.insert(r.targetId,r),n.Fn.set(t,r.targetId)),r})}function on(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return v(this,function(u){switch(u.label){case 0:r=_(e),i=r.kn.get(t),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(a){return r.persistence.referenceDelegate.removeTarget(a,i)})];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!be(s=u.sent()))throw s;return I("LocalStore","Failed to update sequence numbers for target "+t+": "+s),[3,5];case 5:return r.kn=r.kn.remove(t),r.Fn.delete(i.target),[2]}})})}function Zr(e,t,n){var r=_(e),i=L.min(),o=j();return r.persistence.runTransaction("Execute query","readonly",function(s){return function(u,a,c){var h=_(u),l=h.Fn.get(c);return l!==void 0?b.resolve(h.kn.get(l)):h.qe.getTargetData(a,c)}(r,s,xt(t)).next(function(u){if(u)return i=u.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(s,u.targetId).next(function(a){o=a})}).next(function(){return r.xn.getDocumentsMatchingQuery(s,t,n?i:L.min(),n?o:j())}).next(function(u){return{documents:u,Bn:o}})})}function dc(e,t){var n=_(e),r=_(n.qe),i=n.kn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(o){return r.lt(o,t).next(function(s){return s?s.target:null})})}function pc(e){var t=_(e);return t.persistence.runTransaction("Get new document changes","readonly",function(n){return function(r,i,o){var s=_(r),u=Rt(),a=Lo(o),c=ne(i),h=IDBKeyRange.lowerBound(a,!0);return c.$t({index:Q.readTimeIndex,range:h},function(l,f){var p=Ro(s.R,f);u=u.insert(p.key,p),a=f.readTime}).next(function(){return{wn:u,readTime:za(a)}})}(t.On,n,t.$n)}).then(function(n){var r=n.wn,i=n.readTime;return t.$n=i,r})}function cd(e){return m(this,void 0,void 0,function(){var t;return v(this,function(n){return[2,(t=_(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(r){return function(i){var o=ne(i),s=L.min();return o.$t({index:Q.readTimeIndex,reverse:!0},function(u,a,c){a.readTime&&(s=za(a.readTime)),c.done()}).next(function(){return s})}(r)}).then(function(r){t.$n=r})]})})}function hd(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s,u,a,c,h,l,f,p;return v(this,function(d){switch(d.label){case 0:for(i=_(e),o=j(),s=Rt(),u=wa(),a=0,c=n;a<c.length;a++)h=c[a],l=t.qn(h.metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,t.Un(h)),u=u.insert(l,t.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,rn(i,function(g){return xt(Be(V.fromString("__bundle__/docs/"+g)))}(r))];case 1:return p=d.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(g){return fc(g,f,s,L.min(),u).next(function(T){return f.apply(g),T}).next(function(T){return i.qe.removeMatchingKeysForTargetId(g,p.targetId).next(function(){return i.qe.addMatchingKeys(g,o,p.targetId)}).next(function(){return i.Mn.En(g,T)}).next(function(){return T})})})]}})})}function ld(e,t,n){return n===void 0&&(n=j()),m(this,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return[4,rn(e,xt(Oo(t.bundledQuery)))];case 1:return r=o.sent(),[2,(i=_(e)).persistence.runTransaction("Save named query","readwrite",function(s){var u=et(t.readTime);if(r.snapshotVersion.compareTo(u)>=0)return i.Ke.saveNamedQuery(s,t);var a=r.withResumeToken(wt.EMPTY_BYTE_STRING,u);return i.kn=i.kn.insert(a.targetId,a),i.qe.updateTargetData(s,a).next(function(){return i.qe.removeMatchingKeysForTargetId(s,r.targetId)}).next(function(){return i.qe.addMatchingKeys(s,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(s,t)})})]}})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fd=function(){function e(t){this.R=t,this.Qn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,n){return b.resolve(this.Qn.get(n))},e.prototype.saveBundleMetadata=function(t,n){var r;return this.Qn.set(n.id,{id:(r=n).id,version:r.version,createTime:et(r.createTime)}),b.resolve()},e.prototype.getNamedQuery=function(t,n){return b.resolve(this.jn.get(n))},e.prototype.saveNamedQuery=function(t,n){return this.jn.set(n.name,function(r){return{name:r.name,query:Oo(r.bundledQuery),readTime:et(r.readTime)}}(n)),b.resolve()},e}(),Vo=function(){function e(){this.Wn=new Z(nt.Gn),this.zn=new Z(nt.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,n){var r=new nt(t,n);this.Wn=this.Wn.add(r),this.zn=this.zn.add(r)},e.prototype.Jn=function(t,n){var r=this;t.forEach(function(i){return r.addReference(i,n)})},e.prototype.removeReference=function(t,n){this.Yn(new nt(t,n))},e.prototype.Xn=function(t,n){var r=this;t.forEach(function(i){return r.removeReference(i,n)})},e.prototype.Zn=function(t){var n=this,r=new N(new V([])),i=new nt(r,t),o=new nt(r,t+1),s=[];return this.zn.forEachInRange([i,o],function(u){n.Yn(u),s.push(u.key)}),s},e.prototype.ts=function(){var t=this;this.Wn.forEach(function(n){return t.Yn(n)})},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var n=new N(new V([])),r=new nt(n,t),i=new nt(n,t+1),o=j();return this.zn.forEachInRange([r,i],function(s){o=o.add(s.key)}),o},e.prototype.containsKey=function(t){var n=new nt(t,0),r=this.Wn.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)},e}(),nt=function(){function e(t,n){this.key=t,this.ns=n}return e.Gn=function(t,n){return N.comparator(t.key,n.key)||P(t.ns,n.ns)},e.Hn=function(t,n){return P(t.ns,n.ns)||N.comparator(t.key,n.key)},e}(),dd=function(){function e(t,n){this.Ut=t,this.referenceDelegate=n,this._n=[],this.ss=1,this.rs=new Z(nt.Gn)}return e.prototype.checkEmpty=function(t){return b.resolve(this._n.length===0)},e.prototype.addMutationBatch=function(t,n,r,i){var o=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var s=new xo(o,n,r,i);this._n.push(s);for(var u=0,a=i;u<a.length;u++){var c=a[u];this.rs=this.rs.add(new nt(c.key,o)),this.Ut.addToCollectionParentIndex(t,c.key.path.popLast())}return b.resolve(s)},e.prototype.lookupMutationBatch=function(t,n){return b.resolve(this.os(n))},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=n+1,i=this.cs(r),o=i<0?0:i;return b.resolve(this._n.length>o?this._n[o]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return b.resolve(this._n.length===0?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return b.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=new nt(n,0),o=new nt(n,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([i,o],function(u){var a=r.os(u.ns);s.push(a)}),b.resolve(s)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new Z(P);return n.forEach(function(o){var s=new nt(o,0),u=new nt(o,Number.POSITIVE_INFINITY);r.rs.forEachInRange([s,u],function(a){i=i.add(a.ns)})}),b.resolve(this.us(i))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=n.path,i=r.length+1,o=r;N.isDocumentKey(o)||(o=o.child(""));var s=new nt(new N(o),0),u=new Z(P);return this.rs.forEachWhile(function(a){var c=a.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(u=u.add(a.ns)),!0)},s),b.resolve(this.us(u))},e.prototype.us=function(t){var n=this,r=[];return t.forEach(function(i){var o=n.os(i);o!==null&&r.push(o)}),r},e.prototype.removeMutationBatch=function(t,n){var r=this;x(this.hs(n.batchId,"removed")===0),this._n.shift();var i=this.rs;return b.forEach(n.mutations,function(o){var s=new nt(o.key,n.batchId);return i=i.delete(s),r.referenceDelegate.markPotentiallyOrphaned(t,o.key)}).next(function(){r.rs=i})},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,n){var r=new nt(n,0),i=this.rs.firstAfterOrEqual(r);return b.resolve(n.isEqual(i&&i.key))},e.prototype.performConsistencyCheck=function(t){return this._n.length,b.resolve()},e.prototype.hs=function(t,n){return this.cs(t)},e.prototype.cs=function(t){return this._n.length===0?0:t-this._n[0].batchId},e.prototype.os=function(t){var n=this.cs(t);return n<0||n>=this._n.length?null:this._n[n]},e}(),pd=function(){function e(t,n){this.Ut=t,this.ls=n,this.docs=new dt(N.comparator),this.size=0}return e.prototype.addEntry=function(t,n,r){var i=n.key,o=this.docs.get(i),s=o?o.size:0,u=this.ls(n);return this.docs=this.docs.insert(i,{document:n.clone(),size:u,readTime:r}),this.size+=u-s,this.Ut.addToCollectionParentIndex(t,i.path.popLast())},e.prototype.removeEntry=function(t){var n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)},e.prototype.getEntry=function(t,n){var r=this.docs.get(n);return b.resolve(r?r.document.clone():at.newInvalidDocument(n))},e.prototype.getEntries=function(t,n){var r=this,i=Rt();return n.forEach(function(o){var s=r.docs.get(o);i=i.insert(o,s?s.document.clone():at.newInvalidDocument(o))}),b.resolve(i)},e.prototype.getDocumentsMatchingQuery=function(t,n,r){for(var i=Rt(),o=new N(n.path.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var u=s.getNext(),a=u.key,c=u.value,h=c.document,l=c.readTime;if(!n.path.isPrefixOf(a.path))break;l.compareTo(r)<=0||Un(n,h)&&(i=i.insert(h.key,h.clone()))}return b.resolve(i)},e.prototype.fs=function(t,n){return b.forEach(this.docs,function(r){return n(r)})},e.prototype.newChangeBuffer=function(t){return new yd(this)},e.prototype.getSize=function(t){return b.resolve(this.size)},e}(),yd=function(e){function t(n){var r=this;return(r=e.call(this)||this).Ie=n,r}return k(t,e),t.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(o,s){s.document.isValidDocument()?i.push(r.Ie.addEntry(n,s.document,r.getReadTime(o))):r.Ie.removeEntry(o)}),b.waitFor(i)},t.prototype.getFromCache=function(n,r){return this.Ie.getEntry(n,r)},t.prototype.getAllFromCache=function(n,r){return this.Ie.getEntries(n,r)},t}(ic),gd=function(){function e(t){this.persistence=t,this.ds=new nn(function(n){return Fn(n)},Pr),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.ws=0,this._s=new Vo,this.targetCount=0,this.ys=Wr.Jt()}return e.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(r,i){return n(i)}),b.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return b.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return b.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),b.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ws&&(this.ws=n),b.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var n=t.targetId;n>this.highestTargetId&&(this.ys=new Wr(n),this.highestTargetId=n),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,n){return this.te(n),this.targetCount+=1,b.resolve()},e.prototype.updateTargetData=function(t,n){return this.te(n),b.resolve()},e.prototype.removeTargetData=function(t,n){return this.ds.delete(n.target),this._s.Zn(n.targetId),this.targetCount-=1,b.resolve()},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return this.ds.forEach(function(u,a){a.sequenceNumber<=n&&r.get(a.targetId)===null&&(i.ds.delete(u),s.push(i.removeMatchingKeysForTargetId(t,a.targetId)),o++)}),b.waitFor(s).next(function(){return o})},e.prototype.getTargetCount=function(t){return b.resolve(this.targetCount)},e.prototype.getTargetData=function(t,n){var r=this.ds.get(n)||null;return b.resolve(r)},e.prototype.addMatchingKeys=function(t,n,r){return this._s.Jn(n,r),b.resolve()},e.prototype.removeMatchingKeys=function(t,n,r){this._s.Xn(n,r);var i=this.persistence.referenceDelegate,o=[];return i&&n.forEach(function(s){o.push(i.markPotentiallyOrphaned(t,s))}),b.waitFor(o)},e.prototype.removeMatchingKeysForTargetId=function(t,n){return this._s.Zn(n),b.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=this._s.es(n);return b.resolve(r)},e.prototype.containsKey=function(t,n){return b.resolve(this._s.containsKey(n))},e}(),vd=function(){function e(t,n){var r=this;this.gs={},this.Ne=new Dt(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new gd(this),this.Ut=new Qf,this.Ue=function(i,o){return new pd(i,function(s){return r.referenceDelegate.ps(s)})}(this.Ut),this.R=new Qa(n),this.Ke=new fd(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var n=this.gs[t.toKey()];return n||(n=new dd(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=n),n},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;I("MemoryPersistence","Starting transaction:",t);var o=new md(this.Ne.next());return this.referenceDelegate.Es(),r(o).next(function(s){return i.referenceDelegate.Ts(o).next(function(){return s})}).toPromise().then(function(s){return o.raiseOnCommittedEvent(),s})},e.prototype.Is=function(t,n){return b.or(Object.values(this.gs).map(function(r){return function(){return r.containsKey(t,n)}}))},e}(),md=function(e){function t(n){var r=this;return(r=e.call(this)||this).currentSequenceNumber=n,r}return k(t,e),t}(ja),wd=function(){function e(t){this.persistence=t,this.As=new Vo,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw D()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,n,r){return this.As.addReference(r,n),this.vs.delete(r.toString()),b.resolve()},e.prototype.removeReference=function(t,n,r){return this.As.removeReference(r,n),this.vs.add(r.toString()),b.resolve()},e.prototype.markPotentiallyOrphaned=function(t,n){return this.vs.add(n.toString()),b.resolve()},e.prototype.removeTarget=function(t,n){var r=this;this.As.Zn(n.targetId).forEach(function(o){return r.vs.add(o.toString())});var i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,n.targetId).next(function(o){o.forEach(function(s){return r.vs.add(s.toString())})}).next(function(){return i.removeTargetData(t,n)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.vs,function(i){var o=N.fromPath(i);return n.Ps(t,o).next(function(s){s||r.removeEntry(o)})}).next(function(){return n.Rs=null,r.apply(t)})},e.prototype.updateLimboDocument=function(t,n){var r=this;return this.Ps(t,n).next(function(i){i?r.vs.delete(n.toString()):r.vs.add(n.toString())})},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,n){var r=this;return b.or([function(){return b.resolve(r.As.containsKey(n))},function(){return r.persistence.getTargetCache().containsKey(t,n)},function(){return r.persistence.Is(t,n)}])},e}(),ht=function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return this.uid!=null},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yc(e,t){return"firestore_clients_"+e+"_"+t}function gc(e,t,n){var r="firestore_mutations_"+e+"_"+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function Uo(e,t){return"firestore_targets_"+e+"_"+t}ht.UNAUTHENTICATED=new ht(null),ht.GOOGLE_CREDENTIALS=new ht("google-credentials-uid"),ht.FIRST_PARTY=new ht("first-party-uid"),ht.MOCK_USER=new ht("mock-user");var vc=function(){function e(t,n,r,i){this.user=t,this.batchId=n,this.state=r,this.error=i}return e.Vs=function(t,n,r){var i,o=JSON.parse(r),s=typeof o=="object"&&["pending","acknowledged","rejected"].indexOf(o.state)!==-1&&(o.error===void 0||typeof o.error=="object");return s&&o.error&&(s=typeof o.error.message=="string"&&typeof o.error.code=="string")&&(i=new w(o.error.code,o.error.message)),s?new e(t,n,o.state,i):(Y("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),qo=function(){function e(t,n,r){this.targetId=t,this.state=n,this.error=r}return e.Vs=function(t,n){var r,i=JSON.parse(n),o=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string")&&(r=new w(i.error.code,i.error.message)),o?new e(t,i.state,r):(Y("SharedClientState","Failed to parse target state for ID '"+t+"': "+n),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),mc=function(){function e(t,n){this.clientId=t,this.activeTargetIds=n}return e.Vs=function(t,n){for(var r=JSON.parse(n),i=typeof r=="object"&&r.activeTargetIds instanceof Array,o=Gr(),s=0;i&&s<r.activeTargetIds.length;++s)i=Gu(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new e(t,o):(Y("SharedClientState","Failed to parse client data for instance '"+t+"': "+n),null)},e}(),bd=function(){function e(t,n){this.clientId=t,this.onlineState=n}return e.Vs=function(t){var n=JSON.parse(t);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new e(n.clientId,n.onlineState):(Y("SharedClientState","Failed to parse online state: "+t),null)},e}(),jo=function(){function e(){this.activeTargetIds=Gr()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e}(),Bo=function(){function e(t,n,r,i,o){this.window=t,this.Se=n,this.persistenceKey=r,this.Ns=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new dt(P),this.started=!1,this.$s=[];var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.Os=yc(this.persistenceKey,this.Ns),this.Ms=function(u){return"firestore_sequence_number_"+u}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new jo),this.Ls=new RegExp("^firestore_clients_"+s+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+s+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+s+"_(\\d+)$"),this.Us=function(u){return"firestore_online_state_"+u}(this.persistenceKey),this.Ks=function(u){return"firestore_bundle_loaded_"+u}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o,s,u,a,c,h,l,f=this;return v(this,function(p){switch(p.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=p.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Ns&&(o=this.getItem(yc(this.persistenceKey,i)))&&(s=mc.Vs(i,o))&&(this.Fs=this.Fs.insert(s.clientId,s));for(this.Qs(),(u=this.storage.getItem(this.Us))&&(a=this.js(u))&&this.Ws(a),c=0,h=this.$s;c<h.length;c++)l=h[c],this.ks(l);return this.$s=[],this.window.addEventListener("pagehide",function(){return f.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},e.prototype.isActiveQueryTarget=function(t){var n=!1;return this.Fs.forEach(function(r,i){i.activeTargetIds.has(t)&&(n=!0)}),n},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,n,r){this.zs(t,n,r),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var n="not-current";if(this.isActiveQueryTarget(t)){var r=this.storage.getItem(Uo(this.persistenceKey,t));if(r){var i=qo.Vs(t,r);i&&(n=i.state)}}return this.Js.Ds(t),this.Qs(),n},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(Uo(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,n,r){this.Ys(t,n,r)},e.prototype.handleUserChange=function(t,n,r){var i=this;n.forEach(function(o){i.Hs(o)}),this.currentUser=t,r.forEach(function(o){i.addPendingMutation(o)})},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(t){var n=this.storage.getItem(t);return I("SharedClientState","READ",t,n),n},e.prototype.setItem=function(t,n){I("SharedClientState","SET",t,n),this.storage.setItem(t,n)},e.prototype.removeItem=function(t){I("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.ks=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(I("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Os)return void Y("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return m(n,void 0,void 0,function(){var i,o,s,u,a,c;return v(this,function(h){if(this.started){if(r.key!==null){if(this.Ls.test(r.key)){if(r.newValue==null)return i=this.ti(r.key),[2,this.ei(i,null)];if(o=this.ni(r.key,r.newValue))return[2,this.ei(o.clientId,o)]}else if(this.Bs.test(r.key)){if(r.newValue!==null&&(s=this.si(r.key,r.newValue)))return[2,this.ii(s)]}else if(this.qs.test(r.key)){if(r.newValue!==null&&(u=this.ri(r.key,r.newValue)))return[2,this.oi(u)]}else if(r.key===this.Us){if(r.newValue!==null&&(a=this.js(r.newValue)))return[2,this.Ws(a)]}else if(r.key===this.Ms)(c=function(l){var f=Dt.o;if(l!=null)try{var p=JSON.parse(l);x(typeof p=="number"),f=p}catch(d){Y("SharedClientState","Failed to read sequence number from WebStorage",d)}return f}(r.newValue))!==Dt.o&&this.sequenceNumberHandler(c);else if(r.key===this.Ks)return[2,this.syncEngine.ci()]}}else this.$s.push(r);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(t,n,r){var i=new vc(this.currentUser,t,n,r),o=gc(this.persistenceKey,this.currentUser,t);this.setItem(o,i.Ss())},e.prototype.Hs=function(t){var n=gc(this.persistenceKey,this.currentUser,t);this.removeItem(n)},e.prototype.Xs=function(t){var n={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(n))},e.prototype.Ys=function(t,n,r){var i=Uo(this.persistenceKey,t),o=new qo(t,n,r);this.setItem(i,o.Ss())},e.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},e.prototype.ti=function(t){var n=this.Ls.exec(t);return n?n[1]:null},e.prototype.ni=function(t,n){var r=this.ti(t);return mc.Vs(r,n)},e.prototype.si=function(t,n){var r=this.Bs.exec(t),i=Number(r[1]),o=r[2]!==void 0?r[2]:null;return vc.Vs(new ht(o),i,n)},e.prototype.ri=function(t,n){var r=this.qs.exec(t),i=Number(r[1]);return qo.Vs(i,n)},e.prototype.js=function(t){return bd.Vs(t)},e.prototype.ii=function(t){return m(this,void 0,void 0,function(){return v(this,function(n){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(I("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,n){var r=this,i=n?this.Fs.insert(t,n):this.Fs.remove(t),o=this.Gs(this.Fs),s=this.Gs(i),u=[],a=[];return s.forEach(function(c){o.has(c)||u.push(c)}),o.forEach(function(c){s.has(c)||a.push(c)}),this.syncEngine.hi(u,a).then(function(){r.Fs=i})},e.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var n=Gr();return t.forEach(function(r,i){n=n.unionWith(i.activeTargetIds)}),n},e}(),wc=function(){function e(){this.li=new jo,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,n,r){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,n,r){this.fi[t]=n},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new jo,Promise.resolve()},e.prototype.handleUserChange=function(t,n,r){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e}(),Td=function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e}(),bc=function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(0)},e.prototype.yi=function(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(1)},e.yt=function(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0},e}(),Id={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ed=function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e}(),_d=function(e){function t(n){var r=this;return(r=e.call(this,n)||this).forceLongPolling=n.forceLongPolling,r.autoDetectLongPolling=n.autoDetectLongPolling,r.useFetchStreams=n.useFetchStreams,r}return k(t,e),t.prototype.Fi=function(n,r,i,o){return new Promise(function(s,u){var a=new tf;a.listenOnce(Xl.COMPLETE,function(){try{switch(a.getLastErrorCode()){case ho.NO_ERROR:var h=a.getResponseJson();I("Connection","XHR received:",JSON.stringify(h)),s(h);break;case ho.TIMEOUT:I("Connection",'RPC "'+n+'" timed out'),u(new w(y.DEADLINE_EXCEEDED,"Request time out"));break;case ho.HTTP_ERROR:var l=a.getStatus();if(I("Connection",'RPC "'+n+'" failed with status:',l,"response text:",a.getResponseText()),l>0){var f=a.getResponseJson().error;if(f&&f.status&&f.message){var p=function(d){var g=d.toLowerCase().replace(/_/g,"-");return Object.values(y).indexOf(g)>=0?g:y.UNKNOWN}(f.status);u(new w(p,f.message))}else u(new w(y.UNKNOWN,"Server responded with status "+a.getStatus()))}else u(new w(y.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{I("Connection",'RPC "'+n+'" completed.')}});var c=JSON.stringify(o);a.send(r,"POST",c,i,15)})},t.prototype.Oi=function(n,r){var i=[this.Di,"/","google.firestore.v1.Firestore","/",n,"/channel"],o=Wl(),s=Yl(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new Zl({})),this.ki(u.initMessageHeaders,r),Mh()||Vh()||Uh()||qh()||jh()||Bh()||(u.httpHeadersOverwriteParam="$httpHeaders");var a=i.join("");I("Connection","Creating WebChannel: "+a,u);var c=o.createWebChannel(a,u),h=!1,l=!1,f=new Ed({Ei:function(d){l?I("Connection","Not sending because WebChannel is closed:",d):(h||(I("Connection","Opening WebChannel transport."),c.open(),h=!0),I("Connection","WebChannel sending:",d),c.send(d))},Ti:function(){return c.close()}}),p=function(d,g,T){d.listen(g,function(E){try{T(E)}catch(A){setTimeout(function(){throw A},0)}})};return p(c,xr.EventType.OPEN,function(){l||I("Connection","WebChannel transport opened.")}),p(c,xr.EventType.CLOSE,function(){l||(l=!0,I("Connection","WebChannel transport closed"),f.Vi())}),p(c,xr.EventType.ERROR,function(d){l||(l=!0,Rn("Connection","WebChannel transport errored:",d),f.Vi(new w(y.UNAVAILABLE,"The operation could not be completed")))}),p(c,xr.EventType.MESSAGE,function(d){var g;if(!l){var T=d.data[0];x(!!T);var E=T,A=E.error||((g=E[0])===null||g===void 0?void 0:g.error);if(A){I("Connection","WebChannel received error:",A);var C=A.status,O=function(q){var it=J[q];if(it!==void 0)return va(it)}(C),F=A.message;O===void 0&&(O=y.INTERNAL,F="Unknown error status: "+C+" with message "+A.message),l=!0,f.Vi(new w(O,F)),c.close()}else I("Connection","WebChannel received:",T),f.Si(T)}}),p(s,Jl.STAT_EVENT,function(d){d.stat===Mu.PROXY?I("Connection","Detected buffering proxy"):d.stat===Mu.NOPROXY&&I("Connection","Detected no buffering proxy")}),setTimeout(function(){f.Pi()},0),f},t}(function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Di=n+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,n,r,i){var o=this.xi(t,n);I("RestConnection","Sending: ",o,r);var s={};return this.ki(s,i),this.Fi(t,o,s,r).then(function(u){return I("RestConnection","Received: ",u),u},function(u){throw Rn("RestConnection",t+" failed with error: ",u,"url: ",o,"request:",r),u})},e.prototype.$i=function(t,n,r,i){return this.Ni(t,n,r,i)},e.prototype.ki=function(t,n){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n)for(var r in n.authHeaders)n.authHeaders.hasOwnProperty(r)&&(t[r]=n.authHeaders[r])},e.prototype.xi=function(t,n){var r=Id[t];return this.Di+"/v1/"+n+":"+r},e}());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tc(){return typeof window!="undefined"?window:null}function ti(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(e){return new Cf(e,!0)}var Ko=function(){function e(t,n,r,i,o){r===void 0&&(r=1e3),i===void 0&&(i=1.5),o===void 0&&(o=6e4),this.Se=t,this.timerId=n,this.Mi=r,this.Li=i,this.Bi=o,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Qi=function(){this.qi=this.Bi},e.prototype.ji=function(t){var n=this;this.cancel();var r=Math.floor(this.qi+this.Wi()),i=Math.max(0,Date.now()-this.Ki),o=Math.max(0,r-i);o>0&&I("ExponentialBackoff","Backing off for "+o+" ms (base delay: "+this.qi+" ms, delay with jitter: "+r+" ms, last attempt: "+i+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,o,function(){return n.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){this.Ui!==null&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){this.Ui!==null&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),Ic=function(){function e(t,n,r,i,o,s){this.Se=t,this.zi=r,this.Hi=i,this.Ji=o,this.listener=s,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Ko(t,n)}return e.prototype.tr=function(){return this.state===1||this.state===2||this.state===4},e.prototype.er=function(){return this.state===2},e.prototype.start=function(){this.state!==3?this.auth():this.nr()},e.prototype.stop=function(){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&this.Xi===null&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return m(this,void 0,void 0,function(){return v(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,n){return m(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,t!==3?this.Zi.reset():n&&n.code===y.RESOURCE_EXHAUSTED?(Y(n.toString()),Y("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):n&&n.code===y.UNAUTHENTICATED&&this.Ji.invalidateToken(),this.stream!==null&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(n)];case 1:return r.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var n=this.hr(this.Yi),r=this.Yi;this.Ji.getToken().then(function(i){t.Yi===r&&t.lr(i)},function(i){n(function(){var o=new w(y.UNKNOWN,"Fetching auth token failed: "+i.message);return t.dr(o)})})},e.prototype.lr=function(t){var n=this,r=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){r(function(){return n.state=2,n.listener.Ii()})}),this.stream.Ri(function(i){r(function(){return n.dr(i)})}),this.stream.onMessage(function(i){r(function(){return n.onMessage(i)})})},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return m(t,void 0,void 0,function(){return v(this,function(n){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(t){return I("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var n=this;return function(r){n.Se.enqueueAndForget(function(){return n.Yi===t?r():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),Sd=function(e){function t(n,r,i,o,s){var u=this;return(u=e.call(this,n,"listen_stream_connection_backoff","listen_stream_idle",r,i,s)||this).R=o,u}return k(t,e),t.prototype.wr=function(n){return this.Hi.Oi("Listen",n)},t.prototype.onMessage=function(n){this.Zi.reset();var r=function(o,s){var u;if("targetChange"in s){s.targetChange;var a=function(T){return T==="NO_CHANGE"?0:T==="ADD"?1:T==="REMOVE"?2:T==="CURRENT"?3:T==="RESET"?4:D()}(s.targetChange.targetChangeType||"NO_CHANGE"),c=s.targetChange.targetIds||[],h=function(T,E){return T.I?(x(E===void 0||typeof E=="string"),wt.fromBase64String(E||"")):(x(E===void 0||E instanceof Uint8Array),wt.fromUint8Array(E||new Uint8Array))}(o,s.targetChange.resumeToken),l=(f=s.targetChange.cause)&&function(T){var E=T.code===void 0?y.UNKNOWN:va(T.code);return new w(E,T.message||"")}(f);u=new Ta(a,c,h,l||null)}else if("documentChange"in s){s.documentChange,(a=s.documentChange).document,a.document.name,a.document.updateTime,c=Mt(o,a.document.name),h=et(a.document.updateTime);var f=new Nt({mapValue:{fields:a.document.fields}}),p=(l=at.newFoundDocument(c,h,f),a.targetIds||[]),d=a.removedTargetIds||[];u=new Qr(p,d,l.key,l)}else if("documentDelete"in s)s.documentDelete,(a=s.documentDelete).document,c=Mt(o,a.document),h=a.readTime?et(a.readTime):L.min(),f=at.newNoDocument(c,h),l=a.removedTargetIds||[],u=new Qr([],l,f.key,f);else if("documentRemove"in s)s.documentRemove,(a=s.documentRemove).document,c=Mt(o,a.document),h=a.removedTargetIds||[],u=new Qr([],h,c,null);else{if(!("filter"in s))return D();s.filter;var g=s.filter;g.targetId,a=g.count||0,c=new bf(a),h=g.targetId,u=new ba(h,c)}return u}(this.R,n),i=function(o){if(!("targetChange"in o))return L.min();var s=o.targetChange;return s.targetIds&&s.targetIds.length?L.min():s.readTime?et(s.readTime):L.min()}(n);return this.listener._r(r,i)},t.prototype.mr=function(n){var r={};r.database=Qn(this.R),r.addTarget=function(o,s){var u,a=s.target;return(u=Fr(a)?{documents:Ra(o,a)}:{query:La(o,a)}).targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Sa(o,s.resumeToken):s.snapshotVersion.compareTo(L.min())>0&&(u.readTime=Kn(o,s.snapshotVersion.toTimestamp())),u}(this.R,n);var i=function(o,s){var u=function(a,c){switch(c){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return D()}}(0,s.purpose);return u==null?null:{"goog-listen-tags":u}}(this.R,n);i&&(r.labels=i),this.cr(r)},t.prototype.yr=function(n){var r={};r.database=Qn(this.R),r.removeTarget=n,this.cr(r)},t}(Ic),Dd=function(e){function t(n,r,i,o,s){var u=this;return(u=e.call(this,n,"write_stream_connection_backoff","write_stream_idle",r,i,s)||this).R=o,u.gr=!1,u}return k(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(n){return this.Hi.Oi("Write",n)},t.prototype.onMessage=function(n){if(x(!!n.streamToken),this.lastStreamToken=n.streamToken,this.gr){this.Zi.reset();var r=function(o,s){return o&&o.length>0?(x(s!==void 0),o.map(function(u){return function(a,c){var h=a.updateTime?et(a.updateTime):et(c);return h.isEqual(L.min())&&(h=et(c)),new vf(h,a.transformResults||[])}(u,s)})):[]}(n.writeResults,n.commitTime),i=et(n.commitTime);return this.listener.Tr(i,r)}return x(!n.writeResults||n.writeResults.length===0),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var n={};n.database=Qn(this.R),this.cr(n)},t.prototype.Er=function(n){var r=this,i={streamToken:this.lastStreamToken,writes:n.map(function(o){return $r(r.R,o)})};this.cr(i)},t}(Ic),Nd=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).credentials=n,o.Hi=r,o.R=i,o.Rr=!1,o}return k(t,e),t.prototype.br=function(){if(this.Rr)throw new w(y.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.Ni(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(y.UNKNOWN,s.toString())})},t.prototype.$i=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.$i(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(y.UNKNOWN,s.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),Ad=function(){function e(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;this.vr===0&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(t){this.state==="Online"?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.kr(),this.vr=0,t==="Online"&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var n="Could not reach Cloud Firestore backend. "+t+`
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(Y(n),this.Vr=!1):I("OnlineStateTracker",n)},e.prototype.kr=function(){this.Pr!==null&&(this.Pr.cancel(),this.Pr=null)},e}(),Cd=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(s){n.enqueueAndForget(function(){return m(o,void 0,void 0,function(){return v(this,function(u){switch(u.label){case 0:return re(this)?(I("RemoteStore","Restarting streams for network reachability change."),[4,function(a){return m(this,void 0,void 0,function(){var c;return v(this,function(h){switch(h.label){case 0:return(c=_(a)).Or.add(4),[4,sn(c)];case 1:return h.sent(),c.Br.set("Unknown"),c.Or.delete(4),[4,Yn(c)];case 2:return h.sent(),[2]}})})}(this)]):[3,2];case 1:u.sent(),u.label=2;case 2:return[2]}})})})}),this.Br=new Ad(n,r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(e){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:if(!re(e))return[3,4];t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function sn(e){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function ei(e,t){var n=_(e);n.$r.has(t.targetId)||(n.$r.set(t.targetId,t),$o(n)?Qo(n):an(n).er()&&Go(n,t))}function Xn(e,t){var n=_(e),r=an(n);n.$r.delete(t),r.er()&&Ec(n,t),n.$r.size===0&&(r.er()?r.ir():re(n)&&n.Br.set("Unknown"))}function Go(e,t){e.qr.U(t.targetId),an(e).mr(t)}function Ec(e,t){e.qr.U(t),an(e).yr(t)}function Qo(e){e.qr=new Df({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),an(e).start(),e.Br.Sr()}function $o(e){return re(e)&&!an(e).tr()&&e.$r.size>0}function re(e){return _(e).Or.size===0}function _c(e){e.qr=void 0}function kd(e){return m(this,void 0,void 0,function(){return v(this,function(t){return e.$r.forEach(function(n,r){Go(e,n)}),[2]})})}function xd(e,t){return m(this,void 0,void 0,function(){return v(this,function(n){return _c(e),$o(e)?(e.Br.Nr(t),Qo(e)):e.Br.set("Unknown"),[2]})})}function Rd(e,t,n){return m(this,void 0,void 0,function(){var r,i,o;return v(this,function(s){switch(s.label){case 0:if(e.Br.set("Online"),!(t instanceof Ta&&t.state===2&&t.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(u,a){return m(this,void 0,void 0,function(){var c,h,l,f;return v(this,function(p){switch(p.label){case 0:c=a.cause,h=0,l=a.targetIds,p.label=1;case 1:return h<l.length?(f=l[h],u.$r.has(f)?[4,u.remoteSyncer.rejectListen(f,c)]:[3,3]):[3,5];case 2:p.sent(),u.$r.delete(f),u.qr.removeTarget(f),p.label=3;case 3:p.label=4;case 4:return h++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),I("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),[4,ni(e,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof Qr?e.qr.X(t):t instanceof ba?e.qr.rt(t):e.qr.et(t),n.isEqual(L.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,lc(e.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(u,a){var c=u.qr.ut(a);return c.targetChanges.forEach(function(h,l){if(h.resumeToken.approximateByteSize()>0){var f=u.$r.get(l);f&&u.$r.set(l,f.withResumeToken(h.resumeToken,a))}}),c.targetMismatches.forEach(function(h){var l=u.$r.get(h);if(l){u.$r.set(h,l.withResumeToken(wt.EMPTY_BYTE_STRING,l.snapshotVersion)),Ec(u,h);var f=new zr(l.target,h,1,l.sequenceNumber);Go(u,f)}}),u.remoteSyncer.applyRemoteEvent(c)}(e,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return I("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,ni(e,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function ni(e,t,n){return m(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:if(!be(t))throw t;return e.Or.add(1),[4,sn(e)];case 1:return i.sent(),e.Br.set("Offline"),n||(n=function(){return lc(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return v(this,function(o){switch(o.label){case 0:return I("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return o.sent(),e.Or.delete(1),[4,Yn(e)];case 2:return o.sent(),[2]}})})}),[2]}})})}function Sc(e,t){return t().catch(function(n){return ni(e,n,t)})}function un(e){return m(this,void 0,void 0,function(){var t,n,r,i,o;return v(this,function(s){switch(s.label){case 0:t=_(e),n=ie(t),r=t.Fr.length>0?t.Fr[t.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(u){return re(u)&&u.Fr.length<10}(t))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,ad(t.localStore,r)];case 3:return(i=s.sent())===null?(t.Fr.length===0&&n.ir(),[3,7]):(r=i.batchId,function(u,a){u.Fr.push(a);var c=ie(u);c.er()&&c.pr&&c.Er(a.mutations)}(t,i),[3,6]);case 4:return o=s.sent(),[4,ni(t,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Dc(t)&&Nc(t),[2]}})})}function Dc(e){return re(e)&&!ie(e).tr()&&e.Fr.length>0}function Nc(e){ie(e).start()}function Ld(e){return m(this,void 0,void 0,function(){return v(this,function(t){return ie(e).Ar(),[2]})})}function Od(e){return m(this,void 0,void 0,function(){var t,n,r,i;return v(this,function(o){for(t=ie(e),n=0,r=e.Fr;n<r.length;n++)i=r[n],t.Er(i.mutations);return[2]})})}function Pd(e,t,n){return m(this,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return r=e.Fr.shift(),i=Kf.from(r,t,n),[4,Sc(e,function(){return e.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,un(e)];case 2:return o.sent(),[2]}})})}function Fd(e,t){return m(this,void 0,void 0,function(){return v(this,function(n){switch(n.label){case 0:return t&&ie(e).pr?[4,function(r,i){return m(this,void 0,void 0,function(){var o,s;return v(this,function(u){switch(u.label){case 0:return ga(s=i.code)&&s!==y.ABORTED?(o=r.Fr.shift(),ie(r).sr(),[4,Sc(r,function(){return r.remoteSyncer.rejectFailedWrite(o.batchId,i)})]):[3,3];case 1:return u.sent(),[4,un(r)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Dc(e)&&Nc(e),[2]}})})}function zo(e,t){return m(this,void 0,void 0,function(){var n;return v(this,function(r){switch(r.label){case 0:return n=_(e),t?(n.Or.delete(2),[4,Yn(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return t?[3,4]:(n.Or.add(2),[4,sn(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function an(e){var t=this;return e.Ur||(e.Ur=function(n,r,i){var o=_(n);return o.br(),new Sd(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:kd.bind(null,e),Ri:xd.bind(null,e),_r:Rd.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return n?(e.Ur.sr(),$o(e)?Qo(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:r.sent(),_c(e),r.label=3;case 3:return[2]}})})})),e.Ur}function ie(e){var t=this;return e.Kr||(e.Kr=function(n,r,i){var o=_(n);return o.br(),new Dd(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:Ld.bind(null,e),Ri:Fd.bind(null,e),Ir:Od.bind(null,e),Tr:Pd.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return n?(e.Kr.sr(),[4,un(e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.Kr.stop()];case 3:r.sent(),e.Fr.length>0&&(I("RemoteStore","Stopping write stream with "+e.Fr.length+" pending writes"),e.Fr=[]),r.label=4;case 4:return[2]}})})})),e.Kr}var Md=function(){function e(t,n,r,i,o){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(s){})}return e.createAndSchedule=function(t,n,r,i,o){var s=new e(t,n,Date.now()+r,i,o);return s.start(r),s},e.prototype.start=function(t){var n=this;this.timerHandle=setTimeout(function(){return n.handleDelayElapsed()},t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(y.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return t.timerHandle!==null?(t.clearTimeout(),t.op().then(function(n){return t.deferred.resolve(n)})):Promise.resolve()})},e.prototype.clearTimeout=function(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function cn(e,t){if(Y("AsyncQueue",t+": "+e),be(e))return new w(y.UNAVAILABLE,t+": "+e);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ac=function(){function e(t){this.comparator=t?function(n,r){return t(n,r)||N.comparator(n.key,r.key)}:function(n,r){return N.comparator(n.key,r.key)},this.keyedMap=So(),this.sortedSet=new dt(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return this.keyedMap.get(t)!=null},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.add=function(t){var n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))},e.prototype.delete=function(t){var n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach(function(n){t.push(n.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`},e.prototype.copy=function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r},e}(),Cc=function(){function e(){this.Qr=new dt(N.comparator)}return e.prototype.track=function(t){var n=t.doc.key,r=this.Qr.get(n);r?t.type!==0&&r.type===3?this.Qr=this.Qr.insert(n,t):t.type===3&&r.type!==1?this.Qr=this.Qr.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.Qr=this.Qr.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.Qr=this.Qr.remove(n):t.type===1&&r.type===2?this.Qr=this.Qr.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):D():this.Qr=this.Qr.insert(n,t)},e.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(n,r){t.push(r)}),t},e}(),ri=function(){function e(t,n,r,i,o,s,u,a){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=u,this.excludesMetadataChanges=a}return e.fromInitialDocuments=function(t,n,r,i){var o=[];return n.forEach(function(s){o.push({type:0,doc:s})}),new e(t,n,Ac.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Vn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0},e}(),Vd=function(){this.Wr=void 0,this.listeners=[]},Ud=function(){this.queries=new nn(function(e){return ea(e)},Vn),this.onlineState="Unknown",this.Gr=new Set};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ho(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u,a;return v(this,function(c){switch(c.label){case 0:if(n=_(e),r=t.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new Vd),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return u=c.sent(),a=cn(u,"Initialization of query '"+Io(t.query)+"' failed"),[2,void t.onError(a)];case 4:return n.queries.set(r,o),o.listeners.push(t),t.zr(n.onlineState),o.Wr&&t.Hr(o.Wr)&&Yo(n),[2]}})})}function Wo(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return v(this,function(u){return n=_(e),r=t.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(t))>=0&&(o.listeners.splice(s,1),i=o.listeners.length===0),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function qd(e,t){for(var n=_(e),r=!1,i=0,o=t;i<o.length;i++){var s=o[i],u=s.query,a=n.queries.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);a.Wr=s}}r&&Yo(n)}function jd(e,t,n){var r=_(e),i=r.queries.get(t);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(t)}function Yo(e){e.Gr.forEach(function(t){t.next()})}var Xo=function(){function e(t,n,r){this.query=t,this.Jr=n,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=r||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var n=[],r=0,i=t.docChanges;r<i.length;r++){var o=i[r];o.type!==3&&n.push(o)}t=new ri(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var s=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),s=!0):this.eo(t,this.onlineState)&&(this.no(t),s=!0),this.Xr=t,s},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var n=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),n=!0),n},e.prototype.eo=function(t,n){if(!t.fromCache)return!0;var r=n!=="Offline";return!(this.options.so&&r||t.docs.isEmpty()&&n!=="Offline")},e.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var n=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0},e.prototype.no=function(t){t=ri.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e}(),Bd=function(){function e(t,n){this.payload=t,this.byteLength=n}return e.prototype.io=function(){return"metadata"in this.payload},e}(),kc=function(){function e(t){this.R=t}return e.prototype.qn=function(t){return Mt(this.R,t)},e.prototype.Un=function(t){return t.metadata.exists?ka(this.R,t.document,!1):at.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},e.prototype.Kn=function(t){return et(t)},e}(),Kd=function(){function e(t,n,r){this.ro=t,this.localStore=n,this.R=r,this.queries=[],this.documents=[],this.progress=xc(t)}return e.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var n=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++n):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++n),n!==this.progress.documentsLoaded?(this.progress.documentsLoaded=n,Object.assign({},this.progress)):null},e.prototype.co=function(t){for(var n=new Map,r=new kc(this.R),i=0,o=t;i<o.length;i++){var s=o[i];if(s.metadata.queries)for(var u=r.qn(s.metadata.name),a=0,c=s.metadata.queries;a<c.length;a++){var h=c[a],l=(n.get(h)||j()).add(u);n.set(h,l)}}return n},e.prototype.complete=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o;return v(this,function(s){switch(s.label){case 0:return[4,hd(this.localStore,new kc(this.R),this.documents,this.ro.id)];case 1:t=s.sent(),n=this.co(this.documents),r=0,i=this.queries,s.label=2;case 2:return r<i.length?(o=i[r],[4,ld(this.localStore,o,n.get(o.name))]):[3,5];case 3:s.sent(),s.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new rd(Object.assign({},this.progress),t))]}})})},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rc=function(e){this.key=e},Lc=function(e){this.key=e},Oc=function(){function e(t,n){this.query=t,this.uo=n,this.ao=null,this.current=!1,this.ho=j(),this.mutatedKeys=j(),this.lo=na(t),this.fo=new Ac(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,n){var r=this,i=n?n.mo:new Cc,o=n?n.fo:this.fo,s=n?n.mutatedKeys:this.mutatedKeys,u=o,a=!1,c=Vr(this.query)&&o.size===this.query.limit?o.last():null,h=Ur(this.query)&&o.size===this.query.limit?o.first():null;if(t.inorderTraversal(function(f,p){var d=o.get(f),g=Un(r.query,p)?p:null,T=!!d&&r.mutatedKeys.has(d.key),E=!!g&&(g.hasLocalMutations||r.mutatedKeys.has(g.key)&&g.hasCommittedMutations),A=!1;d&&g?d.data.isEqual(g.data)?T!==E&&(i.track({type:3,doc:g}),A=!0):r.yo(d,g)||(i.track({type:2,doc:g}),A=!0,(c&&r.lo(g,c)>0||h&&r.lo(g,h)<0)&&(a=!0)):!d&&g?(i.track({type:0,doc:g}),A=!0):d&&!g&&(i.track({type:1,doc:d}),A=!0,(c||h)&&(a=!0)),A&&(g?(u=u.add(g),s=E?s.add(f):s.delete(f)):(u=u.delete(f),s=s.delete(f)))}),Vr(this.query)||Ur(this.query))for(;u.size>this.query.limit;){var l=Vr(this.query)?u.last():u.first();u=u.delete(l.key),s=s.delete(l.key),i.track({type:1,doc:l})}return{fo:u,mo:i,Nn:a,mutatedKeys:s}},e.prototype.yo=function(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations},e.prototype.applyChanges=function(t,n,r){var i=this,o=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var s=t.mo.jr();s.sort(function(h,l){return function(f,p){var d=function(g){switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return d(f)-d(p)}(h.type,l.type)||i.lo(h.doc,l.doc)}),this.po(r);var u=n?this.Eo():[],a=this.ho.size===0&&this.current?1:0,c=a!==this.ao;return this.ao=a,s.length!==0||c?{snapshot:new ri(this.query,t.fo,o,s,t.mutatedKeys,a===0,c,!1),To:u}:{To:u}},e.prototype.zr=function(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Cc,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var n=this;t&&(t.addedDocuments.forEach(function(r){return n.uo=n.uo.add(r)}),t.modifiedDocuments.forEach(function(r){}),t.removedDocuments.forEach(function(r){return n.uo=n.uo.delete(r)}),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var n=this.ho;this.ho=j(),this.fo.forEach(function(i){t.Io(i.key)&&(t.ho=t.ho.add(i.key))});var r=[];return n.forEach(function(i){t.ho.has(i)||r.push(new Lc(i))}),this.ho.forEach(function(i){n.has(i)||r.push(new Rc(i))}),r},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=j();var n=this._o(t.documents);return this.applyChanges(n,!0)},e.prototype.Ro=function(){return ri.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,this.ao===0)},e}(),Gd=function(e,t,n){this.query=e,this.targetId=t,this.view=n},Qd=function(e){this.key=e,this.bo=!1},$d=function(){function e(t,n,r,i,o,s){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.vo={},this.Po=new nn(function(u){return ea(u)},Vn),this.Vo=new Map,this.So=new Set,this.Do=new dt(N.comparator),this.Co=new Map,this.No=new Vo,this.xo={},this.ko=new Map,this.Fo=Wr.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return this.$o===!0},enumerable:!1,configurable:!0}),e}();function zd(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u;return v(this,function(a){switch(a.label){case 0:return n=rs(e),(o=n.Po.get(t))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,rn(n.localStore,xt(t))];case 2:return s=a.sent(),u=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,Jo(n,t,r,u==="current")];case 3:i=a.sent(),n.isPrimaryClient&&ei(n.remoteStore,s),a.label=4;case 4:return[2,i]}})})}function Jo(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s,u,a,c;return v(this,function(h){switch(h.label){case 0:return e.Oo=function(l,f,p){return function(d,g,T,E){return m(this,void 0,void 0,function(){var A,C,O;return v(this,function(F){switch(F.label){case 0:return A=g.view._o(T),A.Nn?[4,Zr(d.localStore,g.query,!1).then(function(q){var it=q.documents;return g.view._o(it,A)})]:[3,2];case 1:A=F.sent(),F.label=2;case 2:return C=E&&E.targetChanges.get(g.targetId),O=g.view.applyChanges(A,d.isPrimaryClient,C),[2,(es(d,g.targetId,O.To),O.snapshot)]}})})}(e,l,f,p)},[4,Zr(e.localStore,t,!0)];case 1:return i=h.sent(),o=new Oc(t,i.Bn),s=o._o(i.documents),u=No.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline"),a=o.applyChanges(s,e.isPrimaryClient,u),es(e,n,a.To),c=new Gd(t,n,o),[2,(e.Po.set(t,c),e.Vo.has(n)?e.Vo.get(n).push(t):e.Vo.set(n,[t]),a.snapshot)]}})})}function Hd(e,t){return m(this,void 0,void 0,function(){var n,r,i;return v(this,function(o){switch(o.label){case 0:return n=_(e),r=n.Po.get(t),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(s){return!Vn(s,t)})),void n.Po.delete(t))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,on(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Xn(n.remoteStore,r.targetId),hn(n,r.targetId)}).catch(Ie)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return hn(n,r.targetId),[4,on(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Wd(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return v(this,function(u){switch(u.label){case 0:r=is(e),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,function(a,c){var h,l=_(a),f=Tt.now(),p=c.reduce(function(d,g){return d.add(g.key)},j());return l.persistence.runTransaction("Locally write mutations","readwrite",function(d){return l.Mn.pn(d,p).next(function(g){h=g;for(var T=[],E=0,A=c;E<A.length;E++){var C=A[E],O=wf(C,h.get(C.key));O!=null&&T.push(new Xt(C.key,O,Hu(O.value.mapValue),ft.exists(!0)))}return l._n.addMutationBatch(d,f,T,c)})}).then(function(d){return d.applyToLocalDocumentSet(h),{batchId:d.batchId,changes:h}})}(r.localStore,t)];case 2:return i=u.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(a,c,h){var l=a.xo[a.currentUser.toKey()];l||(l=new dt(P)),l=l.insert(c,h),a.xo[a.currentUser.toKey()]=l}(r,i.batchId,n),[4,$t(r,i.changes)];case 3:return u.sent(),[4,un(r.remoteStore)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=cn(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Pc(e,t){return m(this,void 0,void 0,function(){var n,r;return v(this,function(i){switch(i.label){case 0:n=_(e),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,ud(n.localStore,t)];case 2:return r=i.sent(),t.targetChanges.forEach(function(o,s){var u=n.Co.get(s);u&&(x(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?u.bo=!0:o.modifiedDocuments.size>0?x(u.bo):o.removedDocuments.size>0&&(x(u.bo),u.bo=!1))}),[4,$t(n,r,t)];case 3:return i.sent(),[3,6];case 4:return[4,Ie(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Fc(e,t,n){var r=_(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){var i=[];r.Po.forEach(function(o,s){var u=s.view.zr(t);u.snapshot&&i.push(u.snapshot)}),function(o,s){var u=_(o);u.onlineState=s;var a=!1;u.queries.forEach(function(c,h){for(var l=0,f=h.listeners;l<f.length;l++)f[l].zr(s)&&(a=!0)}),a&&Yo(u)}(r.eventManager,t),i.length&&r.vo._r(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Yd(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a;return v(this,function(c){switch(c.label){case 0:return(r=_(e)).sharedClientState.updateQueryState(t,"rejected",n),i=r.Co.get(t),(o=i&&i.key)?(s=(s=new dt(N.comparator)).insert(o,at.newNoDocument(o,L.min())),u=j().add(o),a=new Do(L.min(),new Map,new Z(P),s,u),[4,Pc(r,a)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(t),ns(r),[3,4];case 2:return[4,on(r.localStore,t,!1).then(function(){return hn(r,t,n)}).catch(Ie)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Xd(e,t){return m(this,void 0,void 0,function(){var n,r,i;return v(this,function(o){switch(o.label){case 0:n=_(e),r=t.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,sd(n.localStore,t)];case 2:return i=o.sent(),ts(n,r,null),Zo(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,$t(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ie(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Jd(e,t,n){return m(this,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:r=_(e),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(s,u){var a=_(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",function(c){var h;return a._n.lookupMutationBatch(c,u).next(function(l){return x(l!==null),h=l.keys(),a._n.removeMutationBatch(c,l)}).next(function(){return a._n.performConsistencyCheck(c)}).next(function(){return a.Mn.pn(c,h)})})}(r.localStore,t)];case 2:return i=o.sent(),ts(r,t,n),Zo(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),[4,$t(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ie(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Zd(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return v(this,function(u){switch(u.label){case 0:re((n=_(e)).remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,function(a){var c=_(a);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(h){return c._n.getHighestUnacknowledgedBatchId(h)})}(n.localStore)];case 2:return(r=u.sent())===-1?[2,void t.resolve()]:((i=n.ko.get(r)||[]).push(t),n.ko.set(r,i),[3,4]);case 3:return o=u.sent(),s=cn(o,"Initialization of waitForPendingWrites() operation failed"),t.reject(s),[3,4];case 4:return[2]}})})}function Zo(e,t){(e.ko.get(t)||[]).forEach(function(n){n.resolve()}),e.ko.delete(t)}function ts(e,t,n){var r=_(e),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(t);o&&(n?o.reject(n):o.resolve(),i=i.remove(t)),r.xo[r.currentUser.toKey()]=i}}function hn(e,t,n){n===void 0&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(s){e.No.containsKey(s)||Mc(e,s)})}function Mc(e,t){e.So.delete(t.path.canonicalString());var n=e.Do.get(t);n!==null&&(Xn(e.remoteStore,n),e.Do=e.Do.remove(t),e.Co.delete(n),ns(e))}function es(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Rc?(e.No.addReference(o.key,t),tp(e,o)):o instanceof Lc?(I("SyncEngine","Document no longer in limbo: "+o.key),e.No.removeReference(o.key,t),e.No.containsKey(o.key)||Mc(e,o.key)):D()}}function tp(e,t){var n=t.key,r=n.path.canonicalString();e.Do.get(n)||e.So.has(r)||(I("SyncEngine","New document in limbo: "+n),e.So.add(r),ns(e))}function ns(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var n=new N(V.fromString(t)),r=e.Fo.next();e.Co.set(r,new Qd(n)),e.Do=e.Do.insert(n,r),ei(e.remoteStore,new zr(xt(Be(n.path)),r,2,Dt.o))}}function $t(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return v(this,function(u){switch(u.label){case 0:return r=_(e),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(a,c){s.push(r.Oo(c,t,n).then(function(h){if(h){r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,h.fromCache?"not-current":"current"),i.push(h);var l=id.Pn(c.targetId,h);o.push(l)}}))}),[4,Promise.all(s)]);case 1:return u.sent(),r.vo._r(i),[4,function(a,c){return m(this,void 0,void 0,function(){var h,l,f,p,d,g,T,E,A;return v(this,function(C){switch(C.label){case 0:h=_(a),C.label=1;case 1:return C.trys.push([1,3,,4]),[4,h.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(O){return b.forEach(c,function(F){return b.forEach(F.bn,function(q){return h.persistence.referenceDelegate.addReference(O,F.targetId,q)}).next(function(){return b.forEach(F.vn,function(q){return h.persistence.referenceDelegate.removeReference(O,F.targetId,q)})})})})];case 2:return C.sent(),[3,4];case 3:if(!be(l=C.sent()))throw l;return I("LocalStore","Failed to update sequence numbers: "+l),[3,4];case 4:for(f=0,p=c;f<p.length;f++)d=p[f],g=d.targetId,d.fromCache||(T=h.kn.get(g),E=T.snapshotVersion,A=T.withLastLimboFreeSnapshotVersion(E),h.kn=h.kn.insert(g,A));return[2]}})})}(r.localStore,o)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}function ep(e,t){return m(this,void 0,void 0,function(){var n,r;return v(this,function(i){switch(i.label){case 0:return(n=_(e)).currentUser.isEqual(t)?[3,3]:(I("SyncEngine","User change. New user:",t.toKey()),[4,hc(n.localStore,t)]);case 1:return r=i.sent(),n.currentUser=t,function(o,s){o.ko.forEach(function(u){u.forEach(function(a){a.reject(new w(y.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.ko.clear()}(n),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),[4,$t(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function np(e,t){var n=_(e),r=n.Co.get(t);if(r&&r.bo)return j().add(r.key);var i=j(),o=n.Vo.get(t);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Po.get(a);i=i.unionWith(c.view.wo)}return i}function rp(e,t){return m(this,void 0,void 0,function(){var n,r,i;return v(this,function(o){switch(o.label){case 0:return[4,Zr((n=_(e)).localStore,t.query,!0)];case 1:return r=o.sent(),i=t.view.Ao(r),[2,(n.isPrimaryClient&&es(n,t.targetId,i.To),i)]}})})}function ip(e){return m(this,void 0,void 0,function(){var t;return v(this,function(n){return[2,pc((t=_(e)).localStore).then(function(r){return $t(t,r)})]})})}function op(e,t,n,r){return m(this,void 0,void 0,function(){var i,o;return v(this,function(s){switch(s.label){case 0:return[4,function(u,a){var c=_(u),h=_(c._n);return c.persistence.runTransaction("Lookup mutation documents","readonly",function(l){return h.jt(l,a).next(function(f){return f?c.Mn.pn(l,f):b.resolve(null)})})}((i=_(e)).localStore,t)];case 1:return(o=s.sent())===null?[3,6]:n!=="pending"?[3,3]:[4,un(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:n==="acknowledged"||n==="rejected"?(ts(i,t,r||null),Zo(i,t),function(u,a){_(_(u)._n).Gt(a)}(i.localStore,t)):D(),s.label=4;case 4:return[4,$t(i,o)];case 5:return s.sent(),[3,7];case 6:I("SyncEngine","Cannot apply mutation batch with id: "+t),s.label=7;case 7:return[2]}})})}function sp(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u,a,c;return v(this,function(h){switch(h.label){case 0:return rs(n=_(e)),is(n),t!==!0||n.$o===!0?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Vc(n,r.toArray())]);case 1:return i=h.sent(),n.$o=!0,[4,zo(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)u=s[o],ei(n.remoteStore,u);return[3,7];case 3:return t!==!1||n.$o===!1?[3,7]:(a=[],c=Promise.resolve(),n.Vo.forEach(function(l,f){n.sharedClientState.isLocalQueryTarget(f)?a.push(f):c=c.then(function(){return hn(n,f),on(n.localStore,f,!0)}),Xn(n.remoteStore,f)}),[4,c]);case 4:return h.sent(),[4,Vc(n,a)];case 5:return h.sent(),function(l){var f=_(l);f.Co.forEach(function(p,d){Xn(f.remoteStore,d)}),f.No.ts(),f.Co=new Map,f.Do=new dt(N.comparator)}(n),n.$o=!1,[4,zo(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}})})}function Vc(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,l,f,p,d,g,T;return v(this,function(E){switch(E.label){case 0:r=_(e),i=[],o=[],s=0,u=t,E.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=r.Vo.get(a))&&h.length!==0?[4,rn(r.localStore,xt(h[0]))]:[3,7]):[3,13];case 2:c=E.sent(),l=0,f=h,E.label=3;case 3:return l<f.length?(p=f[l],d=r.Po.get(p),[4,rp(r,d)]):[3,6];case 4:(g=E.sent()).snapshot&&o.push(g.snapshot),E.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,dc(r.localStore,a)];case 8:return T=E.sent(),[4,rn(r.localStore,T)];case 9:return c=E.sent(),[4,Jo(r,Uc(T),a,!1)];case 10:E.sent(),E.label=11;case 11:i.push(c),E.label=12;case 12:return s++,[3,1];case 13:return[2,(r.vo._r(o),i)]}})})}function Uc(e){return Zu(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function up(e){var t=_(e);return _(_(t.localStore).persistence).fn()}function ap(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s;return v(this,function(u){switch(u.label){case 0:return(i=_(e)).$o?(I("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(t))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,pc(i.localStore)];case 3:return o=u.sent(),s=Do.createSynthesizedRemoteEventForCurrentChange(t,n==="current"),[4,$t(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,on(i.localStore,t,!0)];case 6:return u.sent(),hn(i,t,r),[3,8];case 7:D(),u.label=8;case 8:return[2]}})})}function cp(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,l,f;return v(this,function(p){switch(p.label){case 0:if(!(r=rs(e)).$o)return[3,10];i=0,o=t,p.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(I("SyncEngine","Adding an already active target "+s),[3,5]):[4,dc(r.localStore,s)]):[3,6];case 2:return u=p.sent(),[4,rn(r.localStore,u)];case 3:return a=p.sent(),[4,Jo(r,Uc(u),a.targetId,!1)];case 4:p.sent(),ei(r.remoteStore,a),p.label=5;case 5:return i++,[3,1];case 6:c=function(d){return v(this,function(g){switch(g.label){case 0:return r.Vo.has(d)?[4,on(r.localStore,d,!1).then(function(){Xn(r.remoteStore,d),hn(r,d)}).catch(Ie)]:[3,2];case 1:g.sent(),g.label=2;case 2:return[2]}})},h=0,l=n,p.label=7;case 7:return h<l.length?(f=l[h],[5,c(f)]):[3,10];case 8:p.sent(),p.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function rs(e){var t=_(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Pc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=np.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Yd.bind(null,t),t.vo._r=qd.bind(null,t.eventManager),t.vo.Mo=jd.bind(null,t.eventManager),t}function is(e){var t=_(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Xd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Jd.bind(null,t),t}function hp(e,t,n){var r=_(e);(function(i,o,s){return m(this,void 0,void 0,function(){var u,a,c,h,l,f;return v(this,function(p){switch(p.label){case 0:return p.trys.push([0,14,,15]),[4,o.getMetadata()];case 1:return u=p.sent(),[4,function(d,g){var T=_(d),E=et(g.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",function(A){return T.Ke.getBundleMetadata(A,g.id)}).then(function(A){return!!A&&A.createTime.compareTo(E)>=0})}(i.localStore,u)];case 2:return p.sent()?[4,o.close()]:[3,4];case 3:return[2,(p.sent(),void s._completeWith(function(d){return{taskState:"Success",documentsLoaded:d.totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}}(u)))];case 4:return s._updateProgress(xc(u)),a=new Kd(u,i.localStore,o.R),[4,o.Lo()];case 5:c=p.sent(),p.label=6;case 6:return c?[4,a.oo(c)]:[3,10];case 7:return(h=p.sent())&&s._updateProgress(h),[4,o.Lo()];case 8:c=p.sent(),p.label=9;case 9:return[3,6];case 10:return[4,a.complete()];case 11:return l=p.sent(),[4,$t(i,l.wn,void 0)];case 12:return p.sent(),[4,function(d,g){var T=_(d);return T.persistence.runTransaction("Save bundle","readwrite",function(E){return T.Ke.saveBundleMetadata(E,g)})}(i.localStore,u)];case 13:return p.sent(),s._completeWith(l.progress),[3,15];case 14:return Rn("SyncEngine","Loading bundle failed with "+(f=p.sent())),s._failWith(f),[3,15];case 15:return[2]}})})})(r,t,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var qc=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return m(this,void 0,void 0,function(){return v(this,function(n){switch(n.label){case 0:return this.R=Wn(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return n.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},e.prototype.Uo=function(t){return null},e.prototype.Ko=function(t){return cc(this.persistence,new ac,t.initialUser,this.R)},e.prototype.qo=function(t){return new vd(wd.bs,this.R)},e.prototype.Bo=function(t){return new wc},e.prototype.terminate=function(){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},e}(),jc=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).Qo=n,o.cacheSizeBytes=r,o.forceOwnership=i,o.synchronizeTabs=!1,o}return k(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return i.sent(),[4,cd(this.localStore)];case 2:return i.sent(),[4,this.Qo.initialize(this,n)];case 3:return i.sent(),[4,is(this.Qo.syncEngine)];case 4:return i.sent(),[4,un(this.Qo.remoteStore)];case 5:return i.sent(),[4,this.persistence.He(function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()})];case 6:return i.sent(),[2]}})})},t.prototype.Ko=function(n){return cc(this.persistence,new ac,n.initialUser,this.R)},t.prototype.Uo=function(n){var r=this.persistence.referenceDelegate.garbageCollector;return new Yf(r,n.asyncQueue)},t.prototype.qo=function(n){var r=Mo(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Ut.withCacheSize(this.cacheSizeBytes):Ut.DEFAULT;return new nd(this.synchronizeTabs,r,n.clientId,i,n.asyncQueue,Tc(),ti(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(n){return new wc},t}(qc),lp=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r,!1)||this).Qo=n,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return k(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r,i=this;return v(this,function(o){switch(o.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Qo.syncEngine,this.sharedClientState instanceof Bo?(this.sharedClientState.syncEngine={ui:op.bind(null,r),ai:ap.bind(null,r),hi:cp.bind(null,r),fn:up.bind(null,r),ci:ip.bind(null,r)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(s){return m(i,void 0,void 0,function(){return v(this,function(u){switch(u.label){case 0:return[4,sp(this.Qo.syncEngine,s)];case 1:return u.sent(),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):s||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},t.prototype.Bo=function(n){var r=Tc();if(!Bo.yt(r))throw new w(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var i=Mo(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey);return new Bo(r,n.asyncQueue,i,n.clientId,n.initialUser)},t}(jc),os=function(){function e(){}return e.prototype.initialize=function(t,n){return m(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(o){return Fc(r.syncEngine,o,1)},this.remoteStore.remoteSyncer.handleCredentialChange=ep.bind(null,this.syncEngine),[4,zo(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(t){return new Ud},e.prototype.createDatastore=function(t){var n,r=Wn(t.databaseInfo.databaseId),i=(n=t.databaseInfo,new _d(n));return function(o,s,u){return new Nd(o,s,u)}(t.credentials,i,r)},e.prototype.createRemoteStore=function(t){var n,r,i,o,s,u=this;return n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(a){return Fc(u.syncEngine,a,0)},s=bc.yt()?new bc:new Td,new Cd(n,r,i,o,s)},e.prototype.createSyncEngine=function(t,n){return function(r,i,o,s,u,a,c){var h=new $d(r,i,o,s,u,a);return c&&(h.$o=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)},e.prototype.terminate=function(){return function(t){return m(this,void 0,void 0,function(){var n;return v(this,function(r){switch(r.label){case 0:return n=_(t),I("RemoteStore","RemoteStore shutting down."),n.Or.add(5),[4,sn(n)];case 1:return r.sent(),n.Lr.shutdown(),n.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(e,t){t===void 0&&(t=10240);var n=0;return{read:function(){return m(this,void 0,void 0,function(){var r;return v(this,function(i){return n<e.byteLength?(r={value:e.slice(n,n+t),done:!1},[2,(n+=t,r)]):[2,{done:!0}]})})},cancel:function(){return m(this,void 0,void 0,function(){return v(this,function(r){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ii=function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,n){var r=this;this.muted||setTimeout(function(){r.muted||t(n)},0)},e}(),fp=function(){function e(t,n){var r=this;this.Go=t,this.R=n,this.metadata=new yt,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(i){i&&i.io()?r.metadata.resolve(i.payload.metadata):r.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(i==null?void 0:i.payload)))},function(i){return r.metadata.reject(i)})}return e.prototype.close=function(){return this.Go.cancel()},e.prototype.getMetadata=function(){return m(this,void 0,void 0,function(){return v(this,function(t){return[2,this.metadata.promise]})})},e.prototype.Lo=function(){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},e.prototype.Ho=function(){return m(this,void 0,void 0,function(){var t,n,r,i;return v(this,function(o){switch(o.label){case 0:return[4,this.Jo()];case 1:return(t=o.sent())===null?[2,null]:(n=this.zo.decode(t),r=Number(n),isNaN(r)&&this.Yo("length string ("+n+") is not valid number"),[4,this.Xo(r)]);case 2:return i=o.sent(),[2,new Bd(JSON.parse(i),t.length+r)]}})})},e.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},e.prototype.Jo=function(){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(r.sent())return[3,3];r.label=2;case 2:return[3,0];case 3:return this.buffer.length===0?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),n)])}})})},e.prototype.Xo=function(t){return m(this,void 0,void 0,function(){var n;return v(this,function(r){switch(r.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:r.sent()&&this.Yo("Reached the end of bundle when more is expected."),r.label=2;case 2:return[3,0];case 3:return n=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),n)]}})})},e.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},e.prototype.tc=function(){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:return[4,this.Go.read()];case 1:return(t=r.sent()).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),[2,t.done]}})})},e}(),dp=function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return m(this,void 0,void 0,function(){var n,r=this;return v(this,function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new w(y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(o,s){return m(this,void 0,void 0,function(){var u,a,c,h,l,f;return v(this,function(p){switch(p.label){case 0:return u=_(o),a=Qn(u.R)+"/documents",c={documents:s.map(function(d){return Gn(u.R,d)})},[4,u.$i("BatchGetDocuments",a,c)];case 1:return h=p.sent(),l=new Map,h.forEach(function(d){var g=function(T,E){return"found"in E?function(A,C){x(!!C.found),C.found.name,C.found.updateTime;var O=Mt(A,C.found.name),F=et(C.found.updateTime),q=new Nt({mapValue:{fields:C.found.fields}});return at.newFoundDocument(O,F,q)}(T,E):"missing"in E?function(A,C){x(!!C.missing),x(!!C.readTime);var O=Mt(A,C.missing),F=et(C.readTime);return at.newNoDocument(O,F)}(T,E):D()}(u.R,d);l.set(g.key.toString(),g)}),f=[],[2,(s.forEach(function(d){var g=l.get(d.toString());x(!!g),f.push(g)}),f)]}})})}(this.datastore,t)];case 1:return[2,((n=i.sent()).forEach(function(o){return r.recordVersion(o)}),n)]}})})},e.prototype.set=function(t,n){this.write(n.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,n){try{this.write(n.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new Bn(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return m(this,void 0,void 0,function(){var t,n=this;return v(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(i){t.delete(i.key.toString())}),t.forEach(function(i,o){var s=N.fromPath(o);n.mutations.push(new _o(s,n.precondition(s)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var s,u,a;return v(this,function(c){switch(c.label){case 0:return s=_(i),u=Qn(s.R)+"/documents",a={writes:o.map(function(h){return $r(s.R,h)})},[4,s.Ni("Commit",u,a)];case 1:return c.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return r.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(t){var n;if(t.isFoundDocument())n=t.version;else{if(!t.isNoDocument())throw D();n=L.min()}var r=this.readVersions.get(t.key.toString());if(r){if(!n.isEqual(r))throw new w(y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),n)},e.prototype.precondition=function(t){var n=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&n?ft.updateTime(n):ft.none()},e.prototype.preconditionForUpdate=function(t){var n=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&n){if(n.isEqual(L.min()))throw new w(y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ft.updateTime(n)}return ft.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e}(),pp=function(){function e(t,n,r,i){this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.ec=5,this.Zi=new Ko(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.ec-=1,this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji(function(){return m(t,void 0,void 0,function(){var n,r,i=this;return v(this,function(o){return n=new dp(this.datastore),(r=this.sc(n))&&r.then(function(s){i.asyncQueue.enqueueAndForget(function(){return n.commit().then(function(){i.deferred.resolve(s)}).catch(function(u){i.ic(u)})})}).catch(function(s){i.ic(s)}),[2]})})})},e.prototype.sc=function(t){try{var n=this.updateFunction(t);return!ye(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(r){return this.deferred.reject(r),null}},e.prototype.ic=function(t){var n=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return n.nc(),Promise.resolve()})):this.deferred.reject(t)},e.prototype.rc=function(t){if(t.name==="FirebaseError"){var n=t.code;return n==="aborted"||n==="failed-precondition"||!ga(n)}return!1},e}(),yp=function(){function e(t,n,r){var i=this;this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=ht.UNAUTHENTICATED,this.clientId=Vu.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(n,function(o){return m(i,void 0,void 0,function(){return v(this,function(s){switch(s.label){case 0:return I("FirestoreClient","Received user=",o.uid),[4,this.credentialListener(o)];case 1:return s.sent(),this.user=o,[2]}})})})}return e.prototype.getConfiguration=function(){return m(this,void 0,void 0,function(){return v(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new w(y.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return m(t,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:o.sent(),o.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return r=o.sent(),i=cn(r,"Failed to shutdown persistence"),n.reject(i),[3,6];case 6:return[2]}})})}),n.promise},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(e,t){return m(this,void 0,void 0,function(){var n,r,i=this;return v(this,function(o){switch(o.label){case 0:return e.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return n=o.sent(),[4,t.initialize(n)];case 2:return o.sent(),r=n.initialUser,e.setCredentialChangeListener(function(s){return m(i,void 0,void 0,function(){return v(this,function(u){switch(u.label){case 0:return r.isEqual(s)?[3,2]:[4,hc(t.localStore,s)];case 1:u.sent(),r=s,u.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function Gc(e,t){return m(this,void 0,void 0,function(){var n,r;return v(this,function(i){switch(i.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,ss(e)];case 1:return n=i.sent(),I("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return r=i.sent(),[4,t.initialize(n,r)];case 3:return i.sent(),e.setCredentialChangeListener(function(o){return function(s,u){return m(this,void 0,void 0,function(){var a,c;return v(this,function(h){switch(h.label){case 0:return(a=_(s)).asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials"),c=re(a),a.Or.add(3),[4,sn(a)];case 1:return h.sent(),c&&a.Br.set("Unknown"),[4,a.remoteSyncer.handleCredentialChange(u)];case 2:return h.sent(),a.Or.delete(3),[4,Yn(a)];case 3:return h.sent(),[2]}})})}(t.remoteStore,o)}),e.onlineComponents=t,[2]}})})}function ss(e){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(I("FirestoreClient","Using default OfflineComponentProvider"),[4,Kc(e,new qc)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function oi(e){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(I("FirestoreClient","Using default OnlineComponentProvider"),[4,Gc(e,new os)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Qc(e){return ss(e).then(function(t){return t.persistence})}function us(e){return ss(e).then(function(t){return t.localStore})}function $c(e){return oi(e).then(function(t){return t.remoteStore})}function as(e){return oi(e).then(function(t){return t.syncEngine})}function ln(e){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:return[4,oi(e)];case 1:return t=r.sent(),[2,((n=t.eventManager).onListen=zd.bind(null,t.syncEngine),n.onUnlisten=Hd.bind(null,t.syncEngine),n)]}})})}function zc(e,t,n){var r=this;n===void 0&&(n={});var i=new yt;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return o=function(u,a,c,h,l){var f=new ii({next:function(d){a.enqueueAndForget(function(){return Wo(u,p)});var g=d.docs.has(c);!g&&d.fromCache?l.reject(new w(y.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&d.fromCache&&h&&h.source==="server"?l.reject(new w(y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(d)},error:function(d){return l.reject(d)}}),p=new Xo(Be(c.path),f,{includeMetadataChanges:!0,so:!0});return Ho(u,p)},[4,ln(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}function Hc(e,t,n){var r=this;n===void 0&&(n={});var i=new yt;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return o=function(u,a,c,h,l){var f=new ii({next:function(d){a.enqueueAndForget(function(){return Wo(u,p)}),d.fromCache&&h.source==="server"?l.reject(new w(y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:function(d){return l.reject(d)}}),p=new Xo(c,f,{includeMetadataChanges:!0,so:!0});return Ho(u,p)},[4,ln(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}var gp=function(e,t,n,r,i,o,s,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=u},si=function(){function e(t,n){this.projectId=t,this.database=n||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database==="(default)"},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),Wc=new Map,Yc=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},Xc=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){this.changeListener=n,t.enqueueRetryable(function(){return n(ht.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),vp=function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){var r=this;this.changeListener=n,t.enqueueRetryable(function(){return n(r.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),mp=function(){function e(t){var n=this;this.currentUser=ht.UNAUTHENTICATED,this.oc=new yt,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){n.cc++,n.currentUser=n.ac(),n.oc.resolve(),n.changeListener&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})};var r=function(i){I("FirebaseCredentialsProvider","Auth detected"),n.auth=i,n.auth.addAuthTokenListener(n.uc)};t.onInit(function(i){return r(i)}),setTimeout(function(){if(!n.auth){var i=t.getImmediate({optional:!0});i?r(i):(I("FirebaseCredentialsProvider","Auth not yet detected"),n.oc.resolve())}},0)}return e.prototype.getToken=function(){var t=this,n=this.cc,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(function(i){return t.cc!==n?(I("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):i?(x(typeof i.accessToken=="string"),new Yc(i.accessToken,t.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t,n){var r=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this.oc.promise];case 1:return i.sent(),[4,n(this.currentUser)];case 2:return i.sent(),this.changeListener=n,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return x(t===null||typeof t=="string"),new ht(t)},e}(),wp=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r,this.type="FirstParty",this.user=ht.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},n=this.hc.auth.getAuthHeaderValueForFirstParty([]);return n&&(t.Authorization=n),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),e}(),bp=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r}return e.prototype.getToken=function(){return Promise.resolve(new wp(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(t,n){t.enqueueRetryable(function(){return n(ht.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cs(e,t,n){if(!n)throw new w(y.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function hs(e,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new w(y.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function Jc(e,t,n,r){if(t===!0&&r===!0)throw new w(y.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function Zc(e){if(!N.isDocumentKey(e))throw new w(y.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function th(e){if(N.isDocumentKey(e))throw new w(y.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function ui(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";var t=function(n){if(n.constructor){var r=/function\s+([^\s(]+)\s*\(/.exec(n.constructor.toString());if(r&&r.length>1)return r[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return typeof e=="function"?"a function":D()}function U(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new w(y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ui(e);throw new w(y.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+n)}return e}function eh(e,t){if(t<=0)throw new w(y.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nh=function(){function e(t){var n;if(t.host===void 0){if(t.ssl!==void 0)throw new w(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new w(y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Jc("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},e}(),Jn=function(){function e(t,n){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nh({}),this._settingsFrozen=!1,t instanceof si?(this._databaseId=t,this._credentials=new Xc):(this._app=t,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new w(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new si(r.options.projectId)}(t),this._credentials=new mp(n))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new w(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return this._terminateTask!==void 0},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new w(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nh(t),t.credentials!==void 0&&(this._credentials=function(n){if(!n)return new Xc;switch(n.type){case"gapi":var r=n.client;return x(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new bp(r,n.sessionIndex||"0",n.iamToken||null);case"provider":return n.client;default:throw new w(y.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return t=this,(n=Wc.get(t))&&(I("ComponentProvider","Removing Datastore"),Wc.delete(t),n.terminate()),Promise.resolve();var t,n},e}(),G=function(){function e(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new oe(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),_t=function(){function e(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),oe=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,Be(i))||this)._path=i,o.type="collection",o}return k(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._path.popLast();return n.isEmpty()?null:new G(this.firestore,null,new N(n))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(n){return new t(this.firestore,n,this._path)},t}(_t);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rh(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=H(e),cs("collection","path",t),e instanceof Jn)return th(n=V.fromString.apply(V,z([t],r))),new oe(e,null,n);if(!(e instanceof G||e instanceof oe))throw new w(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return th(n=V.fromString.apply(V,z([e.path],r)).child(V.fromString(t))),new oe(e.firestore,null,n)}function ai(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=H(e),arguments.length===1&&(t=Vu.u()),cs("doc","path",t),e instanceof Jn)return Zc(n=V.fromString.apply(V,z([t],r))),new G(e,null,new N(n));if(!(e instanceof G||e instanceof oe))throw new w(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Zc(n=e._path.child(V.fromString.apply(V,z([t],r)))),new G(e.firestore,e instanceof oe?e.converter:null,new N(n))}function ih(e,t){return e=H(e),t=H(t),(e instanceof G||e instanceof oe)&&(t instanceof G||t instanceof oe)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function oh(e,t){return e=H(e),t=H(t),e instanceof _t&&t instanceof _t&&e.firestore===t.firestore&&Vn(e._query,t._query)&&e.converter===t.converter}var Tp=function(){function e(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Ko(this,"async_queue_retry"),this.Ic=function(){var r=ti();r&&I("AsyncQueue","Visibility state changed to "+r.visibilityState),t.Zi.Gi()};var n=ti();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},e.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var n=ti();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Ic)}},e.prototype.enqueue=function(t){var n=this;if(this.Ac(),this._c)return new Promise(function(){});var r=new yt;return this.Rc(function(){return n._c&&n.Ec?Promise.resolve():(t().then(r.resolve,r.reject),r.promise)}).then(function(){return r.promise})},e.prototype.enqueueRetryable=function(t){var n=this;this.enqueueAndForget(function(){return n.wc.push(t),n.bc()})},e.prototype.bc=function(){return m(this,void 0,void 0,function(){var t,n=this;return v(this,function(r){switch(r.label){case 0:if(this.wc.length===0)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return r.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!be(t=r.sent()))throw t;return I("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return n.bc()}),r.label=5;case 5:return[2]}})})},e.prototype.Rc=function(t){var n=this,r=this.dc.then(function(){return n.gc=!0,t().catch(function(i){throw n.yc=i,n.gc=!1,Y("INTERNAL UNHANDLED ERROR: ",function(o){var s=o.message||"";return o.stack&&(s=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),s}(i)),i}).then(function(i){return n.gc=!1,i})});return this.dc=r,r},e.prototype.enqueueAfterDelay=function(t,n,r){var i=this;this.Ac(),this.Tc.indexOf(t)>-1&&(n=0);var o=Md.createAndSchedule(this,t,n,r,function(s){return i.vc(s)});return this.mc.push(o),o},e.prototype.Ac=function(){this.yc&&D()},e.prototype.verifyOperationInProgress=function(){},e.prototype.Pc=function(){return m(this,void 0,void 0,function(){var t;return v(this,function(n){switch(n.label){case 0:return[4,t=this.dc];case 1:n.sent(),n.label=2;case 2:if(t!==this.dc)return[3,0];n.label=3;case 3:return[2]}})})},e.prototype.Vc=function(t){for(var n=0,r=this.mc;n<r.length;n++)if(r[n].timerId===t)return!0;return!1},e.prototype.Sc=function(t){var n=this;return this.Pc().then(function(){n.mc.sort(function(s,u){return s.targetTimeMs-u.targetTimeMs});for(var r=0,i=n.mc;r<i.length;r++){var o=i[r];if(o.skipDelay(),t!=="all"&&o.timerId===t)break}return n.Pc()})},e.prototype.Dc=function(t){this.Tc.push(t)},e.prototype.vc=function(t){var n=this.mc.indexOf(t);this.mc.splice(n,1)},e}();function fn(e){return function(t,n){if(typeof t!="object"||t===null)return!1;for(var r=t,i=0,o=["next","error","complete"];i<o.length;i++){var s=o[i];if(s in r&&typeof r[s]=="function")return!0}return!1}(e)}var Ip=function(){function e(){this._progressObserver={},this._taskCompletionResolver=new yt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return e.prototype.onProgress=function(t,n,r){this._progressObserver={next:t,error:n,complete:r}},e.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},e.prototype.then=function(t,n){return this._taskCompletionResolver.promise.then(t,n)},e.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},e.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},e.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},e}(),Ep=-1,$=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).type="firestore",i._queue=new Tp,i._persistenceKey="name"in n?n.name:"[DEFAULT]",i}return k(t,e),t.prototype._terminate=function(){return this._firestoreClient||sh(this),this._firestoreClient.terminate()},t}(Jn);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rt(e){return e._firestoreClient||sh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function sh(e){var t,n=e._freezeSettings(),r=function(i,o,s,u){return new gp(i,o,s,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,u.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new yp(e._credentials,e._queue,r)}function uh(e,t,n){var r=this,i=new yt;return e.asyncQueue.enqueue(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,Kc(e,n)];case 1:return s.sent(),[4,Gc(e,t)];case 2:return s.sent(),i.resolve(),[3,4];case 3:if(!function(u){return u.name==="FirebaseError"?u.code===y.FAILED_PRECONDITION||u.code===y.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&u instanceof DOMException)||u.code===22||u.code===20||u.code===11}(o=s.sent()))throw o;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),i.reject(o),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function ah(e){if(e._initialized||e._terminated)throw new w(y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qt=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)if(t[r].length===0)throw new w(y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ot(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e}(),Ee=function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(wt.fromBase64String(t))}catch(n){throw new w(y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},e.fromUint8Array=function(t){return new e(wt.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e}(),_e=function(e){this._methodName=e},ci=function(){function e(t,n){if(!isFinite(t)||t<-90||t>90)throw new w(y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new w(y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return P(this._lat,t._lat)||P(this._long,t._long)},e}(),_p=/^__.*__$/,Sp=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return this.fieldMask!==null?new Xt(t,this.data,this.fieldMask,n,this.fieldTransforms):new jn(t,this.data,n,this.fieldTransforms)},e}(),ch=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return new Xt(t,this.data,this.fieldMask,n,this.fieldTransforms)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}var lh=function(){function e(t,n,r,i,o,s){this.settings=t,this.databaseId=n,this.R=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Cc(),this.fieldTransforms=o||[],this.fieldMask=s||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),e.prototype.xc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.kc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.$c(t),i},e.prototype.Oc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.Cc(),i},e.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},e.prototype.Lc=function(t){return li(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},e.prototype.contains=function(t){return this.fieldMask.find(function(n){return t.isPrefixOf(n)})!==void 0||this.fieldTransforms.find(function(n){return t.isPrefixOf(n.field)})!==void 0},e.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},e.prototype.$c=function(t){if(t.length===0)throw this.Lc("Document fields must not be empty");if(hh(this.Nc)&&_p.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},e}(),Dp=function(){function e(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.R=r||Wn(t)}return e.prototype.Uc=function(t,n,r,i){return i===void 0&&(i=!1),new lh({Nc:t,methodName:n,qc:r,path:Ot.emptyPath(),Fc:!1,Bc:i},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function Se(e){var t=e._freezeSettings(),n=Wn(e._databaseId);return new Dp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function hi(e,t,n,r,i,o){o===void 0&&(o={});var s=e.Uc(o.merge||o.mergeFields?2:0,t,n,i);ps("Data must be an object, but it was:",s,r);var u,a,c=ph(r,s);if(o.merge)u=new Ve(s.fieldMask),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=ys(t,f[l],n);if(!s.contains(p))throw new w(y.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");gh(h,p)||h.push(p)}u=new Ve(h),a=s.fieldTransforms.filter(function(d){return u.covers(d.field)})}else u=null,a=s.fieldTransforms;return new Sp(new Nt(c),u,a)}var ls=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype._toFieldTransform=function(n){if(n.Nc!==2)throw n.Nc===1?n.Lc(this._methodName+"() can only appear at the top level of your update data"):n.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return n.fieldMask.push(n.path),null},t.prototype.isEqual=function(n){return n instanceof t},t}(_e);function fh(e,t,n){return new lh({Nc:3,qc:t.settings.qc,methodName:e._methodName,Fc:n},t.databaseId,t.R,t.ignoreUndefinedProperties)}var Np=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype._toFieldTransform=function(n){return new qn(n.path,new Ge)},t.prototype.isEqual=function(n){return n instanceof t},t}(_e),Ap=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return k(t,e),t.prototype._toFieldTransform=function(n){var r=fh(this,n,!0),i=this.Kc.map(function(s){return De(s,r)}),o=new ve(i);return new qn(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(_e),Cp=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return k(t,e),t.prototype._toFieldTransform=function(n){var r=fh(this,n,!0),i=this.Kc.map(function(s){return De(s,r)}),o=new me(i);return new qn(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(_e),kp=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Qc=r,i}return k(t,e),t.prototype._toFieldTransform=function(n){var r=new Qe(n.R,oa(n.R,this.Qc));return new qn(n.path,r)},t.prototype.isEqual=function(n){return this===n},t}(_e);function fs(e,t,n,r){var i=e.Uc(1,t,n);ps("Data must be an object, but it was:",i,r);var o=[],s=Nt.empty();pe(r,function(a,c){var h=gs(t,a,n);c=H(c);var l=i.Oc(h);if(c instanceof ls)o.push(h);else{var f=De(c,l);f!=null&&(o.push(h),s.set(h,f))}});var u=new Ve(o);return new ch(s,u,i.fieldTransforms)}function ds(e,t,n,r,i,o){var s=e.Uc(1,t,n),u=[ys(t,r,n)],a=[i];if(o.length%2!=0)throw new w(y.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(ys(t,o[c])),a.push(o[c+1]);for(var h=[],l=Nt.empty(),f=u.length-1;f>=0;--f)if(!gh(h,u[f])){var p=u[f],d=a[f];d=H(d);var g=s.Oc(p);if(d instanceof ls)h.push(p);else{var T=De(d,g);T!=null&&(h.push(p),l.set(p,T))}}var E=new Ve(h);return new ch(l,E,s.fieldTransforms)}function dh(e,t,n,r){return r===void 0&&(r=!1),De(n,e.Uc(r?4:3,t))}function De(e,t){if(yh(e=H(e)))return ps("Unsupported field value:",t,e),ph(e,t);if(e instanceof _e)return function(n,r){if(!hh(r.Nc))throw r.Lc(n._methodName+"() can only be used with update() and set()");if(!r.path)throw r.Lc(n._methodName+"() is not currently supported inside arrays");var i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&t.Nc!==4)throw t.Lc("Nested arrays are not supported");return function(n,r){for(var i=[],o=0,s=0,u=n;s<u.length;s++){var a=De(u[s],r.Mc(o));a==null&&(a={nullValue:"NULL_VALUE"}),i.push(a),o++}return{arrayValue:{values:i}}}(e,t)}return function(n,r){if((n=H(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return oa(r.R,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){var i=Tt.fromDate(n);return{timestampValue:Kn(r.R,i)}}if(n instanceof Tt)return i=new Tt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3)),{timestampValue:Kn(r.R,i)};if(n instanceof ci)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ee)return{bytesValue:Sa(r.R,n._byteString)};if(n instanceof G){i=r.databaseId;var o=n.firestore._databaseId;if(!o.isEqual(i))throw r.Lc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Ao(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.Lc("Unsupported field value: "+ui(n))}(e,t)}function ph(e,t){var n={};return ju(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):pe(e,function(r,i){var o=De(i,t.kc(r));o!=null&&(n[r]=o)}),{mapValue:{fields:n}}}function yh(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof Tt||e instanceof ci||e instanceof Ee||e instanceof G||e instanceof _e)}function ps(e,t,n){if(!yh(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){var r=ui(n);throw r==="an object"?t.Lc(e+" a custom object"):t.Lc(e+" "+r)}}function ys(e,t,n){if((t=H(t))instanceof qt)return t._internalPath;if(typeof t=="string")return gs(e,t);throw li("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var xp=new RegExp("[~\\*/\\[\\]]");function gs(e,t,n){if(t.search(xp)>=0)throw li("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,n);try{return new(qt.bind.apply(qt,z([void 0],t.split("."))))()._internalPath}catch{throw li("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,n)}}function li(e,t,n,r,i){var o=r&&!r.isEmpty(),s=i!==void 0,u="Function "+t+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new w(y.INVALID_ARGUMENT,(u+=". ")+e+a)}function gh(e,t){return e.some(function(n){return n.isEqual(t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zn=function(){function e(t,n,r,i,o){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new G(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return this._document!==null},e.prototype.data=function(){if(this._document){if(this._converter){var t=new Rp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(t){if(this._document){var n=this._document.data.field(fi("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}},e}(),Rp=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}(Zn);function fi(e,t){return typeof t=="string"?gs(e,t):t instanceof qt?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ne=function(){function e(t,n){this.hasPendingWrites=t,this.fromCache=n}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e}(),zt=function(e){function t(n,r,i,o,s,u){var a=this;return(a=e.call(this,n,r,i,o,u)||this)._firestore=n,a._firestoreImpl=n,a.metadata=s,a}return k(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(n){if(n===void 0&&(n={}),this._document){if(this._converter){var r=new tr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}},t.prototype.get=function(n,r){if(r===void 0&&(r={}),this._document){var i=this._document.data.field(fi("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i,r.serverTimestamps)}},t}(Zn),tr=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.data=function(n){return n===void 0&&(n={}),e.prototype.data.call(this,n)},t}(zt),se=function(){function e(t,n,r,i){this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new Ne(i.hasPendingWrites,i.fromCache),this.query=r}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach(function(n){return t.push(n)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.size===0},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach(function(i){t.call(n,new tr(r._firestore,r._userDataWriter,i.key,i,new Ne(r._snapshot.mutatedKeys.has(i.key),r._snapshot.fromCache),r.query.converter))})},e.prototype.docChanges=function(t){t===void 0&&(t={});var n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new w(y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){var o=0;return r._snapshot.docChanges.map(function(u){return{type:"added",doc:new tr(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ne(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:o++}})}var s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(function(u){return i||u.type!==3}).map(function(u){var a=new tr(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ne(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),c=-1,h=-1;return u.type!==0&&(c=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),u.type!==1&&(h=(s=s.add(u.doc)).indexOf(u.doc.key)),{type:Lp(u.type),doc:a,oldIndex:c,newIndex:h}})}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges},e}();function Lp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function vh(e,t){return e instanceof zt&&t instanceof zt?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(e._document===null?t._document===null:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof se&&t instanceof se&&e._firestore===t._firestore&&oh(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mh(e){if(Ur(e)&&e.explicitOrderBy.length===0)throw new w(y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var er=function(){};function ue(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=o._apply(e)}return e}var Op=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).jc=n,o.Wc=r,o.Gc=i,o.type="where",o}return k(t,e),t.prototype._apply=function(n){var r=Se(n.firestore),i=function(o,s,u,a,c,h,l){var f;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new w(y.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+h+"' queries on FieldPath.documentId().");if(h==="in"||h==="not-in"){_h(l,h);for(var p=[],d=0,g=l;d<g.length;d++){var T=g[d];p.push(Eh(a,o,T))}f={arrayValue:{values:p}}}else f=Eh(a,o,l)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||_h(l,h),f=dh(u,"where",l,h==="in"||h==="not-in");var E=At.create(c,h,f);return function(A,C){if(C.g()){var O=bo(A);if(O!==null&&!O.isEqual(C.field))throw new w(y.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+O.toString()+"' and '"+C.field.toString()+"'");var F=wo(A);F!==null&&Sh(A,C.field,F)}var q=function(it,vi){for(var dn=0,bs=it.filters;dn<bs.length;dn++){var Ts=bs[dn];if(vi.indexOf(Ts.op)>=0)return Ts.op}return null}(A,function(it){switch(it){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(C.op));if(q!==null)throw q===C.op?new w(y.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+C.op.toString()+"' filter."):new w(y.INVALID_ARGUMENT,"Invalid query. You cannot use '"+C.op.toString()+"' filters with '"+q.toString()+"' filters.")}(o,E),E}(n._query,0,r,n.firestore._databaseId,this.jc,this.Wc,this.Gc);return new _t(n.firestore,n.converter,function(o,s){var u=o.filters.concat([s]);return new Kt(o.path,o.collectionGroup,o.explicitOrderBy.slice(),u,o.limit,o.limitType,o.startAt,o.endAt)}(n._query,i))},t}(er),Pp=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).jc=n,i.zc=r,i.type="orderBy",i}return k(t,e),t.prototype._apply=function(n){var r=function(i,o,s){if(i.startAt!==null)throw new w(y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new w(y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var u=new je(o,s);return function(a,c){if(wo(a)===null){var h=bo(a);h!==null&&Sh(a,h,c.field)}}(i,u),u}(n._query,this.jc,this.zc);return new _t(n.firestore,n.converter,function(i,o){var s=i.explicitOrderBy.concat([o]);return new Kt(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(n._query,r))},t}(er),wh=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Hc=r,o.Jc=i,o}return k(t,e),t.prototype._apply=function(n){return new _t(n.firestore,n.converter,ta(n._query,this.Hc,this.Jc))},t}(er),bh=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return k(t,e),t.prototype._apply=function(n){var r=Ih(n,this.type,this.Yc,this.Xc);return new _t(n.firestore,n.converter,function(i,o){return new Kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)}(n._query,r))},t}(er),Th=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return k(t,e),t.prototype._apply=function(n){var r=Ih(n,this.type,this.Yc,this.Xc);return new _t(n.firestore,n.converter,function(i,o){return new Kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)}(n._query,r))},t}(er);function Ih(e,t,n,r){if(n[0]=H(n[0]),n[0]instanceof Zn)return function(o,s,u,a,c){if(!a)throw new w(y.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+u+"().");for(var h=[],l=0,f=Ke(o);l<f.length;l++){var p=f[l];if(p.field.isKeyField())h.push(Lr(s,a.key));else{var d=a.data.field(p.field);if(po(d))throw new w(y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){var g=p.field.canonicalString();throw new w(y.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+g+"' (used as the orderBy) does not exist.")}h.push(d)}}return new Mn(h,c)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Se(e.firestore);return function(o,s,u,a,c,h){var l=o.explicitOrderBy;if(c.length>l.length)throw new w(y.INVALID_ARGUMENT,"Too many arguments provided to "+a+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var f=[],p=0;p<c.length;p++){var d=c[p];if(l[p].field.isKeyField()){if(typeof d!="string")throw new w(y.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+a+"(), but got a "+typeof d);if(!To(o)&&d.indexOf("/")!==-1)throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+a+"() must be a plain document ID, but '"+d+"' contains a slash.");var g=o.path.child(V.fromString(d));if(!N.isDocumentKey(g))throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+a+"() must result in a valid document path, but '"+g+"' is not because it contains an odd number of segments.");var T=new N(g);f.push(Lr(s,T))}else{var E=dh(u,a,d);f.push(E)}}return new Mn(f,h)}(e._query,e.firestore._databaseId,i,t,n,r)}function Eh(e,t,n){if(typeof(n=H(n))=="string"){if(n==="")throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!To(t)&&n.indexOf("/")!==-1)throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=t.path.child(V.fromString(n));if(!N.isDocumentKey(r))throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Lr(e,new N(r))}if(n instanceof G)return Lr(e,n._key);throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ui(n)+".")}function _h(e,t){if(!Array.isArray(e)||e.length===0)throw new w(y.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new w(y.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function Sh(e,t,n){if(!n.isEqual(t))throw new w(y.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vs=function(){function e(){}return e.prototype.convertValue=function(t,n){switch(n===void 0&&(n="none"),ge(t)){case 0:return null;case 1:return t.booleanValue;case 2:return X(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(Ue(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 10:return this.convertObject(t.mapValue,n);default:throw D()}},e.prototype.convertObject=function(t,n){var r=this,i={};return pe(t.fields,function(o,s){i[o]=r.convertValue(s,n)}),i},e.prototype.convertGeoPoint=function(t){return new ci(X(t.latitude),X(t.longitude))},e.prototype.convertArray=function(t,n){var r=this;return(t.values||[]).map(function(i){return r.convertValue(i,n)})},e.prototype.convertServerTimestamp=function(t,n){switch(n){case"previous":var r=Ku(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Ln(t));default:return null}},e.prototype.convertTimestamp=function(t){var n=Yt(t);return new Tt(n.seconds,n.nanos)},e.prototype.convertDocumentKey=function(t,n){var r=V.fromString(t);x(Va(r));var i=new si(r.get(1),r.get(3)),o=new N(r.popFirst(5));return i.isEqual(n)||Y("Document "+o+" contains a document reference within a different database ("+i.projectId+"/"+i.database+") which is not supported. It will be treated as a reference in the current database ("+n.projectId+"/"+n.database+") instead."),o},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Fp=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return k(t,e),t.prototype.convertBytes=function(n){return new Ee(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new G(this.firestore,null,r)},t}(vs),Mp=function(){function e(t,n){this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Se(t)}return e.prototype.set=function(t,n,r){this._verifyNotCommitted();var i=ae(t,this._firestore),o=di(i.converter,n,r),s=hi(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(s.toMutation(i._key,ft.none())),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,u=ae(t,this._firestore);return s=typeof(n=H(n))=="string"||n instanceof qt?ds(this._dataReader,"WriteBatch.update",u._key,n,r,i):fs(this._dataReader,"WriteBatch.update",u._key,n),this._mutations.push(s.toMutation(u._key,ft.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var n=ae(t,this._firestore);return this._mutations=this._mutations.concat(new Bn(n._key,ft.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new w(y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(e,t){if((e=H(e)).firestore!==t)throw new w(y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ae=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return k(t,e),t.prototype.convertBytes=function(n){return new Ee(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new G(this.firestore,null,r)},t}(vs);function Dh(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=U(e,G);var o=U(e.firestore,$),s=Se(o);return nr(o,[(typeof(t=H(t))=="string"||t instanceof qt?ds(s,"updateDoc",e._key,t,n,r):fs(s,"updateDoc",e._key,t)).toMutation(e._key,ft.exists(!0))])}function Nh(e){for(var t,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];e=H(e);var s={includeMetadataChanges:!1},u=0;typeof i[u]!="object"||fn(i[u])||(s=i[u],u++);var a,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(fn(i[u])){var f=i[u];i[u]=(t=f.next)===null||t===void 0?void 0:t.bind(f),i[u+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),i[u+2]=(r=f.complete)===null||r===void 0?void 0:r.bind(f)}if(e instanceof G)c=U(e.firestore,$),h=Be(e._key.path),a={next:function(g){i[u]&&i[u](ms(c,e,g))},error:i[u+1],complete:i[u+2]};else{var p=U(e,_t);c=U(p.firestore,$),h=p._query;var d=new Ae(c);a={next:function(g){i[u]&&i[u](new se(c,d,p,g))},error:i[u+1],complete:i[u+2]},mh(e._query)}return function(g,T,E,A){var C=this,O=new ii(A),F=new Xo(T,O,E);return g.asyncQueue.enqueueAndForget(function(){return m(C,void 0,void 0,function(){var q;return v(this,function(it){switch(it.label){case 0:return q=Ho,[4,ln(g)];case 1:return[2,q.apply(void 0,[it.sent(),F])]}})})}),function(){O.Wo(),g.asyncQueue.enqueueAndForget(function(){return m(C,void 0,void 0,function(){var q;return v(this,function(it){switch(it.label){case 0:return q=Wo,[4,ln(g)];case 1:return[2,q.apply(void 0,[it.sent(),F])]}})})})}}(rt(c),h,l,a)}function nr(e,t){return function(n,r){var i=this,o=new yt;return n.asyncQueue.enqueueAndForget(function(){return m(i,void 0,void 0,function(){var s;return v(this,function(u){switch(u.label){case 0:return s=Wd,[4,as(n)];case 1:return[2,s.apply(void 0,[u.sent(),r,o])]}})})}),o.promise}(rt(e),t)}function ms(e,t,n){var r=n.docs.get(t._key),i=new Ae(e);return new zt(e,i,t._key,r,new Ne(n.hasPendingWrites,n.fromCache),t.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vp=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this)._firestore=n,i}return k(t,e),t.prototype.get=function(n){var r=this,i=ae(n,this._firestore),o=new Ae(this._firestore);return e.prototype.get.call(this,n).then(function(s){return new zt(r._firestore,o,i._key,s._document,new Ne(!1,!1),i.converter)})},t}(function(){function e(t,n){this._firestore=t,this._transaction=n,this._dataReader=Se(t)}return e.prototype.get=function(t){var n=this,r=ae(t,this._firestore),i=new Fp(this._firestore);return this._transaction.lookup([r._key]).then(function(o){if(!o||o.length!==1)return D();var s=o[0];if(s.isFoundDocument())return new Zn(n._firestore,i,s.key,s,r.converter);if(s.isNoDocument())return new Zn(n._firestore,i,r._key,null,r.converter);throw D()})},e.prototype.set=function(t,n,r){var i=ae(t,this._firestore),o=di(i.converter,n,r),s=hi(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,r);return this._transaction.set(i._key,s),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,u=ae(t,this._firestore);return s=typeof(n=H(n))=="string"||n instanceof qt?ds(this._dataReader,"Transaction.update",u._key,n,r,i):fs(this._dataReader,"Transaction.update",u._key,n),this._transaction.update(u._key,s),this},e.prototype.delete=function(t){var n=ae(t,this._firestore);return this._transaction.delete(n._key),this},e}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ah(){if(typeof Uint8Array=="undefined")throw new w(y.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ch(){if(typeof atob=="undefined")throw new w(y.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var kh=function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return Ch(),new e(Ee.fromBase64String(t))},e.fromUint8Array=function(t){return Ah(),new e(Ee.fromUint8Array(t))},e.prototype.toBase64=function(){return Ch(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return Ah(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),Up=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,n){return function(r,i){ah(r=U(r,$));var o=rt(r),s=r._freezeSettings(),u=new os;return uh(o,u,new jc(u,s.cacheSizeBytes,i==null?void 0:i.forceOwnership))}(t._delegate,{forceOwnership:n})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(n){ah(n=U(n,$));var r=rt(n),i=n._freezeSettings(),o=new os;return uh(r,o,new lp(o,i.cacheSizeBytes))}(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return function(n){var r=this;if(n._initialized&&!n._terminated)throw new w(y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var i=new yt;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,function(u){return m(this,void 0,void 0,function(){var a;return v(this,function(c){switch(c.label){case 0:return Ye.yt()?(a=u+"main",[4,Ye.delete(a)]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})}(Mo(n._databaseId,n._persistenceKey))];case 1:return s.sent(),i.resolve(),[3,3];case 2:return o=s.sent(),i.reject(o),[3,3];case 3:return[2]}})})}),i.promise}(t._delegate)},e}(),xh=function(){function e(t,n,r){var i=this;this._delegate=n,this.Zc=r,this.INTERNAL={delete:function(){return i.terminate()}},t instanceof si||(this.tu=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){var n=this._delegate._getSettings();t.merge||n.host===t.host||Rn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},n),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,n,r){r===void 0&&(r={}),function(i,o,s,u){var a;u===void 0&&(u={});var c=(i=U(i,Jn))._getSettings();if(c.host!=="firestore.googleapis.com"&&c.host!==o&&Rn("Host has been set in both settings() and useEmulator(), emulator host will be used"),i._setSettings(Object.assign(Object.assign({},c),{host:o+":"+s,ssl:!1})),u.mockUserToken){var h,l;if(typeof u.mockUserToken=="string")h=u.mockUserToken,l=ht.MOCK_USER;else{h=Kh(u.mockUserToken,(a=i._app)===null||a===void 0?void 0:a.options.projectId);var f=u.mockUserToken.sub||u.mockUserToken.user_id;if(!f)throw new w(y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ht(f)}i._credentials=new vp(new Yc(h,l))}}(this._delegate,t,n,r)},e.prototype.enableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return[4,Qc(t)];case 1:return r=o.sent(),[4,$c(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!0),function(s){var u=_(s);return u.Or.delete(0),Yn(u)}(i))]}})})})}(rt(U(this._delegate,$)))},e.prototype.disableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return[4,Qc(t)];case 1:return r=o.sent(),[4,$c(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!1),function(s){return m(this,void 0,void 0,function(){var u;return v(this,function(a){switch(a.label){case 0:return(u=_(s)).Or.add(0),[4,sn(u)];case 1:return a.sent(),u.Br.set("Offline"),[2]}})})}(i))]}})})})}(rt(U(this._delegate,$)))},e.prototype.enablePersistence=function(t){var n=!1,r=!1;return t&&Jc("synchronizeTabs",n=!!t.synchronizeTabs,"experimentalForceOwningTab",r=!!t.experimentalForceOwningTab),n?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,r)},e.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var n=this,r=new yt;return t.asyncQueue.enqueueAndForget(function(){return m(n,void 0,void 0,function(){var i;return v(this,function(o){switch(o.label){case 0:return i=Zd,[4,as(t)];case 1:return[2,i.apply(void 0,[o.sent(),r])]}})})}),r.promise}(rt(U(this._delegate,$)))},e.prototype.onSnapshotsInSync=function(t){return function(n,r){return function(i,o){var s=this,u=new ii(o);return i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var a;return v(this,function(c){switch(c.label){case 0:return a=function(h,l){_(h).Gr.add(l),l.next()},[4,ln(i)];case 1:return[2,a.apply(void 0,[c.sent(),u])]}})})}),function(){u.Wo(),i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var a;return v(this,function(c){switch(c.label){case 0:return a=function(h,l){_(h).Gr.delete(l)},[4,ln(i)];case 1:return[2,a.apply(void 0,[c.sent(),u])]}})})})}}(rt(n=U(n,$)),fn(r)?r:{next:r})}(this._delegate,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.tu)throw new w(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new gi(this,rh(this._delegate,t))}catch(n){throw bt(n,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new Ce(this,ai(this._delegate,t))}catch(n){throw bt(n,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new or(this,function(n,r){if(n=U(n,Jn),cs("collectionGroup","collection id",r),r.indexOf("/")>=0)throw new w(y.INVALID_ARGUMENT,"Invalid collection ID '"+r+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new _t(n,null,function(i){return new Kt(V.emptyPath(),i)}(r))}(this._delegate,t))}catch(n){throw bt(n,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var n=this;return function(r,i){return function(o,s){var u=this,a=new yt;return o.asyncQueue.enqueueAndForget(function(){return m(u,void 0,void 0,function(){var c;return v(this,function(h){switch(h.label){case 0:return[4,function(l){return oi(l).then(function(f){return f.datastore})}(o)];case 1:return c=h.sent(),new pp(o.asyncQueue,c,s,a).run(),[2]}})})}),a.promise}(rt(r),function(o){return i(new Vp(r,o))})}(this._delegate,function(r){return t(new Rh(n,r))})},e.prototype.batch=function(){var t=this;return rt(this._delegate),new Lh(new Mp(this._delegate,function(n){return nr(t._delegate,n)}))},e.prototype.loadBundle=function(t){throw new w(y.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new w(y.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),pi=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return k(t,e),t.prototype.convertBytes=function(n){return new kh(new Ee(n))},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return Ce.eu(r,this.firestore,null)},t}(vs);function qp(e){var t;t=e,Lt.setLogLevel(t)}var Rh=function(){function e(t,n){this._firestore=t,this._delegate=n,this._userDataWriter=new pi(t)}return e.prototype.get=function(t){var n=this,r=ke(t);return this._delegate.get(r).then(function(i){return new rr(n._firestore,new zt(n._firestore._delegate,n._userDataWriter,i._key,i._document,i.metadata,r.converter))})},e.prototype.set=function(t,n,r){var i=ke(t);return r?(hs("Transaction.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=ke(t);return arguments.length===2?this._delegate.update(u,n):(i=this._delegate).update.apply(i,z([u,n,r],o)),this},e.prototype.delete=function(t){var n=ke(t);return this._delegate.delete(n),this},e}(),Lh=function(){function e(t){this._delegate=t}return e.prototype.set=function(t,n,r){var i=ke(t);return r?(hs("WriteBatch.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=ke(t);return arguments.length===2?this._delegate.update(u,n):(i=this._delegate).update.apply(i,z([u,n,r],o)),this},e.prototype.delete=function(t){var n=ke(t);return this._delegate.delete(n),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),yi=function(){function e(t,n,r){this._firestore=t,this._userDataWriter=n,this._delegate=r}return e.prototype.fromFirestore=function(t,n){var r=new tr(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new ir(this._firestore,r),n!=null?n:{})},e.prototype.toFirestore=function(t,n){return n?this._delegate.toFirestore(t,n):this._delegate.toFirestore(t)},e.nu=function(t,n){var r=e.su,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new pi(t),n),i.set(n,o)),o},e}();yi.su=new WeakMap;var Ce=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new pi(t)}return e.iu=function(t,n,r){if(t.length%2!=0)throw new w(y.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(n,new G(n._delegate,r,new N(t)))},e.eu=function(t,n,r){return new e(n,new G(n._delegate,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new gi(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new gi(this.firestore,rh(this._delegate,t))}catch(n){throw bt(n,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=H(t))instanceof G&&ih(this._delegate,t)},e.prototype.set=function(t,n){n=hs("DocumentReference.set",n);try{return function(r,i,o){r=U(r,G);var s=U(r.firestore,$),u=di(r.converter,i,o);return nr(s,[hi(Se(s),"setDoc",r._key,u,r.converter!==null,o).toMutation(r._key,ft.none())])}(this._delegate,t,n)}catch(r){throw bt(r,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return arguments.length===1?Dh(this._delegate,t):Dh.apply(void 0,z([this._delegate,t,n],r))}catch(o){throw bt(o,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return nr(U((t=this._delegate).firestore,$),[new Bn(t._key,ft.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Oh(n),o=Ph(n,function(s){return new rr(t.firestore,new zt(t.firestore._delegate,t._userDataWriter,s._key,s._document,s.metadata,t._delegate.converter))});return Nh(this._delegate,i,o)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=U(r,G);var i=U(r.firestore,$),o=rt(i),s=new Ae(i);return function(u,a){var c=this,h=new yt;return u.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return v(this,function(f){switch(f.label){case 0:return l=function(p,d,g){return m(this,void 0,void 0,function(){var T,E;return v(this,function(A){switch(A.label){case 0:return A.trys.push([0,2,,3]),[4,function(C,O){var F=_(C);return F.persistence.runTransaction("read document","readonly",function(q){return F.Mn.mn(q,O)})}(p,d)];case 1:return(E=A.sent()).isFoundDocument()?g.resolve(E):E.isNoDocument()?g.resolve(null):g.reject(new w(y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return T=A.sent(),E=cn(T,"Failed to get document '"+d+" from cache"),g.reject(E),[3,3];case 3:return[2]}})})},[4,us(u)];case 1:return[2,l.apply(void 0,[f.sent(),a,h])]}})})}),h.promise}(o,r._key).then(function(u){return new zt(i,s,r._key,u,new Ne(u!==null&&u.hasLocalMutations,!0),r.converter)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=U(r,G);var i=U(r.firestore,$);return zc(rt(i),r._key,{source:"server"}).then(function(o){return ms(i,r,o)})}(this._delegate):function(r){r=U(r,G);var i=U(r.firestore,$);return zc(rt(i),r._key).then(function(o){return ms(i,r,o)})}(this._delegate)).then(function(r){return new rr(n.firestore,new zt(n.firestore._delegate,n._userDataWriter,r._key,r._document,r.metadata,n._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(yi.nu(this.firestore,t)):this._delegate.withConverter(null))},e}();function bt(e,t,n){return e.message=e.message.replace(t,n),e}function Oh(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(typeof r=="object"&&!fn(r))return r}return{}}function Ph(e,t){var n,r,i;return{next:function(o){i.next&&i.next(t(o))},error:(n=(i=fn(e[0])?e[0]:fn(e[1])?e[1]:typeof e[0]=="function"?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)===null||n===void 0?void 0:n.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var rr=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"ref",{get:function(){return new Ce(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,n){return this._delegate.get(t,n)},e.prototype.isEqual=function(t){return vh(this._delegate,t._delegate)},e}(),ir=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.data=function(n){return this._delegate.data(n)},t}(rr),or=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new pi(t)}return e.prototype.where=function(t,n,r){try{return new e(this.firestore,ue(this._delegate,function(i,o,s){var u=o,a=fi("where",i);return new Op(a,u,s)}(t,n,r)))}catch(i){throw bt(i,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,ue(this._delegate,function(r,i){i===void 0&&(i="asc");var o=i,s=fi("orderBy",r);return new Pp(s,o)}(t,n)))}catch(r){throw bt(r,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,ue(this._delegate,function(n){return eh("limit",n),new wh("limit",n,"F")}(t)))}catch(n){throw bt(n,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,ue(this._delegate,function(n){return eh("limitToLast",n),new wh("limitToLast",n,"L")}(t)))}catch(n){throw bt(n,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ue(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new bh("startAt",r,!0)}.apply(void 0,t)))}catch(r){throw bt(r,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ue(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new bh("startAfter",r,!1)}.apply(void 0,t)))}catch(r){throw bt(r,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ue(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Th("endBefore",r,!0)}.apply(void 0,t)))}catch(r){throw bt(r,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ue(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Th("endAt",r,!1)}.apply(void 0,t)))}catch(r){throw bt(r,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return oh(this._delegate,t._delegate)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=U(r,_t);var i=U(r.firestore,$),o=rt(i),s=new Ae(i);return function(u,a){var c=this,h=new yt;return u.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return v(this,function(f){switch(f.label){case 0:return l=function(p,d,g){return m(this,void 0,void 0,function(){var T,E,A,C,O;return v(this,function(F){switch(F.label){case 0:return F.trys.push([0,2,,3]),[4,Zr(p,d,!0)];case 1:return O=F.sent(),T=new Oc(d,O.Bn),E=T._o(O.documents),A=T.applyChanges(E,!1),g.resolve(A.snapshot),[3,3];case 2:return C=F.sent(),O=cn(C,"Failed to execute query '"+d+" against cache"),g.reject(O),[3,3];case 3:return[2]}})})},[4,us(u)];case 1:return[2,l.apply(void 0,[f.sent(),a,h])]}})})}),h.promise}(o,r._query).then(function(u){return new se(i,s,r,u)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=U(r,_t);var i=U(r.firestore,$),o=rt(i),s=new Ae(i);return Hc(o,r._query,{source:"server"}).then(function(u){return new se(i,s,r,u)})}(this._delegate):function(r){r=U(r,_t);var i=U(r.firestore,$),o=rt(i),s=new Ae(i);return mh(r._query),Hc(o,r._query).then(function(u){return new se(i,s,r,u)})}(this._delegate)).then(function(r){return new ws(n.firestore,new se(n.firestore._delegate,n._userDataWriter,n._delegate,r._snapshot))})},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Oh(n),o=Ph(n,function(s){return new ws(t.firestore,new se(t.firestore._delegate,t._userDataWriter,t._delegate,s._snapshot))});return Nh(this._delegate,i,o)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(yi.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(),jp=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new ir(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),ws=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"query",{get:function(){return new or(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(n){return new ir(t._firestore,n)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var n=this;return this._delegate.docChanges(t).map(function(r){return new jp(n._firestore,r)})},e.prototype.forEach=function(t,n){var r=this;this._delegate.forEach(function(i){t.call(n,new ir(r._firestore,i))})},e.prototype.isEqual=function(t){return vh(this._delegate,t._delegate)},e}(),gi=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).firestore=n,i._delegate=r,i}return k(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._delegate.parent;return n?new Ce(this.firestore,n):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(n){try{return new Ce(this.firestore,n===void 0?ai(this._delegate):ai(this._delegate,n))}catch(r){throw bt(r,"doc()","CollectionReference.doc()")}},t.prototype.add=function(n){var r=this;return function(i,o){var s=U(i.firestore,$),u=ai(i),a=di(i.converter,o);return nr(s,[hi(Se(i.firestore),"addDoc",u._key,a,i.converter!==null,{}).toMutation(u._key,ft.exists(!1))]).then(function(){return u})}(this._delegate,n).then(function(i){return new Ce(r.firestore,i)})},t.prototype.isEqual=function(n){return ih(this._delegate,n._delegate)},t.prototype.withConverter=function(n){return new t(this.firestore,n?this._delegate.withConverter(yi.nu(this.firestore,n)):this._delegate.withConverter(null))},t}(or);function ke(e){return U(e,G)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bp=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(qt.bind.apply(qt,z([void 0],t)))}return e.documentId=function(){return new e(Ot.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=H(t))instanceof qt&&this._delegate._internalPath.isEqual(t._internalPath)},e}(),Kp=function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new Np("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new ls("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new Ap("arrayUnion",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new Cp("arrayRemove",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(r){return new kp("increment",r)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zp(e){return function(t,n){var r=rt(t=U(t,$)),i=new Ip;return function(o,s,u,a){var c=this,h=function(l,f){return function(p,d){return new fp(p,d)}(function(p,d){if(p instanceof Uint8Array)return Bc(p,d);if(p instanceof ArrayBuffer)return Bc(new Uint8Array(p),d);if(p instanceof ReadableStream)return p.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(typeof l=="string"?new TextEncoder().encode(l):l),f)}(u,Wn(s));o.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return v(this,function(f){switch(f.label){case 0:return l=hp,[4,as(o)];case 1:return l.apply(void 0,[f.sent(),h,a]),[2]}})})})}(r,t._databaseId,n,i),i}(this._delegate,e)}function Hp(e){var t,n,r=this;return(t=this._delegate,n=e,function(i,o){var s=this;return i.asyncQueue.enqueue(function(){return m(s,void 0,void 0,function(){var u;return v(this,function(a){switch(a.label){case 0:return u=function(c,h){var l=_(c);return l.persistence.runTransaction("Get named query","readonly",function(f){return l.Ke.getNamedQuery(f,h)})},[4,us(i)];case 1:return[2,u.apply(void 0,[a.sent(),o])]}})})})}(rt(t=U(t,$)),n).then(function(i){return i?new _t(t,null,i.query):null})).then(function(i){return i?new or(r,i):null})}var Gp={Firestore:xh,GeoPoint:ci,Timestamp:Tt,Blob:kh,Transaction:Rh,WriteBatch:Lh,DocumentReference:Ce,DocumentSnapshot:rr,Query:or,QueryDocumentSnapshot:ir,QuerySnapshot:ws,CollectionReference:gi,FieldPath:Bp,FieldValue:Kp,setLogLevel:qp,CACHE_SIZE_UNLIMITED:Ep};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qp(e){(function(t,n){t.INTERNAL.registerComponent(new Qh("firestore",function(r){var i=r.getProvider("app").getImmediate();return n(i,r.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Gp)))})(e,function(t,n){return new xh(t,new $(t,n),new Up)}),e.registerVersion("@firebase/firestore","2.4.0")}Qp($h);export{zp as K,Hp as Q,xh as _};
