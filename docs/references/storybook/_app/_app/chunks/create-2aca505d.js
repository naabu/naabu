import{S as x,i as ee,s as se,a3 as te,Y as B,Z as H,e as I,j as R,k as L,c as M,a as S,m as E,n as O,d as T,b as A,f as ae,o as V,F as C,G as Z,H as re,_ as Y,x as $,u as z,v as G,J as oe,K as le,A as ne,a6 as ie}from"./vendor-05d04a9e.js";import{s as ue}from"./stores-e07732fe.js";import{C as fe}from"./checkPlayerHasProfile-2454222b.js";import{F as ce}from"./form-cce74b52.js";import{R as me}from"./resultFeedback-d6392221.js";import{g as de,c as ge}from"./helper-d6a45b8d.js";import{g as pe}from"./navigation-51f4a605.js";import{B as _e}from"./Button-e99ba711.js";const{setTimeout:N}=ie;function be(r){let p=!1,a=()=>{p=!1},m,o,n,g,k,i,u,t,f,c,v,P,_,b,s,d,h,y;te(r[7]);function q(e){r[8](e)}let F={};r[4]!==void 0&&(F.alert=r[4]),n=new me({props:F}),B.push(()=>H(n,"alert",q));function U(e){r[9](e)}let J={};r[2]!==void 0&&(J.hasCurriculumProfile=r[2]),i=new fe({props:J}),B.push(()=>H(i,"hasCurriculumProfile",U));function W(e){r[10](e)}let K={};return r[3]!==void 0&&(K.goal=r[3]),c=new ce({props:K}),B.push(()=>H(c,"goal",W)),s=new _e({props:{content:"Leerdoel publiseren",isDisabled:r[1]||!r[2],isSubmit:!0,color:"primary",dataTest:"create-goal-submit-button"}}),{c(){o=I("div"),R(n.$$.fragment),k=L(),R(i.$$.fragment),t=L(),f=I("form"),R(c.$$.fragment),P=L(),_=I("div"),b=I("div"),R(s.$$.fragment),this.h()},l(e){o=M(e,"DIV",{});var l=S(o);E(n.$$.fragment,l),k=O(l),E(i.$$.fragment,l),t=O(l),f=M(l,"FORM",{class:!0});var w=S(f);E(c.$$.fragment,w),P=O(w),_=M(w,"DIV",{class:!0});var j=S(_);b=M(j,"DIV",{class:!0});var D=S(b);E(s.$$.fragment,D),D.forEach(T),j.forEach(T),w.forEach(T),l.forEach(T),this.h()},h(){A(b,"class","flex justify-end"),A(_,"class","pt-5"),A(f,"class","mt-8 space-y-8 divide-y divide-gray-200")},m(e,l){ae(e,o,l),V(n,o,null),C(o,k),V(i,o,null),C(o,t),C(o,f),V(c,f,null),C(f,P),C(f,_),C(_,b),V(s,b,null),d=!0,h||(y=[Z(window,"scroll",()=>{p=!0,clearTimeout(m),m=N(a,100),r[7]()}),Z(f,"submit",re(r[5]))],h=!0)},p(e,[l]){l&1&&!p&&(p=!0,clearTimeout(m),scrollTo(window.pageXOffset,e[0]),m=N(a,100));const w={};!g&&l&16&&(g=!0,w.alert=e[4],Y(()=>g=!1)),n.$set(w);const j={};!u&&l&4&&(u=!0,j.hasCurriculumProfile=e[2],Y(()=>u=!1)),i.$set(j);const D={};!v&&l&8&&(v=!0,D.goal=e[3],Y(()=>v=!1)),c.$set(D);const X={};l&6&&(X.isDisabled=e[1]||!e[2]),s.$set(X)},i(e){d||($(n.$$.fragment,e),$(i.$$.fragment,e),$(c.$$.fragment,e),$(s.$$.fragment,e),d=!0)},o(e){z(n.$$.fragment,e),z(i.$$.fragment,e),z(c.$$.fragment,e),z(s.$$.fragment,e),d=!1},d(e){e&&T(o),G(n),G(i),G(c),G(s),h=!1,oe(y)}}}function Q(){return{success:!1,successMessage:"",error:!1,errorCode:"",errorMessage:""}}function he(r,p,a){let m;le(r,ue,s=>a(13,m=s));let{firebase:o}=p,n,g,k=!1,i;ne(async()=>{g=await o.firestore()});let u={title:"",description:"",goalLinks:[],taxonomy_bloom:[],taxonomy_solo:[],unitopic:"",multitopics:[],context:"",selectedVerbs:[],fromText:"",battles:[]},t=Q();async function f(){if(m.user){let s=de(u,m.serverFirestoreTimeStamp);a(4,t=Q());try{let d=await g.collection("talk").add({type:"goal"});s.talkId=d.id;let h=await g.collection("goals").add(s);for(let y=0;y<u.battles.length;y++){let q=g.doc("/goals/"+h.id+"/battles/"+u.battles[y].name),F={quizzes:u.battles[y].quizzes};await q.set(F)}s.authorId=m.player.curriculumProfileId,s.goalId=h.id,await ge(g,u,s,m.user.uid,o),a(4,t.success=!0,t),a(4,t.successTitle="Leerdoel gemaakt",t),a(4,t.successMessage="id: "+h.id,t),await pe("/leerdoel/"+h.id)}catch(d){console.error("Error adding document: ",d),a(4,t.error=!0,t),a(4,t.errorCode=d.code,t),a(4,t.errorMessage=d.message,t)}a(0,n=0)}}async function c(s){a(1,k=!0),await f(),setTimeout(()=>{a(1,k=!1)},5e3)}function v(){a(0,n=window.pageYOffset)}function P(s){t=s,a(4,t)}function _(s){i=s,a(2,i)}function b(s){u=s,a(3,u)}return r.$$set=s=>{"firebase"in s&&a(6,o=s.firebase)},[n,k,i,u,t,c,o,v,P,_,b]}class Te extends x{constructor(p){super();ee(this,p,he,be,se,{firebase:6})}}export{Te as C};
