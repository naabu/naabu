import{S as le,i as re,s as oe,a3 as ie,j as z,k as H,e as O,m as M,n as L,c as Y,a as A,d as B,b as K,o as V,f as Q,F as E,G as x,H as ne,_ as N,x as v,u as D,v as q,l as ee,r as fe,w as ue,K as ce,Y as X,Z}from"./vendor-05d04a9e.js";import{s as me}from"./stores-e07732fe.js";import{C as ge}from"./checkPlayerHasProfile-2454222b.js";import{F as de}from"./form-cce74b52.js";import{G as be}from"./goal-80d3ba40.js";import{R as _e}from"./resultFeedback-d6392221.js";import{g as pe,c as he}from"./helper-d6a45b8d.js";import{B as we}from"./Button-e99ba711.js";function te(o){let i,s,m,n,u,g,p,t,f,r,l,d,F,S,w,k,h,T,a,P;function b(e){o[10](e)}let _={subSelected:"edit"};o[0]!==void 0&&(_.goal=o[0]),i=new be({props:_}),X.push(()=>Z(i,"goal",b));function C(e){o[11](e)}let y={};o[3]!==void 0&&(y.alert=o[3]),u=new _e({props:y}),X.push(()=>Z(u,"alert",C));function R(e){o[12](e)}let J={};o[1]!==void 0&&(J.hasCurriculumProfile=o[1]),t=new ge({props:J}),X.push(()=>Z(t,"hasCurriculumProfile",R));function se(e){o[13](e)}let U={};return o[0]!==void 0&&(U.goal=o[0]),d=new de({props:U}),X.push(()=>Z(d,"goal",se)),h=new we({props:{isDisabled:!o[1],dataTest:"edit-goal-submit-button",isSubmit:!0,color:"primary",content:"Leerdoel publiseren"}}),{c(){z(i.$$.fragment),m=H(),n=O("div"),z(u.$$.fragment),p=H(),z(t.$$.fragment),r=H(),l=O("form"),z(d.$$.fragment),S=H(),w=O("div"),k=O("div"),z(h.$$.fragment),this.h()},l(e){M(i.$$.fragment,e),m=L(e),n=Y(e,"DIV",{class:!0});var c=A(n);M(u.$$.fragment,c),p=L(c),M(t.$$.fragment,c),r=L(c),l=Y(c,"FORM",{class:!0});var j=A(l);M(d.$$.fragment,j),S=L(j),w=Y(j,"DIV",{class:!0});var G=A(w);k=Y(G,"DIV",{class:!0});var I=A(k);M(h.$$.fragment,I),I.forEach(B),G.forEach(B),j.forEach(B),c.forEach(B),this.h()},h(){K(k,"class","flex justify-end"),K(w,"class","pt-5"),K(l,"class","space-y-8 divide-y divide-gray-200"),K(n,"class","mt-8")},m(e,c){V(i,e,c),Q(e,m,c),Q(e,n,c),V(u,n,null),E(n,p),V(t,n,null),E(n,r),E(n,l),V(d,l,null),E(l,S),E(l,w),E(w,k),V(h,k,null),T=!0,a||(P=x(l,"submit",ne(o[4])),a=!0)},p(e,c){const j={};!s&&c&1&&(s=!0,j.goal=e[0],N(()=>s=!1)),i.$set(j);const G={};!g&&c&8&&(g=!0,G.alert=e[3],N(()=>g=!1)),u.$set(G);const I={};!f&&c&2&&(f=!0,I.hasCurriculumProfile=e[1],N(()=>f=!1)),t.$set(I);const W={};!F&&c&1&&(F=!0,W.goal=e[0],N(()=>F=!1)),d.$set(W);const $={};c&2&&($.isDisabled=!e[1]),h.$set($)},i(e){T||(v(i.$$.fragment,e),v(u.$$.fragment,e),v(t.$$.fragment,e),v(d.$$.fragment,e),v(h.$$.fragment,e),T=!0)},o(e){D(i.$$.fragment,e),D(u.$$.fragment,e),D(t.$$.fragment,e),D(d.$$.fragment,e),D(h.$$.fragment,e),T=!1},d(e){q(i,e),e&&B(m),e&&B(n),q(u),q(t),q(d),q(h),a=!1,P()}}}function ke(o){let i=!1,s=()=>{i=!1},m,n,u,g,p;ie(o[9]);let t=o[0]&&te(o);return{c(){t&&t.c(),n=ee()},l(f){t&&t.l(f),n=ee()},m(f,r){t&&t.m(f,r),Q(f,n,r),u=!0,g||(p=x(window,"scroll",()=>{i=!0,clearTimeout(m),m=setTimeout(s,100),o[9]()}),g=!0)},p(f,[r]){r&4&&!i&&(i=!0,clearTimeout(m),scrollTo(window.pageXOffset,f[2]),m=setTimeout(s,100)),f[0]?t?(t.p(f,r),r&1&&v(t,1)):(t=te(f),t.c(),v(t,1),t.m(n.parentNode,n)):t&&(fe(),D(t,1,1,()=>{t=null}),ue())},i(f){u||(v(t),u=!0)},o(f){D(t),u=!1},d(f){t&&t.d(f),f&&B(n),g=!1,p()}}}function ae(){return{success:!1,successMessage:"",error:!1,errorCode:"",errorMessage:""}}function Ce(o,i,s){let m;ce(o,me,a=>s(14,m=a));let{battleCol:n}=i,{firebase:u}=i,{previousBattles:g=[]}=i,p,t,{goalRef:f}=i,{goal:r}=i,l=ae();async function d(){const a=await u.firestore();let P=pe(r,m.serverFirestoreTimeStamp);s(3,l=ae());try{let b=a.collection("goals").doc(r.id);await b.update(P);for(let _=0;_<r.battles.length;_++){let C=a.doc("/goals/"+b.id+"/battles/"+r.battles[_].name),y={quizzes:r.battles[_].quizzes};(await C.get()).exists?await C.update(y):await C.set(y)}for(let _=0;_<g.length;_++){let C=g[_],y=!0;for(let R=0;R<r.battles.length;R++)r.battles[R].name===C.name&&(y=!1);y&&await a.doc("/goals/"+b.id+"/battles/"+C.name).delete()}P.authorId=m.player.curriculumProfileId,P.goalId=b.id,await he(a,r,P,m.user.uid,u),s(3,l.success=!0,l),s(3,l.successTitle="Leerdoel gewijzigd",l),s(3,l.successMessage="id: "+b.id,l)}catch(b){console.error("Error adding document: ",b),s(3,l.error=!0,l),s(3,l.errorCode=b.code,l),s(3,l.errorMessage=b.message,l)}s(2,t=0)}async function F(a){await d()}function S(){s(2,t=window.pageYOffset)}function w(a){r=a,s(0,r)}function k(a){l=a,s(3,l)}function h(a){p=a,s(1,p)}function T(a){r=a,s(0,r)}return o.$$set=a=>{"battleCol"in a&&s(5,n=a.battleCol),"firebase"in a&&s(6,u=a.firebase),"previousBattles"in a&&s(7,g=a.previousBattles),"goalRef"in a&&s(8,f=a.goalRef),"goal"in a&&s(0,r=a.goal)},[r,p,t,l,F,n,u,g,f,S,w,k,h,T]}class Ee extends le{constructor(i){super();re(this,i,Ce,ke,oe,{battleCol:5,firebase:6,previousBattles:7,goalRef:8,goal:0})}}export{Ee as E};
