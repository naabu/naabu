import{S as K,i as M,s as q,j as w,m as $,o as I,_ as j,x as m,u as v,v as R,k as O,l as C,n as J,f as k,r as P,w as z,d as h,K as ee,A as te,Y as A,Z as D,t as U,g as V,O as T,e as ie,c as ne,a as oe,b as se,F as ae}from"../../../../chunks/vendor-05d04a9e.js";import{S as re}from"../../../../chunks/show-44582c58.js";import{s as ce}from"../../../../chunks/stores-e07732fe.js";import{g as L}from"../../../../chunks/navigation-51f4a605.js";import{g as le}from"../../../../chunks/helper-62c526cc.js";import{a as fe,g as ue}from"../../../../chunks/helper-cf411eac.js";import{a as Y,g as Z}from"../../../../chunks/helper-249596aa.js";import{B as E}from"../../../../chunks/Button-e99ba711.js";import{G as de}from"../../../../chunks/getActivityData-bc74ca08.js";import"../../../../chunks/show-2c607e3f.js";import"../../../../chunks/helper-a37f5850.js";import"../../../../chunks/helper-5c7a4c9b.js";import"../../../../chunks/singletons-12a22614.js";/* empty css                                                              */import"../../../../chunks/store-fa4e989c.js";function H(r){let e,i,t,a;function c(n){r[8](n)}function o(n){r[9](n)}let p={showFeedback:!1};return r[0]!==void 0&&(p.firebase=r[0]),r[1]!==void 0&&(p.activity=r[1]),e=new re({props:p}),A.push(()=>D(e,"firebase",c)),A.push(()=>D(e,"activity",o)),{c(){w(e.$$.fragment)},l(n){$(e.$$.fragment,n)},m(n,u){I(e,n,u),a=!0},p(n,u){const s={};!i&&u&1&&(i=!0,s.firebase=n[0],j(()=>i=!1)),!t&&u&2&&(t=!0,s.activity=n[1],j(()=>t=!1)),e.$set(s)},i(n){a||(m(e.$$.fragment,n),a=!0)},o(n){v(e.$$.fragment,n),a=!1},d(n){R(e,n)}}}function pe(r){let e;return{c(){e=U("Je moet ingelogd zijn om deze activiteit te kunnen koppelen.")},l(i){e=V(i,"Je moet ingelogd zijn om deze activiteit te kunnen koppelen.")},m(i,t){k(i,e,t)},p:T,i:T,o:T,d(i){i&&h(e)}}}function _e(r){let e,i,t,a,c,o;i=new E({props:{dataTest:"back-to-form-button",content:"Terug"}}),i.$on("click",r[5]);const p=[ve,me],n=[];function u(s,d){return s[2].connectionId?0:1}return a=u(r),c=n[a]=p[a](r),{c(){e=ie("div"),w(i.$$.fragment),t=O(),c.c(),this.h()},l(s){e=ne(s,"DIV",{class:!0});var d=oe(e);$(i.$$.fragment,d),t=J(d),c.l(d),d.forEach(h),this.h()},h(){se(e,"class","flex justify-between mt-8 mb-32")},m(s,d){k(s,e,d),I(i,e,null),ae(e,t),n[a].m(e,null),o=!0},p(s,d){let b=a;a=u(s),a===b?n[a].p(s,d):(P(),v(n[b],1,1,()=>{n[b]=null}),z(),c=n[a],c?c.p(s,d):(c=n[a]=p[a](s),c.c()),m(c,1),c.m(e,null))},i(s){o||(m(i.$$.fragment,s),m(c),o=!0)},o(s){v(i.$$.fragment,s),v(c),o=!1},d(s){s&&h(e),R(i),n[a].d()}}}function me(r){let e,i;return e=new E({props:{color:"primary",isDisabled:r[4],dataTest:"connect-activity-learning-goal-button",content:"Deze activiteit koppelen met leerdoel"}}),e.$on("click",r[7]),{c(){w(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,a){I(e,t,a),i=!0},p(t,a){const c={};a&16&&(c.isDisabled=t[4]),e.$set(c)},i(t){i||(m(e.$$.fragment,t),i=!0)},o(t){v(e.$$.fragment,t),i=!1},d(t){R(e,t)}}}function ve(r){let e,i;return e=new E({props:{color:"primary",isDisabled:r[4],dataTest:"update-activity-learning-goal-button",content:"Koppeling met leerdoel updaten"}}),e.$on("click",r[6]),{c(){w(e.$$.fragment)},l(t){$(e.$$.fragment,t)},m(t,a){I(e,t,a),i=!0},p(t,a){const c={};a&16&&(c.isDisabled=t[4]),e.$set(c)},i(t){i||(m(e.$$.fragment,t),i=!0)},o(t){v(e.$$.fragment,t),i=!1},d(t){R(e,t)}}}function be(r){let e,i,t,a,c,o=r[1]&&H(r);const p=[_e,pe],n=[];function u(s,d){return s[3].user?0:1}return i=u(r),t=n[i]=p[i](r),{c(){o&&o.c(),e=O(),t.c(),a=C()},l(s){o&&o.l(s),e=J(s),t.l(s),a=C()},m(s,d){o&&o.m(s,d),k(s,e,d),n[i].m(s,d),k(s,a,d),c=!0},p(s,[d]){s[1]?o?(o.p(s,d),d&2&&m(o,1)):(o=H(s),o.c(),m(o,1),o.m(e.parentNode,e)):o&&(P(),v(o,1,1,()=>{o=null}),z());let b=i;i=u(s),i===b?n[i].p(s,d):(P(),v(n[b],1,1,()=>{n[b]=null}),z(),t=n[i],t?t.p(s,d):(t=n[i]=p[i](s),t.c()),m(t,1),t.m(a.parentNode,a))},i(s){c||(m(o),m(t),c=!0)},o(s){v(o),v(t),c=!1},d(s){o&&o.d(s),s&&h(e),n[i].d(s),s&&h(a)}}}function ge(r,e,i){let t;ee(r,ce,f=>i(3,t=f));let{firebase:a}=e,{showActivity:c}=e,{activity:o}=e,p=!1,n,u;te(async()=>{n=await a.firestore()});function s(){L("/lerarenkamer/activiteit/"+o.id)}async function d(){if(i(4,p=!0),t.user.uid){let f=n.collection("connections");try{let _=f.doc(o.connectionId),y=await _.get();if(y.exists){let N=y.data().lastRevisionId;u.lastRevisionId=o.latestRevisionId,await _.update(u);let B=await n.collection("revisions").doc(N).get();if(B.exists){let W=B.data(),X=Y(),G=Z(W,o,X);if(G.length>0){let x={type:"activity-updated-teacher",differences:G,authorId:t.user.uid,createdAt:a.firestore.Timestamp.now().seconds,connectionId:o.connectionId};await b(x)}L("/leerdoel/"+o.goalId+"/activiteiten/"+o.connectionId)}}}catch(_){console.log(_)}}}async function b(f){t.player.curriculumProfileId&&(f.curriculumProfile=await le(n,t.player.curriculumProfileId)),await n.collection("updates").add(f)}async function g(){if(i(4,p=!0),t.user.uid){let f=n.collection("connections");try{u.createdAt=a.firestore.Timestamp.now().seconds,u.status="in-progress",u.lastRevisionId=o.latestRevisionId;let _=await f.add(u),y={status:"open",connectionId:_.id,connectionStatus:"in-progress"};n.collection("activities").doc(o.id).update(y);let N=Y(),F=Z({},o,N),B={type:"created-teacher",differences:F,authorId:t.user.uid,createdAt:a.firestore.Timestamp.now().seconds,connectionId:_.id};await b(B),L("/leerdoel/"+o.goalId+"/activiteiten/"+_.id)}catch(_){console.error(_)}}}function S(f){a=f,i(0,a)}function l(f){c=f,i(1,c)}return r.$$set=f=>{"firebase"in f&&i(0,a=f.firebase),"showActivity"in f&&i(1,c=f.showActivity),"activity"in f&&i(2,o=f.activity)},r.$$.update=()=>{r.$$.dirty&13&&o&&(u={type:"goal-activity",sourceId:o.goalId,linkId:o.id,updatedAt:a.firestore.Timestamp.now().seconds,inProgressAt:a.firestore.Timestamp.now().seconds,authorId:t.user.uid,title:o.title,fields:[{title:"Beschrijving",value:o.description},{title:"Moeilijkheid",value:fe(o.difficulty)},{title:"Type",value:ue(o.type)}]})},[a,c,o,t,p,s,d,g,S,l]}class ye extends K{constructor(e){super();M(this,e,ge,be,q,{firebase:0,showActivity:1,activity:2})}}function he(r){let e;return{c(){e=U("Loading...")},l(i){e=V(i,"Loading...")},m(i,t){k(i,e,t)},p:T,i:T,o:T,d(i){i&&h(e)}}}function ke(r){let e,i,t,a;function c(n){r[5](n)}function o(n){r[6](n)}let p={showActivity:r[2]};return r[1]!==void 0&&(p.firebase=r[1]),r[0]!==void 0&&(p.activity=r[0]),e=new ye({props:p}),A.push(()=>D(e,"firebase",c)),A.push(()=>D(e,"activity",o)),{c(){w(e.$$.fragment)},l(n){$(e.$$.fragment,n)},m(n,u){I(e,n,u),a=!0},p(n,u){const s={};u&4&&(s.showActivity=n[2]),!i&&u&2&&(i=!0,s.firebase=n[1],j(()=>i=!1)),!t&&u&1&&(t=!0,s.activity=n[0],j(()=>t=!1)),e.$set(s)},i(n){a||(m(e.$$.fragment,n),a=!0)},o(n){v(e.$$.fragment,n),a=!1},d(n){R(e,n)}}}function we(r){let e,i,t,a,c,o,p,n;function u(l){r[3](l)}function s(l){r[4](l)}let d={};r[1]!==void 0&&(d.firebase=r[1]),r[0]!==void 0&&(d.activity=r[0]),e=new de({props:d}),A.push(()=>D(e,"firebase",u)),A.push(()=>D(e,"activity",s));const b=[ke,he],g=[];function S(l,f){return l[0]?0:1}return c=S(r),o=g[c]=b[c](r),{c(){w(e.$$.fragment),a=O(),o.c(),p=C()},l(l){$(e.$$.fragment,l),a=J(l),o.l(l),p=C()},m(l,f){I(e,l,f),k(l,a,f),g[c].m(l,f),k(l,p,f),n=!0},p(l,[f]){const _={};!i&&f&2&&(i=!0,_.firebase=l[1],j(()=>i=!1)),!t&&f&1&&(t=!0,_.activity=l[0],j(()=>t=!1)),e.$set(_);let y=c;c=S(l),c===y?g[c].p(l,f):(P(),v(g[y],1,1,()=>{g[y]=null}),z(),o=g[c],o?o.p(l,f):(o=g[c]=b[c](l),o.c()),m(o,1),o.m(p.parentNode,p))},i(l){n||(m(e.$$.fragment,l),m(o),n=!0)},o(l){v(e.$$.fragment,l),v(o),n=!1},d(l){R(e,l),l&&h(a),g[c].d(l),l&&h(p)}}}function $e(r,e,i){let t,a,c;function o(s){t=s,i(1,t)}function p(s){a=s,i(0,a)}function n(s){t=s,i(1,t)}function u(s){a=s,i(0,a)}return r.$$.update=()=>{r.$$.dirty&1&&a&&i(2,c=JSON.parse(JSON.stringify(a)))},[a,t,c,o,p,n,u]}class Ee extends K{constructor(e){super();M(this,e,$e,we,q,{})}}export{Ee as default};
