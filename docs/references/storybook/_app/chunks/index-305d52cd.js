import{_ as R,a as qh,b as z,c as m,d as v,f as Bh}from"./index.esm-dda1bb38.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _s=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)==55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)==56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},jh=function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){var o=e[n++],s=e[n++],u=e[n++],a=((i&7)<<18|(o&63)<<12|(s&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(a&1023))}else{var o=e[n++],s=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|s&63)}}return t.join("")},Kh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,u=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,h=o>>2,l=(o&3)<<4|u>>4,f=(u&15)<<2|c>>6,d=c&63;a||(d=64,s||(f=64)),r.push(n[h],n[l],n[f],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(_s(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):jh(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length,u=s?n[e.charAt(i)]:0;++i;var a=i<e.length,c=a?n[e.charAt(i)]:64;++i;var h=i<e.length,l=h?n[e.charAt(i)]:64;if(++i,o==null||u==null||c==null||l==null)throw Error();var f=o<<2|u>>4;if(r.push(f),c!==64){var d=u<<4&240|c>>2;if(r.push(d),l!==64){var p=c<<6&192|l;r.push(p)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Gh=function(e){var t=_s(e);return Kh.encodeByteArray(t,!0)},Ss=function(e){return Gh(e).replace(/\./g,"")};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qh(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=qh({iss:"https://securetoken.google.com/"+r,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},e),u="";return[Ss(JSON.stringify(n)),Ss(JSON.stringify(s)),u].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $h(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(le())}function Hh(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function zh(){var e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Wh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Yh(){return le().indexOf("Electron/")>=0}function Xh(){var e=le();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Jh(){return le().indexOf("MSAppHost/")>=0}function Zh(){return!Hh()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tl="FirebaseError",el=function(e){R(t,e);function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name=tl,Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,nl.prototype.create),o}return t}(Error),nl=function(){function e(t,n,r){this.service=t,this.serviceName=n,this.errors=r}return e.prototype.create=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=n[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?rl(s,i):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new el(o,a,i);return c},e}();function rl(e,t){return e.replace(il,function(n,r){var i=t[r];return i!=null?String(i):"<"+r+"?>"})}var il=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W(e){return e&&e._delegate?e._delegate:e}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Lt(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fe,q;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(q||(q={}));var ol={debug:q.DEBUG,verbose:q.VERBOSE,info:q.INFO,warn:q.WARN,error:q.ERROR,silent:q.SILENT},sl=q.INFO,ul=(fe={},fe[q.DEBUG]="log",fe[q.VERBOSE]="log",fe[q.INFO]="info",fe[q.WARN]="warn",fe[q.ERROR]="error",fe),al=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=new Date().toISOString(),o=ul[t];if(o)console[o].apply(console,Lt(["["+i+"]  "+e.name+":"],n));else throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}},cl=function(){function e(t){this.name=t,this._logLevel=sl,this._logHandler=al,this._userLogHandler=null}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in q))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(t){this._logLevel=typeof t=="string"?ol[t]:t},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,q.DEBUG],t)),this._logHandler.apply(this,Lt([this,q.DEBUG],t))},e.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,q.VERBOSE],t)),this._logHandler.apply(this,Lt([this,q.VERBOSE],t))},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,q.INFO],t)),this._logHandler.apply(this,Lt([this,q.INFO],t))},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,q.WARN],t)),this._logHandler.apply(this,Lt([this,q.WARN],t))},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,q.ERROR],t)),this._logHandler.apply(this,Lt([this,q.ERROR],t))},e}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ei=function(e,t){return Ei=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Ei(e,t)};function hl(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Ei(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function As(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var ll=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},S,Ti=Ti||{},x=ll||self;function cr(){}function Ii(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function vn(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function fl(e){return Object.prototype.hasOwnProperty.call(e,_i)&&e[_i]||(e[_i]=++dl)}var _i="closure_uid_"+(1e9*Math.random()>>>0),dl=0;function pl(e,t,n){return e.call.apply(e.bind,arguments)}function gl(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function st(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?st=pl:st=gl,st.apply(null,arguments)}function hr(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function ut(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(r,i,o){for(var s=Array(arguments.length-2),u=2;u<arguments.length;u++)s[u-2]=arguments[u];return t.prototype[i].apply(r,s)}}function Yt(){this.s=this.s,this.o=this.o}var yl=0,vl={};Yt.prototype.s=!1;Yt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),yl!=0)){var e=fl(this);delete vl[e]}};Yt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Ns=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Ds=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=typeof e=="string"?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function ml(e){t:{for(var t=hf,n=e.length,r=typeof e=="string"?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break t}t=-1}return 0>t?null:typeof e=="string"?e.charAt(t):e[t]}function Cs(e){return Array.prototype.concat.apply([],arguments)}function Si(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function lr(e){return/^[\s\xa0]*$/.test(e)}var Rs=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function vt(e,t){return e.indexOf(t)!=-1}function Ai(e,t){return e<t?-1:e>t?1:0}var mt;t:{var ks=x.navigator;if(ks){var xs=ks.userAgent;if(xs){mt=xs;break t}}mt=""}function Ni(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function Os(e){var t={};for(var n in e)t[n]=e[n];return t}var Ls="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ps(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var o=0;o<Ls.length;o++)n=Ls[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Di(e){return Di[" "](e),e}Di[" "]=cr;function wl(e){var t=Tl;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}var bl=vt(mt,"Opera"),Pe=vt(mt,"Trident")||vt(mt,"MSIE"),Ms=vt(mt,"Edge"),Ci=Ms||Pe,Fs=vt(mt,"Gecko")&&!(vt(mt.toLowerCase(),"webkit")&&!vt(mt,"Edge"))&&!(vt(mt,"Trident")||vt(mt,"MSIE"))&&!vt(mt,"Edge"),El=vt(mt.toLowerCase(),"webkit")&&!vt(mt,"Edge");function Vs(){var e=x.document;return e?e.documentMode:void 0}var fr;t:{var Ri="",ki=function(){var e=mt;if(Fs)return/rv:([^\);]+)(\)|;)/.exec(e);if(Ms)return/Edge\/([\d\.]+)/.exec(e);if(Pe)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(El)return/WebKit\/(\S+)/.exec(e);if(bl)return/(?:Version)[ \/]?(\S+)/.exec(e)}();if(ki&&(Ri=ki?ki[1]:""),Pe){var xi=Vs();if(xi!=null&&xi>parseFloat(Ri)){fr=String(xi);break t}}fr=Ri}var Tl={};function Il(){return wl(function(){for(var e=0,t=Rs(String(fr)).split("."),n=Rs("9").split("."),r=Math.max(t.length,n.length),i=0;e==0&&i<r;i++){var o=t[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o[0].length==0&&s[0].length==0)break;e=Ai(o[1].length==0?0:parseInt(o[1],10),s[1].length==0?0:parseInt(s[1],10))||Ai(o[2].length==0,s[2].length==0)||Ai(o[2],s[2]),o=o[3],s=s[3]}while(e==0)}return 0<=e})}var Oi;if(x.document&&Pe){var Us=Vs();Oi=Us||parseInt(fr,10)||void 0}else Oi=void 0;var _l=Oi,Sl=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{x.addEventListener("test",cr,t),x.removeEventListener("test",cr,t)}catch{}return e}();function ft(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}ft.prototype.h=function(){this.defaultPrevented=!0};function mn(e,t){if(ft.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Fs){t:{try{Di(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:Al[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&mn.Z.h.call(this)}}ut(mn,ft);var Al={2:"touch",3:"pen",4:"mouse"};mn.prototype.h=function(){mn.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var wn="closure_listenable_"+(1e6*Math.random()|0),Nl=0;function Dl(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Nl,this.ca=this.fa=!1}function dr(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function pr(e){this.src=e,this.g={},this.h=0}pr.prototype.add=function(e,t,n,r,i){var o=e.toString();e=this.g[o],e||(e=this.g[o]=[],this.h++);var s=Pi(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):(t=new Dl(t,this.src,o,!!r,i),t.fa=n,e.push(t)),t};function Li(e,t){var n=t.type;if(n in e.g){var r=e.g[n],i=Ns(r,t),o;(o=0<=i)&&Array.prototype.splice.call(r,i,1),o&&(dr(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function Pi(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.ca&&o.listener==t&&o.capture==!!n&&o.ia==r)return i}return-1}var Mi="closure_lm_"+(1e6*Math.random()|0),Fi={};function qs(e,t,n,r,i){if(r&&r.once)return js(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)qs(e,t[o],n,r,i);return null}return n=Bi(n),e&&e[wn]?e.N(t,n,vn(r)?!!r.capture:!!r,i):Bs(e,t,n,!1,r,i)}function Bs(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var s=vn(i)?!!i.capture:!!i,u=Ui(e);if(u||(e[Mi]=u=new pr(e)),n=u.add(t,n,r,s,o),n.proxy)return n;if(r=Cl(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Sl||(i=s),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Gs(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Cl(){function e(n){return t.call(e.src,e.listener,n)}var t=Rl;return e}function js(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)js(e,t[o],n,r,i);return null}return n=Bi(n),e&&e[wn]?e.O(t,n,vn(r)?!!r.capture:!!r,i):Bs(e,t,n,!0,r,i)}function Ks(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)Ks(e,t[o],n,r,i);else r=vn(r)?!!r.capture:!!r,n=Bi(n),e&&e[wn]?(e=e.i,t=String(t).toString(),t in e.g&&(o=e.g[t],n=Pi(o,n,r,i),-1<n&&(dr(o[n]),Array.prototype.splice.call(o,n,1),o.length==0&&(delete e.g[t],e.h--)))):e&&(e=Ui(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Pi(t,n,r,i)),(n=-1<e?t[e]:null)&&Vi(n))}function Vi(e){if(typeof e!="number"&&e&&!e.ca){var t=e.src;if(t&&t[wn])Li(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Gs(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ui(t))?(Li(n,e),n.h==0&&(n.src=null,t[Mi]=null)):dr(e)}}}function Gs(e){return e in Fi?Fi[e]:Fi[e]="on"+e}function Rl(e,t){if(e.ca)e=!0;else{t=new mn(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Vi(e),e=n.call(r,t)}return e}function Ui(e){return e=e[Mi],e instanceof pr?e:null}var qi="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bi(e){return typeof e=="function"?e:(e[qi]||(e[qi]=function(t){return e.handleEvent(t)}),e[qi])}function et(){Yt.call(this),this.i=new pr(this),this.P=this,this.I=null}ut(et,Yt);et.prototype[wn]=!0;et.prototype.removeEventListener=function(e,t,n,r){Ks(this,e,t,n,r)};function at(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,typeof t=="string")t=new ft(t,e);else if(t instanceof ft)t.target=t.target||e;else{var i=t;t=new ft(r,e),Ps(t,i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.g=n[o];i=gr(s,r,!0,t)&&i}if(s=t.g=e,i=gr(s,r,!0,t)&&i,i=gr(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)s=t.g=n[o],i=gr(s,r,!1,t)&&i}et.prototype.M=function(){if(et.Z.M.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)dr(n[r]);delete e.g[t],e.h--}}this.I=null};et.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};et.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function gr(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.ca&&s.capture==n){var u=s.listener,a=s.ia||s.src;s.fa&&Li(e.i,s),i=u.call(a,r)!==!1&&i}}return i&&!r.defaultPrevented}var ji=x.JSON.stringify;function kl(){var e=$s,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var xl=function(){function e(){this.h=this.g=null}return e.prototype.add=function(t,n){var r=Qs.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r},e}(),Qs=new(function(){function e(t,n){this.i=t,this.j=n,this.h=0,this.g=null}return e.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},e}())(function(){return new Ol},function(e){return e.reset()}),Ol=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(t,n){this.h=t,this.g=n,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function Ll(e){x.setTimeout(function(){throw e},0)}function Ki(e,t){Gi||Pl(),Qi||(Gi(),Qi=!0),$s.add(e,t)}var Gi;function Pl(){var e=x.Promise.resolve(void 0);Gi=function(){e.then(Ml)}}var Qi=!1,$s=new xl;function Ml(){for(var e;e=kl();){try{e.h.call(e.g)}catch(n){Ll(n)}var t=Qs;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Qi=!1}function yr(e,t){et.call(this),this.h=e||1,this.g=t||x,this.j=st(this.kb,this),this.l=Date.now()}ut(yr,et);S=yr.prototype;S.da=!1;S.S=null;S.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),at(this,"tick"),this.da&&($i(this),this.start()))}};S.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function $i(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}S.M=function(){yr.Z.M.call(this),$i(this),delete this.g};function Hi(e,t,n){if(typeof e=="function")n&&(e=st(e,n));else if(e&&typeof e.handleEvent=="function")e=st(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:x.setTimeout(e,t||0)}function Hs(e){e.g=Hi(function(){e.g=null,e.i&&(e.i=!1,Hs(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}var Fl=function(e){hl(t,e);function t(n,r){var i=e.call(this)||this;return i.m=n,i.j=r,i.h=null,i.i=!1,i.g=null,i}return t.prototype.l=function(n){this.h=arguments,this.g?this.i=!0:Hs(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(Yt);function bn(e){Yt.call(this),this.h=e,this.g={}}ut(bn,Yt);var zs=[];function Ws(e,t,n,r){Array.isArray(n)||(n&&(zs[0]=n.toString()),n=zs);for(var i=0;i<n.length;i++){var o=qs(t,n[i],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}}function Ys(e){Ni(e.g,function(t,n){this.g.hasOwnProperty(n)&&Vi(t)},e),e.g={}}bn.prototype.M=function(){bn.Z.M.call(this),Ys(this)};bn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function vr(){this.g=!0}vr.prototype.Aa=function(){this.g=!1};function Vl(e,t,n,r,i,o){e.info(function(){if(e.g)if(o)for(var s="",u=o.split("&"),a=0;a<u.length;a++){var c=u[a].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&l[1]=="type"?s+(h+"="+c+"&"):s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+n+`
`+s})}function Ul(e,t,n,r,i,o,s){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+n+`
`+o+" "+s})}function Me(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+Bl(e,n)+(r?" "+r:"")})}function ql(e,t){e.info(function(){return"TIMEOUT: "+t})}vr.prototype.info=function(){};function Bl(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if(o!="noop"&&o!="stop"&&o!="close")for(var s=1;s<i.length;s++)i[s]=""}}}}return ji(n)}catch{return t}}var de={},Xs=null;function mr(){return Xs=Xs||new et}de.Ma="serverreachability";function Js(e){ft.call(this,de.Ma,e)}ut(Js,ft);function En(e){var t=mr();at(t,new Js(t,e))}de.STAT_EVENT="statevent";function Zs(e,t){ft.call(this,de.STAT_EVENT,e),this.stat=t}ut(Zs,ft);function wt(e){var t=mr();at(t,new Zs(t,e))}de.Na="timingevent";function tu(e,t){ft.call(this,de.Na,e),this.size=t}ut(tu,ft);function Tn(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){e()},t)}var wr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},eu={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function zi(){}zi.prototype.h=null;function nu(e){return e.h||(e.h=e.i())}function ru(){}var In={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Wi(){ft.call(this,"d")}ut(Wi,ft);function Yi(){ft.call(this,"c")}ut(Yi,ft);var Xi;function br(){}ut(br,zi);br.prototype.g=function(){return new XMLHttpRequest};br.prototype.i=function(){return{}};Xi=new br;function _n(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new bn(this),this.P=jl,e=Ci?125:void 0,this.W=new yr(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new iu}function iu(){this.i=null,this.g="",this.h=!1}var jl=45e3,Ji={},Er={};S=_n.prototype;S.setTimeout=function(e){this.P=e};function Zi(e,t,n){e.K=1,e.v=Ar(Kt(t)),e.s=n,e.U=!0,ou(e,null)}function ou(e,t){e.F=Date.now(),Sn(e),e.A=Kt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),pu(n.h,"t",r),e.C=0,n=e.l.H,e.h=new iu,e.g=Fu(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Fl(st(e.Ia,e,e.g),e.O)),Ws(e.V,e.g,"readystatechange",e.gb),t=e.H?Os(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),En(1),Vl(e.j,e.u,e.A,e.m,e.X,e.s)}S.gb=function(e){e=e.target;var t=this.L;t&&Gt(e)==3?t.l():this.Ia(e)};S.Ia=function(e){try{if(e==this.g)t:{var t=Gt(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(t!=3||Ci||this.g&&(this.h.h||this.g.ga()||Au(this.g)))){this.I||t!=4||n==7||(n==8||0>=r?En(3):En(2)),Tr(this);var i=this.g.ba();this.N=i;e:if(su(this)){var o=Au(this.g);e="";var s=o.length,u=Gt(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){pe(this),An(this);var a="";break e}this.h.i=new x.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(o[n],{stream:u&&n==s-1});o.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=i==200,Ul(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!lr(c)){var l=c;break e}}l=null}if(i=l)Me(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,to(this,i);else{this.i=!1,this.o=3,wt(12),pe(this),An(this);break t}}this.U?(uu(this,t,a),Ci&&this.i&&t==3&&(Ws(this.V,this.W,"tick",this.fb),this.W.start())):(Me(this.j,this.m,a,null),to(this,a)),t==4&&pe(this),this.i&&!this.I&&(t==4?Ou(this.l,this):(this.i=!1,Sn(this)))}else i==400&&0<a.indexOf("Unknown SID")?(this.o=3,wt(12)):(this.o=0,wt(13)),pe(this),An(this)}}}catch{}finally{}};function su(e){return e.g?e.u=="GET"&&e.K!=2&&e.l.Ba:!1}function uu(e,t,n){for(var r=!0,i;!e.I&&e.C<n.length;)if(i=Kl(e,n),i==Er){t==4&&(e.o=4,wt(14),r=!1),Me(e.j,e.m,null,"[Incomplete Response]");break}else if(i==Ji){e.o=4,wt(15),Me(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else Me(e.j,e.m,i,null),to(e,i);su(e)&&i!=Er&&i!=Ji&&(e.h.g="",e.C=0),t!=4||n.length!=0||e.h.h||(e.o=1,wt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,t=e.l,t.g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),lo(t),t.L=!0,wt(11))):(Me(e.j,e.m,n,"[Invalid Chunked Response]"),pe(e),An(e))}S.fb=function(){if(this.g){var e=Gt(this.g),t=this.g.ga();this.C<t.length&&(Tr(this),uu(this,e,t),this.i&&e!=4&&Sn(this))}};function Kl(e,t){var n=e.C,r=t.indexOf(`
`,n);return r==-1?Er:(n=Number(t.substring(n,r)),isNaN(n)?Ji:(r+=1,r+n>t.length?Er:(t=t.substr(r,n),e.C=r+n,t)))}S.cancel=function(){this.I=!0,pe(this)};function Sn(e){e.Y=Date.now()+e.P,au(e,e.P)}function au(e,t){if(e.B!=null)throw Error("WatchDog timer not null");e.B=Tn(st(e.eb,e),t)}function Tr(e){e.B&&(x.clearTimeout(e.B),e.B=null)}S.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(ql(this.j,this.A),this.K!=2&&(En(3),wt(17)),pe(this),this.o=2,An(this)):au(this,this.Y-e)};function An(e){e.l.G==0||e.I||Ou(e.l,e)}function pe(e){Tr(e);var t=e.L;t&&typeof t.na=="function"&&t.na(),e.L=null,$i(e.W),Ys(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function to(e,t){try{var n=e.l;if(n.G!=0&&(n.g==e||ro(n.i,e))){if(n.I=e.N,!e.J&&ro(n.i,e)&&n.G==3){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0)t:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)xr(n),Rr(n);else break t;ho(n),wt(18)}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&n.A==0&&!n.v&&(n.v=Tn(st(n.ab,n),6e3));if(1>=vu(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else ve(n,11)}else if((e.J||n.g==e)&&xr(n),!lr(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var o=i[t];if(n.U=o[0],o=o[1],n.G==2)if(o[0]=="c"){n.J=o[1],n.la=o[2];var s=o[3];s!=null&&(n.ma=s,n.h.info("VER="+n.ma));var u=o[4];u!=null&&(n.za=u,n.h.info("SVER="+n.za));var a=o[5];a!=null&&typeof a=="number"&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(vt(h,"spdy")||vt(h,"quic")||vt(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(io(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,G(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms")),r=n;var d=e;if(r.oa=Mu(r,r.H?r.la:null,r.W),d.J){mu(r.i,d);var p=d,y=r.K;y&&p.setTimeout(y),p.B&&(Tr(p),Sn(p)),r.g=d}else ku(r);0<n.l.length&&kr(n)}else o[0]!="stop"&&o[0]!="close"||ve(n,7);else n.G==3&&(o[0]=="stop"||o[0]=="close"?o[0]=="stop"?ve(n,7):ao(n):o[0]!="noop"&&n.j&&n.j.wa(o),n.A=0)}}En(4)}catch{}}function Gl(e){if(e.R&&typeof e.R=="function")return e.R();if(typeof e=="string")return e.split("");if(Ii(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function eo(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(Ii(e)||typeof e=="string")Ds(e,t,void 0);else{if(e.T&&typeof e.T=="function")var n=e.T();else if(e.R&&typeof e.R=="function")n=void 0;else if(Ii(e)||typeof e=="string"){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=Gl(e),i=r.length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Fe(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Fe)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}S=Fe.prototype;S.R=function(){no(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e};S.T=function(){return no(this),this.g.concat()};function no(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];ge(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)r=e.g[t],ge(i,r)||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}S.get=function(e,t){return ge(this.h,e)?this.h[e]:t};S.set=function(e,t){ge(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t};S.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};function ge(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var cu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ql(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function ye(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof ye){this.g=t!==void 0?t:e.g,Ir(this,e.j),this.s=e.s,_r(this,e.i),Sr(this,e.m),this.l=e.l,t=e.h;var n=new Cn;n.i=t.i,t.g&&(n.g=new Fe(t.g),n.h=t.h),hu(this,n),this.o=e.o}else e&&(n=String(e).match(cu))?(this.g=!!t,Ir(this,n[1]||"",!0),this.s=Nn(n[2]||""),_r(this,n[3]||"",!0),Sr(this,n[4]),this.l=Nn(n[5]||"",!0),hu(this,n[6]||"",!0),this.o=Nn(n[7]||"")):(this.g=!!t,this.h=new Cn(null,this.g))}ye.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Dn(t,lu,!0),":");var n=this.i;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(Dn(t,lu,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.i&&n.charAt(0)!="/"&&e.push("/"),e.push(Dn(n,n.charAt(0)=="/"?Yl:Wl,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Dn(n,Jl)),e.join("")};function Kt(e){return new ye(e)}function Ir(e,t,n){e.j=n?Nn(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function _r(e,t,n){e.i=n?Nn(t,!0):t}function Sr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function hu(e,t,n){t instanceof Cn?(e.h=t,Zl(e.h,e.g)):(n||(t=Dn(t,Xl)),e.h=new Cn(t,e.g))}function G(e,t,n){e.h.set(t,n)}function Ar(e){return G(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function $l(e){return e instanceof ye?Kt(e):new ye(e,void 0)}function Hl(e,t,n,r){var i=new ye(null,void 0);return e&&Ir(i,e),t&&_r(i,t),n&&Sr(i,n),r&&(i.l=r),i}function Nn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Dn(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,zl),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function zl(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var lu=/[#\/\?@]/g,Wl=/[#\?:]/g,Yl=/[#\?]/g,Xl=/[#\?@]/g,Jl=/#/g;function Cn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Xt(e){e.g||(e.g=new Fe,e.h=0,e.i&&Ql(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}S=Cn.prototype;S.add=function(e,t){Xt(this),this.i=null,e=Ve(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function fu(e,t){Xt(e),t=Ve(e,t),ge(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,e=e.g,ge(e.h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&no(e)))}function du(e,t){return Xt(e),t=Ve(e,t),ge(e.g.h,t)}S.forEach=function(e,t){Xt(this),this.g.forEach(function(n,r){Ds(n,function(i){e.call(t,i,r,this)},this)},this)};S.T=function(){Xt(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n};S.R=function(e){Xt(this);var t=[];if(typeof e=="string")du(this,e)&&(t=Cs(t,this.g.get(Ve(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Cs(t,e[n])}return t};S.set=function(e,t){return Xt(this),this.i=null,e=Ve(this,e),du(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};S.get=function(e,t){return e?(e=this.R(e),0<e.length?String(e[0]):t):t};function pu(e,t,n){fu(e,t),0<n.length&&(e.i=null,e.g.set(Ve(e,t),Si(n)),e.h+=n.length)}S.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;r[o]!==""&&(s+="="+encodeURIComponent(String(r[o]))),e.push(s)}}return this.i=e.join("&")};function Ve(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Zl(e,t){t&&!e.j&&(Xt(e),e.i=null,e.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(fu(this,r),pu(this,i,n))},e)),e.j=t}var tf=function(){function e(t,n){this.h=t,this.g=n}return e}();function gu(e){this.l=e||ef,x.PerformanceNavigationTiming?(e=x.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(x.g&&x.g.Ea&&x.g.Ea()&&x.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ef=10;function yu(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function vu(e){return e.h?1:e.g?e.g.size:0}function ro(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function io(e,t){e.g?e.g.add(t):e.h=t}function mu(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}gu.prototype.cancel=function(){var e,t;if(this.i=wu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){try{for(var n=As(this.g.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.cancel()}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}};function wu(e){var t,n;if(e.h!=null)return e.i.concat(e.h.D);if(e.g!=null&&e.g.size!==0){var r=e.i;try{for(var i=As(e.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}return Si(e.i)}function oo(){}oo.prototype.stringify=function(e){return x.JSON.stringify(e,void 0)};oo.prototype.parse=function(e){return x.JSON.parse(e,void 0)};function nf(){this.g=new oo}function rf(e,t,n){var r=n||"";try{eo(e,function(i,o){var s=i;vn(i)&&(s=ji(i)),t.push(r+o+"="+encodeURIComponent(s))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function of(e,t){var n=new vr;if(x.Image){var r=new Image;r.onload=hr(Nr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=hr(Nr,n,r,"TestLoadImage: error",!1,t),r.onabort=hr(Nr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=hr(Nr,n,r,"TestLoadImage: timeout",!1,t),x.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function Nr(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function Rn(e){this.l=e.$b||null,this.j=e.ib||!1}ut(Rn,zi);Rn.prototype.g=function(){return new Dr(this.l,this.j)};Rn.prototype.i=function(e){return function(){return e}}({});function Dr(e,t){et.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=so,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ut(Dr,et);var so=0;S=Dr.prototype;S.open=function(e,t){if(this.readyState!=so)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,xn(this)};S.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||x).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))};S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,kn(this)),this.readyState=so};S.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,xn(this)),this.g&&(this.readyState=3,xn(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof x.ReadableStream!="undefined"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;bu(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))};function bu(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}S.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?kn(this):xn(this),this.readyState==3&&bu(this)}};S.Ua=function(e){this.g&&(this.response=this.responseText=e,kn(this))};S.Ta=function(e){this.g&&(this.response=e,kn(this))};S.ha=function(){this.g&&kn(this)};function kn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,xn(e)}S.setRequestHeader=function(e,t){this.v.append(e,t)};S.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};S.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function xn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(Dr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var sf=x.JSON.parse;function Y(e){et.call(this),this.headers=new Fe,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Eu,this.K=this.L=!1}ut(Y,et);var Eu="",uf=/^https?$/i,af=["POST","PUT"];S=Y.prototype;S.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Xi.g(),this.C=this.u?nu(this.u):nu(Xi),this.g.onreadystatechange=st(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(o){Tu(this,o);return}e=n||"";var i=new Fe(this.headers);r&&eo(r,function(o,s){i.set(s,o)}),r=ml(i.T()),n=x.FormData&&e instanceof x.FormData,!(0<=Ns(af,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(o,s){this.g.setRequestHeader(s,o)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Su(this),0<this.B&&((this.K=cf(this.g))?(this.g.timeout=this.B,this.g.ontimeout=st(this.pa,this)):this.A=Hi(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(o){Tu(this,o)}};function cf(e){return Pe&&Il()&&typeof e.timeout=="number"&&e.ontimeout!==void 0}function hf(e){return e.toLowerCase()=="content-type"}S.pa=function(){typeof Ti!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,at(this,"timeout"),this.abort(8))};function Tu(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Iu(e),Cr(e)}function Iu(e){e.D||(e.D=!0,at(e,"complete"),at(e,"error"))}S.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,at(this,"complete"),at(this,"abort"),Cr(this))};S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Cr(this,!0)),Y.Z.M.call(this)};S.Fa=function(){this.s||(this.F||this.v||this.l?_u(this):this.cb())};S.cb=function(){_u(this)};function _u(e){if(e.h&&typeof Ti!="undefined"&&(!e.C[1]||Gt(e)!=4||e.ba()!=2)){if(e.v&&Gt(e)==4)Hi(e.Fa,0,e);else if(at(e,"readystatechange"),Gt(e)==4){e.h=!1;try{var t=e.ba();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break t;default:n=!1}var r;if(!(r=n)){var i;if(i=t===0){var o=String(e.H).match(cu)[1]||null;if(!o&&x.self&&x.self.location){var s=x.self.location.protocol;o=s.substr(0,s.length-1)}i=!uf.test(o?o.toLowerCase():"")}r=i}if(r)at(e,"complete"),at(e,"success");else{e.m=6;try{var u=2<Gt(e)?e.g.statusText:""}catch{u=""}e.j=u+" ["+e.ba()+"]",Iu(e)}}finally{Cr(e)}}}}function Cr(e,t){if(e.g){Su(e);var n=e.g,r=e.C[0]?cr:null;e.g=null,e.C=null,t||at(e,"ready");try{n.onreadystatechange=r}catch{}}}function Su(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(x.clearTimeout(e.A),e.A=null)}function Gt(e){return e.g?e.g.readyState:0}S.ba=function(){try{return 2<Gt(this)?this.g.status:-1}catch{return-1}};S.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};S.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),sf(t)}};function Au(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Eu:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}S.Da=function(){return this.m};S.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function lf(e){var t="";return Ni(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function uo(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=lf(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):G(e,t,n))}function On(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Nu(e){this.za=0,this.l=[],this.h=new vr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=On("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=On("baseRetryDelayMs",5e3,e),this.$a=On("retryDelaySeedMs",1e4,e),this.Ya=On("forwardChannelMaxRetries",2,e),this.ra=On("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new gu(e&&e.concurrentRequestLimit),this.Ca=new nf,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||e.Xb!==!1}S=Nu.prototype;S.ma=8;S.G=1;function ao(e){if(Du(e),e.G==3){var t=e.V++,n=Kt(e.F);G(n,"SID",e.J),G(n,"RID",t),G(n,"TYPE","terminate"),Ln(e,n),t=new _n(e,e.h,t,void 0),t.K=2,t.v=Ar(Kt(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(t.v.toString(),"")),!n&&x.Image&&(new Image().src=t.v,n=!0),n||(t.g=Fu(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Sn(t)}Pu(e)}S.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}};function Rr(e){e.g&&(lo(e),e.g.cancel(),e.g=null)}function Du(e){Rr(e),e.u&&(x.clearTimeout(e.u),e.u=null),xr(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&x.clearTimeout(e.m),e.m=null)}function co(e,t){e.l.push(new tf(e.Za++,t)),e.G==3&&kr(e)}function kr(e){yu(e.i)||e.m||(e.m=!0,Ki(e.Ha,e),e.C=0)}function ff(e,t){return vu(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.l=t.D.concat(e.l),!0):e.G==1||e.G==2||e.C>=(e.Xa?0:e.Ya)?!1:(e.m=Tn(st(e.Ha,e,t),Lu(e,e.C)),e.C++,!0)}S.Ha=function(e){if(this.m)if(this.m=null,this.G==1){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new _n(this,this.h,e,void 0),n=this.s;if(this.P&&(n?(n=Os(n),Ps(n,this.P)):n=this.P),this.o===null&&(t.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){e:{var o=this.l[i];if("__data__"in o.g&&(o=o.g.__data__,typeof o=="string")){o=o.length;break e}o=void 0}if(o===void 0)break;if(r+=o,4096<r){r=i;break t}if(r===4096||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Ru(this,t,r),i=Kt(this.F),G(i,"RID",e),G(i,"CVER",22),this.D&&G(i,"X-HTTP-Session-Id",this.D),Ln(this,i),this.o&&n&&uo(i,this.o,n),io(this.i,t),this.Ra&&G(i,"TYPE","init"),this.ja?(G(i,"$req",r),G(i,"SID","null"),t.$=!0,Zi(t,i,null)):Zi(t,i,r),this.G=2}}else this.G==3&&(e?Cu(this,e):this.l.length==0||yu(this.i)||Cu(this))};function Cu(e,t){var n;t?n=t.m:n=e.V++;var r=Kt(e.F);G(r,"SID",e.J),G(r,"RID",n),G(r,"AID",e.U),Ln(e,r),e.o&&e.s&&uo(r,e.o,e.s),n=new _n(e,e.h,n,e.C+1),e.o===null&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Ru(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),io(e.i,n),Zi(n,r,t)}function Ln(e,t){e.j&&eo({},function(n,r){G(t,r,n)})}function Ru(e,t,n){n=Math.min(e.l.length,n);var r=e.j?st(e.j.Oa,e.j,e):null;t:for(var i=e.l,o=-1;;){var s=["count="+n];o==-1?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].h,h=i[a].g;if(c-=o,0>c)o=Math.max(0,i[a].h-100),u=!1;else try{rf(h,s,"req"+c+"_")}catch{r&&r(h)}}if(u){r=s.join("&");break t}}return e=e.l.splice(0,n),t.D=e,r}function ku(e){e.g||e.u||(e.Y=1,Ki(e.Ga,e),e.A=0)}function ho(e){return e.g||e.u||3<=e.A?!1:(e.Y++,e.u=Tn(st(e.Ga,e),Lu(e,e.A)),e.A++,!0)}S.Ga=function(){if(this.u=null,xu(this),this.$&&!(this.L||this.g==null||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Tn(st(this.bb,this),e)}};S.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,wt(10),Rr(this),xu(this))};function lo(e){e.B!=null&&(x.clearTimeout(e.B),e.B=null)}function xu(e){e.g=new _n(e,e.h,"rpc",e.Y),e.o===null&&(e.g.H=e.s),e.g.O=0;var t=Kt(e.oa);G(t,"RID","rpc"),G(t,"SID",e.J),G(t,"CI",e.N?"0":"1"),G(t,"AID",e.U),Ln(e,t),G(t,"TYPE","xmlhttp"),e.o&&e.s&&uo(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Ar(Kt(t)),n.s=null,n.U=!0,ou(n,e)}S.ab=function(){this.v!=null&&(this.v=null,Rr(this),ho(this),wt(19))};function xr(e){e.v!=null&&(x.clearTimeout(e.v),e.v=null)}function Ou(e,t){var n=null;if(e.g==t){xr(e),lo(e),e.g=null;var r=2}else if(ro(e.i,t))n=t.D,mu(e.i,t),r=1;else return;if(e.I=t.N,e.G!=0){if(t.i)if(r==1){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;r=mr(),at(r,new tu(r,n,t,i)),kr(e)}else ku(e);else if(i=t.o,i==3||i==0&&0<e.I||!(r==1&&ff(e,t)||r==2&&ho(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:ve(e,5);break;case 4:ve(e,10);break;case 3:ve(e,6);break;default:ve(e,2)}}}function Lu(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function ve(e,t){if(e.h.info("Error code "+t),t==2){var n=null;e.j&&(n=null);var r=st(e.jb,e);n||(n=new ye("//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||Ir(n,"https"),Ar(n)),of(n.toString(),r)}else wt(2);e.G=0,e.j&&e.j.va(t),Pu(e),Du(e)}S.jb=function(e){e?(this.h.info("Successfully pinged google.com"),wt(2)):(this.h.info("Failed to ping google.com"),wt(1))};function Pu(e){e.G=0,e.I=-1,e.j&&((wu(e.i).length!=0||e.l.length!=0)&&(e.i.i.length=0,Si(e.l),e.l.length=0),e.j.ua())}function Mu(e,t,n){var r=$l(n);if(r.i!="")t&&_r(r,t+"."+r.i),Sr(r,r.m);else{var i=x.location;r=Hl(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&Ni(e.aa,function(o,s){G(r,s,o)}),t=e.D,n=e.sa,t&&n&&G(r,t,n),G(r,"VER",e.ma),Ln(e,r),r}function Fu(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return t=n&&e.Ba&&!e.qa?new Y(new Rn({ib:!0})):new Y(e.qa),t.L=e.H,t}function Vu(){}S=Vu.prototype;S.xa=function(){};S.wa=function(){};S.va=function(){};S.ua=function(){};S.Oa=function(){};function Or(){if(Pe&&!(10<=Number(_l)))throw Error("Environmental error: no available transport.")}Or.prototype.g=function(e,t){return new At(e,t)};function At(e,t){et.call(this),this.g=new Nu(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!lr(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!lr(t)&&(this.g.D=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new Ue(this)}ut(At,et);At.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Ki(st(e.hb,e,t))),wt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=Mu(e,null,e.W),kr(e)};At.prototype.close=function(){ao(this.g)};At.prototype.u=function(e){if(typeof e=="string"){var t={};t.__data__=e,co(this.g,t)}else this.v?(t={},t.__data__=ji(e),co(this.g,t)):co(this.g,e)};At.prototype.M=function(){this.g.j=null,delete this.j,ao(this.g),delete this.g,At.Z.M.call(this)};function Uu(e){Wi.call(this);var t=e.__sm__;if(t){t:{for(var n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}ut(Uu,Wi);function qu(){Yi.call(this),this.status=1}ut(qu,Yi);function Ue(e){this.g=e}ut(Ue,Vu);Ue.prototype.xa=function(){at(this.g,"a")};Ue.prototype.wa=function(e){at(this.g,new Uu(e))};Ue.prototype.va=function(e){at(this.g,new qu(e))};Ue.prototype.ua=function(){at(this.g,"b")};Or.prototype.createWebChannel=Or.prototype.g;At.prototype.send=At.prototype.u;At.prototype.open=At.prototype.m;At.prototype.close=At.prototype.close;wr.NO_ERROR=0;wr.TIMEOUT=8;wr.HTTP_ERROR=6;eu.COMPLETE="complete";ru.EventType=In;In.OPEN="a";In.CLOSE="b";In.ERROR="c";In.MESSAGE="d";et.prototype.listen=et.prototype.N;Y.prototype.listenOnce=Y.prototype.O;Y.prototype.getLastError=Y.prototype.La;Y.prototype.getLastErrorCode=Y.prototype.Da;Y.prototype.getStatus=Y.prototype.ba;Y.prototype.getResponseJson=Y.prototype.Qa;Y.prototype.getResponseText=Y.prototype.ga;Y.prototype.send=Y.prototype.ea;var df=function(){return new Or},pf=function(){return mr()},fo=wr,gf=eu,yf=de,Bu={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},vf=Rn,Lr=ru,mf=Y;/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nt=function(){function e(t,n){var r=this;this.previousValue=t,n&&(n.sequenceNumberHandler=function(i){return r.t(i)},this.i=function(i){return n.writeSequenceNumber(i)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e}();Nt.o=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=function(e){function t(n,r){var i=this;return(i=e.call(this,r)||this).code=n,i.message=r,i.name="FirebaseError",i.toString=function(){return i.name+": [code="+i.code+"]: "+i.message},i}return R(t,e),t}(Error),Pt=new cl("@firebase/firestore");function po(){return Pt.logLevel}function T(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Pt.logLevel<=q.DEBUG){var r=t.map(go);Pt.debug.apply(Pt,z(["Firestore (8.10.0): "+e],r))}}function X(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Pt.logLevel<=q.ERROR){var r=t.map(go);Pt.error.apply(Pt,z(["Firestore (8.10.0): "+e],r))}}function Pn(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Pt.logLevel<=q.WARN){var r=t.map(go);Pt.warn.apply(Pt,z(["Firestore (8.10.0): "+e],r))}}function go(e){if(typeof e=="string")return e;try{return t=e,JSON.stringify(t)}catch{return e}var t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A(e){e===void 0&&(e="Unexpected state");var t="FIRESTORE (8.10.0) INTERNAL ASSERTION FAILED: "+e;throw X(t),new Error(t)}function k(e,t){e||A()}function _(e,t){return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wf(e){var t=typeof self!="undefined"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ju=function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";r.length<20;)for(var i=wf(40),o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=t.charAt(i[o]%t.length));return r},e}();function P(e,t){return e<t?-1:e>t?1:0}function qe(e,t,n){return e.length===t.length&&e.every(function(r,i){return n(r,t[i])})}function Ku(e){return e+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt=function(){function e(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new w(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new w(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new w(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new w(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?P(this.nanoseconds,t.nanoseconds):P(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),O=function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new Tt(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function me(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Qu(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $u=function(){function e(t,n,r){n===void 0?n=0:n>t.length&&A(),r===void 0?r=t.length-n:r>t.length-n&&A(),this.segments=t,this.offset=n,this.len=r}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return e.comparator(this,t)===0},e.prototype.child=function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(r){n.push(r)}):n.push(t),this.construct(n)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return this.length===0},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.forEach=function(t){for(var n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,n){for(var r=Math.min(t.length,n.length),i=0;i<r;i++){var o=t.get(i),s=n.get(i);if(o<s)return-1;if(o>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0},e}(),V=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=[],o=0,s=n;o<s.length;o++){var u=s[o];if(u.indexOf("//")>=0)throw new w(g.INVALID_ARGUMENT,"Invalid segment ("+u+"). Paths must not contain // in them.");i.push.apply(i,u.split("/").filter(function(a){return a.length>0}))}return new t(i)},t.emptyPath=function(){return new t([])},t}($u),bf=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Mt=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.isValidIdentifier=function(n){return bf.test(n)},t.prototype.canonicalString=function(){return this.toArray().map(function(n){return n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(n)||(n="`"+n+"`"),n}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return this.length===1&&this.get(0)==="__name__"},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(n){for(var r=[],i="",o=0,s=function(){if(i.length===0)throw new w(g.INVALID_ARGUMENT,"Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");r.push(i),i=""},u=!1;o<n.length;){var a=n[o];if(a==="\\"){if(o+1===n.length)throw new w(g.INVALID_ARGUMENT,"Path has trailing escape character: "+n);var c=n[o+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new w(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);i+=c,o+=2}else a==="`"?(u=!u,o++):a!=="."||u?(i+=a,o++):(s(),o++)}if(s(),u)throw new w(g.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new t(r)},t.emptyPath=function(){return new t([])},t}($u),Be=function(){function e(t){this.fields=t,t.sort(Mt.comparator)}return e.prototype.covers=function(t){for(var n=0,r=this.fields;n<r.length;n++)if(r[n].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return qe(this.fields,t.fields,function(n,r){return n.isEqual(r)})},e}(),bt=function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(n){for(var r="",i=0;i<n.length;++i)r+=String.fromCharCode(n[i]);return r}(t))},e.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},e.prototype.toUint8Array=function(){return function(t){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return P(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e}();bt.EMPTY_BYTE_STRING=new bt("");var Ef=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Jt(e){if(k(!!e),typeof e=="string"){var t=0,n=Ef.exec(e);if(k(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:J(e.seconds),nanos:J(e.nanos)}}function J(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function je(e){return typeof e=="string"?bt.fromBase64String(e):bt.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yo(e){var t,n;return((n=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Hu(e){var t=e.mapValue.fields.__previous_value__;return yo(t)?Hu(t):t}function Mn(e){var t=Jt(e.mapValue.fields.__local_write_time__.timestampValue);return new Tt(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function we(e){return e==null}function Pr(e){return e===0&&1/e==-1/0}function zu(e){return typeof e=="number"&&Number.isInteger(e)&&!Pr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N=function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(V.fromString(t))},e.fromName=function(t){return new e(V.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return t!==null&&V.comparator(this.path,t.path)===0},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,n){return V.comparator(t.path,n.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new V(t.slice()))},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?yo(e)?4:10:A()}function Vt(e,t){var n=be(e);if(n!==be(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Mn(e).isEqual(Mn(t));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;var o=Jt(r.timestampValue),s=Jt(i.timestampValue);return o.seconds===s.seconds&&o.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(r,i){return je(r.bytesValue).isEqual(je(i.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(r,i){return J(r.geoPointValue.latitude)===J(i.geoPointValue.latitude)&&J(r.geoPointValue.longitude)===J(i.geoPointValue.longitude)}(e,t);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return J(r.integerValue)===J(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){var o=J(r.doubleValue),s=J(i.doubleValue);return o===s?Pr(o)===Pr(s):isNaN(o)&&isNaN(s)}return!1}(e,t);case 9:return qe(e.arrayValue.values||[],t.arrayValue.values||[],Vt);case 10:return function(r,i){var o=r.mapValue.fields||{},s=i.mapValue.fields||{};if(Gu(o)!==Gu(s))return!1;for(var u in o)if(o.hasOwnProperty(u)&&(s[u]===void 0||!Vt(o[u],s[u])))return!1;return!0}(e,t);default:return A()}}function Fn(e,t){return(e.values||[]).find(function(n){return Vt(n,t)})!==void 0}function Ke(e,t){var n=be(e),r=be(t);if(n!==r)return P(n,r);switch(n){case 0:return 0;case 1:return P(e.booleanValue,t.booleanValue);case 2:return function(i,o){var s=J(i.integerValue||i.doubleValue),u=J(o.integerValue||o.doubleValue);return s<u?-1:s>u?1:s===u?0:isNaN(s)?isNaN(u)?0:-1:1}(e,t);case 3:return Wu(e.timestampValue,t.timestampValue);case 4:return Wu(Mn(e),Mn(t));case 5:return P(e.stringValue,t.stringValue);case 6:return function(i,o){var s=je(i),u=je(o);return s.compareTo(u)}(e.bytesValue,t.bytesValue);case 7:return function(i,o){for(var s=i.split("/"),u=o.split("/"),a=0;a<s.length&&a<u.length;a++){var c=P(s[a],u[a]);if(c!==0)return c}return P(s.length,u.length)}(e.referenceValue,t.referenceValue);case 8:return function(i,o){var s=P(J(i.latitude),J(o.latitude));return s!==0?s:P(J(i.longitude),J(o.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(i,o){for(var s=i.values||[],u=o.values||[],a=0;a<s.length&&a<u.length;++a){var c=Ke(s[a],u[a]);if(c)return c}return P(s.length,u.length)}(e.arrayValue,t.arrayValue);case 10:return function(i,o){var s=i.fields||{},u=Object.keys(s),a=o.fields||{},c=Object.keys(a);u.sort(),c.sort();for(var h=0;h<u.length&&h<c.length;++h){var l=P(u[h],c[h]);if(l!==0)return l;var f=Ke(s[u[h]],a[c[h]]);if(f!==0)return f}return P(u.length,c.length)}(e.mapValue,t.mapValue);default:throw A()}}function Wu(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return P(e,t);var n=Jt(e),r=Jt(t),i=P(n.seconds,r.seconds);return i!==0?i:P(n.nanos,r.nanos)}function vo(e){return mo(e)}function mo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(r){var i=Jt(r);return"time("+i.seconds+","+i.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?je(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,N.fromName(n).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(r){for(var i="[",o=!0,s=0,u=r.values||[];s<u.length;s++)o?o=!1:i+=",",i+=mo(u[s]);return i+"]"}(e.arrayValue):"mapValue"in e?function(r){for(var i="{",o=!0,s=0,u=Object.keys(r.fields||{}).sort();s<u.length;s++){var a=u[s];o?o=!1:i+=",",i+=a+":"+mo(r.fields[a])}return i+"}"}(e.mapValue):A();var t,n}function Mr(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function wo(e){return!!e&&"integerValue"in e}function bo(e){return!!e&&"arrayValue"in e}function Yu(e){return!!e&&"nullValue"in e}function Xu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Fr(e){return!!e&&"mapValue"in e}function Vn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return me(e.mapValue.fields,function(i,o){return t.mapValue.fields[i]=Vn(o)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Vn(e.arrayValue.values[r]);return n}return Object.assign({},e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt=function(){function e(t){this.value=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){if(t.isEmpty())return this.value;for(var n=this.value,r=0;r<t.length-1;++r)if(!Fr(n=(n.mapValue.fields||{})[t.get(r)]))return null;return(n=(n.mapValue.fields||{})[t.lastSegment()])||null},e.prototype.set=function(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=Vn(n)},e.prototype.setAll=function(t){var n=this,r=Mt.emptyPath(),i={},o=[];t.forEach(function(u,a){if(!r.isImmediateParentOf(a)){var c=n.getFieldsMap(r);n.applyChanges(c,i,o),i={},o=[],r=a.popLast()}u?i[a.lastSegment()]=Vn(u):o.push(a.lastSegment())});var s=this.getFieldsMap(r);this.applyChanges(s,i,o)},e.prototype.delete=function(t){var n=this.field(t.popLast());Fr(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]},e.prototype.isEqual=function(t){return Vt(this.value,t.value)},e.prototype.getFieldsMap=function(t){var n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(var r=0;r<t.length;++r){var i=n.mapValue.fields[t.get(r)];Fr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=i),n=i}return n.mapValue.fields},e.prototype.applyChanges=function(t,n,r){me(n,function(u,a){return t[u]=a});for(var i=0,o=r;i<o.length;i++){var s=o[i];delete t[s]}},e.prototype.clone=function(){return new e(Vn(this.value))},e}();function Ju(e){var t=[];return me(e.fields,function(n,r){var i=new Mt([n]);if(Fr(r)){var o=Ju(r.mapValue).fields;if(o.length===0)t.push(i);else for(var s=0,u=o;s<u.length;s++){var a=u[s];t.push(i.child(a))}}else t.push(i)}),new Be(t)}var ct=function(){function e(t,n,r,i,o){this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=o}return e.newInvalidDocument=function(t){return new e(t,0,O.min(),Dt.empty(),0)},e.newFoundDocument=function(t,n,r){return new e(t,1,n,r,0)},e.newNoDocument=function(t,n){return new e(t,2,n,Dt.empty(),0)},e.newUnknownDocument=function(t,n){return new e(t,3,n,Dt.empty(),2)},e.prototype.convertToFoundDocument=function(t,n){return this.version=t,this.documentType=1,this.data=n,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Dt.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Dt.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return this.documentState===1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return this.documentState===2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return this.documentType!==0},e.prototype.isFoundDocument=function(){return this.documentType===1},e.prototype.isNoDocument=function(){return this.documentType===2},e.prototype.isUnknownDocument=function(){return this.documentType===3},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),Tf=function(e,t,n,r,i,o,s){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zu(e,t,n,r,i,o,s){return t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),new Tf(e,t,n,r,i,o,s)}function Un(e){var t=_(e);if(t.h===null){var n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(r){return function(i){return i.field.canonicalString()+i.op.toString()+vo(i.value)}(r)}).join(","),n+="|ob:",n+=t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+i.dir}(r)}).join(","),we(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=qr(t.startAt)),t.endAt&&(n+="|ub:",n+=qr(t.endAt)),t.h=n}return t.h}function Vr(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Rf(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],o=t.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Vt(i.value,o.value))return!1;var i,o;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!na(e.startAt,t.startAt)&&na(e.endAt,t.endAt)}function Ur(e){return N.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var Ct=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).field=n,o.op=r,o.value=i,o}return R(t,e),t.create=function(n,r,i){return n.isKeyField()?r==="in"||r==="not-in"?this.l(n,r,i):new If(n,r,i):r==="array-contains"?new Af(n,i):r==="in"?new Nf(n,i):r==="not-in"?new Df(n,i):r==="array-contains-any"?new Cf(n,i):new t(n,r,i)},t.l=function(n,r,i){return r==="in"?new _f(n,i):new Sf(n,i)},t.prototype.matches=function(n){var r=n.data.field(this.field);return this.op==="!="?r!==null&&this.m(Ke(r,this.value)):r!==null&&be(this.value)===be(r)&&this.m(Ke(r,this.value))},t.prototype.m=function(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return A()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),If=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,i)||this).key=N.fromName(i.referenceValue),o}return R(t,e),t.prototype.matches=function(n){var r=N.comparator(n.key,this.key);return this.m(r)},t}(Ct),_f=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"in",r)||this).keys=ta("in",r),i}return R(t,e),t.prototype.matches=function(n){return this.keys.some(function(r){return r.isEqual(n.key)})},t}(Ct),Sf=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"not-in",r)||this).keys=ta("not-in",r),i}return R(t,e),t.prototype.matches=function(n){return!this.keys.some(function(r){return r.isEqual(n.key)})},t}(Ct);function ta(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(function(r){return N.fromName(r.referenceValue)})}var Af=function(e){function t(n,r){return e.call(this,n,"array-contains",r)||this}return R(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return bo(r)&&Fn(r.arrayValue,this.value)},t}(Ct),Nf=function(e){function t(n,r){return e.call(this,n,"in",r)||this}return R(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return r!==null&&Fn(this.value.arrayValue,r)},t}(Ct),Df=function(e){function t(n,r){return e.call(this,n,"not-in",r)||this}return R(t,e),t.prototype.matches=function(n){if(Fn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var r=n.data.field(this.field);return r!==null&&!Fn(this.value.arrayValue,r)},t}(Ct),Cf=function(e){function t(n,r){return e.call(this,n,"array-contains-any",r)||this}return R(t,e),t.prototype.matches=function(n){var r=this,i=n.data.field(this.field);return!(!bo(i)||!i.arrayValue.values)&&i.arrayValue.values.some(function(o){return Fn(r.value.arrayValue,o)})},t}(Ct),qn=function(e,t){this.position=e,this.before=t};function qr(e){return(e.before?"b":"a")+":"+e.position.map(function(t){return vo(t)}).join(",")}var Ge=function(e,t){t===void 0&&(t="asc"),this.field=e,this.dir=t};function Rf(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function ea(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var o=t[i],s=e.position[i];if(r=o.field.isKeyField()?N.comparator(N.fromName(s.referenceValue),n.key):Ke(s,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return e.before?r<=0:r<0}function na(e,t){if(e===null)return t===null;if(t===null||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Vt(e.position[n],t.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qt=function(e,t,n,r,i,o,s,u){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o="F"),s===void 0&&(s=null),u===void 0&&(u=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.p=null,this.T=null,this.startAt,this.endAt};function ra(e,t,n,r,i,o,s,u){return new Qt(e,t,n,r,i,o,s,u)}function Qe(e){return new Qt(e)}function Br(e){return!we(e.limit)&&e.limitType==="F"}function jr(e){return!we(e.limit)&&e.limitType==="L"}function Eo(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function To(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(r.g())return r.field}return null}function Io(e){return e.collectionGroup!==null}function $e(e){var t=_(e);if(t.p===null){t.p=[];var n=To(t),r=Eo(t);if(n!==null&&r===null)n.isKeyField()||t.p.push(new Ge(n)),t.p.push(new Ge(Mt.keyField(),"asc"));else{for(var i=!1,o=0,s=t.explicitOrderBy;o<s.length;o++){var u=s[o];t.p.push(u),u.field.isKeyField()&&(i=!0)}if(!i){var a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new Ge(Mt.keyField(),a))}}}return t.p}function xt(e){var t=_(e);if(!t.T)if(t.limitType==="F")t.T=Zu(t.path,t.collectionGroup,$e(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=$e(t);r<i.length;r++){var o=i[r],s=o.dir==="desc"?"asc":"desc";n.push(new Ge(o.field,s))}var u=t.endAt?new qn(t.endAt.position,!t.endAt.before):null,a=t.startAt?new qn(t.startAt.position,!t.startAt.before):null;t.T=Zu(t.path,t.collectionGroup,n,t.filters,t.limit,u,a)}return t.T}function ia(e,t,n){return new Qt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Bn(e,t){return Vr(xt(e),xt(t))&&e.limitType===t.limitType}function oa(e){return Un(xt(e))+"|lt:"+e.limitType}function _o(e){return"Query(target="+function(t){var n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=", filters: ["+t.filters.map(function(r){return(i=r).field.canonicalString()+" "+i.op+" "+vo(i.value);var i}).join(", ")+"]"),we(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=", orderBy: ["+t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+" ("+i.dir+")"}(r)}).join(", ")+"]"),t.startAt&&(n+=", startAt: "+qr(t.startAt)),t.endAt&&(n+=", endAt: "+qr(t.endAt)),"Target("+n+")"}(xt(e))+"; limitType="+e.limitType+")"}function jn(e,t){return t.isFoundDocument()&&function(n,r){var i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):N.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(e,t)&&function(n,r){for(var i=0,o=n.explicitOrderBy;i<o.length;i++){var s=o[i];if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1}return!0}(e,t)&&function(n,r){for(var i=0,o=n.filters;i<o.length;i++)if(!o[i].matches(r))return!1;return!0}(e,t)&&function(n,r){return!(n.startAt&&!ea(n.startAt,$e(n),r))&&(!n.endAt||!ea(n.endAt,$e(n),r))}(e,t)}function sa(e){return function(t,n){for(var r=!1,i=0,o=$e(e);i<o.length;i++){var s=o[i],u=kf(s,t,n);if(u!==0)return u;r=r||s.field.isKeyField()}return 0}}function kf(e,t,n){var r=e.field.isKeyField()?N.comparator(t.key,n.key):function(i,o,s){var u=o.data.field(i),a=s.data.field(i);return u!==null&&a!==null?Ke(u,a):A()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return A()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ua(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(t)?"-0":t}}function aa(e){return{integerValue:""+e}}function ca(e,t){return zu(t)?aa(t):ua(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kr=function(){this._=void 0};function xf(e,t,n){return e instanceof He?function(r,i){var o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,t):e instanceof Ee?la(e,t):e instanceof Te?fa(e,t):function(r,i){var o=ha(r,i),s=da(o)+da(r.A);return wo(o)&&wo(r.A)?aa(s):ua(r.R,s)}(e,t)}function Of(e,t,n){return e instanceof Ee?la(e,t):e instanceof Te?fa(e,t):n}function ha(e,t){return e instanceof ze?wo(n=t)||function(r){return!!r&&"doubleValue"in r}(n)?t:{integerValue:0}:null;var n}var He=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t}(Kr),Ee=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return R(t,e),t}(Kr);function la(e,t){for(var n=pa(t),r=function(s){n.some(function(u){return Vt(u,s)})||n.push(s)},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Te=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return R(t,e),t}(Kr);function fa(e,t){for(var n=pa(t),r=function(s){n=n.filter(function(u){return!Vt(u,s)})},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ze=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).R=n,i.A=r,i}return R(t,e),t}(Kr);function da(e){return J(e.integerValue||e.doubleValue)}function pa(e){return bo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kn=function(e,t){this.field=e,this.transform=t},Lf=function(e,t){this.version=e,this.transformResults=t},dt=function(){function e(t,n){this.updateTime=t,this.exists=n}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return this.updateTime===void 0&&this.exists===void 0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e}();function Gr(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var Qr=function(){};function Pf(e,t,n){e instanceof Gn?function(r,i,o){var s=r.value.clone(),u=ma(r.fieldTransforms,i,o.transformResults);s.setAll(u),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Zt?function(r,i,o){if(Gr(r.precondition,i)){var s=ma(r.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(va(r)),u.setAll(s),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}else i.convertToUnknownDocument(o.version)}(e,t,n):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,n)}function So(e,t,n){e instanceof Gn?function(r,i,o){if(Gr(r.precondition,i)){var s=r.value.clone(),u=wa(r.fieldTransforms,o,i);s.setAll(u),i.convertToFoundDocument(ya(i),s).setHasLocalMutations()}}(e,t,n):e instanceof Zt?function(r,i,o){if(Gr(r.precondition,i)){var s=wa(r.fieldTransforms,o,i),u=i.data;u.setAll(va(r)),u.setAll(s),i.convertToFoundDocument(ya(i),u).setHasLocalMutations()}}(e,t,n):function(r,i){Gr(r.precondition,i)&&i.convertToNoDocument(O.min())}(e,t)}function Mf(e,t){for(var n=null,r=0,i=e.fieldTransforms;r<i.length;r++){var o=i[r],s=t.data.field(o.field),u=ha(o.transform,s||null);u!=null&&(n==null&&(n=Dt.empty()),n.set(o.field,u))}return n||null}function ga(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&qe(n,r,function(i,o){return function(s,u){return s.field.isEqual(u.field)&&function(a,c){return a instanceof Ee&&c instanceof Ee||a instanceof Te&&c instanceof Te?qe(a.elements,c.elements,Vt):a instanceof ze&&c instanceof ze?Vt(a.A,c.A):a instanceof He&&c instanceof He}(s.transform,u.transform)}(i,o)})}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function ya(e){return e.isFoundDocument()?e.version:O.min()}var Gn=function(e){function t(n,r,i,o){o===void 0&&(o=[]);var s=this;return(s=e.call(this)||this).key=n,s.value=r,s.precondition=i,s.fieldTransforms=o,s.type=0,s}return R(t,e),t}(Qr),Zt=function(e){function t(n,r,i,o,s){s===void 0&&(s=[]);var u=this;return(u=e.call(this)||this).key=n,u.data=r,u.fieldMask=i,u.precondition=o,u.fieldTransforms=s,u.type=1,u}return R(t,e),t}(Qr);function va(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function ma(e,t,n){var r=new Map;k(e.length===n.length);for(var i=0;i<n.length;i++){var o=e[i],s=o.transform,u=t.data.field(o.field);r.set(o.field,Of(s,u,n[i]))}return r}function wa(e,t,n){for(var r=new Map,i=0,o=e;i<o.length;i++){var s=o[i],u=s.transform,a=n.data.field(s.field);r.set(s.field,xf(u,a,t))}return r}var Z,F,Qn=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return R(t,e),t}(Qr),Ao=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return R(t,e),t}(Qr),Ff=function(e){this.count=e};function ba(e){switch(e){case g.OK:return A();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0;default:return A()}}function Ea(e){if(e===void 0)return X("GRPC error has no .code"),g.UNKNOWN;switch(e){case Z.OK:return g.OK;case Z.CANCELLED:return g.CANCELLED;case Z.UNKNOWN:return g.UNKNOWN;case Z.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case Z.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case Z.INTERNAL:return g.INTERNAL;case Z.UNAVAILABLE:return g.UNAVAILABLE;case Z.UNAUTHENTICATED:return g.UNAUTHENTICATED;case Z.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case Z.NOT_FOUND:return g.NOT_FOUND;case Z.ALREADY_EXISTS:return g.ALREADY_EXISTS;case Z.PERMISSION_DENIED:return g.PERMISSION_DENIED;case Z.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case Z.ABORTED:return g.ABORTED;case Z.OUT_OF_RANGE:return g.OUT_OF_RANGE;case Z.UNIMPLEMENTED:return g.UNIMPLEMENTED;case Z.DATA_LOSS:return g.DATA_LOSS;default:return A()}}(F=Z||(Z={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pt=function(){function e(t,n){this.comparator=t,this.root=n||te.EMPTY}return e.prototype.insert=function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,te.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,te.BLACK,null,null))},e.prototype.get=function(t){for(var n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null},e.prototype.indexOf=function(t){for(var n=0,r=this.root;!r.isEmpty();){var i=this.comparator(t,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal(function(n,r){return t(n,r),!1})},e.prototype.toString=function(){var t=[];return this.inorderTraversal(function(n,r){return t.push(n+":"+r),!1}),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new $r(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new $r(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new $r(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new $r(this.root,t,this.comparator,!0)},e}(),$r=function(){function e(t,n,r,i){this.isReverse=i,this.nodeStack=[];for(var o=1;!t.isEmpty();)if(o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(this.nodeStack.length===0)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e}(),te=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=r!=null?r:e.RED,this.left=i!=null?i:e.EMPTY,this.right=o!=null?o:e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,n,r,i,o){return new e(t!=null?t:this.key,n!=null?n:this.value,r!=null?r:this.color,i!=null?i:this.left,o!=null?o:this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,n,r){var i=this,o=r(t,i.key);return(i=o<0?i.copy(null,null,null,i.left.insert(t,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(t,n,r))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw A();var t=this.left.check();if(t!==this.right.check())throw A();return t+(this.isRed()?0:1)},e}();te.EMPTY=null,te.RED=!0,te.BLACK=!1,te.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw A()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw A()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw A()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw A()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw A()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,n,r,i,o){return this},e.prototype.insert=function(t,n,r){return new te(t,n)},e.prototype.remove=function(t,n){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt=function(){function e(t){this.comparator=t,this.data=new pt(this.comparator)}return e.prototype.has=function(t){return this.data.get(t)!==null},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.forEachInRange=function(t,n){for(var r=this.data.getIteratorFrom(t[0]);r.hasNext();){var i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;n(i.key)}},e.prototype.forEachWhile=function(t,n){var r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null},e.prototype.getIterator=function(){return new Ta(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new Ta(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var n=this;return n.size<t.size&&(n=t,t=this),t.forEach(function(r){n=n.add(r)}),n},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach(function(n){t.push(n)}),t},e.prototype.toString=function(){var t=[];return this.forEach(function(n){return t.push(n)}),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var n=new e(this.comparator);return n.data=t,n},e}(),Ta=function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),Vf=new pt(N.comparator);function Ot(){return Vf}var Uf=new pt(N.comparator);function No(){return Uf}var qf=new pt(N.comparator);function Ia(){return qf}var Bf=new tt(N.comparator);function j(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=Bf,r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var jf=new tt(P);function Hr(){return jf}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Do=function(){function e(t,n,r,i,o){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}return e.createSynthesizedRemoteEventForCurrentChange=function(t,n){var r=new Map;return r.set(t,Co.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(O.min(),r,Hr(),Ot(),j())},e}(),Co=function(){function e(t,n,r,i,o){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}return e.createSynthesizedTargetChangeForCurrentChange=function(t,n){return new e(bt.EMPTY_BYTE_STRING,n,j(),j(),j())},e}(),zr=function(e,t,n,r){this.v=e,this.removedTargetIds=t,this.key=n,this.P=r},_a=function(e,t){this.targetId=e,this.V=t},Sa=function(e,t,n,r){n===void 0&&(n=bt.EMPTY_BYTE_STRING),r===void 0&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},Aa=function(){function e(){this.S=0,this.D=Da(),this.C=bt.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"F",{get:function(){return this.S!==0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),e.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},e.prototype.M=function(){var t=j(),n=j(),r=j();return this.D.forEach(function(i,o){switch(o){case 0:t=t.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:A()}}),new Co(this.C,this.N,t,n,r)},e.prototype.L=function(){this.k=!1,this.D=Da()},e.prototype.B=function(t,n){this.k=!0,this.D=this.D.insert(t,n)},e.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.k=!0,this.N=!0},e}(),Kf=function(){function e(t){this.W=t,this.G=new Map,this.H=Ot(),this.J=Na(),this.Y=new tt(P)}return e.prototype.X=function(t){for(var n=0,r=t.v;n<r.length;n++){var i=r[n];t.P&&t.P.isFoundDocument()?this.Z(i,t.P):this.tt(i,t.key,t.P)}for(var o=0,s=t.removedTargetIds;o<s.length;o++)i=s[o],this.tt(i,t.key,t.P)},e.prototype.et=function(t){var n=this;this.forEachTarget(t,function(r){var i=n.nt(r);switch(t.state){case 0:n.st(r)&&i.O(t.resumeToken);break;case 1:i.K(),i.F||i.L(),i.O(t.resumeToken);break;case 2:i.K(),i.F||n.removeTarget(r);break;case 3:n.st(r)&&(i.j(),i.O(t.resumeToken));break;case 4:n.st(r)&&(n.it(r),i.O(t.resumeToken));break;default:A()}})},e.prototype.forEachTarget=function(t,n){var r=this;t.targetIds.length>0?t.targetIds.forEach(n):this.G.forEach(function(i,o){r.st(o)&&n(o)})},e.prototype.rt=function(t){var n=t.targetId,r=t.V.count,i=this.ot(n);if(i){var o=i.target;if(Ur(o))if(r===0){var s=new N(o.path);this.tt(n,s,ct.newNoDocument(s,O.min()))}else k(r===1);else this.ct(n)!==r&&(this.it(n),this.Y=this.Y.add(n))}},e.prototype.ut=function(t){var n=this,r=new Map;this.G.forEach(function(s,u){var a=n.ot(u);if(a){if(s.current&&Ur(a.target)){var c=new N(a.target.path);n.H.get(c)!==null||n.at(u,c)||n.tt(u,c,ct.newNoDocument(c,t))}s.$&&(r.set(u,s.M()),s.L())}});var i=j();this.J.forEach(function(s,u){var a=!0;u.forEachWhile(function(c){var h=n.ot(c);return!h||h.purpose===2||(a=!1,!1)}),a&&(i=i.add(s))});var o=new Do(t,r,this.Y,this.H,i);return this.H=Ot(),this.J=Na(),this.Y=new tt(P),o},e.prototype.Z=function(t,n){if(this.st(t)){var r=this.at(t,n.key)?2:0;this.nt(t).B(n.key,r),this.H=this.H.insert(n.key,n),this.J=this.J.insert(n.key,this.ht(n.key).add(t))}},e.prototype.tt=function(t,n,r){if(this.st(t)){var i=this.nt(t);this.at(t,n)?i.B(n,1):i.q(n),this.J=this.J.insert(n,this.ht(n).delete(t)),r&&(this.H=this.H.insert(n,r))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var n=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var n=this.G.get(t);return n||(n=new Aa,this.G.set(t,n)),n},e.prototype.ht=function(t){var n=this.J.get(t);return n||(n=new tt(P),this.J=this.J.insert(t,n)),n},e.prototype.st=function(t){var n=this.ot(t)!==null;return n||T("WatchChangeAggregator","Detected inactive target",t),n},e.prototype.ot=function(t){var n=this.G.get(t);return n&&n.F?null:this.W.lt(t)},e.prototype.it=function(t){var n=this;this.G.set(t,new Aa),this.W.getRemoteKeysForTarget(t).forEach(function(r){n.tt(t,r,null)})},e.prototype.at=function(t,n){return this.W.getRemoteKeysForTarget(t).has(n)},e}();function Na(){return new pt(N.comparator)}function Da(){return new pt(N.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gf={asc:"ASCENDING",desc:"DESCENDING"},Qf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},$f=function(e,t){this.databaseId=e,this.I=t};function $n(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ca(e,t){return e.I?t.toBase64():t.toUint8Array()}function Hf(e,t){return $n(e,t.toTimestamp())}function nt(e){return k(!!e),O.fromTimestamp(function(t){var n=Jt(t);return new Tt(n.seconds,n.nanos)}(e))}function Ro(e,t){return function(n){return new V(["projects",n.projectId,"databases",n.database])}(e).child("documents").child(t).canonicalString()}function Ra(e){var t=V.fromString(e);return k(ja(t)),t}function Hn(e,t){return Ro(e.databaseId,t.path)}function Ut(e,t){var n=Ra(t);if(n.get(1)!==e.databaseId.projectId)throw new w(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new w(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new N(xa(n))}function ko(e,t){return Ro(e.databaseId,t)}function ka(e){var t=Ra(e);return t.length===4?V.emptyPath():xa(t)}function zn(e){return new V(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function xa(e){return k(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function Oa(e,t,n){return{name:Hn(e,t),fields:n.value.mapValue.fields}}function La(e,t,n){var r=Ut(e,t.name),i=nt(t.updateTime),o=new Dt({mapValue:{fields:t.fields}}),s=ct.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Wr(e,t){var n;if(t instanceof Gn)n={update:Oa(e,t.key,t.value)};else if(t instanceof Qn)n={delete:Hn(e,t.key)};else if(t instanceof Zt)n={update:Oa(e,t.key,t.data),updateMask:Jf(t.fieldMask)};else{if(!(t instanceof Ao))return A();n={verify:Hn(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(r){return function(i,o){var s=o.transform;if(s instanceof He)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Ee)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof Te)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof ze)return{fieldPath:o.field.canonicalString(),increment:s.A};throw A()}(0,r)})),t.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:Hf(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:A()}(e,t.precondition)),n}function Pa(e,t){var n=t.currentDocument?function(c){return c.updateTime!==void 0?dt.updateTime(nt(c.updateTime)):c.exists!==void 0?dt.exists(c.exists):dt.none()}(t.currentDocument):dt.none(),r=t.updateTransforms?t.updateTransforms.map(function(c){return function(h,l){var f=null;if("setToServerValue"in l)k(l.setToServerValue==="REQUEST_TIME"),f=new He;else if("appendMissingElements"in l){var d=l.appendMissingElements.values||[];f=new Ee(d)}else if("removeAllFromArray"in l){var p=l.removeAllFromArray.values||[];f=new Te(p)}else"increment"in l?f=new ze(h,l.increment):A();var y=Mt.fromServerFormat(l.fieldPath);return new Kn(y,f)}(e,c)}):[];if(t.update){t.update.name;var i=Ut(e,t.update.name),o=new Dt({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=function(c){var h=c.fieldPaths||[];return new Be(h.map(function(l){return Mt.fromServerFormat(l)}))}(t.updateMask);return new Zt(i,o,s,n,r)}return new Gn(i,o,n,r)}if(t.delete){var u=Ut(e,t.delete);return new Qn(u,n)}if(t.verify){var a=Ut(e,t.verify);return new Ao(a,n)}return A()}function Ma(e,t){return{documents:[ko(e,t.path)]}}function Fa(e,t){var n={structuredQuery:{}},r=t.path;t.collectionGroup!==null?(n.parent=ko(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=ko(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(u){if(u.length!==0){var a=u.map(function(c){return function(h){if(h.op==="=="){if(Xu(h.value))return{unaryFilter:{field:We(h.field),op:"IS_NAN"}};if(Yu(h.value))return{unaryFilter:{field:We(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(Xu(h.value))return{unaryFilter:{field:We(h.field),op:"IS_NOT_NAN"}};if(Yu(h.value))return{unaryFilter:{field:We(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:We(h.field),op:Wf(h.op),value:h.value}}}(c)});return a.length===1?a[0]:{compositeFilter:{op:"AND",filters:a}}}}(t.filters);i&&(n.structuredQuery.where=i);var o=function(u){if(u.length!==0)return u.map(function(a){return function(c){return{field:We(c.field),direction:zf(c.dir)}}(a)})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(u,a){return u.I||we(a)?a:{value:a}}(e,t.limit);return s!==null&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=qa(t.startAt)),t.endAt&&(n.structuredQuery.endAt=qa(t.endAt)),n}function Va(e){var t=ka(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){k(r===1);var o=n.from[0];o.allDescendants?i=o.collectionId:t=t.child(o.collectionId)}var s=[];n.where&&(s=Ua(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(l){return function(f){return new Ge(Ye(f.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(f.direction))}(l)}));var a=null;n.limit&&(a=function(l){var f;return we(f=typeof l=="object"?l.value:l)?null:f}(n.limit));var c=null;n.startAt&&(c=Ba(n.startAt));var h=null;return n.endAt&&(h=Ba(n.endAt)),ra(t,i,u,s,a,"F",c,h)}function Ua(e){return e?e.unaryFilter!==void 0?[Xf(e)]:e.fieldFilter!==void 0?[Yf(e)]:e.compositeFilter!==void 0?e.compositeFilter.filters.map(function(t){return Ua(t)}).reduce(function(t,n){return t.concat(n)}):A():[]}function qa(e){return{before:e.before,values:e.position}}function Ba(e){var t=!!e.before,n=e.values||[];return new qn(n,t)}function zf(e){return Gf[e]}function Wf(e){return Qf[e]}function We(e){return{fieldPath:e.canonicalString()}}function Ye(e){return Mt.fromServerFormat(e.fieldPath)}function Yf(e){return Ct.create(Ye(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return A()}}(e.fieldFilter.op),e.fieldFilter.value)}function Xf(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Ye(e.unaryFilter.field);return Ct.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=Ye(e.unaryFilter.field);return Ct.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ye(e.unaryFilter.field);return Ct.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ye(e.unaryFilter.field);return Ct.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return A()}}function Jf(e){var t=[];return e.fields.forEach(function(n){return t.push(n.canonicalString())}),{fieldPaths:t}}function ja(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ft(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=Ka(t)),t=Zf(e.get(n),t);return Ka(t)}function Zf(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Ka(e){return e+""}function $t(e){var t=e.length;if(k(t>=2),t===2)return k(e.charAt(0)===""&&e.charAt(1)===""),V.emptyPath();for(var n=t-2,r=[],i="",o=0;o<t;){var s=e.indexOf("",o);switch((s<0||s>n)&&A(),e.charAt(s+1)){case"":var u=e.substring(o,s),a=void 0;i.length===0?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=e.substring(o,s),i+="\0";break;case"":i+=e.substring(o,s+1);break;default:A()}o=s+2}return new V(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var td=function(e,t){this.seconds=e,this.nanoseconds=t},Rt=function(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n};Rt.store="owner",Rt.key="owner";var ee=function(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n};ee.store="mutationQueues",ee.keyPath="userId";var K=function(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};K.store="mutations",K.keyPath="batchId",K.userMutationsIndex="userMutationsIndex",K.userMutationsKeyPath=["userId","batchId"];var gt=function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,n){return[t,Ft(n)]},e.key=function(t,n,r){return[t,Ft(n),r]},e}();gt.store="documentMutations",gt.PLACEHOLDER=new gt;var ed=function(e,t){this.path=e,this.readTime=t},nd=function(e,t){this.path=e,this.version=t},$=function(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};$.store="remoteDocuments",$.readTimeIndex="readTimeIndex",$.readTimeIndexPath="readTime",$.collectionReadTimeIndex="collectionReadTimeIndex",$.collectionReadTimeIndexPath=["parentPath","readTime"];var qt=function(e){this.byteSize=e};qt.store="remoteDocumentGlobal",qt.key="remoteDocumentGlobalKey";var It=function(e,t,n,r,i,o,s){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};It.store="targets",It.keyPath="targetId",It.queryTargetsIndexName="queryTargetsIndex",It.queryTargetsKeyPath=["canonicalId","targetId"];var ht=function(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n};ht.store="targetDocuments",ht.keyPath=["targetId","path"],ht.documentTargetsIndex="documentTargetsIndex",ht.documentTargetsKeyPath=["path","targetId"];var kt=function(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r};kt.key="targetGlobalKey",kt.store="targetGlobal";var Ie=function(e,t){this.collectionId=e,this.parent=t};Ie.store="collectionParents",Ie.keyPath=["collectionId","parent"];var Ht=function(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r};Ht.store="clientMetadata",Ht.keyPath="clientId";var Xe=function(e,t,n){this.bundleId=e,this.createTime=t,this.version=n};Xe.store="bundles",Xe.keyPath="bundleId";var Je=function(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n};Je.store="namedQueries",Je.keyPath="name";var rd=z(z([],z(z([],z(z([],z(z([],[ee.store,K.store,gt.store,$.store,It.store,Rt.store,kt.store,ht.store]),[Ht.store])),[qt.store])),[Ie.store])),[Xe.store,Je.store]),Ga="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Qa=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},e}(),yt=function(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})},b=function(){function e(t){var n=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(r){n.isDone=!0,n.result=r,n.nextCallback&&n.nextCallback(r)},function(r){n.isDone=!0,n.error=r,n.catchCallback&&n.catchCallback(r)})}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,n){var r=this;return this.callbackAttached&&A(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(i,o){r.nextCallback=function(s){r.wrapSuccess(t,s).next(i,o)},r.catchCallback=function(s){r.wrapFailure(n,s).next(i,o)}})},e.prototype.toPromise=function(){var t=this;return new Promise(function(n,r){t.next(n,r)})},e.prototype.wrapUserFunction=function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(r){return e.reject(r)}},e.prototype.wrapSuccess=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)},e.prototype.wrapFailure=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)},e.resolve=function(t){return new e(function(n,r){n(t)})},e.reject=function(t){return new e(function(n,r){r(t)})},e.waitFor=function(t){return new e(function(n,r){var i=0,o=0,s=!1;t.forEach(function(u){++i,u.next(function(){++o,s&&o===i&&n()},function(a){return r(a)})}),s=!0,o===i&&n()})},e.or=function(t){for(var n=e.resolve(!1),r=function(s){n=n.next(function(u){return u?e.resolve(u):s()})},i=0,o=t;i<o.length;i++)r(o[i]);return n},e.forEach=function(t,n){var r=this,i=[];return t.forEach(function(o,s){i.push(n.call(r,o,s))}),this.waitFor(i)},e}(),$a=function(){function e(t,n){var r=this;this.action=t,this.transaction=n,this.aborted=!1,this.ft=new yt,this.transaction.oncomplete=function(){r.ft.resolve()},this.transaction.onabort=function(){n.error?r.ft.reject(new Wn(t,n.error)):r.ft.resolve()},this.transaction.onerror=function(i){var o=xo(i.target.error);r.ft.reject(new Wn(t,o))}}return e.open=function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(o){throw new Wn(n,o)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(T("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var n=this.transaction.objectStore(t);return new od(n)},e}(),Ze=function(){function e(t,n,r){this.name=t,this.version=n,this.wt=r,e._t(le())===12.2&&X("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return T("SimpleDb","Removing database:",t),Se(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if(typeof indexedDB=="undefined")return!1;if(e.gt())return!0;var t=le(),n=e._t(t),r=0<n&&n<10,i=e.Et(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.gt=function(){var t;return typeof process!="undefined"&&((t=process.env)===null||t===void 0?void 0:t.Tt)==="YES"},e.It=function(t,n){return t.store(n)},e._t=function(t){var n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)},e.Et=function(t){var n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)},e.prototype.At=function(t){return m(this,void 0,void 0,function(){var n,r=this;return v(this,function(i){switch(i.label){case 0:return this.db?[3,2]:(T("SimpleDb","Opening database:",this.name),n=this,[4,new Promise(function(o,s){var u=indexedDB.open(r.name,r.version);u.onsuccess=function(a){var c=a.target.result;o(c)},u.onblocked=function(){s(new Wn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},u.onerror=function(a){var c=a.target.error;c.name==="VersionError"?s(new w(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s(new Wn(t,c))},u.onupgradeneeded=function(a){T("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',a.oldVersion);var c=a.target.result;r.wt.Rt(c,u.transaction,a.oldVersion,r.version).next(function(){T("SimpleDb","Database upgrade to version "+r.version+" complete")})}})]);case 1:n.db=i.sent(),i.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(o){return r.bt(o)}),this.db)]}})})},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(n){return t(n)})},e.prototype.runTransaction=function(t,n,r,i){return m(this,void 0,void 0,function(){var o,s,u,a,c;return v(this,function(h){switch(h.label){case 0:o=n==="readonly",s=0,u=function(){var l,f,d,p,y;return v(this,function(E){switch(E.label){case 0:++s,E.label=1;case 1:return E.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=E.sent(),l=$a.open(a.db,t,o?"readonly":"readwrite",r),f=i(l).catch(function(I){return l.abort(I),b.reject(I)}).toPromise(),d={},f.catch(function(){}),[4,l.dt];case 3:return[2,(d.value=(E.sent(),f),d)];case 4:return p=E.sent(),y=p.name!=="FirebaseError"&&s<3,T("SimpleDb","Transaction failed with error:",p.message,"Retrying:",y),a.close(),y?[3,5]:[2,{value:Promise.reject(p)}];case 5:return[2]}})},a=this,h.label=1;case 1:return[5,u()];case 2:if(typeof(c=h.sent())=="object")return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),id=function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return Se(this.Pt.delete())},e}(),Wn=function(e){function t(n,r){var i=this;return(i=e.call(this,g.UNAVAILABLE,"IndexedDB transaction '"+n+"' failed: "+r)||this).name="IndexedDbTransactionError",i}return R(t,e),t}(w);function _e(e){return e.name==="IndexedDbTransactionError"}var od=function(){function e(t){this.store=t}return e.prototype.put=function(t,n){var r;return n!==void 0?(T("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(T("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),Se(r)},e.prototype.add=function(t){return T("SimpleDb","ADD",this.store.name,t,t),Se(this.store.add(t))},e.prototype.get=function(t){var n=this;return Se(this.store.get(t)).next(function(r){return r===void 0&&(r=null),T("SimpleDb","GET",n.store.name,t,r),r})},e.prototype.delete=function(t){return T("SimpleDb","DELETE",this.store.name,t),Se(this.store.delete(t))},e.prototype.count=function(){return T("SimpleDb","COUNT",this.store.name),Se(this.store.count())},e.prototype.Nt=function(t,n){var r=this.cursor(this.options(t,n)),i=[];return this.xt(r,function(o,s){i.push(s)}).next(function(){return i})},e.prototype.kt=function(t,n){T("SimpleDb","DELETE ALL",this.store.name);var r=this.options(t,n);r.Ft=!1;var i=this.cursor(r);return this.xt(i,function(o,s,u){return u.delete()})},e.prototype.$t=function(t,n){var r;n?r=t:(r={},n=t);var i=this.cursor(r);return this.xt(i,n)},e.prototype.Ot=function(t){var n=this.cursor({});return new b(function(r,i){n.onerror=function(o){var s=xo(o.target.error);i(s)},n.onsuccess=function(o){var s=o.target.result;s?t(s.primaryKey,s.value).next(function(u){u?s.continue():r()}):r()}})},e.prototype.xt=function(t,n){var r=[];return new b(function(i,o){t.onerror=function(s){o(s.target.error)},t.onsuccess=function(s){var u=s.target.result;if(u){var a=new id(u),c=n(u.primaryKey,u.value,a);if(c instanceof b){var h=c.catch(function(l){return a.done(),b.reject(l)});r.push(h)}a.isDone?i():a.Dt===null?u.continue():u.continue(a.Dt)}else i()}}).next(function(){return b.waitFor(r)})},e.prototype.options=function(t,n){var r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}},e.prototype.cursor=function(t){var n="next";if(t.reverse&&(n="prev"),t.index){var r=this.store.index(t.index);return t.Ft?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)},e}();function Se(e){return new b(function(t,n){e.onsuccess=function(r){var i=r.target.result;t(i)},e.onerror=function(r){var i=xo(r.target.error);n(i)}})}var Ha=!1;function xo(e){var t=Ze._t(le());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new w("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ha||(Ha=!0,setTimeout(function(){throw r},0)),r}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var za=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Mt=n,i.currentSequenceNumber=r,i}return R(t,e),t}(Qa);function _t(e,t){var n=_(e);return Ze.It(n.Mt,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oo=function(){function e(t,n,r,i){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return e.prototype.applyToRemoteDocument=function(t,n){for(var r=n.mutationResults,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t.key)&&Pf(o,t,r[i])}},e.prototype.applyToLocalView=function(t){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t.key)&&So(s,t,this.localWriteTime);for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t.key)&&So(s,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var n=this;this.mutations.forEach(function(r){var i=t.get(r.key),o=i;n.applyToLocalView(o),i.isValidDocument()||o.convertToNoDocument(O.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(t,n){return t.add(n.key)},j())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&qe(this.mutations,t.mutations,function(n,r){return ga(n,r)})&&qe(this.baseMutations,t.baseMutations,function(n,r){return ga(n,r)})},e}(),sd=function(){function e(t,n,r,i){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return e.from=function(t,n,r){k(t.mutations.length===r.length);for(var i=Ia(),o=t.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new e(t,n,r,i)},e}(),Yr=function(){function e(t,n,r,i,o,s,u){o===void 0&&(o=O.min()),s===void 0&&(s=O.min()),u===void 0&&(u=bt.EMPTY_BYTE_STRING),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),Wa=function(e){this.Lt=e};function Lo(e,t){if(t.document)return La(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=N.fromSegments(t.noDocument.path),r=en(t.noDocument.readTime),i=ct.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var o=N.fromSegments(t.unknownDocument.path);return r=en(t.unknownDocument.version),ct.newUnknownDocument(o,r)}return A()}function Ya(e,t,n){var r=Po(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var o=function(l,f){return{name:Hn(l,f.key),fields:f.data.value.mapValue.fields,updateTime:$n(l,f.version.toTimestamp())}}(e.Lt,t),s=t.hasCommittedMutations;return new $(null,null,o,s,r,i)}if(t.isNoDocument()){var u=t.key.path.toArray(),a=tn(t.version);return s=t.hasCommittedMutations,new $(null,new ed(u,a),null,s,r,i)}if(t.isUnknownDocument()){var c=t.key.path.toArray(),h=tn(t.version);return new $(new nd(c,h),null,null,!0,r,i)}return A()}function Po(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Xa(e){var t=new Tt(e[0],e[1]);return O.fromTimestamp(t)}function tn(e){var t=e.toTimestamp();return new td(t.seconds,t.nanoseconds)}function en(e){var t=new Tt(e.seconds,e.nanoseconds);return O.fromTimestamp(t)}function nn(e,t){for(var n=(t.baseMutations||[]).map(function(a){return Pa(e.Lt,a)}),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&t.mutations[r+1].transform!==void 0){var o=t.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var s=t.mutations.map(function(a){return Pa(e.Lt,a)}),u=Tt.fromMillis(t.localWriteTimeMs);return new Oo(t.batchId,u,n,s)}function Yn(e){var t,n,r=en(e.readTime),i=e.lastLimboFreeSnapshotVersion!==void 0?en(e.lastLimboFreeSnapshotVersion):O.min();return e.query.documents!==void 0?(k((n=e.query).documents.length===1),t=xt(Qe(ka(n.documents[0])))):t=function(o){return xt(Va(o))}(e.query),new Yr(t,e.targetId,0,e.lastListenSequenceNumber,r,i,bt.fromBase64String(e.resumeToken))}function Ja(e,t){var n,r=tn(t.snapshotVersion),i=tn(t.lastLimboFreeSnapshotVersion);n=Ur(t.target)?Ma(e.Lt,t.target):Fa(e.Lt,t.target);var o=t.resumeToken.toBase64();return new It(t.targetId,Un(t.target),r,o,t.sequenceNumber,i,n)}function Mo(e){var t=Va({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?ia(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ud=function(){function e(){}return e.prototype.getBundleMetadata=function(t,n){return Za(t).get(n).next(function(r){if(r)return{id:(i=r).bundleId,createTime:en(i.createTime),version:i.version};var i})},e.prototype.saveBundleMetadata=function(t,n){return Za(t).put({bundleId:(r=n).id,createTime:tn(nt(r.createTime)),version:r.version});var r},e.prototype.getNamedQuery=function(t,n){return tc(t).get(n).next(function(r){if(r)return{name:(i=r).name,query:Mo(i.bundledQuery),readTime:en(i.readTime)};var i})},e.prototype.saveNamedQuery=function(t,n){return tc(t).put(function(r){return{name:r.name,readTime:tn(nt(r.readTime)),bundledQuery:r.bundledQuery}}(n))},e}();function Za(e){return _t(e,Xe.store)}function tc(e){return _t(e,Je.store)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ad=function(){function e(){this.Bt=new Fo}return e.prototype.addToCollectionParentIndex=function(t,n){return this.Bt.add(n),b.resolve()},e.prototype.getCollectionParents=function(t,n){return b.resolve(this.Bt.getEntries(n))},e}(),Fo=function(){function e(){this.index={}}return e.prototype.add=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n]||new tt(V.comparator),o=!i.has(r);return this.index[n]=i.add(r),o},e.prototype.has=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n];return i&&i.has(r)},e.prototype.getEntries=function(t){return(this.index[t]||new tt(V.comparator)).toArray()},e}(),cd=function(){function e(){this.qt=new Fo}return e.prototype.addToCollectionParentIndex=function(t,n){var r=this;if(!this.qt.has(n)){var i=n.lastSegment(),o=n.popLast();t.addOnCommittedListener(function(){r.qt.add(n)});var s={collectionId:i,parent:Ft(o)};return ec(t).put(s)}return b.resolve()},e.prototype.getCollectionParents=function(t,n){var r=[],i=IDBKeyRange.bound([n,""],[Ku(n),""],!1,!0);return ec(t).Nt(i).next(function(o){for(var s=0,u=o;s<u.length;s++){var a=u[s];if(a.collectionId!==n)break;r.push($t(a.parent))}return r})},e}();function ec(e){return _t(e,Ie.store)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Bt=function(){function e(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(e,t,n){var r=e.store(K.store),i=e.store(gt.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.$t({range:s},function(p,y,E){return u++,E.delete()});o.push(a.next(function(){k(u===1)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=gt.key(t,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return b.waitFor(o).next(function(){return c})}function Xr(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw A();t=e.noDocument}return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bt.DEFAULT_COLLECTION_PERCENTILE=10,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bt.DEFAULT=new Bt(41943040,Bt.DEFAULT_COLLECTION_PERCENTILE,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bt.DISABLED=new Bt(-1,0,0);var hd=function(){function e(t,n,r,i){this.userId=t,this.R=n,this.Ut=r,this.referenceDelegate=i,this.Kt={}}return e.Qt=function(t,n,r,i){return k(t.uid!==""),new e(t.isAuthenticated()?t.uid:"",n,r,i)},e.prototype.checkEmpty=function(t){var n=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ne(t).$t({index:K.userMutationsIndex,range:r},function(i,o,s){n=!1,s.done()}).next(function(){return n})},e.prototype.addMutationBatch=function(t,n,r,i){var o=this,s=rn(t),u=ne(t);return u.add({}).next(function(a){k(typeof a=="number");for(var c=new Oo(a,n,r,i),h=function(I,D,C){var L=C.baseMutations.map(function(B){return Wr(I.Lt,B)}),M=C.mutations.map(function(B){return Wr(I.Lt,B)});return new K(D,C.batchId,C.localWriteTime.toMillis(),L,M)}(o.R,o.userId,c),l=[],f=new tt(function(I,D){return P(I.canonicalString(),D.canonicalString())}),d=0,p=i;d<p.length;d++){var y=p[d],E=gt.key(o.userId,y.key.path,a);f=f.add(y.key.path.popLast()),l.push(u.put(h)),l.push(s.put(E,gt.PLACEHOLDER))}return f.forEach(function(I){l.push(o.Ut.addToCollectionParentIndex(t,I))}),t.addOnCommittedListener(function(){o.Kt[a]=c.keys()}),b.waitFor(l).next(function(){return c})})},e.prototype.lookupMutationBatch=function(t,n){var r=this;return ne(t).get(n).next(function(i){return i?(k(i.userId===r.userId),nn(r.R,i)):null})},e.prototype.jt=function(t,n){var r=this;return this.Kt[n]?b.resolve(this.Kt[n]):this.lookupMutationBatch(t,n).next(function(i){if(i){var o=i.keys();return r.Kt[n]=o,o}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=this,i=n+1,o=IDBKeyRange.lowerBound([this.userId,i]),s=null;return ne(t).$t({index:K.userMutationsIndex,range:o},function(u,a,c){a.userId===r.userId&&(k(a.batchId>=i),s=nn(r.R,a)),c.done()}).next(function(){return s})},e.prototype.getHighestUnacknowledgedBatchId=function(t){var n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return ne(t).$t({index:K.userMutationsIndex,range:n,reverse:!0},function(i,o,s){r=o.batchId,s.done()}).next(function(){return r})},e.prototype.getAllMutationBatches=function(t){var n=this,r=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ne(t).Nt(K.userMutationsIndex,r).next(function(i){return i.map(function(o){return nn(n.R,o)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=gt.prefixForPath(this.userId,n.path),o=IDBKeyRange.lowerBound(i),s=[];return rn(t).$t({range:o},function(u,a,c){var h=u[0],l=u[1],f=u[2],d=$t(l);if(h===r.userId&&n.path.isEqual(d))return ne(t).get(f).next(function(p){if(!p)throw A();k(p.userId===r.userId),s.push(nn(r.R,p))});c.done()}).next(function(){return s})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new tt(P),o=[];return n.forEach(function(s){var u=gt.prefixForPath(r.userId,s.path),a=IDBKeyRange.lowerBound(u),c=rn(t).$t({range:a},function(h,l,f){var d=h[0],p=h[1],y=h[2],E=$t(p);d===r.userId&&s.path.isEqual(E)?i=i.add(y):f.done()});o.push(c)}),b.waitFor(o).next(function(){return r.Wt(t,i)})},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=this,i=n.path,o=i.length+1,s=gt.prefixForPath(this.userId,i),u=IDBKeyRange.lowerBound(s),a=new tt(P);return rn(t).$t({range:u},function(c,h,l){var f=c[0],d=c[1],p=c[2],y=$t(d);f===r.userId&&i.isPrefixOf(y)?y.length===o&&(a=a.add(p)):l.done()}).next(function(){return r.Wt(t,a)})},e.prototype.Wt=function(t,n){var r=this,i=[],o=[];return n.forEach(function(s){o.push(ne(t).get(s).next(function(u){if(u===null)throw A();k(u.userId===r.userId),i.push(nn(r.R,u))}))}),b.waitFor(o).next(function(){return i})},e.prototype.removeMutationBatch=function(t,n){var r=this;return rc(t.Mt,this.userId,n).next(function(i){return t.addOnCommittedListener(function(){r.Gt(n.batchId)}),b.forEach(i,function(o){return r.referenceDelegate.markPotentiallyOrphaned(t,o)})})},e.prototype.Gt=function(t){delete this.Kt[t]},e.prototype.performConsistencyCheck=function(t){var n=this;return this.checkEmpty(t).next(function(r){if(!r)return b.resolve();var i=IDBKeyRange.lowerBound(gt.prefixForUser(n.userId)),o=[];return rn(t).$t({range:i},function(s,u,a){if(s[0]===n.userId){var c=$t(s[1]);o.push(c)}else a.done()}).next(function(){k(o.length===0)})})},e.prototype.containsKey=function(t,n){return ic(t,this.userId,n)},e.prototype.zt=function(t){var n=this;return oc(t).get(this.userId).next(function(r){return r||new ee(n.userId,-1,"")})},e}();function ic(e,t,n){var r=gt.prefixForPath(t,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return rn(e).$t({range:o,Ft:!0},function(u,a,c){var h=u[0],l=u[1];u[2],h===t&&l===i&&(s=!0),c.done()}).next(function(){return s})}function ne(e){return _t(e,K.store)}function rn(e){return _t(e,gt.store)}function oc(e){return _t(e,ee.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jr=function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),ld=function(){function e(t,n){this.referenceDelegate=t,this.R=n}return e.prototype.allocateTargetId=function(t){var n=this;return this.Xt(t).next(function(r){var i=new Jr(r.highestTargetId);return r.highestTargetId=i.next(),n.Zt(t,r).next(function(){return r.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(n){return O.fromTimestamp(new Tt(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(n){return n.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(t,n,r){var i=this;return this.Xt(t).next(function(o){return o.highestListenSequenceNumber=n,r&&(o.lastRemoteSnapshotVersion=r.toTimestamp()),n>o.highestListenSequenceNumber&&(o.highestListenSequenceNumber=n),i.Zt(t,o)})},e.prototype.addTargetData=function(t,n){var r=this;return this.te(t,n).next(function(){return r.Xt(t).next(function(i){return i.targetCount+=1,r.ee(n,i),r.Zt(t,i)})})},e.prototype.updateTargetData=function(t,n){return this.te(t,n)},e.prototype.removeTargetData=function(t,n){var r=this;return this.removeMatchingKeysForTargetId(t,n.targetId).next(function(){return on(t).delete(n.targetId)}).next(function(){return r.Xt(t)}).next(function(i){return k(i.targetCount>0),i.targetCount-=1,r.Zt(t,i)})},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return on(t).$t(function(u,a){var c=Yn(a);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(o++,s.push(i.removeTargetData(t,c)))}).next(function(){return b.waitFor(s)}).next(function(){return o})},e.prototype.forEachTarget=function(t,n){return on(t).$t(function(r,i){var o=Yn(i);n(o)})},e.prototype.Xt=function(t){return sc(t).get(kt.key).next(function(n){return k(n!==null),n})},e.prototype.Zt=function(t,n){return sc(t).put(kt.key,n)},e.prototype.te=function(t,n){return on(t).put(Ja(this.R,n))},e.prototype.ee=function(t,n){var r=!1;return t.targetId>n.highestTargetId&&(n.highestTargetId=t.targetId,r=!0),t.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t.sequenceNumber,r=!0),r},e.prototype.getTargetCount=function(t){return this.Xt(t).next(function(n){return n.targetCount})},e.prototype.getTargetData=function(t,n){var r=Un(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return on(t).$t({range:i,index:It.queryTargetsIndexName},function(s,u,a){var c=Yn(u);Vr(n,c.target)&&(o=c,a.done())}).next(function(){return o})},e.prototype.addMatchingKeys=function(t,n,r){var i=this,o=[],s=re(t);return n.forEach(function(u){var a=Ft(u.path);o.push(s.put(new ht(r,a))),o.push(i.referenceDelegate.addReference(t,r,u))}),b.waitFor(o)},e.prototype.removeMatchingKeys=function(t,n,r){var i=this,o=re(t);return b.forEach(n,function(s){var u=Ft(s.path);return b.waitFor([o.delete([r,u]),i.referenceDelegate.removeReference(t,r,s)])})},e.prototype.removeMatchingKeysForTargetId=function(t,n){var r=re(t),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=IDBKeyRange.bound([n],[n+1],!1,!0),i=re(t),o=j();return i.$t({range:r,Ft:!0},function(s,u,a){var c=$t(s[1]),h=new N(c);o=o.add(h)}).next(function(){return o})},e.prototype.containsKey=function(t,n){var r=Ft(n.path),i=IDBKeyRange.bound([r],[Ku(r)],!1,!0),o=0;return re(t).$t({index:ht.documentTargetsIndex,Ft:!0,range:i},function(s,u,a){var c=s[0];s[1],c!==0&&(o++,a.done())}).next(function(){return o>0})},e.prototype.lt=function(t,n){return on(t).get(n).next(function(r){return r?Yn(r):null})},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function on(e){return _t(e,It.store)}function sc(e){return _t(e,kt.store)}function re(e){return _t(e,ht.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(e){return m(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==g.FAILED_PRECONDITION||e.message!==Ga)throw e;return T("LocalStore","Unexpectedly lost primary lease"),[2]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uc(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],s=P(n,i);return s===0?P(r,o):s}var fd=function(){function e(t){this.ne=t,this.buffer=new tt(uc),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var n=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(n);else{var r=this.buffer.last();uc(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),dd=function(){function e(t,n){this.garbageCollector=t,this.asyncQueue=n,this.oe=!1,this.ce=null}return e.prototype.start=function(t){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return this.ce!==null},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var n=this,r=this.oe?3e5:6e4;T("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,function(){return m(n,void 0,void 0,function(){var i;return v(this,function(o){switch(o.label){case 0:this.ce=null,this.oe=!0,o.label=1;case 1:return o.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return o.sent(),[3,7];case 3:return _e(i=o.sent())?(T("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i),[3,6]):[3,4];case 4:return[4,Ae(i)];case 5:o.sent(),o.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return o.sent(),[2]}})})})},e}(),pd=function(){function e(t,n){this.ae=t,this.params=n}return e.prototype.calculateTargetCount=function(t,n){return this.ae.he(t).next(function(r){return Math.floor(n/100*r)})},e.prototype.nthSequenceNumber=function(t,n){var r=this;if(n===0)return b.resolve(Nt.o);var i=new fd(n);return this.ae.forEachTarget(t,function(o){return i.re(o.sequenceNumber)}).next(function(){return r.ae.le(t,function(o){return i.re(o)})}).next(function(){return i.maxValue})},e.prototype.removeTargets=function(t,n,r){return this.ae.removeTargets(t,n,r)},e.prototype.removeOrphanedDocuments=function(t,n){return this.ae.removeOrphanedDocuments(t,n)},e.prototype.collect=function(t,n){var r=this;return this.params.cacheSizeCollectionThreshold===-1?(T("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(nc)):this.getCacheSize(t).next(function(i){return i<r.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector","Garbage collection skipped; Cache size "+i+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),nc):r.fe(t,n)})},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,n){var r,i,o,s,u,a,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(f){return f>h.params.maximumSequenceNumbersToCollect?(T("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+f),i=h.params.maximumSequenceNumbersToCollect):i=f,s=Date.now(),h.nthSequenceNumber(t,i)}).next(function(f){return r=f,u=Date.now(),h.removeTargets(t,r,n)}).next(function(f){return o=f,a=Date.now(),h.removeOrphanedDocuments(t,r)}).next(function(f){return c=Date.now(),po()<=q.DEBUG&&T("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in `+(s-l)+`ms
	Determined least recently used `+i+" in "+(u-s)+`ms
	Removed `+o+" targets in "+(a-u)+`ms
	Removed `+f+" documents in "+(c-a)+`ms
Total Duration: `+(c-l)+"ms"),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:f})})},e}(),gd=function(){function e(t,n){this.db=t,this.garbageCollector=function(r,i){return new pd(r,i)}(this,n)}return e.prototype.he=function(t){var n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(r){return n.next(function(i){return r+i})})},e.prototype.de=function(t){var n=0;return this.le(t,function(r){n++}).next(function(){return n})},e.prototype.forEachTarget=function(t,n){return this.db.getTargetCache().forEachTarget(t,n)},e.prototype.le=function(t,n){return this.we(t,function(r,i){return n(i)})},e.prototype.addReference=function(t,n,r){return Zr(t,r)},e.prototype.removeReference=function(t,n,r){return Zr(t,r)},e.prototype.removeTargets=function(t,n,r){return this.db.getTargetCache().removeTargets(t,n,r)},e.prototype.markPotentiallyOrphaned=function(t,n){return Zr(t,n)},e.prototype._e=function(t,n){return function(r,i){var o=!1;return oc(r).Ot(function(s){return ic(r,s,i).next(function(u){return u&&(o=!0),b.resolve(!u)})}).next(function(){return o})}(t,n)},e.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=this.db.getRemoteDocumentCache().newChangeBuffer(),o=[],s=0;return this.we(t,function(u,a){if(a<=n){var c=r._e(t,u).next(function(h){if(!h)return s++,i.getEntry(t,u).next(function(){return i.removeEntry(u),re(t).delete([0,Ft(u.path)])})});o.push(c)}}).next(function(){return b.waitFor(o)}).next(function(){return i.apply(t)}).next(function(){return s})},e.prototype.removeTarget=function(t,n){var r=n.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)},e.prototype.updateLimboDocument=function(t,n){return Zr(t,n)},e.prototype.we=function(t,n){var r,i=re(t),o=Nt.o;return i.$t({index:ht.documentTargetsIndex},function(s,u){var a=s[0];s[1];var c=u.path,h=u.sequenceNumber;a===0?(o!==Nt.o&&n(new N($t(r)),o),o=h,r=c):o=Nt.o}).next(function(){o!==Nt.o&&n(new N($t(r)),o)})},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e}();function Zr(e,t){return re(e).put(function(n,r){return new ht(0,Ft(n.path),r)}(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sn=function(){function e(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return e.prototype.get=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0)for(var i=0,o=r;i<o.length;i++){var s=o[i],u=s[0],a=s[1];if(this.equalsFn(u,t))return a}},e.prototype.has=function(t){return this.get(t)!==void 0},e.prototype.set=function(t,n){var r=this.mapKeyFn(t),i=this.inner[r];if(i!==void 0){for(var o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,n]);i.push([t,n])}else this.inner[r]=[[t,n]]},e.prototype.delete=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[n]:r.splice(i,1),!0;return!1},e.prototype.forEach=function(t){me(this.inner,function(n,r){for(var i=0,o=r;i<o.length;i++){var s=o[i],u=s[0],a=s[1];t(u,a)}})},e.prototype.isEmpty=function(){return Qu(this.inner)},e}(),ac=function(){function e(){this.changes=new sn(function(t){return t.toString()},function(t,n){return t.isEqual(n)}),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var n=this.changes.get(t);return n?n.readTime:O.min()},e.prototype.addEntry=function(t,n){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:n})},e.prototype.removeEntry=function(t,n){n===void 0&&(n=null),this.assertNotApplied(),this.changes.set(t,{document:ct.newInvalidDocument(t),readTime:n})},e.prototype.getEntry=function(t,n){this.assertNotApplied();var r=this.changes.get(n);return r!==void 0?b.resolve(r.document):this.getFromCache(t,n)},e.prototype.getEntries=function(t,n){return this.getAllFromCache(t,n)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e}(),yd=function(){function e(t,n){this.R=t,this.Ut=n}return e.prototype.addEntry=function(t,n,r){return ie(t).put(ti(n),r)},e.prototype.removeEntry=function(t,n){var r=ie(t),i=ti(n);return r.delete(i)},e.prototype.updateMetadata=function(t,n){var r=this;return this.getMetadata(t).next(function(i){return i.byteSize+=n,r.me(t,i)})},e.prototype.getEntry=function(t,n){var r=this;return ie(t).get(ti(n)).next(function(i){return r.ye(n,i)})},e.prototype.ge=function(t,n){var r=this;return ie(t).get(ti(n)).next(function(i){return{document:r.ye(n,i),size:Xr(i)}})},e.prototype.getEntries=function(t,n){var r=this,i=Ot();return this.pe(t,n,function(o,s){var u=r.ye(o,s);i=i.insert(o,u)}).next(function(){return i})},e.prototype.Ee=function(t,n){var r=this,i=Ot(),o=new pt(N.comparator);return this.pe(t,n,function(s,u){var a=r.ye(s,u);i=i.insert(s,a),o=o.insert(s,Xr(u))}).next(function(){return{documents:i,Te:o}})},e.prototype.pe=function(t,n,r){if(n.isEmpty())return b.resolve();var i=IDBKeyRange.bound(n.first().path.toArray(),n.last().path.toArray()),o=n.getIterator(),s=o.getNext();return ie(t).$t({range:i},function(u,a,c){for(var h=N.fromSegments(u);s&&N.comparator(s,h)<0;)r(s,null),s=o.getNext();s&&s.isEqual(h)&&(r(s,a),s=o.hasNext()?o.getNext():null),s?c.Ct(s.path.toArray()):c.done()}).next(function(){for(;s;)r(s,null),s=o.hasNext()?o.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){var i=this,o=Ot(),s=n.path.length+1,u={};if(r.isEqual(O.min())){var a=n.path.toArray();u.range=IDBKeyRange.lowerBound(a)}else{var c=n.path.toArray(),h=Po(r);u.range=IDBKeyRange.lowerBound([c,h],!0),u.index=$.collectionReadTimeIndex}return ie(t).$t(u,function(l,f,d){if(l.length===s){var p=Lo(i.R,f);n.path.isPrefixOf(p.key.path)?jn(n,p)&&(o=o.insert(p.key,p)):d.done()}}).next(function(){return o})},e.prototype.newChangeBuffer=function(t){return new vd(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next(function(n){return n.byteSize})},e.prototype.getMetadata=function(t){return cc(t).get(qt.key).next(function(n){return k(!!n),n})},e.prototype.me=function(t,n){return cc(t).put(qt.key,n)},e.prototype.ye=function(t,n){if(n){var r=Lo(this.R,n);if(!r.isNoDocument()||!r.version.isEqual(O.min()))return r}return ct.newInvalidDocument(t)},e}(),vd=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Ie=n,i.trackRemovals=r,i.Ae=new sn(function(o){return o.toString()},function(o,s){return o.isEqual(s)}),i}return R(t,e),t.prototype.applyChanges=function(n){var r=this,i=[],o=0,s=new tt(function(u,a){return P(u.canonicalString(),a.canonicalString())});return this.changes.forEach(function(u,a){var c=r.Ae.get(u);if(a.document.isValidDocument()){var h=Ya(r.Ie.R,a.document,r.getReadTime(u));s=s.add(u.path.popLast());var l=Xr(h);o+=l-c,i.push(r.Ie.addEntry(n,u,h))}else if(o-=c,r.trackRemovals){var f=Ya(r.Ie.R,ct.newNoDocument(u,O.min()),r.getReadTime(u));i.push(r.Ie.addEntry(n,u,f))}else i.push(r.Ie.removeEntry(n,u))}),s.forEach(function(u){i.push(r.Ie.Ut.addToCollectionParentIndex(n,u))}),i.push(this.Ie.updateMetadata(n,o)),b.waitFor(i)},t.prototype.getFromCache=function(n,r){var i=this;return this.Ie.ge(n,r).next(function(o){return i.Ae.set(r,o.size),o.document})},t.prototype.getAllFromCache=function(n,r){var i=this;return this.Ie.Ee(n,r).next(function(o){var s=o.documents;return o.Te.forEach(function(u,a){i.Ae.set(u,a)}),s})},t}(ac);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(e){return _t(e,qt.store)}function ie(e){return _t(e,$.store)}function ti(e){return e.path.toArray()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var md=function(){function e(t){this.R=t}return e.prototype.Rt=function(t,n,r,i){var o=this;k(r<i&&r>=0&&i<=11);var s=new $a("createOrUpgrade",n);r<1&&i>=1&&(function(a){a.createObjectStore(Rt.store)}(t),function(a){a.createObjectStore(ee.store,{keyPath:ee.keyPath}),a.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0}),a.createObjectStore(gt.store)}(t),hc(t),function(a){a.createObjectStore($.store)}(t));var u=b.resolve();return r<3&&i>=3&&(r!==0&&(function(a){a.deleteObjectStore(ht.store),a.deleteObjectStore(It.store),a.deleteObjectStore(kt.store)}(t),hc(t)),u=u.next(function(){return function(a){var c=a.store(kt.store),h=new kt(0,0,O.min().toTimestamp(),0);return c.put(kt.key,h)}(s)})),r<4&&i>=4&&(r!==0&&(u=u.next(function(){return function(a,c){return c.store(K.store).Nt().next(function(h){a.deleteObjectStore(K.store),a.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0});var l=c.store(K.store),f=h.map(function(d){return l.put(d)});return b.waitFor(f)})}(t,s)})),u=u.next(function(){(function(a){a.createObjectStore(Ht.store,{keyPath:Ht.keyPath})})(t)})),r<5&&i>=5&&(u=u.next(function(){return o.Re(s)})),r<6&&i>=6&&(u=u.next(function(){return function(a){a.createObjectStore(qt.store)}(t),o.be(s)})),r<7&&i>=7&&(u=u.next(function(){return o.ve(s)})),r<8&&i>=8&&(u=u.next(function(){return o.Pe(t,s)})),r<9&&i>=9&&(u=u.next(function(){(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(t),function(a){var c=a.objectStore($.store);c.createIndex($.readTimeIndex,$.readTimeIndexPath,{unique:!1}),c.createIndex($.collectionReadTimeIndex,$.collectionReadTimeIndexPath,{unique:!1})}(n)})),r<10&&i>=10&&(u=u.next(function(){return o.Ve(s)})),r<11&&i>=11&&(u=u.next(function(){(function(a){a.createObjectStore(Xe.store,{keyPath:Xe.keyPath})})(t),function(a){a.createObjectStore(Je.store,{keyPath:Je.keyPath})}(t)})),u},e.prototype.be=function(t){var n=0;return t.store($.store).$t(function(r,i){n+=Xr(i)}).next(function(){var r=new qt(n);return t.store(qt.store).put(qt.key,r)})},e.prototype.Re=function(t){var n=this,r=t.store(ee.store),i=t.store(K.store);return r.Nt().next(function(o){return b.forEach(o,function(s){var u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.Nt(K.userMutationsIndex,u).next(function(a){return b.forEach(a,function(c){k(c.userId===s.userId);var h=nn(n.R,c);return rc(t,s.userId,h).next(function(){})})})})})},e.prototype.ve=function(t){var n=t.store(ht.store),r=t.store($.store);return t.store(kt.store).get(kt.key).next(function(i){var o=[];return r.$t(function(s,u){var a=new V(s),c=function(h){return[0,Ft(h)]}(a);o.push(n.get(c).next(function(h){return h?b.resolve():function(l){return n.put(new ht(0,Ft(l),i.highestListenSequenceNumber))}(a)}))}).next(function(){return b.waitFor(o)})})},e.prototype.Pe=function(t,n){t.createObjectStore(Ie.store,{keyPath:Ie.keyPath});var r=n.store(Ie.store),i=new Fo,o=function(s){if(i.add(s)){var u=s.lastSegment(),a=s.popLast();return r.put({collectionId:u,parent:Ft(a)})}};return n.store($.store).$t({Ft:!0},function(s,u){var a=new V(s);return o(a.popLast())}).next(function(){return n.store(gt.store).$t({Ft:!0},function(s,u){s[0];var a=s[1];s[2];var c=$t(a);return o(c.popLast())})})},e.prototype.Ve=function(t){var n=this,r=t.store(It.store);return r.$t(function(i,o){var s=Yn(o),u=Ja(n.R,s);return r.put(u)})},e}();function hc(e){e.createObjectStore(ht.store,{keyPath:ht.keyPath}).createIndex(ht.documentTargetsIndex,ht.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(It.store,{keyPath:It.keyPath}).createIndex(It.queryTargetsIndexName,It.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(kt.store)}var Vo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",wd=function(){function e(t,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=u,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(l){return Promise.resolve()},!e.yt())throw new w(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new gd(this,i),this.Le=n+"main",this.R=new Wa(a),this.Be=new Ze(this.Le,11,new md(this.R)),this.qe=new ld(this.referenceDelegate,this.R),this.Ut=new cd,this.Ue=function(l,f){return new yd(l,f)}(this.R,this.Ut),this.Ke=new ud,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,h===!1&&X("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new w(g.FAILED_PRECONDITION,Vo);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(n){return t.qe.getHighestSequenceNumber(n)})}).then(function(n){t.Ne=new Nt(n,t.De)}).then(function(){t.xe=!0}).catch(function(n){return t.Be&&t.Be.close(),Promise.reject(n)})},e.prototype.He=function(t){var n=this;return this.Me=function(r){return m(n,void 0,void 0,function(){return v(this,function(i){return this.started?[2,t(r)]:[2]})})},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var n=this;this.Be.vt(function(r){return m(n,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return r.newVersion===null?[4,t()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return m(n,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(n){return ei(n).put(new Ht(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(n).next(function(r){r||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(n)}).next(function(r){return t.isPrimary&&!r?t.Xe(n).next(function(){return!1}):!!r&&t.Ze(n).next(function(){return!0})})}).catch(function(n){if(_e(n))return T("IndexedDbPersistence","Failed to extend owner lease: ",n),t.isPrimary;if(!t.allowTabSynchronization)throw n;return T("IndexedDbPersistence","Releasing owner lease after error during lease refresh",n),!1}).then(function(n){t.isPrimary!==n&&t.Se.enqueueRetryable(function(){return t.Me(n)}),t.isPrimary=n})},e.prototype.Je=function(t){var n=this;return Xn(t).get(Rt.key).next(function(r){return b.resolve(n.tn(r))})},e.prototype.en=function(t){return ei(t).delete(this.clientId)},e.prototype.nn=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o=this;return v(this,function(s){switch(s.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(u){var a=_t(u,Ht.store);return a.Nt().next(function(c){var h=o.rn(c,18e5),l=c.filter(function(f){return h.indexOf(f)===-1});return b.forEach(l,function(f){return a.delete(f.clientId)}).next(function(){return l})})}).catch(function(){return[]})]);case 1:if(t=s.sent(),this.Qe)for(n=0,r=t;n<r.length;n++)i=r[n],this.Qe.removeItem(this.on(i.clientId));s.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var n=this;return this.Ce?b.resolve(!0):Xn(t).get(Rt.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)){if(n.tn(r)&&n.networkEnabled)return!0;if(!n.tn(r)){if(!r.allowTabSynchronization)throw new w(g.FAILED_PRECONDITION,Vo);return!1}}return!(!n.networkEnabled||!n.inForeground)||ei(t).Nt().next(function(i){return n.rn(i,5e3).find(function(o){if(n.clientId!==o.clientId){var s=!n.networkEnabled&&o.networkEnabled,u=!n.inForeground&&o.inForeground,a=n.networkEnabled===o.networkEnabled;if(s||u&&a)return!0}return!1})===void 0})}).next(function(r){return n.isPrimary!==r&&T("IndexedDbPersistence","Client "+(r?"is":"is not")+" eligible for a primary lease."),r})},e.prototype.shutdown=function(){return m(this,void 0,void 0,function(){var t=this;return v(this,function(n){switch(n.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Rt.store,Ht.store],function(r){var i=new za(r,Nt.o);return t.Xe(i).next(function(){return t.en(i)})})];case 1:return n.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(t,n){var r=this;return t.filter(function(i){return r.sn(i.updateTimeMs,n)&&!r.cn(i.clientId)})},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(n){return ei(n).Nt().next(function(r){return t.rn(r,18e5).map(function(i){return i.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return hd.Qt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;T("IndexedDbPersistence","Starting transaction:",t);var o,s=n==="readonly"?"readonly":"readwrite";return this.Be.runTransaction(t,s,rd,function(u){return o=new za(u,i.Ne?i.Ne.next():Nt.o),n==="readwrite-primary"?i.Je(o).next(function(a){return!!a||i.Ye(o)}).next(function(a){if(!a)throw X("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new w(g.FAILED_PRECONDITION,Ga);return r(o)}).next(function(a){return i.Ze(o).next(function(){return a})}):i.dn(o).next(function(){return r(o)})}).then(function(u){return o.raiseOnCommittedEvent(),u})},e.prototype.dn=function(t){var n=this;return Xn(t).get(Rt.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)&&!n.tn(r)&&!(n.Ce||n.allowTabSynchronization&&r.allowTabSynchronization))throw new w(g.FAILED_PRECONDITION,Vo)})},e.prototype.Ze=function(t){var n=new Rt(this.clientId,this.allowTabSynchronization,Date.now());return Xn(t).put(Rt.key,n)},e.yt=function(){return Ze.yt()},e.prototype.Xe=function(t){var n=this,r=Xn(t);return r.get(Rt.key).next(function(i){return n.tn(i)?(T("IndexedDbPersistence","Releasing primary lease."),r.delete(Rt.key)):b.resolve()})},e.prototype.sn=function(t,n){var r=Date.now();return!(t<r-n||t>r&&(X("Detected an update time that is in the future: "+t+" > "+r),1))},e.prototype.We=function(){var t=this;this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground=t.document.visibilityState==="visible",t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground=this.document.visibilityState==="visible")},e.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},e.prototype.Ge=function(){var t,n=this;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ke=function(){n.un(),Zh()&&navigator.appVersion.match("Version/14")&&n.Se.enterRestrictedMode(!0),n.Se.enqueueAndForget(function(){return n.shutdown()})},this.window.addEventListener("pagehide",this.ke))},e.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},e.prototype.cn=function(t){var n;try{var r=((n=this.Qe)===null||n===void 0?void 0:n.getItem(this.on(t)))!==null;return T("IndexedDbPersistence","Client '"+t+"' "+(r?"is":"is not")+" zombied in LocalStorage"),r}catch(i){return X("IndexedDbPersistence","Failed to get zombied client id.",i),!1}},e.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){X("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch{}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e}();function Xn(e){return _t(e,Rt.store)}function ei(e){return _t(e,Ht.store)}function Uo(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var bd=function(e,t){this.progress=e,this.wn=t},lc=function(){function e(t,n,r){this.Ue=t,this._n=n,this.Ut=r}return e.prototype.mn=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(i){return r.yn(t,n,i)})},e.prototype.yn=function(t,n,r){return this.Ue.getEntry(t,n).next(function(i){for(var o=0,s=r;o<s.length;o++)s[o].applyToLocalView(i);return i})},e.prototype.gn=function(t,n){t.forEach(function(r,i){for(var o=0,s=n;o<s.length;o++)s[o].applyToLocalView(i)})},e.prototype.pn=function(t,n){var r=this;return this.Ue.getEntries(t,n).next(function(i){return r.En(t,i).next(function(){return i})})},e.prototype.En=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,n).next(function(i){return r.gn(n,i)})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){return function(i){return N.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.Tn(t,n.path):Io(n)?this.In(t,n,r):this.An(t,n,r)},e.prototype.Tn=function(t,n){return this.mn(t,new N(n)).next(function(r){var i=No();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})},e.prototype.In=function(t,n,r){var i=this,o=n.collectionGroup,s=No();return this.Ut.getCollectionParents(t,o).next(function(u){return b.forEach(u,function(a){var c=function(h,l){return new Qt(l,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,a.child(o));return i.An(t,c,r).next(function(h){h.forEach(function(l,f){s=s.insert(l,f)})})}).next(function(){return s})})},e.prototype.An=function(t,n,r){var i,o,s=this;return this.Ue.getDocumentsMatchingQuery(t,n,r).next(function(u){return i=u,s._n.getAllMutationBatchesAffectingQuery(t,n)}).next(function(u){return o=u,s.Rn(t,o,i).next(function(a){i=a;for(var c=0,h=o;c<h.length;c++)for(var l=h[c],f=0,d=l.mutations;f<d.length;f++){var p=d[f],y=p.key,E=i.get(y);E==null&&(E=ct.newInvalidDocument(y),i=i.insert(y,E)),So(p,E,l.localWriteTime),E.isFoundDocument()||(i=i.remove(y))}})}).next(function(){return i.forEach(function(u,a){jn(n,a)||(i=i.remove(u))}),i})},e.prototype.Rn=function(t,n,r){for(var i=j(),o=0,s=n;o<s.length;o++)for(var u=0,a=s[o].mutations;u<a.length;u++){var c=a[u];c instanceof Zt&&r.get(c.key)===null&&(i=i.add(c.key))}var h=r;return this.Ue.getEntries(t,i).next(function(l){return l.forEach(function(f,d){d.isFoundDocument()&&(h=h.insert(f,d))}),h})},e}(),Ed=function(){function e(t,n,r,i){this.targetId=t,this.fromCache=n,this.bn=r,this.vn=i}return e.Pn=function(t,n){for(var r=j(),i=j(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new e(t,n.fromCache,r,i)},e}(),fc=function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,n,r,i){var o=this;return function(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}(n)||r.isEqual(O.min())?this.Dn(t,n):this.Sn.pn(t,i).next(function(s){var u=o.Cn(n,s);return(Br(n)||jr(n))&&o.Nn(n.limitType,u,i,r)?o.Dn(t,n):(po()<=q.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),_o(n)),o.Sn.getDocumentsMatchingQuery(t,n,r).next(function(a){return u.forEach(function(c){a=a.insert(c.key,c)}),a}))})},e.prototype.Cn=function(t,n){var r=new tt(sa(t));return n.forEach(function(i,o){jn(t,o)&&(r=r.add(o))}),r},e.prototype.Nn=function(t,n,r,i){if(r.size!==n.size)return!0;var o=t==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)},e.prototype.Dn=function(t,n){return po()<=q.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",_o(n)),this.Sn.getDocumentsMatchingQuery(t,n,O.min())},e}(),Td=function(){function e(t,n,r,i){this.persistence=t,this.xn=n,this.R=i,this.kn=new pt(P),this.Fn=new sn(function(o){return Un(o)},Vr),this.$n=O.min(),this._n=t.getMutationQueue(r),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new lc(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(r){return t.collect(r,n.kn)})},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dc(e,t,n,r){return new Td(e,t,n,r)}function pc(e,t){return m(this,void 0,void 0,function(){var n,r,i,o;return v(this,function(s){switch(s.label){case 0:return n=_(e),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(u){var a;return n._n.getAllMutationBatches(u).next(function(c){return a=c,r=n.persistence.getMutationQueue(t),i=new lc(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(u)}).next(function(c){for(var h=[],l=[],f=j(),d=0,p=a;d<p.length;d++){var y=p[d];h.push(y.batchId);for(var E=0,I=y.mutations;E<I.length;E++){var D=I[E];f=f.add(D.key)}}for(var C=0,L=c;C<L.length;C++){var M=L[C];l.push(M.batchId);for(var B=0,ot=M.mutations;B<ot.length;B++){var bi=ot[B];f=f.add(bi.key)}}return i.pn(u,f).next(function(yn){return{Ln:yn,removedBatchIds:h,addedBatchIds:l}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Id(e,t){var n=_(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(r){var i=t.batch.keys(),o=n.On.newChangeBuffer({trackRemovals:!0});return function(s,u,a,c){var h=a.batch,l=h.keys(),f=b.resolve();return l.forEach(function(d){f=f.next(function(){return c.getEntry(u,d)}).next(function(p){var y=a.docVersions.get(d);k(y!==null),p.version.compareTo(y)<0&&(h.applyToRemoteDocument(p,a),p.isValidDocument()&&c.addEntry(p,a.commitVersion))})}),f.next(function(){return s._n.removeMutationBatch(u,h)})}(n,r,t,o).next(function(){return o.apply(r)}).next(function(){return n._n.performConsistencyCheck(r)}).next(function(){return n.Mn.pn(r,i)})})}function gc(e){var t=_(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(n){return t.qe.getLastRemoteSnapshotVersion(n)})}function _d(e,t){var n=_(e),r=t.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var s=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var u=[];t.targetChanges.forEach(function(h,l){var f=i.get(l);if(f){u.push(n.qe.removeMatchingKeys(o,h.removedDocuments,l).next(function(){return n.qe.addMatchingKeys(o,h.addedDocuments,l)}));var d=h.resumeToken;if(d.approximateByteSize()>0){var p=f.withResumeToken(d,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(l,p),function(y,E,I){return k(E.resumeToken.approximateByteSize()>0),y.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8||I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(f,p,h)&&u.push(n.qe.updateTargetData(o,p))}}});var a=Ot();if(t.documentUpdates.forEach(function(h,l){t.resolvedLimboDocuments.has(h)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(o,h))}),u.push(yc(o,s,t.documentUpdates,r,void 0).next(function(h){a=h})),!r.isEqual(O.min())){var c=n.qe.getLastRemoteSnapshotVersion(o).next(function(h){return n.qe.setTargetsMetadata(o,o.currentSequenceNumber,r)});u.push(c)}return b.waitFor(u).next(function(){return s.apply(o)}).next(function(){return n.Mn.En(o,a)}).next(function(){return a})}).then(function(o){return n.kn=i,o})}function yc(e,t,n,r,i){var o=j();return n.forEach(function(s){return o=o.add(s)}),t.getEntries(e,o).next(function(s){var u=Ot();return n.forEach(function(a,c){var h=s.get(a),l=(i==null?void 0:i.get(a))||r;c.isNoDocument()&&c.version.isEqual(O.min())?(t.removeEntry(a,l),u=u.insert(a,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c,l),u=u.insert(a,c)):T("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version)}),u})}function Sd(e,t){var n=_(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(r){return t===void 0&&(t=-1),n._n.getNextMutationBatchAfterBatchId(r,t)})}function un(e,t){var n=_(e);return n.persistence.runTransaction("Allocate target","readwrite",function(r){var i;return n.qe.getTargetData(r,t).next(function(o){return o?(i=o,b.resolve(i)):n.qe.allocateTargetId(r).next(function(s){return i=new Yr(t,s,0,r.currentSequenceNumber),n.qe.addTargetData(r,i).next(function(){return i})})})}).then(function(r){var i=n.kn.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.kn=n.kn.insert(r.targetId,r),n.Fn.set(t,r.targetId)),r})}function an(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return v(this,function(u){switch(u.label){case 0:r=_(e),i=r.kn.get(t),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(a){return r.persistence.referenceDelegate.removeTarget(a,i)})];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!_e(s=u.sent()))throw s;return T("LocalStore","Failed to update sequence numbers for target "+t+": "+s),[3,5];case 5:return r.kn=r.kn.remove(t),r.Fn.delete(i.target),[2]}})})}function ni(e,t,n){var r=_(e),i=O.min(),o=j();return r.persistence.runTransaction("Execute query","readonly",function(s){return function(u,a,c){var h=_(u),l=h.Fn.get(c);return l!==void 0?b.resolve(h.kn.get(l)):h.qe.getTargetData(a,c)}(r,s,xt(t)).next(function(u){if(u)return i=u.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(s,u.targetId).next(function(a){o=a})}).next(function(){return r.xn.getDocumentsMatchingQuery(s,t,n?i:O.min(),n?o:j())}).next(function(u){return{documents:u,Bn:o}})})}function vc(e,t){var n=_(e),r=_(n.qe),i=n.kn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(o){return r.lt(o,t).next(function(s){return s?s.target:null})})}function mc(e){var t=_(e);return t.persistence.runTransaction("Get new document changes","readonly",function(n){return function(r,i,o){var s=_(r),u=Ot(),a=Po(o),c=ie(i),h=IDBKeyRange.lowerBound(a,!0);return c.$t({index:$.readTimeIndex,range:h},function(l,f){var d=Lo(s.R,f);u=u.insert(d.key,d),a=f.readTime}).next(function(){return{wn:u,readTime:Xa(a)}})}(t.On,n,t.$n)}).then(function(n){var r=n.wn,i=n.readTime;return t.$n=i,r})}function Ad(e){return m(this,void 0,void 0,function(){var t;return v(this,function(n){return[2,(t=_(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(r){return function(i){var o=ie(i),s=O.min();return o.$t({index:$.readTimeIndex,reverse:!0},function(u,a,c){a.readTime&&(s=Xa(a.readTime)),c.done()}).next(function(){return s})}(r)}).then(function(r){t.$n=r})]})})}function Nd(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s,u,a,c,h,l,f,d;return v(this,function(p){switch(p.label){case 0:for(i=_(e),o=j(),s=Ot(),u=Ia(),a=0,c=n;a<c.length;a++)h=c[a],l=t.qn(h.metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,t.Un(h)),u=u.insert(l,t.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,un(i,function(y){return xt(Qe(V.fromString("__bundle__/docs/"+y)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(y){return yc(y,f,s,O.min(),u).next(function(E){return f.apply(y),E}).next(function(E){return i.qe.removeMatchingKeysForTargetId(y,d.targetId).next(function(){return i.qe.addMatchingKeys(y,o,d.targetId)}).next(function(){return i.Mn.En(y,E)}).next(function(){return E})})})]}})})}function Dd(e,t,n){return n===void 0&&(n=j()),m(this,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return[4,un(e,xt(Mo(t.bundledQuery)))];case 1:return r=o.sent(),[2,(i=_(e)).persistence.runTransaction("Save named query","readwrite",function(s){var u=nt(t.readTime);if(r.snapshotVersion.compareTo(u)>=0)return i.Ke.saveNamedQuery(s,t);var a=r.withResumeToken(bt.EMPTY_BYTE_STRING,u);return i.kn=i.kn.insert(a.targetId,a),i.qe.updateTargetData(s,a).next(function(){return i.qe.removeMatchingKeysForTargetId(s,r.targetId)}).next(function(){return i.qe.addMatchingKeys(s,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(s,t)})})]}})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cd=function(){function e(t){this.R=t,this.Qn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,n){return b.resolve(this.Qn.get(n))},e.prototype.saveBundleMetadata=function(t,n){var r;return this.Qn.set(n.id,{id:(r=n).id,version:r.version,createTime:nt(r.createTime)}),b.resolve()},e.prototype.getNamedQuery=function(t,n){return b.resolve(this.jn.get(n))},e.prototype.saveNamedQuery=function(t,n){return this.jn.set(n.name,function(r){return{name:r.name,query:Mo(r.bundledQuery),readTime:nt(r.readTime)}}(n)),b.resolve()},e}(),qo=function(){function e(){this.Wn=new tt(rt.Gn),this.zn=new tt(rt.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,n){var r=new rt(t,n);this.Wn=this.Wn.add(r),this.zn=this.zn.add(r)},e.prototype.Jn=function(t,n){var r=this;t.forEach(function(i){return r.addReference(i,n)})},e.prototype.removeReference=function(t,n){this.Yn(new rt(t,n))},e.prototype.Xn=function(t,n){var r=this;t.forEach(function(i){return r.removeReference(i,n)})},e.prototype.Zn=function(t){var n=this,r=new N(new V([])),i=new rt(r,t),o=new rt(r,t+1),s=[];return this.zn.forEachInRange([i,o],function(u){n.Yn(u),s.push(u.key)}),s},e.prototype.ts=function(){var t=this;this.Wn.forEach(function(n){return t.Yn(n)})},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var n=new N(new V([])),r=new rt(n,t),i=new rt(n,t+1),o=j();return this.zn.forEachInRange([r,i],function(s){o=o.add(s.key)}),o},e.prototype.containsKey=function(t){var n=new rt(t,0),r=this.Wn.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)},e}(),rt=function(){function e(t,n){this.key=t,this.ns=n}return e.Gn=function(t,n){return N.comparator(t.key,n.key)||P(t.ns,n.ns)},e.Hn=function(t,n){return P(t.ns,n.ns)||N.comparator(t.key,n.key)},e}(),Rd=function(){function e(t,n){this.Ut=t,this.referenceDelegate=n,this._n=[],this.ss=1,this.rs=new tt(rt.Gn)}return e.prototype.checkEmpty=function(t){return b.resolve(this._n.length===0)},e.prototype.addMutationBatch=function(t,n,r,i){var o=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var s=new Oo(o,n,r,i);this._n.push(s);for(var u=0,a=i;u<a.length;u++){var c=a[u];this.rs=this.rs.add(new rt(c.key,o)),this.Ut.addToCollectionParentIndex(t,c.key.path.popLast())}return b.resolve(s)},e.prototype.lookupMutationBatch=function(t,n){return b.resolve(this.os(n))},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=n+1,i=this.cs(r),o=i<0?0:i;return b.resolve(this._n.length>o?this._n[o]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return b.resolve(this._n.length===0?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return b.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=new rt(n,0),o=new rt(n,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([i,o],function(u){var a=r.os(u.ns);s.push(a)}),b.resolve(s)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new tt(P);return n.forEach(function(o){var s=new rt(o,0),u=new rt(o,Number.POSITIVE_INFINITY);r.rs.forEachInRange([s,u],function(a){i=i.add(a.ns)})}),b.resolve(this.us(i))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=n.path,i=r.length+1,o=r;N.isDocumentKey(o)||(o=o.child(""));var s=new rt(new N(o),0),u=new tt(P);return this.rs.forEachWhile(function(a){var c=a.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(u=u.add(a.ns)),!0)},s),b.resolve(this.us(u))},e.prototype.us=function(t){var n=this,r=[];return t.forEach(function(i){var o=n.os(i);o!==null&&r.push(o)}),r},e.prototype.removeMutationBatch=function(t,n){var r=this;k(this.hs(n.batchId,"removed")===0),this._n.shift();var i=this.rs;return b.forEach(n.mutations,function(o){var s=new rt(o.key,n.batchId);return i=i.delete(s),r.referenceDelegate.markPotentiallyOrphaned(t,o.key)}).next(function(){r.rs=i})},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,n){var r=new rt(n,0),i=this.rs.firstAfterOrEqual(r);return b.resolve(n.isEqual(i&&i.key))},e.prototype.performConsistencyCheck=function(t){return this._n.length,b.resolve()},e.prototype.hs=function(t,n){return this.cs(t)},e.prototype.cs=function(t){return this._n.length===0?0:t-this._n[0].batchId},e.prototype.os=function(t){var n=this.cs(t);return n<0||n>=this._n.length?null:this._n[n]},e}(),kd=function(){function e(t,n){this.Ut=t,this.ls=n,this.docs=new pt(N.comparator),this.size=0}return e.prototype.addEntry=function(t,n,r){var i=n.key,o=this.docs.get(i),s=o?o.size:0,u=this.ls(n);return this.docs=this.docs.insert(i,{document:n.clone(),size:u,readTime:r}),this.size+=u-s,this.Ut.addToCollectionParentIndex(t,i.path.popLast())},e.prototype.removeEntry=function(t){var n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)},e.prototype.getEntry=function(t,n){var r=this.docs.get(n);return b.resolve(r?r.document.clone():ct.newInvalidDocument(n))},e.prototype.getEntries=function(t,n){var r=this,i=Ot();return n.forEach(function(o){var s=r.docs.get(o);i=i.insert(o,s?s.document.clone():ct.newInvalidDocument(o))}),b.resolve(i)},e.prototype.getDocumentsMatchingQuery=function(t,n,r){for(var i=Ot(),o=new N(n.path.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var u=s.getNext(),a=u.key,c=u.value,h=c.document,l=c.readTime;if(!n.path.isPrefixOf(a.path))break;l.compareTo(r)<=0||jn(n,h)&&(i=i.insert(h.key,h.clone()))}return b.resolve(i)},e.prototype.fs=function(t,n){return b.forEach(this.docs,function(r){return n(r)})},e.prototype.newChangeBuffer=function(t){return new xd(this)},e.prototype.getSize=function(t){return b.resolve(this.size)},e}(),xd=function(e){function t(n){var r=this;return(r=e.call(this)||this).Ie=n,r}return R(t,e),t.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(o,s){s.document.isValidDocument()?i.push(r.Ie.addEntry(n,s.document,r.getReadTime(o))):r.Ie.removeEntry(o)}),b.waitFor(i)},t.prototype.getFromCache=function(n,r){return this.Ie.getEntry(n,r)},t.prototype.getAllFromCache=function(n,r){return this.Ie.getEntries(n,r)},t}(ac),Od=function(){function e(t){this.persistence=t,this.ds=new sn(function(n){return Un(n)},Vr),this.lastRemoteSnapshotVersion=O.min(),this.highestTargetId=0,this.ws=0,this._s=new qo,this.targetCount=0,this.ys=Jr.Jt()}return e.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(r,i){return n(i)}),b.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return b.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return b.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),b.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ws&&(this.ws=n),b.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var n=t.targetId;n>this.highestTargetId&&(this.ys=new Jr(n),this.highestTargetId=n),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,n){return this.te(n),this.targetCount+=1,b.resolve()},e.prototype.updateTargetData=function(t,n){return this.te(n),b.resolve()},e.prototype.removeTargetData=function(t,n){return this.ds.delete(n.target),this._s.Zn(n.targetId),this.targetCount-=1,b.resolve()},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return this.ds.forEach(function(u,a){a.sequenceNumber<=n&&r.get(a.targetId)===null&&(i.ds.delete(u),s.push(i.removeMatchingKeysForTargetId(t,a.targetId)),o++)}),b.waitFor(s).next(function(){return o})},e.prototype.getTargetCount=function(t){return b.resolve(this.targetCount)},e.prototype.getTargetData=function(t,n){var r=this.ds.get(n)||null;return b.resolve(r)},e.prototype.addMatchingKeys=function(t,n,r){return this._s.Jn(n,r),b.resolve()},e.prototype.removeMatchingKeys=function(t,n,r){this._s.Xn(n,r);var i=this.persistence.referenceDelegate,o=[];return i&&n.forEach(function(s){o.push(i.markPotentiallyOrphaned(t,s))}),b.waitFor(o)},e.prototype.removeMatchingKeysForTargetId=function(t,n){return this._s.Zn(n),b.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=this._s.es(n);return b.resolve(r)},e.prototype.containsKey=function(t,n){return b.resolve(this._s.containsKey(n))},e}(),Ld=function(){function e(t,n){var r=this;this.gs={},this.Ne=new Nt(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Od(this),this.Ut=new ad,this.Ue=function(i,o){return new kd(i,function(s){return r.referenceDelegate.ps(s)})}(this.Ut),this.R=new Wa(n),this.Ke=new Cd(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var n=this.gs[t.toKey()];return n||(n=new Rd(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=n),n},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;T("MemoryPersistence","Starting transaction:",t);var o=new Pd(this.Ne.next());return this.referenceDelegate.Es(),r(o).next(function(s){return i.referenceDelegate.Ts(o).next(function(){return s})}).toPromise().then(function(s){return o.raiseOnCommittedEvent(),s})},e.prototype.Is=function(t,n){return b.or(Object.values(this.gs).map(function(r){return function(){return r.containsKey(t,n)}}))},e}(),Pd=function(e){function t(n){var r=this;return(r=e.call(this)||this).currentSequenceNumber=n,r}return R(t,e),t}(Qa),Md=function(){function e(t){this.persistence=t,this.As=new qo,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw A()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,n,r){return this.As.addReference(r,n),this.vs.delete(r.toString()),b.resolve()},e.prototype.removeReference=function(t,n,r){return this.As.removeReference(r,n),this.vs.add(r.toString()),b.resolve()},e.prototype.markPotentiallyOrphaned=function(t,n){return this.vs.add(n.toString()),b.resolve()},e.prototype.removeTarget=function(t,n){var r=this;this.As.Zn(n.targetId).forEach(function(o){return r.vs.add(o.toString())});var i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,n.targetId).next(function(o){o.forEach(function(s){return r.vs.add(s.toString())})}).next(function(){return i.removeTargetData(t,n)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.vs,function(i){var o=N.fromPath(i);return n.Ps(t,o).next(function(s){s||r.removeEntry(o)})}).next(function(){return n.Rs=null,r.apply(t)})},e.prototype.updateLimboDocument=function(t,n){var r=this;return this.Ps(t,n).next(function(i){i?r.vs.delete(n.toString()):r.vs.add(n.toString())})},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,n){var r=this;return b.or([function(){return b.resolve(r.As.containsKey(n))},function(){return r.persistence.getTargetCache().containsKey(t,n)},function(){return r.persistence.Is(t,n)}])},e}(),lt=function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return this.uid!=null},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wc(e,t){return"firestore_clients_"+e+"_"+t}function bc(e,t,n){var r="firestore_mutations_"+e+"_"+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function Bo(e,t){return"firestore_targets_"+e+"_"+t}lt.UNAUTHENTICATED=new lt(null),lt.GOOGLE_CREDENTIALS=new lt("google-credentials-uid"),lt.FIRST_PARTY=new lt("first-party-uid"),lt.MOCK_USER=new lt("mock-user");var Ec=function(){function e(t,n,r,i){this.user=t,this.batchId=n,this.state=r,this.error=i}return e.Vs=function(t,n,r){var i,o=JSON.parse(r),s=typeof o=="object"&&["pending","acknowledged","rejected"].indexOf(o.state)!==-1&&(o.error===void 0||typeof o.error=="object");return s&&o.error&&(s=typeof o.error.message=="string"&&typeof o.error.code=="string")&&(i=new w(o.error.code,o.error.message)),s?new e(t,n,o.state,i):(X("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),jo=function(){function e(t,n,r){this.targetId=t,this.state=n,this.error=r}return e.Vs=function(t,n){var r,i=JSON.parse(n),o=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string")&&(r=new w(i.error.code,i.error.message)),o?new e(t,i.state,r):(X("SharedClientState","Failed to parse target state for ID '"+t+"': "+n),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),Tc=function(){function e(t,n){this.clientId=t,this.activeTargetIds=n}return e.Vs=function(t,n){for(var r=JSON.parse(n),i=typeof r=="object"&&r.activeTargetIds instanceof Array,o=Hr(),s=0;i&&s<r.activeTargetIds.length;++s)i=zu(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new e(t,o):(X("SharedClientState","Failed to parse client data for instance '"+t+"': "+n),null)},e}(),Fd=function(){function e(t,n){this.clientId=t,this.onlineState=n}return e.Vs=function(t){var n=JSON.parse(t);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new e(n.clientId,n.onlineState):(X("SharedClientState","Failed to parse online state: "+t),null)},e}(),Ko=function(){function e(){this.activeTargetIds=Hr()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e}(),Go=function(){function e(t,n,r,i,o){this.window=t,this.Se=n,this.persistenceKey=r,this.Ns=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new pt(P),this.started=!1,this.$s=[];var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.Os=wc(this.persistenceKey,this.Ns),this.Ms=function(u){return"firestore_sequence_number_"+u}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new Ko),this.Ls=new RegExp("^firestore_clients_"+s+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+s+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+s+"_(\\d+)$"),this.Us=function(u){return"firestore_online_state_"+u}(this.persistenceKey),this.Ks=function(u){return"firestore_bundle_loaded_"+u}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o,s,u,a,c,h,l,f=this;return v(this,function(d){switch(d.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=d.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Ns&&(o=this.getItem(wc(this.persistenceKey,i)))&&(s=Tc.Vs(i,o))&&(this.Fs=this.Fs.insert(s.clientId,s));for(this.Qs(),(u=this.storage.getItem(this.Us))&&(a=this.js(u))&&this.Ws(a),c=0,h=this.$s;c<h.length;c++)l=h[c],this.ks(l);return this.$s=[],this.window.addEventListener("pagehide",function(){return f.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},e.prototype.isActiveQueryTarget=function(t){var n=!1;return this.Fs.forEach(function(r,i){i.activeTargetIds.has(t)&&(n=!0)}),n},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,n,r){this.zs(t,n,r),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var n="not-current";if(this.isActiveQueryTarget(t)){var r=this.storage.getItem(Bo(this.persistenceKey,t));if(r){var i=jo.Vs(t,r);i&&(n=i.state)}}return this.Js.Ds(t),this.Qs(),n},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(Bo(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,n,r){this.Ys(t,n,r)},e.prototype.handleUserChange=function(t,n,r){var i=this;n.forEach(function(o){i.Hs(o)}),this.currentUser=t,r.forEach(function(o){i.addPendingMutation(o)})},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(t){var n=this.storage.getItem(t);return T("SharedClientState","READ",t,n),n},e.prototype.setItem=function(t,n){T("SharedClientState","SET",t,n),this.storage.setItem(t,n)},e.prototype.removeItem=function(t){T("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.ks=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(T("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Os)return void X("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return m(n,void 0,void 0,function(){var i,o,s,u,a,c;return v(this,function(h){if(this.started){if(r.key!==null){if(this.Ls.test(r.key)){if(r.newValue==null)return i=this.ti(r.key),[2,this.ei(i,null)];if(o=this.ni(r.key,r.newValue))return[2,this.ei(o.clientId,o)]}else if(this.Bs.test(r.key)){if(r.newValue!==null&&(s=this.si(r.key,r.newValue)))return[2,this.ii(s)]}else if(this.qs.test(r.key)){if(r.newValue!==null&&(u=this.ri(r.key,r.newValue)))return[2,this.oi(u)]}else if(r.key===this.Us){if(r.newValue!==null&&(a=this.js(r.newValue)))return[2,this.Ws(a)]}else if(r.key===this.Ms)(c=function(l){var f=Nt.o;if(l!=null)try{var d=JSON.parse(l);k(typeof d=="number"),f=d}catch(p){X("SharedClientState","Failed to read sequence number from WebStorage",p)}return f}(r.newValue))!==Nt.o&&this.sequenceNumberHandler(c);else if(r.key===this.Ks)return[2,this.syncEngine.ci()]}}else this.$s.push(r);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(t,n,r){var i=new Ec(this.currentUser,t,n,r),o=bc(this.persistenceKey,this.currentUser,t);this.setItem(o,i.Ss())},e.prototype.Hs=function(t){var n=bc(this.persistenceKey,this.currentUser,t);this.removeItem(n)},e.prototype.Xs=function(t){var n={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(n))},e.prototype.Ys=function(t,n,r){var i=Bo(this.persistenceKey,t),o=new jo(t,n,r);this.setItem(i,o.Ss())},e.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},e.prototype.ti=function(t){var n=this.Ls.exec(t);return n?n[1]:null},e.prototype.ni=function(t,n){var r=this.ti(t);return Tc.Vs(r,n)},e.prototype.si=function(t,n){var r=this.Bs.exec(t),i=Number(r[1]),o=r[2]!==void 0?r[2]:null;return Ec.Vs(new lt(o),i,n)},e.prototype.ri=function(t,n){var r=this.qs.exec(t),i=Number(r[1]);return jo.Vs(i,n)},e.prototype.js=function(t){return Fd.Vs(t)},e.prototype.ii=function(t){return m(this,void 0,void 0,function(){return v(this,function(n){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(T("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,n){var r=this,i=n?this.Fs.insert(t,n):this.Fs.remove(t),o=this.Gs(this.Fs),s=this.Gs(i),u=[],a=[];return s.forEach(function(c){o.has(c)||u.push(c)}),o.forEach(function(c){s.has(c)||a.push(c)}),this.syncEngine.hi(u,a).then(function(){r.Fs=i})},e.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var n=Hr();return t.forEach(function(r,i){n=n.unionWith(i.activeTargetIds)}),n},e}(),Ic=function(){function e(){this.li=new Ko,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,n,r){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,n,r){this.fi[t]=n},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new Ko,Promise.resolve()},e.prototype.handleUserChange=function(t,n,r){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e}(),Vd=function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e}(),_c=function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){T("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(0)},e.prototype.yi=function(){T("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(1)},e.yt=function(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0},e}(),Ud={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},qd=function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e}(),Bd=function(e){function t(n){var r=this;return(r=e.call(this,n)||this).forceLongPolling=n.forceLongPolling,r.autoDetectLongPolling=n.autoDetectLongPolling,r.useFetchStreams=n.useFetchStreams,r}return R(t,e),t.prototype.Fi=function(n,r,i,o){return new Promise(function(s,u){var a=new mf;a.listenOnce(gf.COMPLETE,function(){try{switch(a.getLastErrorCode()){case fo.NO_ERROR:var h=a.getResponseJson();T("Connection","XHR received:",JSON.stringify(h)),s(h);break;case fo.TIMEOUT:T("Connection",'RPC "'+n+'" timed out'),u(new w(g.DEADLINE_EXCEEDED,"Request time out"));break;case fo.HTTP_ERROR:var l=a.getStatus();if(T("Connection",'RPC "'+n+'" failed with status:',l,"response text:",a.getResponseText()),l>0){var f=a.getResponseJson().error;if(f&&f.status&&f.message){var d=function(p){var y=p.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(y)>=0?y:g.UNKNOWN}(f.status);u(new w(d,f.message))}else u(new w(g.UNKNOWN,"Server responded with status "+a.getStatus()))}else u(new w(g.UNAVAILABLE,"Connection failed."));break;default:A()}}finally{T("Connection",'RPC "'+n+'" completed.')}});var c=JSON.stringify(o);a.send(r,"POST",c,i,15)})},t.prototype.Oi=function(n,r){var i=[this.Di,"/","google.firestore.v1.Firestore","/",n,"/channel"],o=df(),s=pf(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new vf({})),this.ki(u.initMessageHeaders,r),$h()||Wh()||Yh()||Xh()||Jh()||zh()||(u.httpHeadersOverwriteParam="$httpHeaders");var a=i.join("");T("Connection","Creating WebChannel: "+a,u);var c=o.createWebChannel(a,u),h=!1,l=!1,f=new qd({Ei:function(p){l?T("Connection","Not sending because WebChannel is closed:",p):(h||(T("Connection","Opening WebChannel transport."),c.open(),h=!0),T("Connection","WebChannel sending:",p),c.send(p))},Ti:function(){return c.close()}}),d=function(p,y,E){p.listen(y,function(I){try{E(I)}catch(D){setTimeout(function(){throw D},0)}})};return d(c,Lr.EventType.OPEN,function(){l||T("Connection","WebChannel transport opened.")}),d(c,Lr.EventType.CLOSE,function(){l||(l=!0,T("Connection","WebChannel transport closed"),f.Vi())}),d(c,Lr.EventType.ERROR,function(p){l||(l=!0,Pn("Connection","WebChannel transport errored:",p),f.Vi(new w(g.UNAVAILABLE,"The operation could not be completed")))}),d(c,Lr.EventType.MESSAGE,function(p){var y;if(!l){var E=p.data[0];k(!!E);var I=E,D=I.error||((y=I[0])===null||y===void 0?void 0:y.error);if(D){T("Connection","WebChannel received error:",D);var C=D.status,L=function(B){var ot=Z[B];if(ot!==void 0)return Ea(ot)}(C),M=D.message;L===void 0&&(L=g.INTERNAL,M="Unknown error status: "+C+" with message "+D.message),l=!0,f.Vi(new w(L,M)),c.close()}else T("Connection","WebChannel received:",E),f.Si(E)}}),d(s,yf.STAT_EVENT,function(p){p.stat===Bu.PROXY?T("Connection","Detected buffering proxy"):p.stat===Bu.NOPROXY&&T("Connection","Detected no buffering proxy")}),setTimeout(function(){f.Pi()},0),f},t}(function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Di=n+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,n,r,i){var o=this.xi(t,n);T("RestConnection","Sending: ",o,r);var s={};return this.ki(s,i),this.Fi(t,o,s,r).then(function(u){return T("RestConnection","Received: ",u),u},function(u){throw Pn("RestConnection",t+" failed with error: ",u,"url: ",o,"request:",r),u})},e.prototype.$i=function(t,n,r,i){return this.Ni(t,n,r,i)},e.prototype.ki=function(t,n){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n)for(var r in n.authHeaders)n.authHeaders.hasOwnProperty(r)&&(t[r]=n.authHeaders[r])},e.prototype.xi=function(t,n){var r=Ud[t];return this.Di+"/v1/"+n+":"+r},e}());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sc(){return typeof window!="undefined"?window:null}function ri(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jn(e){return new $f(e,!0)}var Qo=function(){function e(t,n,r,i,o){r===void 0&&(r=1e3),i===void 0&&(i=1.5),o===void 0&&(o=6e4),this.Se=t,this.timerId=n,this.Mi=r,this.Li=i,this.Bi=o,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Qi=function(){this.qi=this.Bi},e.prototype.ji=function(t){var n=this;this.cancel();var r=Math.floor(this.qi+this.Wi()),i=Math.max(0,Date.now()-this.Ki),o=Math.max(0,r-i);o>0&&T("ExponentialBackoff","Backing off for "+o+" ms (base delay: "+this.qi+" ms, delay with jitter: "+r+" ms, last attempt: "+i+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,o,function(){return n.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){this.Ui!==null&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){this.Ui!==null&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),Ac=function(){function e(t,n,r,i,o,s){this.Se=t,this.zi=r,this.Hi=i,this.Ji=o,this.listener=s,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Qo(t,n)}return e.prototype.tr=function(){return this.state===1||this.state===2||this.state===4},e.prototype.er=function(){return this.state===2},e.prototype.start=function(){this.state!==3?this.auth():this.nr()},e.prototype.stop=function(){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&this.Xi===null&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return m(this,void 0,void 0,function(){return v(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,n){return m(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,t!==3?this.Zi.reset():n&&n.code===g.RESOURCE_EXHAUSTED?(X(n.toString()),X("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):n&&n.code===g.UNAUTHENTICATED&&this.Ji.invalidateToken(),this.stream!==null&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(n)];case 1:return r.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var n=this.hr(this.Yi),r=this.Yi;this.Ji.getToken().then(function(i){t.Yi===r&&t.lr(i)},function(i){n(function(){var o=new w(g.UNKNOWN,"Fetching auth token failed: "+i.message);return t.dr(o)})})},e.prototype.lr=function(t){var n=this,r=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){r(function(){return n.state=2,n.listener.Ii()})}),this.stream.Ri(function(i){r(function(){return n.dr(i)})}),this.stream.onMessage(function(i){r(function(){return n.onMessage(i)})})},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return m(t,void 0,void 0,function(){return v(this,function(n){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(t){return T("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var n=this;return function(r){n.Se.enqueueAndForget(function(){return n.Yi===t?r():(T("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),jd=function(e){function t(n,r,i,o,s){var u=this;return(u=e.call(this,n,"listen_stream_connection_backoff","listen_stream_idle",r,i,s)||this).R=o,u}return R(t,e),t.prototype.wr=function(n){return this.Hi.Oi("Listen",n)},t.prototype.onMessage=function(n){this.Zi.reset();var r=function(o,s){var u;if("targetChange"in s){s.targetChange;var a=function(E){return E==="NO_CHANGE"?0:E==="ADD"?1:E==="REMOVE"?2:E==="CURRENT"?3:E==="RESET"?4:A()}(s.targetChange.targetChangeType||"NO_CHANGE"),c=s.targetChange.targetIds||[],h=function(E,I){return E.I?(k(I===void 0||typeof I=="string"),bt.fromBase64String(I||"")):(k(I===void 0||I instanceof Uint8Array),bt.fromUint8Array(I||new Uint8Array))}(o,s.targetChange.resumeToken),l=(f=s.targetChange.cause)&&function(E){var I=E.code===void 0?g.UNKNOWN:Ea(E.code);return new w(I,E.message||"")}(f);u=new Sa(a,c,h,l||null)}else if("documentChange"in s){s.documentChange,(a=s.documentChange).document,a.document.name,a.document.updateTime,c=Ut(o,a.document.name),h=nt(a.document.updateTime);var f=new Dt({mapValue:{fields:a.document.fields}}),d=(l=ct.newFoundDocument(c,h,f),a.targetIds||[]),p=a.removedTargetIds||[];u=new zr(d,p,l.key,l)}else if("documentDelete"in s)s.documentDelete,(a=s.documentDelete).document,c=Ut(o,a.document),h=a.readTime?nt(a.readTime):O.min(),f=ct.newNoDocument(c,h),l=a.removedTargetIds||[],u=new zr([],l,f.key,f);else if("documentRemove"in s)s.documentRemove,(a=s.documentRemove).document,c=Ut(o,a.document),h=a.removedTargetIds||[],u=new zr([],h,c,null);else{if(!("filter"in s))return A();s.filter;var y=s.filter;y.targetId,a=y.count||0,c=new Ff(a),h=y.targetId,u=new _a(h,c)}return u}(this.R,n),i=function(o){if(!("targetChange"in o))return O.min();var s=o.targetChange;return s.targetIds&&s.targetIds.length?O.min():s.readTime?nt(s.readTime):O.min()}(n);return this.listener._r(r,i)},t.prototype.mr=function(n){var r={};r.database=zn(this.R),r.addTarget=function(o,s){var u,a=s.target;return(u=Ur(a)?{documents:Ma(o,a)}:{query:Fa(o,a)}).targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Ca(o,s.resumeToken):s.snapshotVersion.compareTo(O.min())>0&&(u.readTime=$n(o,s.snapshotVersion.toTimestamp())),u}(this.R,n);var i=function(o,s){var u=function(a,c){switch(c){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return A()}}(0,s.purpose);return u==null?null:{"goog-listen-tags":u}}(this.R,n);i&&(r.labels=i),this.cr(r)},t.prototype.yr=function(n){var r={};r.database=zn(this.R),r.removeTarget=n,this.cr(r)},t}(Ac),Kd=function(e){function t(n,r,i,o,s){var u=this;return(u=e.call(this,n,"write_stream_connection_backoff","write_stream_idle",r,i,s)||this).R=o,u.gr=!1,u}return R(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(n){return this.Hi.Oi("Write",n)},t.prototype.onMessage=function(n){if(k(!!n.streamToken),this.lastStreamToken=n.streamToken,this.gr){this.Zi.reset();var r=function(o,s){return o&&o.length>0?(k(s!==void 0),o.map(function(u){return function(a,c){var h=a.updateTime?nt(a.updateTime):nt(c);return h.isEqual(O.min())&&(h=nt(c)),new Lf(h,a.transformResults||[])}(u,s)})):[]}(n.writeResults,n.commitTime),i=nt(n.commitTime);return this.listener.Tr(i,r)}return k(!n.writeResults||n.writeResults.length===0),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var n={};n.database=zn(this.R),this.cr(n)},t.prototype.Er=function(n){var r=this,i={streamToken:this.lastStreamToken,writes:n.map(function(o){return Wr(r.R,o)})};this.cr(i)},t}(Ac),Gd=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).credentials=n,o.Hi=r,o.R=i,o.Rr=!1,o}return R(t,e),t.prototype.br=function(){if(this.Rr)throw new w(g.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.Ni(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(g.UNKNOWN,s.toString())})},t.prototype.$i=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.$i(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(g.UNKNOWN,s.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),Qd=function(){function e(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;this.vr===0&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(t){this.state==="Online"?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.kr(),this.vr=0,t==="Online"&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var n="Could not reach Cloud Firestore backend. "+t+`
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(X(n),this.Vr=!1):T("OnlineStateTracker",n)},e.prototype.kr=function(){this.Pr!==null&&(this.Pr.cancel(),this.Pr=null)},e}(),$d=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(s){n.enqueueAndForget(function(){return m(o,void 0,void 0,function(){return v(this,function(u){switch(u.label){case 0:return oe(this)?(T("RemoteStore","Restarting streams for network reachability change."),[4,function(a){return m(this,void 0,void 0,function(){var c;return v(this,function(h){switch(h.label){case 0:return(c=_(a)).Or.add(4),[4,cn(c)];case 1:return h.sent(),c.Br.set("Unknown"),c.Or.delete(4),[4,Zn(c)];case 2:return h.sent(),[2]}})})}(this)]):[3,2];case 1:u.sent(),u.label=2;case 2:return[2]}})})})}),this.Br=new Qd(n,r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(e){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:if(!oe(e))return[3,4];t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function cn(e){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function ii(e,t){var n=_(e);n.$r.has(t.targetId)||(n.$r.set(t.targetId,t),zo(n)?Ho(n):ln(n).er()&&$o(n,t))}function tr(e,t){var n=_(e),r=ln(n);n.$r.delete(t),r.er()&&Nc(n,t),n.$r.size===0&&(r.er()?r.ir():oe(n)&&n.Br.set("Unknown"))}function $o(e,t){e.qr.U(t.targetId),ln(e).mr(t)}function Nc(e,t){e.qr.U(t),ln(e).yr(t)}function Ho(e){e.qr=new Kf({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),ln(e).start(),e.Br.Sr()}function zo(e){return oe(e)&&!ln(e).tr()&&e.$r.size>0}function oe(e){return _(e).Or.size===0}function Dc(e){e.qr=void 0}function Hd(e){return m(this,void 0,void 0,function(){return v(this,function(t){return e.$r.forEach(function(n,r){$o(e,n)}),[2]})})}function zd(e,t){return m(this,void 0,void 0,function(){return v(this,function(n){return Dc(e),zo(e)?(e.Br.Nr(t),Ho(e)):e.Br.set("Unknown"),[2]})})}function Wd(e,t,n){return m(this,void 0,void 0,function(){var r,i,o;return v(this,function(s){switch(s.label){case 0:if(e.Br.set("Online"),!(t instanceof Sa&&t.state===2&&t.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(u,a){return m(this,void 0,void 0,function(){var c,h,l,f;return v(this,function(d){switch(d.label){case 0:c=a.cause,h=0,l=a.targetIds,d.label=1;case 1:return h<l.length?(f=l[h],u.$r.has(f)?[4,u.remoteSyncer.rejectListen(f,c)]:[3,3]):[3,5];case 2:d.sent(),u.$r.delete(f),u.qr.removeTarget(f),d.label=3;case 3:d.label=4;case 4:return h++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),T("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),[4,oi(e,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof zr?e.qr.X(t):t instanceof _a?e.qr.rt(t):e.qr.et(t),n.isEqual(O.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,gc(e.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(u,a){var c=u.qr.ut(a);return c.targetChanges.forEach(function(h,l){if(h.resumeToken.approximateByteSize()>0){var f=u.$r.get(l);f&&u.$r.set(l,f.withResumeToken(h.resumeToken,a))}}),c.targetMismatches.forEach(function(h){var l=u.$r.get(h);if(l){u.$r.set(h,l.withResumeToken(bt.EMPTY_BYTE_STRING,l.snapshotVersion)),Nc(u,h);var f=new Yr(l.target,h,1,l.sequenceNumber);$o(u,f)}}),u.remoteSyncer.applyRemoteEvent(c)}(e,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return T("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,oi(e,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function oi(e,t,n){return m(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:if(!_e(t))throw t;return e.Or.add(1),[4,cn(e)];case 1:return i.sent(),e.Br.set("Offline"),n||(n=function(){return gc(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return v(this,function(o){switch(o.label){case 0:return T("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return o.sent(),e.Or.delete(1),[4,Zn(e)];case 2:return o.sent(),[2]}})})}),[2]}})})}function Cc(e,t){return t().catch(function(n){return oi(e,n,t)})}function hn(e){return m(this,void 0,void 0,function(){var t,n,r,i,o;return v(this,function(s){switch(s.label){case 0:t=_(e),n=se(t),r=t.Fr.length>0?t.Fr[t.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(u){return oe(u)&&u.Fr.length<10}(t))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Sd(t.localStore,r)];case 3:return(i=s.sent())===null?(t.Fr.length===0&&n.ir(),[3,7]):(r=i.batchId,function(u,a){u.Fr.push(a);var c=se(u);c.er()&&c.pr&&c.Er(a.mutations)}(t,i),[3,6]);case 4:return o=s.sent(),[4,oi(t,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Rc(t)&&kc(t),[2]}})})}function Rc(e){return oe(e)&&!se(e).tr()&&e.Fr.length>0}function kc(e){se(e).start()}function Yd(e){return m(this,void 0,void 0,function(){return v(this,function(t){return se(e).Ar(),[2]})})}function Xd(e){return m(this,void 0,void 0,function(){var t,n,r,i;return v(this,function(o){for(t=se(e),n=0,r=e.Fr;n<r.length;n++)i=r[n],t.Er(i.mutations);return[2]})})}function Jd(e,t,n){return m(this,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return r=e.Fr.shift(),i=sd.from(r,t,n),[4,Cc(e,function(){return e.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,hn(e)];case 2:return o.sent(),[2]}})})}function Zd(e,t){return m(this,void 0,void 0,function(){return v(this,function(n){switch(n.label){case 0:return t&&se(e).pr?[4,function(r,i){return m(this,void 0,void 0,function(){var o,s;return v(this,function(u){switch(u.label){case 0:return ba(s=i.code)&&s!==g.ABORTED?(o=r.Fr.shift(),se(r).sr(),[4,Cc(r,function(){return r.remoteSyncer.rejectFailedWrite(o.batchId,i)})]):[3,3];case 1:return u.sent(),[4,hn(r)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Rc(e)&&kc(e),[2]}})})}function Wo(e,t){return m(this,void 0,void 0,function(){var n;return v(this,function(r){switch(r.label){case 0:return n=_(e),t?(n.Or.delete(2),[4,Zn(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return t?[3,4]:(n.Or.add(2),[4,cn(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function ln(e){var t=this;return e.Ur||(e.Ur=function(n,r,i){var o=_(n);return o.br(),new jd(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:Hd.bind(null,e),Ri:zd.bind(null,e),_r:Wd.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return n?(e.Ur.sr(),zo(e)?Ho(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:r.sent(),Dc(e),r.label=3;case 3:return[2]}})})})),e.Ur}function se(e){var t=this;return e.Kr||(e.Kr=function(n,r,i){var o=_(n);return o.br(),new Kd(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:Yd.bind(null,e),Ri:Zd.bind(null,e),Ir:Xd.bind(null,e),Tr:Jd.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return n?(e.Kr.sr(),[4,hn(e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.Kr.stop()];case 3:r.sent(),e.Fr.length>0&&(T("RemoteStore","Stopping write stream with "+e.Fr.length+" pending writes"),e.Fr=[]),r.label=4;case 4:return[2]}})})})),e.Kr}var tp=function(){function e(t,n,r,i,o){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(s){})}return e.createAndSchedule=function(t,n,r,i,o){var s=new e(t,n,Date.now()+r,i,o);return s.start(r),s},e.prototype.start=function(t){var n=this;this.timerHandle=setTimeout(function(){return n.handleDelayElapsed()},t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return t.timerHandle!==null?(t.clearTimeout(),t.op().then(function(n){return t.deferred.resolve(n)})):Promise.resolve()})},e.prototype.clearTimeout=function(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function fn(e,t){if(X("AsyncQueue",t+": "+e),_e(e))return new w(g.UNAVAILABLE,t+": "+e);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xc=function(){function e(t){this.comparator=t?function(n,r){return t(n,r)||N.comparator(n.key,r.key)}:function(n,r){return N.comparator(n.key,r.key)},this.keyedMap=No(),this.sortedSet=new pt(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return this.keyedMap.get(t)!=null},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.add=function(t){var n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))},e.prototype.delete=function(t){var n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach(function(n){t.push(n.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`},e.prototype.copy=function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r},e}(),Oc=function(){function e(){this.Qr=new pt(N.comparator)}return e.prototype.track=function(t){var n=t.doc.key,r=this.Qr.get(n);r?t.type!==0&&r.type===3?this.Qr=this.Qr.insert(n,t):t.type===3&&r.type!==1?this.Qr=this.Qr.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.Qr=this.Qr.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.Qr=this.Qr.remove(n):t.type===1&&r.type===2?this.Qr=this.Qr.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):A():this.Qr=this.Qr.insert(n,t)},e.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(n,r){t.push(r)}),t},e}(),si=function(){function e(t,n,r,i,o,s,u,a){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=u,this.excludesMetadataChanges=a}return e.fromInitialDocuments=function(t,n,r,i){var o=[];return n.forEach(function(s){o.push({type:0,doc:s})}),new e(t,n,xc.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Bn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0},e}(),ep=function(){this.Wr=void 0,this.listeners=[]},np=function(){this.queries=new sn(function(e){return oa(e)},Bn),this.onlineState="Unknown",this.Gr=new Set};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yo(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u,a;return v(this,function(c){switch(c.label){case 0:if(n=_(e),r=t.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new ep),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return u=c.sent(),a=fn(u,"Initialization of query '"+_o(t.query)+"' failed"),[2,void t.onError(a)];case 4:return n.queries.set(r,o),o.listeners.push(t),t.zr(n.onlineState),o.Wr&&t.Hr(o.Wr)&&Jo(n),[2]}})})}function Xo(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return v(this,function(u){return n=_(e),r=t.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(t))>=0&&(o.listeners.splice(s,1),i=o.listeners.length===0),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function rp(e,t){for(var n=_(e),r=!1,i=0,o=t;i<o.length;i++){var s=o[i],u=s.query,a=n.queries.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);a.Wr=s}}r&&Jo(n)}function ip(e,t,n){var r=_(e),i=r.queries.get(t);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(t)}function Jo(e){e.Gr.forEach(function(t){t.next()})}var Zo=function(){function e(t,n,r){this.query=t,this.Jr=n,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=r||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var n=[],r=0,i=t.docChanges;r<i.length;r++){var o=i[r];o.type!==3&&n.push(o)}t=new si(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var s=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),s=!0):this.eo(t,this.onlineState)&&(this.no(t),s=!0),this.Xr=t,s},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var n=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),n=!0),n},e.prototype.eo=function(t,n){if(!t.fromCache)return!0;var r=n!=="Offline";return!(this.options.so&&r||t.docs.isEmpty()&&n!=="Offline")},e.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var n=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0},e.prototype.no=function(t){t=si.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e}(),op=function(){function e(t,n){this.payload=t,this.byteLength=n}return e.prototype.io=function(){return"metadata"in this.payload},e}(),Lc=function(){function e(t){this.R=t}return e.prototype.qn=function(t){return Ut(this.R,t)},e.prototype.Un=function(t){return t.metadata.exists?La(this.R,t.document,!1):ct.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},e.prototype.Kn=function(t){return nt(t)},e}(),sp=function(){function e(t,n,r){this.ro=t,this.localStore=n,this.R=r,this.queries=[],this.documents=[],this.progress=Pc(t)}return e.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var n=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++n):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++n),n!==this.progress.documentsLoaded?(this.progress.documentsLoaded=n,Object.assign({},this.progress)):null},e.prototype.co=function(t){for(var n=new Map,r=new Lc(this.R),i=0,o=t;i<o.length;i++){var s=o[i];if(s.metadata.queries)for(var u=r.qn(s.metadata.name),a=0,c=s.metadata.queries;a<c.length;a++){var h=c[a],l=(n.get(h)||j()).add(u);n.set(h,l)}}return n},e.prototype.complete=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o;return v(this,function(s){switch(s.label){case 0:return[4,Nd(this.localStore,new Lc(this.R),this.documents,this.ro.id)];case 1:t=s.sent(),n=this.co(this.documents),r=0,i=this.queries,s.label=2;case 2:return r<i.length?(o=i[r],[4,Dd(this.localStore,o,n.get(o.name))]):[3,5];case 3:s.sent(),s.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new bd(Object.assign({},this.progress),t))]}})})},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mc=function(e){this.key=e},Fc=function(e){this.key=e},Vc=function(){function e(t,n){this.query=t,this.uo=n,this.ao=null,this.current=!1,this.ho=j(),this.mutatedKeys=j(),this.lo=sa(t),this.fo=new xc(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,n){var r=this,i=n?n.mo:new Oc,o=n?n.fo:this.fo,s=n?n.mutatedKeys:this.mutatedKeys,u=o,a=!1,c=Br(this.query)&&o.size===this.query.limit?o.last():null,h=jr(this.query)&&o.size===this.query.limit?o.first():null;if(t.inorderTraversal(function(f,d){var p=o.get(f),y=jn(r.query,d)?d:null,E=!!p&&r.mutatedKeys.has(p.key),I=!!y&&(y.hasLocalMutations||r.mutatedKeys.has(y.key)&&y.hasCommittedMutations),D=!1;p&&y?p.data.isEqual(y.data)?E!==I&&(i.track({type:3,doc:y}),D=!0):r.yo(p,y)||(i.track({type:2,doc:y}),D=!0,(c&&r.lo(y,c)>0||h&&r.lo(y,h)<0)&&(a=!0)):!p&&y?(i.track({type:0,doc:y}),D=!0):p&&!y&&(i.track({type:1,doc:p}),D=!0,(c||h)&&(a=!0)),D&&(y?(u=u.add(y),s=I?s.add(f):s.delete(f)):(u=u.delete(f),s=s.delete(f)))}),Br(this.query)||jr(this.query))for(;u.size>this.query.limit;){var l=Br(this.query)?u.last():u.first();u=u.delete(l.key),s=s.delete(l.key),i.track({type:1,doc:l})}return{fo:u,mo:i,Nn:a,mutatedKeys:s}},e.prototype.yo=function(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations},e.prototype.applyChanges=function(t,n,r){var i=this,o=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var s=t.mo.jr();s.sort(function(h,l){return function(f,d){var p=function(y){switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return A()}};return p(f)-p(d)}(h.type,l.type)||i.lo(h.doc,l.doc)}),this.po(r);var u=n?this.Eo():[],a=this.ho.size===0&&this.current?1:0,c=a!==this.ao;return this.ao=a,s.length!==0||c?{snapshot:new si(this.query,t.fo,o,s,t.mutatedKeys,a===0,c,!1),To:u}:{To:u}},e.prototype.zr=function(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Oc,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var n=this;t&&(t.addedDocuments.forEach(function(r){return n.uo=n.uo.add(r)}),t.modifiedDocuments.forEach(function(r){}),t.removedDocuments.forEach(function(r){return n.uo=n.uo.delete(r)}),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var n=this.ho;this.ho=j(),this.fo.forEach(function(i){t.Io(i.key)&&(t.ho=t.ho.add(i.key))});var r=[];return n.forEach(function(i){t.ho.has(i)||r.push(new Fc(i))}),this.ho.forEach(function(i){n.has(i)||r.push(new Mc(i))}),r},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=j();var n=this._o(t.documents);return this.applyChanges(n,!0)},e.prototype.Ro=function(){return si.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,this.ao===0)},e}(),up=function(e,t,n){this.query=e,this.targetId=t,this.view=n},ap=function(e){this.key=e,this.bo=!1},cp=function(){function e(t,n,r,i,o,s){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.vo={},this.Po=new sn(function(u){return oa(u)},Bn),this.Vo=new Map,this.So=new Set,this.Do=new pt(N.comparator),this.Co=new Map,this.No=new qo,this.xo={},this.ko=new Map,this.Fo=Jr.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return this.$o===!0},enumerable:!1,configurable:!0}),e}();function hp(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u;return v(this,function(a){switch(a.label){case 0:return n=os(e),(o=n.Po.get(t))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,un(n.localStore,xt(t))];case 2:return s=a.sent(),u=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,ts(n,t,r,u==="current")];case 3:i=a.sent(),n.isPrimaryClient&&ii(n.remoteStore,s),a.label=4;case 4:return[2,i]}})})}function ts(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s,u,a,c;return v(this,function(h){switch(h.label){case 0:return e.Oo=function(l,f,d){return function(p,y,E,I){return m(this,void 0,void 0,function(){var D,C,L;return v(this,function(M){switch(M.label){case 0:return D=y.view._o(E),D.Nn?[4,ni(p.localStore,y.query,!1).then(function(B){var ot=B.documents;return y.view._o(ot,D)})]:[3,2];case 1:D=M.sent(),M.label=2;case 2:return C=I&&I.targetChanges.get(y.targetId),L=y.view.applyChanges(D,p.isPrimaryClient,C),[2,(rs(p,y.targetId,L.To),L.snapshot)]}})})}(e,l,f,d)},[4,ni(e.localStore,t,!0)];case 1:return i=h.sent(),o=new Vc(t,i.Bn),s=o._o(i.documents),u=Co.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline"),a=o.applyChanges(s,e.isPrimaryClient,u),rs(e,n,a.To),c=new up(t,n,o),[2,(e.Po.set(t,c),e.Vo.has(n)?e.Vo.get(n).push(t):e.Vo.set(n,[t]),a.snapshot)]}})})}function lp(e,t){return m(this,void 0,void 0,function(){var n,r,i;return v(this,function(o){switch(o.label){case 0:return n=_(e),r=n.Po.get(t),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(s){return!Bn(s,t)})),void n.Po.delete(t))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,an(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),tr(n.remoteStore,r.targetId),dn(n,r.targetId)}).catch(Ae)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return dn(n,r.targetId),[4,an(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function fp(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return v(this,function(u){switch(u.label){case 0:r=ss(e),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,function(a,c){var h,l=_(a),f=Tt.now(),d=c.reduce(function(p,y){return p.add(y.key)},j());return l.persistence.runTransaction("Locally write mutations","readwrite",function(p){return l.Mn.pn(p,d).next(function(y){h=y;for(var E=[],I=0,D=c;I<D.length;I++){var C=D[I],L=Mf(C,h.get(C.key));L!=null&&E.push(new Zt(C.key,L,Ju(L.value.mapValue),dt.exists(!0)))}return l._n.addMutationBatch(p,f,E,c)})}).then(function(p){return p.applyToLocalDocumentSet(h),{batchId:p.batchId,changes:h}})}(r.localStore,t)];case 2:return i=u.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(a,c,h){var l=a.xo[a.currentUser.toKey()];l||(l=new pt(P)),l=l.insert(c,h),a.xo[a.currentUser.toKey()]=l}(r,i.batchId,n),[4,zt(r,i.changes)];case 3:return u.sent(),[4,hn(r.remoteStore)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=fn(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Uc(e,t){return m(this,void 0,void 0,function(){var n,r;return v(this,function(i){switch(i.label){case 0:n=_(e),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,_d(n.localStore,t)];case 2:return r=i.sent(),t.targetChanges.forEach(function(o,s){var u=n.Co.get(s);u&&(k(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?u.bo=!0:o.modifiedDocuments.size>0?k(u.bo):o.removedDocuments.size>0&&(k(u.bo),u.bo=!1))}),[4,zt(n,r,t)];case 3:return i.sent(),[3,6];case 4:return[4,Ae(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function qc(e,t,n){var r=_(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){var i=[];r.Po.forEach(function(o,s){var u=s.view.zr(t);u.snapshot&&i.push(u.snapshot)}),function(o,s){var u=_(o);u.onlineState=s;var a=!1;u.queries.forEach(function(c,h){for(var l=0,f=h.listeners;l<f.length;l++)f[l].zr(s)&&(a=!0)}),a&&Jo(u)}(r.eventManager,t),i.length&&r.vo._r(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function dp(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a;return v(this,function(c){switch(c.label){case 0:return(r=_(e)).sharedClientState.updateQueryState(t,"rejected",n),i=r.Co.get(t),(o=i&&i.key)?(s=(s=new pt(N.comparator)).insert(o,ct.newNoDocument(o,O.min())),u=j().add(o),a=new Do(O.min(),new Map,new tt(P),s,u),[4,Uc(r,a)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(t),is(r),[3,4];case 2:return[4,an(r.localStore,t,!1).then(function(){return dn(r,t,n)}).catch(Ae)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function pp(e,t){return m(this,void 0,void 0,function(){var n,r,i;return v(this,function(o){switch(o.label){case 0:n=_(e),r=t.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Id(n.localStore,t)];case 2:return i=o.sent(),ns(n,r,null),es(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,zt(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ae(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function gp(e,t,n){return m(this,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:r=_(e),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(s,u){var a=_(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",function(c){var h;return a._n.lookupMutationBatch(c,u).next(function(l){return k(l!==null),h=l.keys(),a._n.removeMutationBatch(c,l)}).next(function(){return a._n.performConsistencyCheck(c)}).next(function(){return a.Mn.pn(c,h)})})}(r.localStore,t)];case 2:return i=o.sent(),ns(r,t,n),es(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),[4,zt(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ae(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function yp(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return v(this,function(u){switch(u.label){case 0:oe((n=_(e)).remoteStore)||T("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,function(a){var c=_(a);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(h){return c._n.getHighestUnacknowledgedBatchId(h)})}(n.localStore)];case 2:return(r=u.sent())===-1?[2,void t.resolve()]:((i=n.ko.get(r)||[]).push(t),n.ko.set(r,i),[3,4]);case 3:return o=u.sent(),s=fn(o,"Initialization of waitForPendingWrites() operation failed"),t.reject(s),[3,4];case 4:return[2]}})})}function es(e,t){(e.ko.get(t)||[]).forEach(function(n){n.resolve()}),e.ko.delete(t)}function ns(e,t,n){var r=_(e),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(t);o&&(n?o.reject(n):o.resolve(),i=i.remove(t)),r.xo[r.currentUser.toKey()]=i}}function dn(e,t,n){n===void 0&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(s){e.No.containsKey(s)||Bc(e,s)})}function Bc(e,t){e.So.delete(t.path.canonicalString());var n=e.Do.get(t);n!==null&&(tr(e.remoteStore,n),e.Do=e.Do.remove(t),e.Co.delete(n),is(e))}function rs(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Mc?(e.No.addReference(o.key,t),vp(e,o)):o instanceof Fc?(T("SyncEngine","Document no longer in limbo: "+o.key),e.No.removeReference(o.key,t),e.No.containsKey(o.key)||Bc(e,o.key)):A()}}function vp(e,t){var n=t.key,r=n.path.canonicalString();e.Do.get(n)||e.So.has(r)||(T("SyncEngine","New document in limbo: "+n),e.So.add(r),is(e))}function is(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var n=new N(V.fromString(t)),r=e.Fo.next();e.Co.set(r,new ap(n)),e.Do=e.Do.insert(n,r),ii(e.remoteStore,new Yr(xt(Qe(n.path)),r,2,Nt.o))}}function zt(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return v(this,function(u){switch(u.label){case 0:return r=_(e),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(a,c){s.push(r.Oo(c,t,n).then(function(h){if(h){r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,h.fromCache?"not-current":"current"),i.push(h);var l=Ed.Pn(c.targetId,h);o.push(l)}}))}),[4,Promise.all(s)]);case 1:return u.sent(),r.vo._r(i),[4,function(a,c){return m(this,void 0,void 0,function(){var h,l,f,d,p,y,E,I,D;return v(this,function(C){switch(C.label){case 0:h=_(a),C.label=1;case 1:return C.trys.push([1,3,,4]),[4,h.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(L){return b.forEach(c,function(M){return b.forEach(M.bn,function(B){return h.persistence.referenceDelegate.addReference(L,M.targetId,B)}).next(function(){return b.forEach(M.vn,function(B){return h.persistence.referenceDelegate.removeReference(L,M.targetId,B)})})})})];case 2:return C.sent(),[3,4];case 3:if(!_e(l=C.sent()))throw l;return T("LocalStore","Failed to update sequence numbers: "+l),[3,4];case 4:for(f=0,d=c;f<d.length;f++)p=d[f],y=p.targetId,p.fromCache||(E=h.kn.get(y),I=E.snapshotVersion,D=E.withLastLimboFreeSnapshotVersion(I),h.kn=h.kn.insert(y,D));return[2]}})})}(r.localStore,o)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}function mp(e,t){return m(this,void 0,void 0,function(){var n,r;return v(this,function(i){switch(i.label){case 0:return(n=_(e)).currentUser.isEqual(t)?[3,3]:(T("SyncEngine","User change. New user:",t.toKey()),[4,pc(n.localStore,t)]);case 1:return r=i.sent(),n.currentUser=t,function(o,s){o.ko.forEach(function(u){u.forEach(function(a){a.reject(new w(g.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.ko.clear()}(n),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),[4,zt(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function wp(e,t){var n=_(e),r=n.Co.get(t);if(r&&r.bo)return j().add(r.key);var i=j(),o=n.Vo.get(t);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Po.get(a);i=i.unionWith(c.view.wo)}return i}function bp(e,t){return m(this,void 0,void 0,function(){var n,r,i;return v(this,function(o){switch(o.label){case 0:return[4,ni((n=_(e)).localStore,t.query,!0)];case 1:return r=o.sent(),i=t.view.Ao(r),[2,(n.isPrimaryClient&&rs(n,t.targetId,i.To),i)]}})})}function Ep(e){return m(this,void 0,void 0,function(){var t;return v(this,function(n){return[2,mc((t=_(e)).localStore).then(function(r){return zt(t,r)})]})})}function Tp(e,t,n,r){return m(this,void 0,void 0,function(){var i,o;return v(this,function(s){switch(s.label){case 0:return[4,function(u,a){var c=_(u),h=_(c._n);return c.persistence.runTransaction("Lookup mutation documents","readonly",function(l){return h.jt(l,a).next(function(f){return f?c.Mn.pn(l,f):b.resolve(null)})})}((i=_(e)).localStore,t)];case 1:return(o=s.sent())===null?[3,6]:n!=="pending"?[3,3]:[4,hn(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:n==="acknowledged"||n==="rejected"?(ns(i,t,r||null),es(i,t),function(u,a){_(_(u)._n).Gt(a)}(i.localStore,t)):A(),s.label=4;case 4:return[4,zt(i,o)];case 5:return s.sent(),[3,7];case 6:T("SyncEngine","Cannot apply mutation batch with id: "+t),s.label=7;case 7:return[2]}})})}function Ip(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u,a,c;return v(this,function(h){switch(h.label){case 0:return os(n=_(e)),ss(n),t!==!0||n.$o===!0?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,jc(n,r.toArray())]);case 1:return i=h.sent(),n.$o=!0,[4,Wo(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)u=s[o],ii(n.remoteStore,u);return[3,7];case 3:return t!==!1||n.$o===!1?[3,7]:(a=[],c=Promise.resolve(),n.Vo.forEach(function(l,f){n.sharedClientState.isLocalQueryTarget(f)?a.push(f):c=c.then(function(){return dn(n,f),an(n.localStore,f,!0)}),tr(n.remoteStore,f)}),[4,c]);case 4:return h.sent(),[4,jc(n,a)];case 5:return h.sent(),function(l){var f=_(l);f.Co.forEach(function(d,p){tr(f.remoteStore,p)}),f.No.ts(),f.Co=new Map,f.Do=new pt(N.comparator)}(n),n.$o=!1,[4,Wo(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}})})}function jc(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,l,f,d,p,y,E;return v(this,function(I){switch(I.label){case 0:r=_(e),i=[],o=[],s=0,u=t,I.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=r.Vo.get(a))&&h.length!==0?[4,un(r.localStore,xt(h[0]))]:[3,7]):[3,13];case 2:c=I.sent(),l=0,f=h,I.label=3;case 3:return l<f.length?(d=f[l],p=r.Po.get(d),[4,bp(r,p)]):[3,6];case 4:(y=I.sent()).snapshot&&o.push(y.snapshot),I.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,vc(r.localStore,a)];case 8:return E=I.sent(),[4,un(r.localStore,E)];case 9:return c=I.sent(),[4,ts(r,Kc(E),a,!1)];case 10:I.sent(),I.label=11;case 11:i.push(c),I.label=12;case 12:return s++,[3,1];case 13:return[2,(r.vo._r(o),i)]}})})}function Kc(e){return ra(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function _p(e){var t=_(e);return _(_(t.localStore).persistence).fn()}function Sp(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s;return v(this,function(u){switch(u.label){case 0:return(i=_(e)).$o?(T("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(t))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,mc(i.localStore)];case 3:return o=u.sent(),s=Do.createSynthesizedRemoteEventForCurrentChange(t,n==="current"),[4,zt(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,an(i.localStore,t,!0)];case 6:return u.sent(),dn(i,t,r),[3,8];case 7:A(),u.label=8;case 8:return[2]}})})}function Ap(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,l,f;return v(this,function(d){switch(d.label){case 0:if(!(r=os(e)).$o)return[3,10];i=0,o=t,d.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(T("SyncEngine","Adding an already active target "+s),[3,5]):[4,vc(r.localStore,s)]):[3,6];case 2:return u=d.sent(),[4,un(r.localStore,u)];case 3:return a=d.sent(),[4,ts(r,Kc(u),a.targetId,!1)];case 4:d.sent(),ii(r.remoteStore,a),d.label=5;case 5:return i++,[3,1];case 6:c=function(p){return v(this,function(y){switch(y.label){case 0:return r.Vo.has(p)?[4,an(r.localStore,p,!1).then(function(){tr(r.remoteStore,p),dn(r,p)}).catch(Ae)]:[3,2];case 1:y.sent(),y.label=2;case 2:return[2]}})},h=0,l=n,d.label=7;case 7:return h<l.length?(f=l[h],[5,c(f)]):[3,10];case 8:d.sent(),d.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function os(e){var t=_(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Uc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=wp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=dp.bind(null,t),t.vo._r=rp.bind(null,t.eventManager),t.vo.Mo=ip.bind(null,t.eventManager),t}function ss(e){var t=_(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=pp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=gp.bind(null,t),t}function Np(e,t,n){var r=_(e);(function(i,o,s){return m(this,void 0,void 0,function(){var u,a,c,h,l,f;return v(this,function(d){switch(d.label){case 0:return d.trys.push([0,14,,15]),[4,o.getMetadata()];case 1:return u=d.sent(),[4,function(p,y){var E=_(p),I=nt(y.createTime);return E.persistence.runTransaction("hasNewerBundle","readonly",function(D){return E.Ke.getBundleMetadata(D,y.id)}).then(function(D){return!!D&&D.createTime.compareTo(I)>=0})}(i.localStore,u)];case 2:return d.sent()?[4,o.close()]:[3,4];case 3:return[2,(d.sent(),void s._completeWith(function(p){return{taskState:"Success",documentsLoaded:p.totalDocuments,bytesLoaded:p.totalBytes,totalDocuments:p.totalDocuments,totalBytes:p.totalBytes}}(u)))];case 4:return s._updateProgress(Pc(u)),a=new sp(u,i.localStore,o.R),[4,o.Lo()];case 5:c=d.sent(),d.label=6;case 6:return c?[4,a.oo(c)]:[3,10];case 7:return(h=d.sent())&&s._updateProgress(h),[4,o.Lo()];case 8:c=d.sent(),d.label=9;case 9:return[3,6];case 10:return[4,a.complete()];case 11:return l=d.sent(),[4,zt(i,l.wn,void 0)];case 12:return d.sent(),[4,function(p,y){var E=_(p);return E.persistence.runTransaction("Save bundle","readwrite",function(I){return E.Ke.saveBundleMetadata(I,y)})}(i.localStore,u)];case 13:return d.sent(),s._completeWith(l.progress),[3,15];case 14:return Pn("SyncEngine","Loading bundle failed with "+(f=d.sent())),s._failWith(f),[3,15];case 15:return[2]}})})})(r,t,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var Gc=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return m(this,void 0,void 0,function(){return v(this,function(n){switch(n.label){case 0:return this.R=Jn(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return n.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},e.prototype.Uo=function(t){return null},e.prototype.Ko=function(t){return dc(this.persistence,new fc,t.initialUser,this.R)},e.prototype.qo=function(t){return new Ld(Md.bs,this.R)},e.prototype.Bo=function(t){return new Ic},e.prototype.terminate=function(){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},e}(),Qc=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).Qo=n,o.cacheSizeBytes=r,o.forceOwnership=i,o.synchronizeTabs=!1,o}return R(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return i.sent(),[4,Ad(this.localStore)];case 2:return i.sent(),[4,this.Qo.initialize(this,n)];case 3:return i.sent(),[4,ss(this.Qo.syncEngine)];case 4:return i.sent(),[4,hn(this.Qo.remoteStore)];case 5:return i.sent(),[4,this.persistence.He(function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()})];case 6:return i.sent(),[2]}})})},t.prototype.Ko=function(n){return dc(this.persistence,new fc,n.initialUser,this.R)},t.prototype.Uo=function(n){var r=this.persistence.referenceDelegate.garbageCollector;return new dd(r,n.asyncQueue)},t.prototype.qo=function(n){var r=Uo(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Bt.withCacheSize(this.cacheSizeBytes):Bt.DEFAULT;return new wd(this.synchronizeTabs,r,n.clientId,i,n.asyncQueue,Sc(),ri(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(n){return new Ic},t}(Gc),Dp=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r,!1)||this).Qo=n,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return R(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r,i=this;return v(this,function(o){switch(o.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Qo.syncEngine,this.sharedClientState instanceof Go?(this.sharedClientState.syncEngine={ui:Tp.bind(null,r),ai:Sp.bind(null,r),hi:Ap.bind(null,r),fn:_p.bind(null,r),ci:Ep.bind(null,r)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(s){return m(i,void 0,void 0,function(){return v(this,function(u){switch(u.label){case 0:return[4,Ip(this.Qo.syncEngine,s)];case 1:return u.sent(),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):s||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},t.prototype.Bo=function(n){var r=Sc();if(!Go.yt(r))throw new w(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var i=Uo(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey);return new Go(r,n.asyncQueue,i,n.clientId,n.initialUser)},t}(Qc),us=function(){function e(){}return e.prototype.initialize=function(t,n){return m(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(o){return qc(r.syncEngine,o,1)},this.remoteStore.remoteSyncer.handleCredentialChange=mp.bind(null,this.syncEngine),[4,Wo(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(t){return new np},e.prototype.createDatastore=function(t){var n,r=Jn(t.databaseInfo.databaseId),i=(n=t.databaseInfo,new Bd(n));return function(o,s,u){return new Gd(o,s,u)}(t.credentials,i,r)},e.prototype.createRemoteStore=function(t){var n,r,i,o,s,u=this;return n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(a){return qc(u.syncEngine,a,0)},s=_c.yt()?new _c:new Vd,new $d(n,r,i,o,s)},e.prototype.createSyncEngine=function(t,n){return function(r,i,o,s,u,a,c){var h=new cp(r,i,o,s,u,a);return c&&(h.$o=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)},e.prototype.terminate=function(){return function(t){return m(this,void 0,void 0,function(){var n;return v(this,function(r){switch(r.label){case 0:return n=_(t),T("RemoteStore","RemoteStore shutting down."),n.Or.add(5),[4,cn(n)];case 1:return r.sent(),n.Lr.shutdown(),n.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $c(e,t){t===void 0&&(t=10240);var n=0;return{read:function(){return m(this,void 0,void 0,function(){var r;return v(this,function(i){return n<e.byteLength?(r={value:e.slice(n,n+t),done:!1},[2,(n+=t,r)]):[2,{done:!0}]})})},cancel:function(){return m(this,void 0,void 0,function(){return v(this,function(r){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ui=function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,n){var r=this;this.muted||setTimeout(function(){r.muted||t(n)},0)},e}(),Cp=function(){function e(t,n){var r=this;this.Go=t,this.R=n,this.metadata=new yt,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(i){i&&i.io()?r.metadata.resolve(i.payload.metadata):r.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(i==null?void 0:i.payload)))},function(i){return r.metadata.reject(i)})}return e.prototype.close=function(){return this.Go.cancel()},e.prototype.getMetadata=function(){return m(this,void 0,void 0,function(){return v(this,function(t){return[2,this.metadata.promise]})})},e.prototype.Lo=function(){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},e.prototype.Ho=function(){return m(this,void 0,void 0,function(){var t,n,r,i;return v(this,function(o){switch(o.label){case 0:return[4,this.Jo()];case 1:return(t=o.sent())===null?[2,null]:(n=this.zo.decode(t),r=Number(n),isNaN(r)&&this.Yo("length string ("+n+") is not valid number"),[4,this.Xo(r)]);case 2:return i=o.sent(),[2,new op(JSON.parse(i),t.length+r)]}})})},e.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},e.prototype.Jo=function(){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(r.sent())return[3,3];r.label=2;case 2:return[3,0];case 3:return this.buffer.length===0?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),n)])}})})},e.prototype.Xo=function(t){return m(this,void 0,void 0,function(){var n;return v(this,function(r){switch(r.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:r.sent()&&this.Yo("Reached the end of bundle when more is expected."),r.label=2;case 2:return[3,0];case 3:return n=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),n)]}})})},e.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},e.prototype.tc=function(){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:return[4,this.Go.read()];case 1:return(t=r.sent()).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),[2,t.done]}})})},e}(),Rp=function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return m(this,void 0,void 0,function(){var n,r=this;return v(this,function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new w(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(o,s){return m(this,void 0,void 0,function(){var u,a,c,h,l,f;return v(this,function(d){switch(d.label){case 0:return u=_(o),a=zn(u.R)+"/documents",c={documents:s.map(function(p){return Hn(u.R,p)})},[4,u.$i("BatchGetDocuments",a,c)];case 1:return h=d.sent(),l=new Map,h.forEach(function(p){var y=function(E,I){return"found"in I?function(D,C){k(!!C.found),C.found.name,C.found.updateTime;var L=Ut(D,C.found.name),M=nt(C.found.updateTime),B=new Dt({mapValue:{fields:C.found.fields}});return ct.newFoundDocument(L,M,B)}(E,I):"missing"in I?function(D,C){k(!!C.missing),k(!!C.readTime);var L=Ut(D,C.missing),M=nt(C.readTime);return ct.newNoDocument(L,M)}(E,I):A()}(u.R,p);l.set(y.key.toString(),y)}),f=[],[2,(s.forEach(function(p){var y=l.get(p.toString());k(!!y),f.push(y)}),f)]}})})}(this.datastore,t)];case 1:return[2,((n=i.sent()).forEach(function(o){return r.recordVersion(o)}),n)]}})})},e.prototype.set=function(t,n){this.write(n.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,n){try{this.write(n.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new Qn(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return m(this,void 0,void 0,function(){var t,n=this;return v(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(i){t.delete(i.key.toString())}),t.forEach(function(i,o){var s=N.fromPath(o);n.mutations.push(new Ao(s,n.precondition(s)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var s,u,a;return v(this,function(c){switch(c.label){case 0:return s=_(i),u=zn(s.R)+"/documents",a={writes:o.map(function(h){return Wr(s.R,h)})},[4,s.Ni("Commit",u,a)];case 1:return c.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return r.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(t){var n;if(t.isFoundDocument())n=t.version;else{if(!t.isNoDocument())throw A();n=O.min()}var r=this.readVersions.get(t.key.toString());if(r){if(!n.isEqual(r))throw new w(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),n)},e.prototype.precondition=function(t){var n=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&n?dt.updateTime(n):dt.none()},e.prototype.preconditionForUpdate=function(t){var n=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&n){if(n.isEqual(O.min()))throw new w(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return dt.updateTime(n)}return dt.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e}(),kp=function(){function e(t,n,r,i){this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.ec=5,this.Zi=new Qo(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.ec-=1,this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji(function(){return m(t,void 0,void 0,function(){var n,r,i=this;return v(this,function(o){return n=new Rp(this.datastore),(r=this.sc(n))&&r.then(function(s){i.asyncQueue.enqueueAndForget(function(){return n.commit().then(function(){i.deferred.resolve(s)}).catch(function(u){i.ic(u)})})}).catch(function(s){i.ic(s)}),[2]})})})},e.prototype.sc=function(t){try{var n=this.updateFunction(t);return!we(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(r){return this.deferred.reject(r),null}},e.prototype.ic=function(t){var n=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return n.nc(),Promise.resolve()})):this.deferred.reject(t)},e.prototype.rc=function(t){if(t.name==="FirebaseError"){var n=t.code;return n==="aborted"||n==="failed-precondition"||!ba(n)}return!1},e}(),xp=function(){function e(t,n,r){var i=this;this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=lt.UNAUTHENTICATED,this.clientId=ju.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(n,function(o){return m(i,void 0,void 0,function(){return v(this,function(s){switch(s.label){case 0:return T("FirestoreClient","Received user=",o.uid),[4,this.credentialListener(o)];case 1:return s.sent(),this.user=o,[2]}})})})}return e.prototype.getConfiguration=function(){return m(this,void 0,void 0,function(){return v(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new w(g.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return m(t,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:o.sent(),o.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return r=o.sent(),i=fn(r,"Failed to shutdown persistence"),n.reject(i),[3,6];case 6:return[2]}})})}),n.promise},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hc(e,t){return m(this,void 0,void 0,function(){var n,r,i=this;return v(this,function(o){switch(o.label){case 0:return e.asyncQueue.verifyOperationInProgress(),T("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return n=o.sent(),[4,t.initialize(n)];case 2:return o.sent(),r=n.initialUser,e.setCredentialChangeListener(function(s){return m(i,void 0,void 0,function(){return v(this,function(u){switch(u.label){case 0:return r.isEqual(s)?[3,2]:[4,pc(t.localStore,s)];case 1:u.sent(),r=s,u.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function zc(e,t){return m(this,void 0,void 0,function(){var n,r;return v(this,function(i){switch(i.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,as(e)];case 1:return n=i.sent(),T("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return r=i.sent(),[4,t.initialize(n,r)];case 3:return i.sent(),e.setCredentialChangeListener(function(o){return function(s,u){return m(this,void 0,void 0,function(){var a,c;return v(this,function(h){switch(h.label){case 0:return(a=_(s)).asyncQueue.verifyOperationInProgress(),T("RemoteStore","RemoteStore received new credentials"),c=oe(a),a.Or.add(3),[4,cn(a)];case 1:return h.sent(),c&&a.Br.set("Unknown"),[4,a.remoteSyncer.handleCredentialChange(u)];case 2:return h.sent(),a.Or.delete(3),[4,Zn(a)];case 3:return h.sent(),[2]}})})}(t.remoteStore,o)}),e.onlineComponents=t,[2]}})})}function as(e){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(T("FirestoreClient","Using default OfflineComponentProvider"),[4,Hc(e,new Gc)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function ai(e){return m(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(T("FirestoreClient","Using default OnlineComponentProvider"),[4,zc(e,new us)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Wc(e){return as(e).then(function(t){return t.persistence})}function cs(e){return as(e).then(function(t){return t.localStore})}function Yc(e){return ai(e).then(function(t){return t.remoteStore})}function hs(e){return ai(e).then(function(t){return t.syncEngine})}function pn(e){return m(this,void 0,void 0,function(){var t,n;return v(this,function(r){switch(r.label){case 0:return[4,ai(e)];case 1:return t=r.sent(),[2,((n=t.eventManager).onListen=hp.bind(null,t.syncEngine),n.onUnlisten=lp.bind(null,t.syncEngine),n)]}})})}function Xc(e,t,n){var r=this;n===void 0&&(n={});var i=new yt;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return o=function(u,a,c,h,l){var f=new ui({next:function(p){a.enqueueAndForget(function(){return Xo(u,d)});var y=p.docs.has(c);!y&&p.fromCache?l.reject(new w(g.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&h&&h.source==="server"?l.reject(new w(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(p)},error:function(p){return l.reject(p)}}),d=new Zo(Qe(c.path),f,{includeMetadataChanges:!0,so:!0});return Yo(u,d)},[4,pn(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}function Jc(e,t,n){var r=this;n===void 0&&(n={});var i=new yt;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return o=function(u,a,c,h,l){var f=new ui({next:function(p){a.enqueueAndForget(function(){return Xo(u,d)}),p.fromCache&&h.source==="server"?l.reject(new w(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(p)},error:function(p){return l.reject(p)}}),d=new Zo(c,f,{includeMetadataChanges:!0,so:!0});return Yo(u,d)},[4,pn(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}var Op=function(e,t,n,r,i,o,s,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=u},ci=function(){function e(t,n){this.projectId=t,this.database=n||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database==="(default)"},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),Zc=new Map,th=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},eh=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){this.changeListener=n,t.enqueueRetryable(function(){return n(lt.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Lp=function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){var r=this;this.changeListener=n,t.enqueueRetryable(function(){return n(r.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Pp=function(){function e(t){var n=this;this.currentUser=lt.UNAUTHENTICATED,this.oc=new yt,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){n.cc++,n.currentUser=n.ac(),n.oc.resolve(),n.changeListener&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})};var r=function(i){T("FirebaseCredentialsProvider","Auth detected"),n.auth=i,n.auth.addAuthTokenListener(n.uc)};t.onInit(function(i){return r(i)}),setTimeout(function(){if(!n.auth){var i=t.getImmediate({optional:!0});i?r(i):(T("FirebaseCredentialsProvider","Auth not yet detected"),n.oc.resolve())}},0)}return e.prototype.getToken=function(){var t=this,n=this.cc,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(function(i){return t.cc!==n?(T("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):i?(k(typeof i.accessToken=="string"),new th(i.accessToken,t.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t,n){var r=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this.oc.promise];case 1:return i.sent(),[4,n(this.currentUser)];case 2:return i.sent(),this.changeListener=n,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return k(t===null||typeof t=="string"),new lt(t)},e}(),Mp=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r,this.type="FirstParty",this.user=lt.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},n=this.hc.auth.getAuthHeaderValueForFirstParty([]);return n&&(t.Authorization=n),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),e}(),Fp=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r}return e.prototype.getToken=function(){return Promise.resolve(new Mp(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(t,n){t.enqueueRetryable(function(){return n(lt.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(e,t,n){if(!n)throw new w(g.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function fs(e,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new w(g.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function nh(e,t,n,r){if(t===!0&&r===!0)throw new w(g.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function rh(e){if(!N.isDocumentKey(e))throw new w(g.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function ih(e){if(N.isDocumentKey(e))throw new w(g.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function hi(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";var t=function(n){if(n.constructor){var r=/function\s+([^\s(]+)\s*\(/.exec(n.constructor.toString());if(r&&r.length>1)return r[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return typeof e=="function"?"a function":A()}function U(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new w(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=hi(e);throw new w(g.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+n)}return e}function oh(e,t){if(t<=0)throw new w(g.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sh=function(){function e(t){var n;if(t.host===void 0){if(t.ssl!==void 0)throw new w(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new w(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,nh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},e}(),er=function(){function e(t,n){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sh({}),this._settingsFrozen=!1,t instanceof ci?(this._databaseId=t,this._credentials=new eh):(this._app=t,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new w(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ci(r.options.projectId)}(t),this._credentials=new Pp(n))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new w(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return this._terminateTask!==void 0},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new w(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sh(t),t.credentials!==void 0&&(this._credentials=function(n){if(!n)return new eh;switch(n.type){case"gapi":var r=n.client;return k(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Fp(r,n.sessionIndex||"0",n.iamToken||null);case"provider":return n.client;default:throw new w(g.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return t=this,(n=Zc.get(t))&&(T("ComponentProvider","Removing Datastore"),Zc.delete(t),n.terminate()),Promise.resolve();var t,n},e}(),Q=function(){function e(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new ue(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),St=function(){function e(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),ue=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,Qe(i))||this)._path=i,o.type="collection",o}return R(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._path.popLast();return n.isEmpty()?null:new Q(this.firestore,null,new N(n))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(n){return new t(this.firestore,n,this._path)},t}(St);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uh(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=W(e),ls("collection","path",t),e instanceof er)return ih(n=V.fromString.apply(V,z([t],r))),new ue(e,null,n);if(!(e instanceof Q||e instanceof ue))throw new w(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ih(n=V.fromString.apply(V,z([e.path],r)).child(V.fromString(t))),new ue(e.firestore,null,n)}function li(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=W(e),arguments.length===1&&(t=ju.u()),ls("doc","path",t),e instanceof er)return rh(n=V.fromString.apply(V,z([t],r))),new Q(e,null,new N(n));if(!(e instanceof Q||e instanceof ue))throw new w(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return rh(n=e._path.child(V.fromString.apply(V,z([t],r)))),new Q(e.firestore,e instanceof ue?e.converter:null,new N(n))}function ah(e,t){return e=W(e),t=W(t),(e instanceof Q||e instanceof ue)&&(t instanceof Q||t instanceof ue)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function ch(e,t){return e=W(e),t=W(t),e instanceof St&&t instanceof St&&e.firestore===t.firestore&&Bn(e._query,t._query)&&e.converter===t.converter}var Vp=function(){function e(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Qo(this,"async_queue_retry"),this.Ic=function(){var r=ri();r&&T("AsyncQueue","Visibility state changed to "+r.visibilityState),t.Zi.Gi()};var n=ri();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},e.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var n=ri();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Ic)}},e.prototype.enqueue=function(t){var n=this;if(this.Ac(),this._c)return new Promise(function(){});var r=new yt;return this.Rc(function(){return n._c&&n.Ec?Promise.resolve():(t().then(r.resolve,r.reject),r.promise)}).then(function(){return r.promise})},e.prototype.enqueueRetryable=function(t){var n=this;this.enqueueAndForget(function(){return n.wc.push(t),n.bc()})},e.prototype.bc=function(){return m(this,void 0,void 0,function(){var t,n=this;return v(this,function(r){switch(r.label){case 0:if(this.wc.length===0)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return r.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!_e(t=r.sent()))throw t;return T("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return n.bc()}),r.label=5;case 5:return[2]}})})},e.prototype.Rc=function(t){var n=this,r=this.dc.then(function(){return n.gc=!0,t().catch(function(i){throw n.yc=i,n.gc=!1,X("INTERNAL UNHANDLED ERROR: ",function(o){var s=o.message||"";return o.stack&&(s=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),s}(i)),i}).then(function(i){return n.gc=!1,i})});return this.dc=r,r},e.prototype.enqueueAfterDelay=function(t,n,r){var i=this;this.Ac(),this.Tc.indexOf(t)>-1&&(n=0);var o=tp.createAndSchedule(this,t,n,r,function(s){return i.vc(s)});return this.mc.push(o),o},e.prototype.Ac=function(){this.yc&&A()},e.prototype.verifyOperationInProgress=function(){},e.prototype.Pc=function(){return m(this,void 0,void 0,function(){var t;return v(this,function(n){switch(n.label){case 0:return[4,t=this.dc];case 1:n.sent(),n.label=2;case 2:if(t!==this.dc)return[3,0];n.label=3;case 3:return[2]}})})},e.prototype.Vc=function(t){for(var n=0,r=this.mc;n<r.length;n++)if(r[n].timerId===t)return!0;return!1},e.prototype.Sc=function(t){var n=this;return this.Pc().then(function(){n.mc.sort(function(s,u){return s.targetTimeMs-u.targetTimeMs});for(var r=0,i=n.mc;r<i.length;r++){var o=i[r];if(o.skipDelay(),t!=="all"&&o.timerId===t)break}return n.Pc()})},e.prototype.Dc=function(t){this.Tc.push(t)},e.prototype.vc=function(t){var n=this.mc.indexOf(t);this.mc.splice(n,1)},e}();function gn(e){return function(t,n){if(typeof t!="object"||t===null)return!1;for(var r=t,i=0,o=["next","error","complete"];i<o.length;i++){var s=o[i];if(s in r&&typeof r[s]=="function")return!0}return!1}(e)}var Up=function(){function e(){this._progressObserver={},this._taskCompletionResolver=new yt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return e.prototype.onProgress=function(t,n,r){this._progressObserver={next:t,error:n,complete:r}},e.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},e.prototype.then=function(t,n){return this._taskCompletionResolver.promise.then(t,n)},e.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},e.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},e.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},e}(),qp=-1,H=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).type="firestore",i._queue=new Vp,i._persistenceKey="name"in n?n.name:"[DEFAULT]",i}return R(t,e),t.prototype._terminate=function(){return this._firestoreClient||hh(this),this._firestoreClient.terminate()},t}(er);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function it(e){return e._firestoreClient||hh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function hh(e){var t,n=e._freezeSettings(),r=function(i,o,s,u){return new Op(i,o,s,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,u.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new xp(e._credentials,e._queue,r)}function lh(e,t,n){var r=this,i=new yt;return e.asyncQueue.enqueue(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,Hc(e,n)];case 1:return s.sent(),[4,zc(e,t)];case 2:return s.sent(),i.resolve(),[3,4];case 3:if(!function(u){return u.name==="FirebaseError"?u.code===g.FAILED_PRECONDITION||u.code===g.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&u instanceof DOMException)||u.code===22||u.code===20||u.code===11}(o=s.sent()))throw o;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),i.reject(o),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function fh(e){if(e._initialized||e._terminated)throw new w(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jt=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)if(t[r].length===0)throw new w(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Mt(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e}(),Ne=function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(bt.fromBase64String(t))}catch(n){throw new w(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},e.fromUint8Array=function(t){return new e(bt.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e}(),De=function(e){this._methodName=e},fi=function(){function e(t,n){if(!isFinite(t)||t<-90||t>90)throw new w(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new w(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return P(this._lat,t._lat)||P(this._long,t._long)},e}(),Bp=/^__.*__$/,jp=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return this.fieldMask!==null?new Zt(t,this.data,this.fieldMask,n,this.fieldTransforms):new Gn(t,this.data,n,this.fieldTransforms)},e}(),dh=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return new Zt(t,this.data,this.fieldMask,n,this.fieldTransforms)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw A()}}var gh=function(){function e(t,n,r,i,o,s){this.settings=t,this.databaseId=n,this.R=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Cc(),this.fieldTransforms=o||[],this.fieldMask=s||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),e.prototype.xc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.kc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.$c(t),i},e.prototype.Oc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.Cc(),i},e.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},e.prototype.Lc=function(t){return pi(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},e.prototype.contains=function(t){return this.fieldMask.find(function(n){return t.isPrefixOf(n)})!==void 0||this.fieldTransforms.find(function(n){return t.isPrefixOf(n.field)})!==void 0},e.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},e.prototype.$c=function(t){if(t.length===0)throw this.Lc("Document fields must not be empty");if(ph(this.Nc)&&Bp.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},e}(),Kp=function(){function e(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.R=r||Jn(t)}return e.prototype.Uc=function(t,n,r,i){return i===void 0&&(i=!1),new gh({Nc:t,methodName:n,qc:r,path:Mt.emptyPath(),Fc:!1,Bc:i},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function Ce(e){var t=e._freezeSettings(),n=Jn(e._databaseId);return new Kp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function di(e,t,n,r,i,o){o===void 0&&(o={});var s=e.Uc(o.merge||o.mergeFields?2:0,t,n,i);ys("Data must be an object, but it was:",s,r);var u,a,c=mh(r,s);if(o.merge)u=new Be(s.fieldMask),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=vs(t,f[l],n);if(!s.contains(d))throw new w(g.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");bh(h,d)||h.push(d)}u=new Be(h),a=s.fieldTransforms.filter(function(p){return u.covers(p.field)})}else u=null,a=s.fieldTransforms;return new jp(new Dt(c),u,a)}var ds=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype._toFieldTransform=function(n){if(n.Nc!==2)throw n.Nc===1?n.Lc(this._methodName+"() can only appear at the top level of your update data"):n.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return n.fieldMask.push(n.path),null},t.prototype.isEqual=function(n){return n instanceof t},t}(De);function yh(e,t,n){return new gh({Nc:3,qc:t.settings.qc,methodName:e._methodName,Fc:n},t.databaseId,t.R,t.ignoreUndefinedProperties)}var Gp=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype._toFieldTransform=function(n){return new Kn(n.path,new He)},t.prototype.isEqual=function(n){return n instanceof t},t}(De),Qp=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=yh(this,n,!0),i=this.Kc.map(function(s){return Re(s,r)}),o=new Ee(i);return new Kn(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(De),$p=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=yh(this,n,!0),i=this.Kc.map(function(s){return Re(s,r)}),o=new Te(i);return new Kn(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(De),Hp=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Qc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=new ze(n.R,ca(n.R,this.Qc));return new Kn(n.path,r)},t.prototype.isEqual=function(n){return this===n},t}(De);function ps(e,t,n,r){var i=e.Uc(1,t,n);ys("Data must be an object, but it was:",i,r);var o=[],s=Dt.empty();me(r,function(a,c){var h=ms(t,a,n);c=W(c);var l=i.Oc(h);if(c instanceof ds)o.push(h);else{var f=Re(c,l);f!=null&&(o.push(h),s.set(h,f))}});var u=new Be(o);return new dh(s,u,i.fieldTransforms)}function gs(e,t,n,r,i,o){var s=e.Uc(1,t,n),u=[vs(t,r,n)],a=[i];if(o.length%2!=0)throw new w(g.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(vs(t,o[c])),a.push(o[c+1]);for(var h=[],l=Dt.empty(),f=u.length-1;f>=0;--f)if(!bh(h,u[f])){var d=u[f],p=a[f];p=W(p);var y=s.Oc(d);if(p instanceof ds)h.push(d);else{var E=Re(p,y);E!=null&&(h.push(d),l.set(d,E))}}var I=new Be(h);return new dh(l,I,s.fieldTransforms)}function vh(e,t,n,r){return r===void 0&&(r=!1),Re(n,e.Uc(r?4:3,t))}function Re(e,t){if(wh(e=W(e)))return ys("Unsupported field value:",t,e),mh(e,t);if(e instanceof De)return function(n,r){if(!ph(r.Nc))throw r.Lc(n._methodName+"() can only be used with update() and set()");if(!r.path)throw r.Lc(n._methodName+"() is not currently supported inside arrays");var i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&t.Nc!==4)throw t.Lc("Nested arrays are not supported");return function(n,r){for(var i=[],o=0,s=0,u=n;s<u.length;s++){var a=Re(u[s],r.Mc(o));a==null&&(a={nullValue:"NULL_VALUE"}),i.push(a),o++}return{arrayValue:{values:i}}}(e,t)}return function(n,r){if((n=W(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return ca(r.R,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){var i=Tt.fromDate(n);return{timestampValue:$n(r.R,i)}}if(n instanceof Tt)return i=new Tt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3)),{timestampValue:$n(r.R,i)};if(n instanceof fi)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ne)return{bytesValue:Ca(r.R,n._byteString)};if(n instanceof Q){i=r.databaseId;var o=n.firestore._databaseId;if(!o.isEqual(i))throw r.Lc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Ro(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.Lc("Unsupported field value: "+hi(n))}(e,t)}function mh(e,t){var n={};return Qu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):me(e,function(r,i){var o=Re(i,t.kc(r));o!=null&&(n[r]=o)}),{mapValue:{fields:n}}}function wh(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof Tt||e instanceof fi||e instanceof Ne||e instanceof Q||e instanceof De)}function ys(e,t,n){if(!wh(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){var r=hi(n);throw r==="an object"?t.Lc(e+" a custom object"):t.Lc(e+" "+r)}}function vs(e,t,n){if((t=W(t))instanceof jt)return t._internalPath;if(typeof t=="string")return ms(e,t);throw pi("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var zp=new RegExp("[~\\*/\\[\\]]");function ms(e,t,n){if(t.search(zp)>=0)throw pi("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,n);try{return new(jt.bind.apply(jt,z([void 0],t.split("."))))()._internalPath}catch{throw pi("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,n)}}function pi(e,t,n,r,i){var o=r&&!r.isEmpty(),s=i!==void 0,u="Function "+t+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new w(g.INVALID_ARGUMENT,(u+=". ")+e+a)}function bh(e,t){return e.some(function(n){return n.isEqual(t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nr=function(){function e(t,n,r,i,o){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new Q(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return this._document!==null},e.prototype.data=function(){if(this._document){if(this._converter){var t=new Wp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(t){if(this._document){var n=this._document.data.field(gi("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}},e}(),Wp=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}(nr);function gi(e,t){return typeof t=="string"?ms(e,t):t instanceof jt?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ke=function(){function e(t,n){this.hasPendingWrites=t,this.fromCache=n}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e}(),Wt=function(e){function t(n,r,i,o,s,u){var a=this;return(a=e.call(this,n,r,i,o,u)||this)._firestore=n,a._firestoreImpl=n,a.metadata=s,a}return R(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(n){if(n===void 0&&(n={}),this._document){if(this._converter){var r=new rr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}},t.prototype.get=function(n,r){if(r===void 0&&(r={}),this._document){var i=this._document.data.field(gi("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i,r.serverTimestamps)}},t}(nr),rr=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(n){return n===void 0&&(n={}),e.prototype.data.call(this,n)},t}(Wt),ae=function(){function e(t,n,r,i){this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new ke(i.hasPendingWrites,i.fromCache),this.query=r}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach(function(n){return t.push(n)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.size===0},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach(function(i){t.call(n,new rr(r._firestore,r._userDataWriter,i.key,i,new ke(r._snapshot.mutatedKeys.has(i.key),r._snapshot.fromCache),r.query.converter))})},e.prototype.docChanges=function(t){t===void 0&&(t={});var n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new w(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){var o=0;return r._snapshot.docChanges.map(function(u){return{type:"added",doc:new rr(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ke(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:o++}})}var s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(function(u){return i||u.type!==3}).map(function(u){var a=new rr(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ke(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),c=-1,h=-1;return u.type!==0&&(c=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),u.type!==1&&(h=(s=s.add(u.doc)).indexOf(u.doc.key)),{type:Yp(u.type),doc:a,oldIndex:c,newIndex:h}})}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges},e}();function Yp(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return A()}}function Eh(e,t){return e instanceof Wt&&t instanceof Wt?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(e._document===null?t._document===null:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof ae&&t instanceof ae&&e._firestore===t._firestore&&ch(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Th(e){if(jr(e)&&e.explicitOrderBy.length===0)throw new w(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ir=function(){};function ce(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=o._apply(e)}return e}var Xp=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).jc=n,o.Wc=r,o.Gc=i,o.type="where",o}return R(t,e),t.prototype._apply=function(n){var r=Ce(n.firestore),i=function(o,s,u,a,c,h,l){var f;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new w(g.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+h+"' queries on FieldPath.documentId().");if(h==="in"||h==="not-in"){Dh(l,h);for(var d=[],p=0,y=l;p<y.length;p++){var E=y[p];d.push(Nh(a,o,E))}f={arrayValue:{values:d}}}else f=Nh(a,o,l)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Dh(l,h),f=vh(u,"where",l,h==="in"||h==="not-in");var I=Ct.create(c,h,f);return function(D,C){if(C.g()){var L=To(D);if(L!==null&&!L.isEqual(C.field))throw new w(g.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+L.toString()+"' and '"+C.field.toString()+"'");var M=Eo(D);M!==null&&Ch(D,C.field,M)}var B=function(ot,bi){for(var yn=0,Ts=ot.filters;yn<Ts.length;yn++){var Is=Ts[yn];if(bi.indexOf(Is.op)>=0)return Is.op}return null}(D,function(ot){switch(ot){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(C.op));if(B!==null)throw B===C.op?new w(g.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+C.op.toString()+"' filter."):new w(g.INVALID_ARGUMENT,"Invalid query. You cannot use '"+C.op.toString()+"' filters with '"+B.toString()+"' filters.")}(o,I),I}(n._query,0,r,n.firestore._databaseId,this.jc,this.Wc,this.Gc);return new St(n.firestore,n.converter,function(o,s){var u=o.filters.concat([s]);return new Qt(o.path,o.collectionGroup,o.explicitOrderBy.slice(),u,o.limit,o.limitType,o.startAt,o.endAt)}(n._query,i))},t}(ir),Jp=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).jc=n,i.zc=r,i.type="orderBy",i}return R(t,e),t.prototype._apply=function(n){var r=function(i,o,s){if(i.startAt!==null)throw new w(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new w(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var u=new Ge(o,s);return function(a,c){if(Eo(a)===null){var h=To(a);h!==null&&Ch(a,h,c.field)}}(i,u),u}(n._query,this.jc,this.zc);return new St(n.firestore,n.converter,function(i,o){var s=i.explicitOrderBy.concat([o]);return new Qt(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(n._query,r))},t}(ir),Ih=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Hc=r,o.Jc=i,o}return R(t,e),t.prototype._apply=function(n){return new St(n.firestore,n.converter,ia(n._query,this.Hc,this.Jc))},t}(ir),_h=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return R(t,e),t.prototype._apply=function(n){var r=Ah(n,this.type,this.Yc,this.Xc);return new St(n.firestore,n.converter,function(i,o){return new Qt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)}(n._query,r))},t}(ir),Sh=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return R(t,e),t.prototype._apply=function(n){var r=Ah(n,this.type,this.Yc,this.Xc);return new St(n.firestore,n.converter,function(i,o){return new Qt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)}(n._query,r))},t}(ir);function Ah(e,t,n,r){if(n[0]=W(n[0]),n[0]instanceof nr)return function(o,s,u,a,c){if(!a)throw new w(g.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+u+"().");for(var h=[],l=0,f=$e(o);l<f.length;l++){var d=f[l];if(d.field.isKeyField())h.push(Mr(s,a.key));else{var p=a.data.field(d.field);if(yo(p))throw new w(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){var y=d.field.canonicalString();throw new w(g.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+y+"' (used as the orderBy) does not exist.")}h.push(p)}}return new qn(h,c)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Ce(e.firestore);return function(o,s,u,a,c,h){var l=o.explicitOrderBy;if(c.length>l.length)throw new w(g.INVALID_ARGUMENT,"Too many arguments provided to "+a+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var f=[],d=0;d<c.length;d++){var p=c[d];if(l[d].field.isKeyField()){if(typeof p!="string")throw new w(g.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+a+"(), but got a "+typeof p);if(!Io(o)&&p.indexOf("/")!==-1)throw new w(g.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+a+"() must be a plain document ID, but '"+p+"' contains a slash.");var y=o.path.child(V.fromString(p));if(!N.isDocumentKey(y))throw new w(g.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+a+"() must result in a valid document path, but '"+y+"' is not because it contains an odd number of segments.");var E=new N(y);f.push(Mr(s,E))}else{var I=vh(u,a,p);f.push(I)}}return new qn(f,h)}(e._query,e.firestore._databaseId,i,t,n,r)}function Nh(e,t,n){if(typeof(n=W(n))=="string"){if(n==="")throw new w(g.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Io(t)&&n.indexOf("/")!==-1)throw new w(g.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=t.path.child(V.fromString(n));if(!N.isDocumentKey(r))throw new w(g.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Mr(e,new N(r))}if(n instanceof Q)return Mr(e,n._key);throw new w(g.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+hi(n)+".")}function Dh(e,t){if(!Array.isArray(e)||e.length===0)throw new w(g.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new w(g.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ch(e,t,n){if(!n.isEqual(t))throw new w(g.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ws=function(){function e(){}return e.prototype.convertValue=function(t,n){switch(n===void 0&&(n="none"),be(t)){case 0:return null;case 1:return t.booleanValue;case 2:return J(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(je(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 10:return this.convertObject(t.mapValue,n);default:throw A()}},e.prototype.convertObject=function(t,n){var r=this,i={};return me(t.fields,function(o,s){i[o]=r.convertValue(s,n)}),i},e.prototype.convertGeoPoint=function(t){return new fi(J(t.latitude),J(t.longitude))},e.prototype.convertArray=function(t,n){var r=this;return(t.values||[]).map(function(i){return r.convertValue(i,n)})},e.prototype.convertServerTimestamp=function(t,n){switch(n){case"previous":var r=Hu(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Mn(t));default:return null}},e.prototype.convertTimestamp=function(t){var n=Jt(t);return new Tt(n.seconds,n.nanos)},e.prototype.convertDocumentKey=function(t,n){var r=V.fromString(t);k(ja(r));var i=new ci(r.get(1),r.get(3)),o=new N(r.popFirst(5));return i.isEqual(n)||X("Document "+o+" contains a document reference within a different database ("+i.projectId+"/"+i.database+") which is not supported. It will be treated as a reference in the current database ("+n.projectId+"/"+n.database+") instead."),o},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yi(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Zp=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new Ne(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new Q(this.firestore,null,r)},t}(ws),tg=function(){function e(t,n){this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Ce(t)}return e.prototype.set=function(t,n,r){this._verifyNotCommitted();var i=he(t,this._firestore),o=yi(i.converter,n,r),s=di(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(s.toMutation(i._key,dt.none())),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,u=he(t,this._firestore);return s=typeof(n=W(n))=="string"||n instanceof jt?gs(this._dataReader,"WriteBatch.update",u._key,n,r,i):ps(this._dataReader,"WriteBatch.update",u._key,n),this._mutations.push(s.toMutation(u._key,dt.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var n=he(t,this._firestore);return this._mutations=this._mutations.concat(new Qn(n._key,dt.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new w(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(e,t){if((e=W(e)).firestore!==t)throw new w(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xe=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new Ne(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new Q(this.firestore,null,r)},t}(ws);function Rh(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=U(e,Q);var o=U(e.firestore,H),s=Ce(o);return or(o,[(typeof(t=W(t))=="string"||t instanceof jt?gs(s,"updateDoc",e._key,t,n,r):ps(s,"updateDoc",e._key,t)).toMutation(e._key,dt.exists(!0))])}function kh(e){for(var t,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];e=W(e);var s={includeMetadataChanges:!1},u=0;typeof i[u]!="object"||gn(i[u])||(s=i[u],u++);var a,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(gn(i[u])){var f=i[u];i[u]=(t=f.next)===null||t===void 0?void 0:t.bind(f),i[u+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),i[u+2]=(r=f.complete)===null||r===void 0?void 0:r.bind(f)}if(e instanceof Q)c=U(e.firestore,H),h=Qe(e._key.path),a={next:function(y){i[u]&&i[u](bs(c,e,y))},error:i[u+1],complete:i[u+2]};else{var d=U(e,St);c=U(d.firestore,H),h=d._query;var p=new xe(c);a={next:function(y){i[u]&&i[u](new ae(c,p,d,y))},error:i[u+1],complete:i[u+2]},Th(e._query)}return function(y,E,I,D){var C=this,L=new ui(D),M=new Zo(E,L,I);return y.asyncQueue.enqueueAndForget(function(){return m(C,void 0,void 0,function(){var B;return v(this,function(ot){switch(ot.label){case 0:return B=Yo,[4,pn(y)];case 1:return[2,B.apply(void 0,[ot.sent(),M])]}})})}),function(){L.Wo(),y.asyncQueue.enqueueAndForget(function(){return m(C,void 0,void 0,function(){var B;return v(this,function(ot){switch(ot.label){case 0:return B=Xo,[4,pn(y)];case 1:return[2,B.apply(void 0,[ot.sent(),M])]}})})})}}(it(c),h,l,a)}function or(e,t){return function(n,r){var i=this,o=new yt;return n.asyncQueue.enqueueAndForget(function(){return m(i,void 0,void 0,function(){var s;return v(this,function(u){switch(u.label){case 0:return s=fp,[4,hs(n)];case 1:return[2,s.apply(void 0,[u.sent(),r,o])]}})})}),o.promise}(it(e),t)}function bs(e,t,n){var r=n.docs.get(t._key),i=new xe(e);return new Wt(e,i,t._key,r,new ke(n.hasPendingWrites,n.fromCache),t.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eg=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this)._firestore=n,i}return R(t,e),t.prototype.get=function(n){var r=this,i=he(n,this._firestore),o=new xe(this._firestore);return e.prototype.get.call(this,n).then(function(s){return new Wt(r._firestore,o,i._key,s._document,new ke(!1,!1),i.converter)})},t}(function(){function e(t,n){this._firestore=t,this._transaction=n,this._dataReader=Ce(t)}return e.prototype.get=function(t){var n=this,r=he(t,this._firestore),i=new Zp(this._firestore);return this._transaction.lookup([r._key]).then(function(o){if(!o||o.length!==1)return A();var s=o[0];if(s.isFoundDocument())return new nr(n._firestore,i,s.key,s,r.converter);if(s.isNoDocument())return new nr(n._firestore,i,r._key,null,r.converter);throw A()})},e.prototype.set=function(t,n,r){var i=he(t,this._firestore),o=yi(i.converter,n,r),s=di(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,r);return this._transaction.set(i._key,s),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,u=he(t,this._firestore);return s=typeof(n=W(n))=="string"||n instanceof jt?gs(this._dataReader,"Transaction.update",u._key,n,r,i):ps(this._dataReader,"Transaction.update",u._key,n),this._transaction.update(u._key,s),this},e.prototype.delete=function(t){var n=he(t,this._firestore);return this._transaction.delete(n._key),this},e}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xh(){if(typeof Uint8Array=="undefined")throw new w(g.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Oh(){if(typeof atob=="undefined")throw new w(g.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Lh=function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return Oh(),new e(Ne.fromBase64String(t))},e.fromUint8Array=function(t){return xh(),new e(Ne.fromUint8Array(t))},e.prototype.toBase64=function(){return Oh(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return xh(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),ng=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,n){return function(r,i){fh(r=U(r,H));var o=it(r),s=r._freezeSettings(),u=new us;return lh(o,u,new Qc(u,s.cacheSizeBytes,i==null?void 0:i.forceOwnership))}(t._delegate,{forceOwnership:n})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(n){fh(n=U(n,H));var r=it(n),i=n._freezeSettings(),o=new us;return lh(r,o,new Dp(o,i.cacheSizeBytes))}(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return function(n){var r=this;if(n._initialized&&!n._terminated)throw new w(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var i=new yt;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return m(r,void 0,void 0,function(){var o;return v(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,function(u){return m(this,void 0,void 0,function(){var a;return v(this,function(c){switch(c.label){case 0:return Ze.yt()?(a=u+"main",[4,Ze.delete(a)]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})}(Uo(n._databaseId,n._persistenceKey))];case 1:return s.sent(),i.resolve(),[3,3];case 2:return o=s.sent(),i.reject(o),[3,3];case 3:return[2]}})})}),i.promise}(t._delegate)},e}(),Ph=function(){function e(t,n,r){var i=this;this._delegate=n,this.Zc=r,this.INTERNAL={delete:function(){return i.terminate()}},t instanceof ci||(this.tu=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){var n=this._delegate._getSettings();t.merge||n.host===t.host||Pn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},n),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,n,r){r===void 0&&(r={}),function(i,o,s,u){var a;u===void 0&&(u={});var c=(i=U(i,er))._getSettings();if(c.host!=="firestore.googleapis.com"&&c.host!==o&&Pn("Host has been set in both settings() and useEmulator(), emulator host will be used"),i._setSettings(Object.assign(Object.assign({},c),{host:o+":"+s,ssl:!1})),u.mockUserToken){var h,l;if(typeof u.mockUserToken=="string")h=u.mockUserToken,l=lt.MOCK_USER;else{h=Qh(u.mockUserToken,(a=i._app)===null||a===void 0?void 0:a.options.projectId);var f=u.mockUserToken.sub||u.mockUserToken.user_id;if(!f)throw new w(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new lt(f)}i._credentials=new Lp(new th(h,l))}}(this._delegate,t,n,r)},e.prototype.enableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return[4,Wc(t)];case 1:return r=o.sent(),[4,Yc(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!0),function(s){var u=_(s);return u.Or.delete(0),Zn(u)}(i))]}})})})}(it(U(this._delegate,H)))},e.prototype.disableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return v(this,function(o){switch(o.label){case 0:return[4,Wc(t)];case 1:return r=o.sent(),[4,Yc(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!1),function(s){return m(this,void 0,void 0,function(){var u;return v(this,function(a){switch(a.label){case 0:return(u=_(s)).Or.add(0),[4,cn(u)];case 1:return a.sent(),u.Br.set("Offline"),[2]}})})}(i))]}})})})}(it(U(this._delegate,H)))},e.prototype.enablePersistence=function(t){var n=!1,r=!1;return t&&nh("synchronizeTabs",n=!!t.synchronizeTabs,"experimentalForceOwningTab",r=!!t.experimentalForceOwningTab),n?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,r)},e.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var n=this,r=new yt;return t.asyncQueue.enqueueAndForget(function(){return m(n,void 0,void 0,function(){var i;return v(this,function(o){switch(o.label){case 0:return i=yp,[4,hs(t)];case 1:return[2,i.apply(void 0,[o.sent(),r])]}})})}),r.promise}(it(U(this._delegate,H)))},e.prototype.onSnapshotsInSync=function(t){return function(n,r){return function(i,o){var s=this,u=new ui(o);return i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var a;return v(this,function(c){switch(c.label){case 0:return a=function(h,l){_(h).Gr.add(l),l.next()},[4,pn(i)];case 1:return[2,a.apply(void 0,[c.sent(),u])]}})})}),function(){u.Wo(),i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var a;return v(this,function(c){switch(c.label){case 0:return a=function(h,l){_(h).Gr.delete(l)},[4,pn(i)];case 1:return[2,a.apply(void 0,[c.sent(),u])]}})})})}}(it(n=U(n,H)),gn(r)?r:{next:r})}(this._delegate,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.tu)throw new w(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new wi(this,uh(this._delegate,t))}catch(n){throw Et(n,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new Oe(this,li(this._delegate,t))}catch(n){throw Et(n,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new ar(this,function(n,r){if(n=U(n,er),ls("collectionGroup","collection id",r),r.indexOf("/")>=0)throw new w(g.INVALID_ARGUMENT,"Invalid collection ID '"+r+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new St(n,null,function(i){return new Qt(V.emptyPath(),i)}(r))}(this._delegate,t))}catch(n){throw Et(n,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var n=this;return function(r,i){return function(o,s){var u=this,a=new yt;return o.asyncQueue.enqueueAndForget(function(){return m(u,void 0,void 0,function(){var c;return v(this,function(h){switch(h.label){case 0:return[4,function(l){return ai(l).then(function(f){return f.datastore})}(o)];case 1:return c=h.sent(),new kp(o.asyncQueue,c,s,a).run(),[2]}})})}),a.promise}(it(r),function(o){return i(new eg(r,o))})}(this._delegate,function(r){return t(new Mh(n,r))})},e.prototype.batch=function(){var t=this;return it(this._delegate),new Fh(new tg(this._delegate,function(n){return or(t._delegate,n)}))},e.prototype.loadBundle=function(t){throw new w(g.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new w(g.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),vi=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new Lh(new Ne(n))},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return Oe.eu(r,this.firestore,null)},t}(ws);function rg(e){var t;t=e,Pt.setLogLevel(t)}var Mh=function(){function e(t,n){this._firestore=t,this._delegate=n,this._userDataWriter=new vi(t)}return e.prototype.get=function(t){var n=this,r=Le(t);return this._delegate.get(r).then(function(i){return new sr(n._firestore,new Wt(n._firestore._delegate,n._userDataWriter,i._key,i._document,i.metadata,r.converter))})},e.prototype.set=function(t,n,r){var i=Le(t);return r?(fs("Transaction.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=Le(t);return arguments.length===2?this._delegate.update(u,n):(i=this._delegate).update.apply(i,z([u,n,r],o)),this},e.prototype.delete=function(t){var n=Le(t);return this._delegate.delete(n),this},e}(),Fh=function(){function e(t){this._delegate=t}return e.prototype.set=function(t,n,r){var i=Le(t);return r?(fs("WriteBatch.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=Le(t);return arguments.length===2?this._delegate.update(u,n):(i=this._delegate).update.apply(i,z([u,n,r],o)),this},e.prototype.delete=function(t){var n=Le(t);return this._delegate.delete(n),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),mi=function(){function e(t,n,r){this._firestore=t,this._userDataWriter=n,this._delegate=r}return e.prototype.fromFirestore=function(t,n){var r=new rr(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new ur(this._firestore,r),n!=null?n:{})},e.prototype.toFirestore=function(t,n){return n?this._delegate.toFirestore(t,n):this._delegate.toFirestore(t)},e.nu=function(t,n){var r=e.su,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new vi(t),n),i.set(n,o)),o},e}();mi.su=new WeakMap;var Oe=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new vi(t)}return e.iu=function(t,n,r){if(t.length%2!=0)throw new w(g.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(n,new Q(n._delegate,r,new N(t)))},e.eu=function(t,n,r){return new e(n,new Q(n._delegate,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new wi(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new wi(this.firestore,uh(this._delegate,t))}catch(n){throw Et(n,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=W(t))instanceof Q&&ah(this._delegate,t)},e.prototype.set=function(t,n){n=fs("DocumentReference.set",n);try{return function(r,i,o){r=U(r,Q);var s=U(r.firestore,H),u=yi(r.converter,i,o);return or(s,[di(Ce(s),"setDoc",r._key,u,r.converter!==null,o).toMutation(r._key,dt.none())])}(this._delegate,t,n)}catch(r){throw Et(r,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return arguments.length===1?Rh(this._delegate,t):Rh.apply(void 0,z([this._delegate,t,n],r))}catch(o){throw Et(o,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return or(U((t=this._delegate).firestore,H),[new Qn(t._key,dt.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Vh(n),o=Uh(n,function(s){return new sr(t.firestore,new Wt(t.firestore._delegate,t._userDataWriter,s._key,s._document,s.metadata,t._delegate.converter))});return kh(this._delegate,i,o)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=U(r,Q);var i=U(r.firestore,H),o=it(i),s=new xe(i);return function(u,a){var c=this,h=new yt;return u.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return v(this,function(f){switch(f.label){case 0:return l=function(d,p,y){return m(this,void 0,void 0,function(){var E,I;return v(this,function(D){switch(D.label){case 0:return D.trys.push([0,2,,3]),[4,function(C,L){var M=_(C);return M.persistence.runTransaction("read document","readonly",function(B){return M.Mn.mn(B,L)})}(d,p)];case 1:return(I=D.sent()).isFoundDocument()?y.resolve(I):I.isNoDocument()?y.resolve(null):y.reject(new w(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return E=D.sent(),I=fn(E,"Failed to get document '"+p+" from cache"),y.reject(I),[3,3];case 3:return[2]}})})},[4,cs(u)];case 1:return[2,l.apply(void 0,[f.sent(),a,h])]}})})}),h.promise}(o,r._key).then(function(u){return new Wt(i,s,r._key,u,new ke(u!==null&&u.hasLocalMutations,!0),r.converter)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=U(r,Q);var i=U(r.firestore,H);return Xc(it(i),r._key,{source:"server"}).then(function(o){return bs(i,r,o)})}(this._delegate):function(r){r=U(r,Q);var i=U(r.firestore,H);return Xc(it(i),r._key).then(function(o){return bs(i,r,o)})}(this._delegate)).then(function(r){return new sr(n.firestore,new Wt(n.firestore._delegate,n._userDataWriter,r._key,r._document,r.metadata,n._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(mi.nu(this.firestore,t)):this._delegate.withConverter(null))},e}();function Et(e,t,n){return e.message=e.message.replace(t,n),e}function Vh(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(typeof r=="object"&&!gn(r))return r}return{}}function Uh(e,t){var n,r,i;return{next:function(o){i.next&&i.next(t(o))},error:(n=(i=gn(e[0])?e[0]:gn(e[1])?e[1]:typeof e[0]=="function"?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)===null||n===void 0?void 0:n.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var sr=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"ref",{get:function(){return new Oe(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,n){return this._delegate.get(t,n)},e.prototype.isEqual=function(t){return Eh(this._delegate,t._delegate)},e}(),ur=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(n){return this._delegate.data(n)},t}(sr),ar=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new vi(t)}return e.prototype.where=function(t,n,r){try{return new e(this.firestore,ce(this._delegate,function(i,o,s){var u=o,a=gi("where",i);return new Xp(a,u,s)}(t,n,r)))}catch(i){throw Et(i,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,ce(this._delegate,function(r,i){i===void 0&&(i="asc");var o=i,s=gi("orderBy",r);return new Jp(s,o)}(t,n)))}catch(r){throw Et(r,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,ce(this._delegate,function(n){return oh("limit",n),new Ih("limit",n,"F")}(t)))}catch(n){throw Et(n,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,ce(this._delegate,function(n){return oh("limitToLast",n),new Ih("limitToLast",n,"L")}(t)))}catch(n){throw Et(n,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ce(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new _h("startAt",r,!0)}.apply(void 0,t)))}catch(r){throw Et(r,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ce(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new _h("startAfter",r,!1)}.apply(void 0,t)))}catch(r){throw Et(r,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ce(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Sh("endBefore",r,!0)}.apply(void 0,t)))}catch(r){throw Et(r,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,ce(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Sh("endAt",r,!1)}.apply(void 0,t)))}catch(r){throw Et(r,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return ch(this._delegate,t._delegate)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=U(r,St);var i=U(r.firestore,H),o=it(i),s=new xe(i);return function(u,a){var c=this,h=new yt;return u.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return v(this,function(f){switch(f.label){case 0:return l=function(d,p,y){return m(this,void 0,void 0,function(){var E,I,D,C,L;return v(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),[4,ni(d,p,!0)];case 1:return L=M.sent(),E=new Vc(p,L.Bn),I=E._o(L.documents),D=E.applyChanges(I,!1),y.resolve(D.snapshot),[3,3];case 2:return C=M.sent(),L=fn(C,"Failed to execute query '"+p+" against cache"),y.reject(L),[3,3];case 3:return[2]}})})},[4,cs(u)];case 1:return[2,l.apply(void 0,[f.sent(),a,h])]}})})}),h.promise}(o,r._query).then(function(u){return new ae(i,s,r,u)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=U(r,St);var i=U(r.firestore,H),o=it(i),s=new xe(i);return Jc(o,r._query,{source:"server"}).then(function(u){return new ae(i,s,r,u)})}(this._delegate):function(r){r=U(r,St);var i=U(r.firestore,H),o=it(i),s=new xe(i);return Th(r._query),Jc(o,r._query).then(function(u){return new ae(i,s,r,u)})}(this._delegate)).then(function(r){return new Es(n.firestore,new ae(n.firestore._delegate,n._userDataWriter,n._delegate,r._snapshot))})},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Vh(n),o=Uh(n,function(s){return new Es(t.firestore,new ae(t.firestore._delegate,t._userDataWriter,t._delegate,s._snapshot))});return kh(this._delegate,i,o)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(mi.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(),ig=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new ur(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),Es=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"query",{get:function(){return new ar(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(n){return new ur(t._firestore,n)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var n=this;return this._delegate.docChanges(t).map(function(r){return new ig(n._firestore,r)})},e.prototype.forEach=function(t,n){var r=this;this._delegate.forEach(function(i){t.call(n,new ur(r._firestore,i))})},e.prototype.isEqual=function(t){return Eh(this._delegate,t._delegate)},e}(),wi=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).firestore=n,i._delegate=r,i}return R(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._delegate.parent;return n?new Oe(this.firestore,n):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(n){try{return new Oe(this.firestore,n===void 0?li(this._delegate):li(this._delegate,n))}catch(r){throw Et(r,"doc()","CollectionReference.doc()")}},t.prototype.add=function(n){var r=this;return function(i,o){var s=U(i.firestore,H),u=li(i),a=yi(i.converter,o);return or(s,[di(Ce(i.firestore),"addDoc",u._key,a,i.converter!==null,{}).toMutation(u._key,dt.exists(!1))]).then(function(){return u})}(this._delegate,n).then(function(i){return new Oe(r.firestore,i)})},t.prototype.isEqual=function(n){return ah(this._delegate,n._delegate)},t.prototype.withConverter=function(n){return new t(this.firestore,n?this._delegate.withConverter(mi.nu(this.firestore,n)):this._delegate.withConverter(null))},t}(ar);function Le(e){return U(e,Q)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var og=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(jt.bind.apply(jt,z([void 0],t)))}return e.documentId=function(){return new e(Mt.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=W(t))instanceof jt&&this._delegate._internalPath.isEqual(t._internalPath)},e}(),sg=function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new Gp("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new ds("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new Qp("arrayUnion",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new $p("arrayRemove",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(r){return new Hp("increment",r)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(e){return function(t,n){var r=it(t=U(t,H)),i=new Up;return function(o,s,u,a){var c=this,h=function(l,f){return function(d,p){return new Cp(d,p)}(function(d,p){if(d instanceof Uint8Array)return $c(d,p);if(d instanceof ArrayBuffer)return $c(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(typeof l=="string"?new TextEncoder().encode(l):l),f)}(u,Jn(s));o.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return v(this,function(f){switch(f.label){case 0:return l=Np,[4,hs(o)];case 1:return l.apply(void 0,[f.sent(),h,a]),[2]}})})})}(r,t._databaseId,n,i),i}(this._delegate,e)}function fg(e){var t,n,r=this;return(t=this._delegate,n=e,function(i,o){var s=this;return i.asyncQueue.enqueue(function(){return m(s,void 0,void 0,function(){var u;return v(this,function(a){switch(a.label){case 0:return u=function(c,h){var l=_(c);return l.persistence.runTransaction("Get named query","readonly",function(f){return l.Ke.getNamedQuery(f,h)})},[4,cs(i)];case 1:return[2,u.apply(void 0,[a.sent(),o])]}})})})}(it(t=U(t,H)),n).then(function(i){return i?new St(t,null,i.query):null})).then(function(i){return i?new ar(r,i):null})}var ug=function(){function e(t,n,r){this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},e.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},e.prototype.setServiceProps=function(t){return this.serviceProps=t,this},e.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},e}(),ag={Firestore:Ph,GeoPoint:fi,Timestamp:Tt,Blob:Lh,Transaction:Mh,WriteBatch:Fh,DocumentReference:Oe,DocumentSnapshot:sr,Query:ar,QueryDocumentSnapshot:ur,QuerySnapshot:Es,CollectionReference:wi,FieldPath:og,FieldValue:sg,setLogLevel:rg,CACHE_SIZE_UNLIMITED:qp};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(e){(function(t,n){t.INTERNAL.registerComponent(new ug("firestore",function(r){var i=r.getProvider("app").getImmediate();return n(i,r.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},ag)))})(e,function(t,n){return new Ph(t,new H(t,n),new ng)}),e.registerVersion("@firebase/firestore","2.4.0")}cg(Bh);export{lg as K,fg as Q,Ph as _};
